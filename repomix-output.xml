This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitignore
backend/.env.example
backend/ipo-data-pipeline/scrapers/comprehensive_ipo_scraper.py
backend/ipo-data-pipeline/scrapers/core/base_scraper.py
backend/ipo-data-pipeline/scrapers/free_api_scraper.py
backend/ipo-data-pipeline/scrapers/ipo_scrapers/enhanced_gmp_scraper.py
backend/ipo-data-pipeline/scrapers/ipo_scrapers/subscription_scraper.py
backend/ipo-data-pipeline/scrapers/orchestrator.py
backend/ipo-data-pipeline/scrapers/web_scraper.py
backend/repomix-output.xml
backend/requirements.txt
backend/scheduler.py
backend/scrape_shareholder.py
backend/scraper.py
frontend/.env.example
frontend/app/allotment-calculator/components/BreakdownCards.tsx
frontend/app/allotment-calculator/components/InputForm.tsx
frontend/app/allotment-calculator/components/OracleCircle.tsx
frontend/app/allotment-calculator/components/ProbabilityGauge.tsx
frontend/app/allotment-calculator/components/ScenarioSimulator.tsx
frontend/app/allotment-calculator/lib/allotmentCalculator.ts
frontend/app/allotment-calculator/page.module.css
frontend/app/allotment-calculator/page.tsx
frontend/app/allotment/AllotmentClient.tsx
frontend/app/allotment/page.module.css
frontend/app/allotment/page.tsx
frontend/app/favicon.ico
frontend/app/globals.css
frontend/app/gmp/GMPClient.tsx
frontend/app/gmp/GMPModal.module.css
frontend/app/gmp/GMPModal.tsx
frontend/app/gmp/page.module.css
frontend/app/gmp/page.tsx
frontend/app/ipo/[slug]/IPOSchema.tsx
frontend/app/ipo/[slug]/layout.tsx
frontend/app/ipo/[slug]/page.module.css
frontend/app/ipo/[slug]/page.tsx
frontend/app/layout.tsx
frontend/app/page.module.css
frontend/app/page.tsx
frontend/app/portfolio-optimizer/components/AccountManager.tsx
frontend/app/portfolio-optimizer/components/CapitalInput.tsx
frontend/app/portfolio-optimizer/components/ComparisonTable.tsx
frontend/app/portfolio-optimizer/components/MultiAccountVisualizer.tsx
frontend/app/portfolio-optimizer/components/StrategyCard.tsx
frontend/app/portfolio-optimizer/page.module.css
frontend/app/portfolio-optimizer/page.tsx
frontend/app/portfolio-optimizer/PortfolioOptimizerClient.tsx
frontend/app/robots.ts
frontend/app/shareholders/page.module.css
frontend/app/shareholders/page.tsx
frontend/app/sitemap.ts
frontend/app/upcoming-ipos/page.module.css
frontend/app/upcoming-ipos/page.tsx
frontend/app/upcoming-ipos/UpcomingIPOsClient.tsx
frontend/components/GoldCard.tsx
frontend/components/homepage/ComparisonTable.module.css
frontend/components/homepage/ComparisonTable.tsx
frontend/components/homepage/DashboardTabs.module.css
frontend/components/homepage/DashboardTabs.tsx
frontend/components/homepage/FeaturedIPOCard.module.css
frontend/components/homepage/FeaturedIPOCard.tsx
frontend/components/homepage/IPOAnalysisTile.module.css
frontend/components/homepage/IPOAnalysisTile.tsx
frontend/components/homepage/IPOCalendarWidget.module.css
frontend/components/homepage/IPOCalendarWidget.tsx
frontend/components/homepage/IPOCategoryChart.module.css
frontend/components/homepage/IPOCategoryChart.tsx
frontend/components/homepage/IPOFilters.module.css
frontend/components/homepage/IPOFilters.tsx
frontend/components/homepage/MarketSentimentGauge.module.css
frontend/components/homepage/MarketSentimentGauge.tsx
frontend/components/homepage/QuickActionButtons.module.css
frontend/components/homepage/QuickActionButtons.tsx
frontend/components/homepage/ShouldIApplyCalculator.module.css
frontend/components/homepage/ShouldIApplyCalculator.tsx
frontend/components/homepage/SubscriptionHeatmap.module.css
frontend/components/homepage/SubscriptionHeatmap.tsx
frontend/components/IPOCard.module.css
frontend/components/IPOCard.tsx
frontend/components/IPOModal.module.css
frontend/components/IPOModal.tsx
frontend/components/Navbar.tsx
frontend/components/Navigation.module.css
frontend/components/Navigation.tsx
frontend/eslint.config.mjs
frontend/lib/api.ts
frontend/lib/portfolio/ipoDataFetcher.ts
frontend/lib/portfolio/multiAccountStrategy.ts
frontend/lib/portfolio/probabilityCalculator.ts
frontend/lib/portfolio/strategyGenerator.ts
frontend/lib/portfolio/types.ts
frontend/lib/supabase.ts
frontend/lib/utils.ts
frontend/next-env.d.ts
frontend/next.config.js
frontend/next.config.ts
frontend/package.json
frontend/postcss.config.mjs
frontend/public/file.svg
frontend/public/globe.svg
frontend/public/next.svg
frontend/public/vercel.svg
frontend/public/window.svg
frontend/README.md
frontend/repomix-output.xml
frontend/scripts/seed-data.sql
frontend/tsconfig.json
README.md
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="backend/.env.example">
# ===========================================
# IPO TRACKER - BACKEND ENVIRONMENT VARIABLES
# ===========================================
# Copy this file to .env and fill in your values:
#   cp .env.example .env

# --------------------------------------------
# SUPABASE CONFIGURATION (Required)
# Get these from: https://supabase.com/dashboard/project/YOUR_PROJECT/settings/api
# --------------------------------------------

# Your Supabase project URL
SUPABASE_URL=https://your-project-id.supabase.co

# Your Supabase service role key (SECRET - keep this private!)
# This key has full access to your database - never expose in frontend
SUPABASE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.your-service-role-key-here

# --------------------------------------------
# RAPIDAPI CONFIGURATION (For IPO Data Fetching)
# Get your API key from: https://rapidapi.com/
# Subscribe to: Indian IPOs API
# --------------------------------------------

RAPIDAPI_KEY=your-rapidapi-key-here

# --------------------------------------------
# OPTIONAL: SCRAPER CONFIGURATION
# --------------------------------------------

# Scraper user agent string
SCRAPER_USER_AGENT=Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/120.0.0.0 Safari/537.36

# Request timeout in seconds
REQUEST_TIMEOUT=30

# Enable debug logging
DEBUG=false

# --------------------------------------------
# OPTIONAL: SCHEDULER CONFIGURATION
# --------------------------------------------

# Interval for API fetching (in hours)
API_FETCH_INTERVAL_HOURS=6

# Interval for web scraping (in hours)
WEB_SCRAPE_INTERVAL_HOURS=3
</file>

<file path="frontend/.env.example">
# ===========================================
# IPO TRACKER - FRONTEND ENVIRONMENT VARIABLES
# ===========================================
# Copy this file to .env and fill in your values:
#   cp .env.example .env

# --------------------------------------------
# SUPABASE CONFIGURATION (Required)
# Get these from: https://supabase.com/dashboard/project/YOUR_PROJECT/settings/api
# --------------------------------------------

# Your Supabase project URL
NEXT_PUBLIC_SUPABASE_URL=https://your-project-id.supabase.co

# Your Supabase anonymous (public) key - safe to expose in frontend
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.your-anon-key-here

# --------------------------------------------
# OPTIONAL: APP CONFIGURATION
# --------------------------------------------

# Application URL (used for SEO and meta tags)
NEXT_PUBLIC_APP_URL=http://localhost:3000

# Enable/disable real-time subscriptions
NEXT_PUBLIC_ENABLE_REALTIME=true
</file>

<file path="frontend/app/allotment-calculator/components/BreakdownCards.tsx">
// BreakdownCards Component
'use client';

export default function BreakdownCards() {
    return <div>BreakdownCards</div>;
}
</file>

<file path="frontend/app/allotment-calculator/components/InputForm.tsx">
// InputForm Component
'use client';

export default function InputForm() {
    return <div>InputForm</div>;
}
</file>

<file path="frontend/app/allotment-calculator/components/OracleCircle.tsx">
// OracleCircle Component
'use client';

export default function OracleCircle() {
    return <div>OracleCircle</div>;
}
</file>

<file path="frontend/app/allotment-calculator/components/ProbabilityGauge.tsx">
// ProbabilityGauge Component
'use client';

export default function ProbabilityGauge() {
    return <div>ProbabilityGauge</div>;
}
</file>

<file path="frontend/app/allotment-calculator/components/ScenarioSimulator.tsx">
// ScenarioSimulator Component
'use client';

export default function ScenarioSimulator() {
    return <div>ScenarioSimulator</div>;
}
</file>

<file path="frontend/app/allotment-calculator/lib/allotmentCalculator.ts">
interface AllotmentInput {
    ipoName: string;
    totalShares: number;
    lotSize: number;
    pricePerShare: number;
    appliedLots: number;
    category: 'retail' | 'hni' | 'qib';
    oversubscription: number;
}

interface AllotmentResult {
    probability: number;
    expectedLots: number;
    expectedShares: number;
    expectedValue: number;
    factors: {
        oversubscriptionImpact: number;
        categoryImpact: number;
        lotSizeImpact: number;
    };
    recommendation: string;
}

function generateRecommendation(probability: number, input: AllotmentInput): string {
    if (probability >= 80) {
        return `High chance of allotment. Consider applying for ${input.appliedLots} lots.`;
    } else if (probability >= 50) {
        return `Moderate chance of allotment. The ${input.category} category has decent odds.`;
    } else if (probability >= 20) {
        return `Low chance of allotment due to ${input.oversubscription}x oversubscription. Consider applying with multiple accounts.`;
    } else {
        return `Very low chance of allotment. The IPO is heavily oversubscribed at ${input.oversubscription}x.`;
    }
}

function calculateAllotmentProbability(input: AllotmentInput): AllotmentResult {
    // Base probability formula
    const baseProbability = 100 / input.oversubscription;

    // Category modifiers
    const categoryMultiplier = {
        retail: 1.0,
        hni: 0.85,
        qib: 0.70
    }[input.category];

    // Lot size impact (applying for more lots can reduce probability)
    const lotImpact = Math.max(0.5, 1 - (input.appliedLots * 0.02));

    // Final probability
    const probability = Math.min(100,
        baseProbability * categoryMultiplier * lotImpact
    );

    // Expected allotment
    const expectedLots = Math.floor(
        (input.appliedLots * probability) / 100
    );

    return {
        probability: Math.round(probability * 100) / 100,
        expectedLots,
        expectedShares: expectedLots * input.lotSize,
        expectedValue: expectedLots * input.lotSize * input.pricePerShare,
        factors: {
            oversubscriptionImpact: (100 - baseProbability),
            categoryImpact: ((categoryMultiplier - 1) * 100),
            lotSizeImpact: ((lotImpact - 1) * 100)
        },
        recommendation: generateRecommendation(probability, input)
    };
}
</file>

<file path="frontend/app/allotment-calculator/page.module.css">
/* Allotment Calculator Styles */
.container {
    padding: 2rem;
}
</file>

<file path="frontend/app/allotment-calculator/page.tsx">
import type { Metadata } from 'next';

export const metadata: Metadata = {
    title: 'IPO Allotment Calculator - Check Your Allotment Probability',
    description: 'Calculate your IPO allotment probability based on subscription data and category. Understand your chances of getting allotment in retail, HNI, and QIB categories.',
    keywords: ['IPO allotment calculator', 'allotment probability', 'IPO lottery', 'IPO subscription', 'retail allotment', 'HNI allotment'],
    openGraph: {
        title: 'IPO Allotment Calculator - Check Your Allotment Probability',
        description: 'Calculate your IPO allotment probability based on subscription data and category.',
        type: 'website',
    },
    twitter: {
        card: 'summary_large_image',
        title: 'IPO Allotment Calculator - Check Your Allotment Probability',
        description: 'Calculate your IPO allotment probability based on subscription data.',
    },
};

export default function AllotmentCalculatorPage() {
    return (
        <div>
            <h1>Allotment Calculator</h1>
        </div>
    );
}
</file>

<file path="frontend/app/allotment/AllotmentClient.tsx">
'use client';

import { useEffect, useState } from 'react';
import styles from './page.module.css';
import { fetchAllotmentLinks } from '@/lib/api';

interface AllotmentData {
    id: number;
    ipo_name: string;
    registrar: string;
    link_url: string;
    allotment_date: string | null;
    status: string | null;
    category: string | null;
}

export default function AllotmentClient() {
    const [allotmentData, setAllotmentData] = useState<AllotmentData[]>([]);
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        const loadData = async () => {
            try {
                const data = await fetchAllotmentLinks();
                setAllotmentData(data);
            } catch (error) {
                console.error('Failed to load allotment data:', error);
            } finally {
                setLoading(false);
            }
        };

        loadData();
    }, []);

    const formatDate = (dateString: string | null) => {
        if (!dateString) return 'TBD';
        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    };

    if (loading) {
        return (
            <div className={styles.pageContainer}>
                <div className={styles.sectionHeader}>
                    <h1 className={styles.sectionTitle}>Check IPO Allotment</h1>
                    <p className={styles.sectionSubtitle}>Loading...</p>
                </div>
            </div>
        );
    }

    return (
        <div className={styles.pageContainer}>
            <div className={styles.sectionHeader}>
                <h1 className={styles.sectionTitle}>Check IPO Allotment</h1>
                <p className={styles.sectionSubtitle}>
                    Check your IPO allotment status directly from registrar websites
                </p>
            </div>

            <div className={styles.allotmentGrid}>
                {allotmentData.map((ipo) => (
                    <div key={ipo.id} className={styles.allotmentCard}>
                        <div className={styles.cardHeader}>
                            <div className={styles.titleRow}>
                                <h3 className={styles.companyName}>{ipo.ipo_name}</h3>
                                {ipo.category && (
                                    <span className={`${styles.categoryBadge} ${ipo.category === 'SME' ? styles.smeBadge : styles.mainboardBadge}`}>
                                        {ipo.category}
                                    </span>
                                )}
                            </div>
                            {ipo.status && (
                                <span className={`${styles.statusBadge} ${ipo.status === 'Allotment Out' ? styles.statusOut : styles.statusPending}`}>
                                    {ipo.status}
                                </span>
                            )}
                        </div>

                        <div className={styles.cardBody}>
                            <div className={styles.infoRow}>
                                <span className={styles.label}>Registrar:</span>
                                <span className={styles.value}>{ipo.registrar}</span>
                            </div>
                            <div className={styles.infoRow}>
                                <span className={styles.label}>Allotment Date:</span>
                                <span className={styles.value}>{formatDate(ipo.allotment_date)}</span>
                            </div>
                            <div className={styles.infoRow}>
                                <span className={styles.label}>Allotment Status:</span>
                                <span className={styles.value}>{ipo.status || 'Pending'}</span>
                            </div>
                        </div>

                        {ipo.status === 'Allotment Out' ? (
                            <a
                                href={ipo.link_url}
                                target="_blank"
                                rel="noopener noreferrer"
                                className={styles.checkButton}
                            >
                                Check Allotment Status
                                <span className={styles.externalIcon}>‚Üó</span>
                            </a>
                        ) : (
                            <div className={styles.checkButtonDisabled}>
                                Check Allotment Status
                                <span className={styles.externalIcon}>‚Üó</span>
                            </div>
                        )}
                    </div>
                ))}
            </div>

            {allotmentData.length === 0 && (
                <div className={styles.emptyState}>
                    <p>No allotment links available at the moment.</p>
                </div>
            )}
        </div>
    );
}
</file>

<file path="frontend/app/gmp/GMPClient.tsx">
'use client';

import { useState, useEffect } from 'react';
import styles from './page.module.css';
import GMPModal from './GMPModal';
import { fetchGMPData } from '@/lib/api';

interface DayWiseData {
    date: string;
    day: number;
    qibExAnchor?: number;
    nii?: number;
    bNII?: number;
    sNII?: number;
    retail: number;
    total: number;
}

interface SubscriptionData {
    anchorInvestors?: number;
    qibExAnchor?: number;
    nonInstitutional?: number;
    bNII?: number;
    sNII?: number;
    retail?: number;
    employee?: number;
    shareholder?: number;
    total?: number;
    dayWise?: DayWiseData[];
}

interface GMPData {
    id: number;
    ipo_name: string;
    company_name: string;
    category: string;
    gmp: number;
    percentage: number;
    issue_price: string;
    price: number;
    expected_listing: string;
    lot_size: string;
    listing_date: string;
    status: string;
    anchor_investors?: number;
    qib_ex_anchor?: number;
    non_institutional?: number;
    b_nii?: number;
    s_nii?: number;
    retail?: number;
    employee?: number;
    shareholder?: number;
    total_subscription?: number;
    day_wise_subscription?: DayWiseData[];
}

// Helper function to get status badge class
const getStatusClass = (status: string) => {
    switch (status) {
        case 'Issue Open': return styles.statusOpen;
        case 'Opening Soon': return styles.statusOpeningSoon;
        case 'Closed': return styles.statusClosed;
        default: return '';
    }
};

// Helper function to format date for display
const formatDisplayDate = (dateStr: string) => {
    if (!dateStr) return '';
    const date = new Date(dateStr);
    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
};

export default function GMPClient() {
    const [gmpData, setGmpData] = useState<GMPData[]>([]);
    const [loading, setLoading] = useState(true);
    const [selectedIPO, setSelectedIPO] = useState<GMPData | null>(null);

    useEffect(() => {
        const loadData = async () => {
            try {
                const data = await fetchGMPData();
                // Transform database fields to UI-expected fields
                const transformedData = data.map((ipo: any) => ({
                    id: ipo.id,
                    ipo_name: ipo.ipo_name,
                    company_name: ipo.company_name || ipo.ipo_name,
                    category: ipo.category || 'Mainboard',
                    gmp: ipo.gmp_amount || 0,
                    percentage: ipo.gmp_percentage || 0,
                    issue_price: ipo.max_price ? `‚Çπ${ipo.max_price}` : (ipo.price_range || '-'),
                    price: ipo.max_price || 0,
                    expected_listing: ipo.max_price && ipo.gmp_amount ? `‚Çπ${ipo.max_price + ipo.gmp_amount}` : '-',
                    lot_size: ipo.lot_size ? `${ipo.lot_size} shares` : '-',
                    listing_date: ipo.listing_date || '',
                    status: ipo.status === 'open' ? 'Issue Open' :
                        ipo.status === 'upcoming' ? 'Opening Soon' : 'Closed',
                    anchor_investors: ipo.anchor_investors,
                    qib_ex_anchor: ipo.subscription_qib,
                    non_institutional: ipo.subscription_nii,
                    b_nii: ipo.subscription_bnii,
                    s_nii: ipo.subscription_snii,
                    retail: ipo.subscription_retail,
                    employee: ipo.subscription_employee,
                    shareholder: ipo.subscription_shareholder,
                    total_subscription: ipo.subscription_total,
                    day_wise_subscription: ipo.day_wise_subscription
                }));
                setGmpData(transformedData);
            } catch (error) {
                console.error('Failed to load GMP data:', error);
            } finally {
                setLoading(false);
            }
        };

        loadData();
    }, []);

    // Sort IPOs by listing date (ascending - nearest first)
    const sortedData = [...gmpData].sort((a, b) =>
        new Date(a.listing_date).getTime() - new Date(b.listing_date).getTime()
    );

    // Group IPOs by category
    const mainboardIPOs = sortedData.filter(ipo => ipo.category === "Mainboard");
    const smeIPOs = sortedData.filter(ipo => ipo.category === "SME");

    const renderIPOCards = (ipos: GMPData[]) => (
        ipos.map((ipo) => (
            <div
                key={ipo.id}
                className={styles.gmpCard}
            >
                <div
                    className={styles.gmpHeader}
                    onClick={() => setSelectedIPO(ipo)}
                >
                    <div className={styles.headerTop}>
                        <h3 className={styles.gmpCompany}>{ipo.company_name || ipo.ipo_name}</h3>
                        <div className={styles.badgeStack}>
                            <span className={`${styles.categoryBadge} ${ipo.category === 'SME' ? styles.smeBadge : styles.mainboardBadge}`}>
                                {ipo.category}
                            </span>
                            <span className={`${styles.statusBadge} ${getStatusClass(ipo.status)}`}>
                                {ipo.status}
                            </span>
                        </div>
                    </div>
                    <div className={`${styles.gmpValue} ${ipo.gmp < 0 ? styles.negative : ''}`}>
                        ‚Çπ{ipo.gmp}
                    </div>
                    <p className={`${styles.gmpPercentage} ${ipo.percentage < 0 ? styles.lossText : styles.profitText}`}>
                        {ipo.percentage >= 0 ? '+' : ''}{ipo.percentage}% {ipo.percentage >= 0 ? 'Profit' : 'Loss'}
                    </p>
                </div>

                <div className={styles.gmpInfo}>
                    <div className={styles.infoItem}>
                        <span className={styles.infoLabel}>Issue Price</span>
                        <span className={styles.infoValue}>{ipo.issue_price}</span>
                    </div>
                    <div className={styles.infoItem}>
                        <span className={styles.infoLabel}>Expected</span>
                        <span className={styles.infoValue}>{ipo.expected_listing}</span>
                    </div>
                    <div className={styles.infoItem}>
                        <span className={styles.infoLabel}>Lot Size</span>
                        <span className={styles.infoValue}>{ipo.lot_size}</span>
                    </div>
                    <div className={styles.infoItem}>
                        <span className={styles.infoLabel}>Listing</span>
                        <span className={styles.infoValue}>{formatDisplayDate(ipo.listing_date)}</span>
                    </div>
                </div>
            </div>
        ))
    );

    if (loading) {
        return (
            <div className={styles.pageContainer}>
                <div className={styles.sectionHeader}>
                    <h1 className={styles.sectionTitle}>Grey Market Premium</h1>
                    <p className={styles.sectionSubtitle}>Loading GMP data...</p>
                </div>
            </div>
        );
    }

    return (
        <div className={styles.pageContainer}>
            <div className={styles.sectionHeader}>
                <h1 className={styles.sectionTitle}>Grey Market Premium</h1>
                <p className={styles.sectionSubtitle}>
                    Real-time GMP tracking and listing price predictions
                </p>
            </div>

            {/* Mainboard IPOs Section */}
            {mainboardIPOs.length > 0 && (
                <div className={styles.categorySection}>
                    <h2 className={styles.categoryTitle}>
                        <span className={styles.categoryIcon}>üìä</span>
                        Mainboard IPOs
                        <span className={styles.categoryCount}>({mainboardIPOs.length})</span>
                    </h2>
                    <div className={styles.gmpGrid}>
                        {renderIPOCards(mainboardIPOs)}
                    </div>
                </div>
            )}

            {/* SME IPOs Section */}
            {smeIPOs.length > 0 && (
                <div className={styles.categorySection}>
                    <h2 className={styles.categoryTitle}>
                        <span className={styles.categoryIcon}>üöÄ</span>
                        SME IPOs
                        <span className={styles.categoryCount}>({smeIPOs.length})</span>
                    </h2>
                    <div className={styles.gmpGrid}>
                        {renderIPOCards(smeIPOs)}
                    </div>
                </div>
            )}

            {gmpData.length === 0 && (
                <div className={styles.emptyState}>
                    <p>No GMP data available at the moment.</p>
                </div>
            )}

            {/* Modal */}
            {selectedIPO && (
                <GMPModal
                    ipo={{
                        ...selectedIPO,
                        companyName: selectedIPO.company_name || selectedIPO.ipo_name,
                        issuePrice: selectedIPO.issue_price,
                        expectedListing: selectedIPO.expected_listing,
                        lotSize: selectedIPO.lot_size,
                        listingDate: selectedIPO.listing_date,
                        subscription: {
                            anchorInvestors: selectedIPO.anchor_investors,
                            qibExAnchor: selectedIPO.qib_ex_anchor,
                            nonInstitutional: selectedIPO.non_institutional,
                            bNII: selectedIPO.b_nii,
                            sNII: selectedIPO.s_nii,
                            retail: selectedIPO.retail,
                            employee: selectedIPO.employee,
                            shareholder: selectedIPO.shareholder,
                            total: selectedIPO.total_subscription,
                            dayWise: selectedIPO.day_wise_subscription
                        }
                    }}
                    onClose={() => setSelectedIPO(null)}
                />
            )}
        </div>
    );
}
</file>

<file path="frontend/app/portfolio-optimizer/PortfolioOptimizerClient.tsx">
// portfolio-optimizer/page.tsx - SIMPLIFIED VERSION
// Just 2 questions: How many people? How much total money?

'use client';

import { useState, useEffect } from 'react';
import { fetchOpenIPOs } from '@/lib/portfolio/ipoDataFetcher';
import { generateMultiAccountStrategies } from '@/lib/portfolio/multiAccountStrategy';
import { generateAllStrategies } from '@/lib/portfolio/strategyGenerator';
import { IPO, UserPortfolio, ApplicationStrategy } from '@/lib/portfolio/types';
import styles from './page.module.css';

export default function PortfolioOptimizerClient() {
  const [openIPOs, setOpenIPOs] = useState<IPO[]>([]);
  const [loading, setLoading] = useState(true);
  const [calculating, setCalculating] = useState(false);

  // SIMPLIFIED USER INPUT
  const [totalCapital, setTotalCapital] = useState<number>(50000);
  const [numPeople, setNumPeople] = useState<number>(1);

  // Results
  const [strategies, setStrategies] = useState<ApplicationStrategy[]>([]);

  // Fetch open IPOs on mount
  useEffect(() => {
    loadOpenIPOs();
  }, []);

  async function loadOpenIPOs() {
    setLoading(true);
    const ipos = await fetchOpenIPOs();
    setOpenIPOs(ipos);
    setLoading(false);
  }

  // Generate strategies
  async function handleGenerateStrategies() {
    if (openIPOs.length === 0) {
      alert('No open IPOs available');
      return;
    }

    if (totalCapital < 10000) {
      alert('Please enter at least ‚Çπ10,000 capital');
      return;
    }

    if (numPeople < 1 || numPeople > 6) {
      alert('Please enter 1-6 people');
      return;
    }

    setCalculating(true);

    try {
      const userPortfolio: UserPortfolio = {
        totalCapital,
        numRetailAccounts: numPeople,
        hasHNICapability: false
      };

      // Generate strategies based on number of accounts
      if (numPeople > 1) {
        const multiStrats = await generateMultiAccountStrategies(userPortfolio, openIPOs);
        setStrategies(multiStrats);
      } else {
        const singleStrats = await generateAllStrategies(totalCapital, openIPOs);
        setStrategies(singleStrats.strategies);
      }
    } catch (error) {
      console.error('Error generating strategies:', error);
      alert('Error calculating strategies. Please try again.');
    } finally {
      setCalculating(false);
    }
  }

  // Quick preset buttons
  const quickPresets = [
    { label: '‚Çπ30K', value: 30000 },
    { label: '‚Çπ50K', value: 50000 },
    { label: '‚Çπ1L', value: 100000 },
    { label: '‚Çπ2.5L', value: 250000 },
    { label: '‚Çπ5L', value: 500000 },
  ];

  return (
    <div className={styles.container}>
      {/* Hero Header */}
      <header className={styles.header}>
        <h1>
          üíº IPO <span className={styles.gradientText}>Portfolio Optimizer</span>
        </h1>
        <p className={styles.headerSubtitle}>
          Get AI-powered strategies to maximize your IPO returns
        </p>
      </header>

      {/* IPO Status Badge */}
      <div style={{ textAlign: 'center' }}>
        <div className={styles.ipoStatus}>
          <span className={styles.statusDot}></span>
          {loading ? (
            <span>Loading open IPOs...</span>
          ) : (
            <span>
              <strong>{openIPOs.length} IPOs</strong> Currently Open
              ({openIPOs.filter(ipo => ipo.category === 'Mainboard').length} Mainboard,{' '}
              {openIPOs.filter(ipo => ipo.category === 'SME').length} SME)
            </span>
          )}
        </div>
      </div>

      {/* Input Section */}
      <div className={styles.inputSection}>
        <h2 className={styles.sectionTitle}>üéØ Let's Optimize Your Portfolio</h2>

        {/* Question 1: Total Capital */}
        <div className={styles.capitalSection}>
          <label className={styles.inputLabel}>
            üí∞ How much total capital do you have?
          </label>

          <div className={styles.presetButtons}>
            {quickPresets.map(preset => (
              <button
                key={preset.value}
                onClick={() => setTotalCapital(preset.value)}
                className={`${styles.presetBtn} ${totalCapital === preset.value ? styles.active : ''}`}
              >
                {preset.label}
              </button>
            ))}
          </div>

          <input
            type="number"
            value={totalCapital}
            onChange={(e) => setTotalCapital(Number(e.target.value))}
            placeholder="Enter amount"
            min={10000}
            step={10000}
            className={styles.capitalInput}
          />
          <p className={styles.inputHint}>
            Total amount you want to invest across all accounts
          </p>
        </div>

        {/* Question 2: Number of People */}
        <div className={styles.peopleSection}>
          <label className={styles.inputLabel}>
            üë• How many people can apply? (including family)
          </label>

          <div className={styles.peopleGrid}>
            {[1, 2, 3, 4, 5, 6].map(num => (
              <button
                key={num}
                onClick={() => setNumPeople(num)}
                className={`${styles.peopleBtn} ${numPeople === num ? styles.active : ''}`}
              >
                {num}
              </button>
            ))}
          </div>

          <p className={styles.inputHint}>
            Self, Parents, Spouse, Siblings - each needs separate Demat account
          </p>

          {numPeople > 1 && (
            <div className={styles.multiAccountTip}>
              <strong>üéØ Multi-Account Advantage:</strong> With {numPeople} accounts,
              your chances increase significantly! Capital will be auto-distributed
              optimally (max ‚Çπ2L per person).
            </div>
          )}
        </div>

        {/* Summary Stats */}
        <div className={styles.summaryCard}>
          <div className={styles.summaryGrid}>
            <div className={styles.summaryItem}>
              <div className={styles.summaryLabel}>Total Capital</div>
              <div className={styles.summaryValue}>‚Çπ{totalCapital.toLocaleString()}</div>
            </div>
            <div className={styles.summaryItem}>
              <div className={styles.summaryLabel}>Accounts</div>
              <div className={styles.summaryValue}>{numPeople}</div>
            </div>
            <div className={styles.summaryItem}>
              <div className={styles.summaryLabel}>Per Account</div>
              <div className={styles.summaryValue}>
                ‚Çπ{Math.min(Math.floor(totalCapital / numPeople), 200000).toLocaleString()}
              </div>
            </div>
          </div>
        </div>

        {/* Generate Button */}
        <button
          onClick={handleGenerateStrategies}
          disabled={calculating || loading}
          className={styles.generateButton}
        >
          {calculating ? 'üîÆ Calculating Optimal Strategies...' : '‚ú® Generate Strategies'}
        </button>
      </div>

      {/* Results Section */}
      {strategies.length > 0 && (
        <div className={styles.resultsSection}>
          <h2 className={styles.resultsTitle}>üìä Your Personalized Strategies</h2>

          {strategies.map((strategy, index) => (
            <div
              key={strategy.strategyId}
              className={`${styles.strategyCard} ${index === 0 ? styles.recommended : ''}`}
            >
              {index === 0 && (
                <div className={styles.recommendedBadge}>üèÜ RECOMMENDED</div>
              )}

              <h3 className={styles.strategyName}>{strategy.strategyName}</h3>
              <p className={styles.strategyDescription}>{strategy.description}</p>

              {/* Key Metrics */}
              <div className={styles.metricsGrid}>
                <div className={styles.metricItem}>
                  <div className={styles.metricLabel}>Investment</div>
                  <div className={styles.metricValue}>‚Çπ{strategy.totalCost.toLocaleString()}</div>
                </div>
                <div className={styles.metricItem}>
                  <div className={styles.metricLabel}>Expected Profit</div>
                  <div className={`${styles.metricValue} ${styles.profit}`}>
                    ‚Çπ{Math.round(strategy.expectedProfit).toLocaleString()}
                  </div>
                </div>
                <div className={styles.metricItem}>
                  <div className={styles.metricLabel}>Success Rate</div>
                  <div className={styles.metricValue}>{strategy.weightedProbability.toFixed(1)}%</div>
                </div>
                <div className={styles.metricItem}>
                  <div className={styles.metricLabel}>Risk Level</div>
                  <div className={`${styles.metricValue} ${styles[strategy.riskScore.toLowerCase()]}`}>
                    {strategy.riskScore === 'LOW' ? 'üü¢' : strategy.riskScore === 'MEDIUM' ? 'üü°' : 'üî¥'}
                    {' '}{strategy.riskScore}
                  </div>
                </div>
              </div>

              {/* Applications List */}
              <div className={styles.applicationsCard}>
                <div className={styles.applicationsTitle}>
                  üìã Applications ({strategy.applications.length}):
                </div>
                {strategy.applications.map((app, i) => (
                  <div key={i} className={styles.applicationItem}>
                    <div className={styles.appInfo}>
                      <div className={styles.appName}>{app.ipo.company_name}</div>
                      <div className={styles.appDetails}>
                        {app.category.toUpperCase()} ‚Ä¢ {app.numLots} lot(s) ‚Ä¢ ‚Çπ{app.totalCost.toLocaleString()}
                      </div>
                    </div>
                    <div className={styles.appProbability}>
                      <div className={styles.appProbValue}>{app.allotmentProbability.toFixed(1)}%</div>
                      <div className={styles.appProbLabel}>chance</div>
                    </div>
                  </div>
                ))}
              </div>

              {/* Recommendation */}
              <div className={styles.recommendationBox}>
                <strong>üí° Why This Works:</strong> {strategy.recommendation}
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );
}
</file>

<file path="frontend/app/robots.ts">
import { MetadataRoute } from 'next';

const BASE_URL = process.env.NEXT_PUBLIC_SITE_URL || 'https://ipotracker.in';

export default function robots(): MetadataRoute.Robots {
    return {
        rules: [
            {
                userAgent: '*',
                allow: '/',
                disallow: ['/api/', '/_next/', '/private/'],
            },
        ],
        sitemap: `${BASE_URL}/sitemap.xml`,
    };
}
</file>

<file path="frontend/app/sitemap.ts">
import { MetadataRoute } from 'next';

const BASE_URL = process.env.NEXT_PUBLIC_SITE_URL || 'https://ipotracker.in';

export default async function sitemap(): Promise<MetadataRoute.Sitemap> {
    // Static pages
    const staticPages: MetadataRoute.Sitemap = [
        {
            url: BASE_URL,
            lastModified: new Date(),
            changeFrequency: 'hourly',
            priority: 1.0,
        },
        {
            url: `${BASE_URL}/gmp`,
            lastModified: new Date(),
            changeFrequency: 'hourly',
            priority: 0.9,
        },
        {
            url: `${BASE_URL}/upcoming-ipos`,
            lastModified: new Date(),
            changeFrequency: 'hourly',
            priority: 0.9,
        },
        {
            url: `${BASE_URL}/allotment`,
            lastModified: new Date(),
            changeFrequency: 'daily',
            priority: 0.8,
        },
        {
            url: `${BASE_URL}/portfolio-optimizer`,
            lastModified: new Date(),
            changeFrequency: 'weekly',
            priority: 0.7,
        },
        {
            url: `${BASE_URL}/allotment-calculator`,
            lastModified: new Date(),
            changeFrequency: 'weekly',
            priority: 0.7,
        },
    ];

    // Dynamic IPO pages - fetch from API
    let ipoPages: MetadataRoute.Sitemap = [];

    try {
        const API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000';
        const response = await fetch(`${API_URL}/api/ipos/all`, {
            next: { revalidate: 3600 }, // Cache for 1 hour
        });

        if (response.ok) {
            const ipos = await response.json();
            ipoPages = ipos.map((ipo: { slug?: string; ipo_name?: string; updated_at?: string }) => {
                const slug = ipo.slug || ipo.ipo_name?.toLowerCase().replace(/\s+/g, '-') + '-ipo-gmp-allotment-subscription';
                return {
                    url: `${BASE_URL}/ipo/${slug}`,
                    lastModified: ipo.updated_at ? new Date(ipo.updated_at) : new Date(),
                    changeFrequency: 'daily' as const,
                    priority: 0.8,
                };
            });
        }
    } catch (error) {
        console.error('Error fetching IPOs for sitemap:', error);
    }

    return [...staticPages, ...ipoPages];
}
</file>

<file path="frontend/app/upcoming-ipos/UpcomingIPOsClient.tsx">
'use client';

import { useEffect, useState } from 'react';
import IPOCard from '@/components/IPOCard';
import styles from './page.module.css';
import { fetchCombinedIPOData } from '@/lib/api';

export default function UpcomingIPOsClient() {
    const [upcomingIPOs, setUpcomingIPOs] = useState<any[]>([]);
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        const loadData = async () => {
            try {
                const data = await fetchCombinedIPOData();
                setUpcomingIPOs(data);
            } catch (error) {
                console.error('Failed to load upcoming IPOs:', error);
            } finally {
                setLoading(false);
            }
        };

        loadData();
    }, []);

    if (loading) {
        return (
            <div className={styles.pageContainer}>
                <div className={styles.sectionHeader}>
                    <h1 className={styles.sectionTitle}>Upcoming IPOs</h1>
                    <p className={styles.sectionSubtitle}>Loading IPO data...</p>
                </div>
            </div>
        );
    }

    return (
        <div className={styles.pageContainer}>
            <div className={styles.sectionHeader}>
                <h1 className={styles.sectionTitle}>Upcoming IPOs</h1>
                <p className={styles.sectionSubtitle}>
                    Live tracking of all scheduled IPO launches with detailed information
                </p>
            </div>

            <div className={styles.ipoGrid}>
                {upcomingIPOs.map((ipo) => (
                    <IPOCard key={ipo.id} ipo={ipo} />
                ))}
            </div>

            {upcomingIPOs.length === 0 && (
                <div className={styles.emptyState}>
                    <p>No upcoming IPOs at the moment. Check back soon!</p>
                </div>
            )}
        </div>
    );
}
</file>

<file path="frontend/lib/portfolio/ipoDataFetcher.ts">
// ipoDataFetcher.ts - Fetch live IPO data from your Supabase

import { supabase } from '../supabase';
import { IPO } from './types';

/**
 * Fetch all currently open IPOs with live subscription and GMP data
 */
export async function fetchOpenIPOs(): Promise<IPO[]> {
    try {
        const { data, error } = await supabase
            .from('ipos')
            .select('*')
            .eq('status', 'open')
            .order('open_date', { ascending: false });

        if (error) {
            console.error('Error fetching IPOs:', error.message || error);
            return [];
        }

        if (!data || data.length === 0) {
            console.log('No open IPOs found');
            return [];
        }

        // Transform to IPO type with proper defaults
        return data.map(ipo => ({
            slug: ipo.slug || '',
            ipo_name: ipo.ipo_name || '',
            company_name: ipo.company_name || ipo.ipo_name || '',
            category: ipo.category || 'Mainboard',
            min_price: ipo.min_price || 0,
            max_price: ipo.max_price || 0,
            lot_size: ipo.lot_size || 1,
            issue_size_cr: ipo.issue_size_cr || 0,
            subscription_retail: ipo.subscription_retail || 0,
            subscription_nii: ipo.subscription_nii || 0,
            subscription_bnii: ipo.subscription_bnii || ipo.subscription_nii || 0,
            subscription_qib: ipo.subscription_qib || 0,
            subscription_total: ipo.subscription_total || 0,
            subscription_updated_at: ipo.subscription_updated_at,
            gmp_amount: ipo.gmp_amount || ipo.current_gmp || 0,
            gmp_percentage: ipo.gmp_percentage || ipo.expected_gain_percent || 0,
            expected_listing_price: ipo.expected_listing_price || (ipo.max_price + (ipo.gmp_amount || 0)),
            gmp_updated_at: ipo.gmp_updated_at,
            open_date: ipo.open_date || '',
            close_date: ipo.close_date || '',
            listing_date: ipo.listing_date,
            status: ipo.status || 'open',
            // Calculated defaults for lot limits
            retail_min_lots: 1,
            retail_max_lots: ipo.category === 'Mainboard' ? 13 : 10,
            shni_min_lots: 2,
            shni_max_lots: ipo.category === 'Mainboard' ? 14 : 20,
            bhni_min_lots: ipo.category === 'Mainboard' ? 10 : 5
        }));
    } catch (error) {
        console.error('Error in fetchOpenIPOs:', error);
        return [];
    }
}

/**
 * Fetch single IPO details
 */
export async function fetchIPODetails(slug: string): Promise<IPO | null> {
    try {
        const { data, error } = await supabase
            .from('ipos')
            .select('*')
            .eq('slug', slug)
            .single();

        if (error || !data) return null;

        return {
            ...data,
            subscription_retail: data.subscription_retail || 0,
            subscription_nii: data.subscription_nii || 0,
            subscription_bnii: data.subscription_bnii || 0,
            subscription_qib: data.subscription_qib || 0,
            subscription_total: data.subscription_total || 0,
            gmp_amount: data.gmp_amount || 0,
            gmp_percentage: data.gmp_percentage || 0
        };
    } catch (error) {
        console.error('Error fetching IPO details:', error);
        return null;
    }
}

/**
 * Subscribe to real-time subscription updates
 */
export function subscribeToIPOUpdates(
    callback: (payload: any) => void
) {
    return supabase
        .channel('ipo-updates')
        .on(
            'postgres_changes',
            {
                event: 'UPDATE',
                schema: 'public',
                table: 'ipos',
                filter: 'status=eq.open'
            },
            callback
        )
        .subscribe();
}
</file>

<file path="frontend/lib/portfolio/multiAccountStrategy.ts">
// multiAccountStrategy.ts - Strategy generator for multiple retail accounts (family portfolios)

import {
    IPO,
    ApplicationCategory,
    MarketType,
    Application,
    ApplicationStrategy,
    UserPortfolio,
    RetailAccount,
    MultiAccountApplication,
    RetailApplicationDetails
} from './types';

import {
    calculateAllotmentProbability,
    calculateExpectedProfit,
    calculateExpectedLots,
    getCategoryRequirements,
    calculateROI,
    calculateRiskScore,
    calculateWeightedProbability,
    canAfford,
    getOptimalLots,
    getSubscriptionForCategory,
    calculateMultiAccountProbability,
    calculateMultiAccountExpectedLots,
    validateRetailLimit
} from './probabilityCalculator';

/**
 * Helper: Generate retail accounts from user portfolio
 * Distributes capital evenly across accounts (max ‚Çπ2L per account for retail)
 */
function generateRetailAccounts(userPortfolio: UserPortfolio): { availableCapital: number; accountId: string }[] {
    const { totalCapital, numRetailAccounts } = userPortfolio;
    const maxRetailPerAccount = 200000; // ‚Çπ2L limit per retail account
    const capitalPerAccount = Math.min(maxRetailPerAccount, Math.floor(totalCapital / numRetailAccounts));

    return Array.from({ length: numRetailAccounts }, (_, i) => ({
        accountId: `account-${i + 1}`,
        availableCapital: capitalPerAccount
    }));
}

/**
 * Generate strategies optimized for users with multiple retail accounts
 * This is the GAME CHANGER - apply to same IPO with 4-6 different accounts!
 */
export async function generateMultiAccountStrategies(
    userPortfolio: UserPortfolio,
    openIPOs: IPO[]
): Promise<ApplicationStrategy[]> {
    const strategies: ApplicationStrategy[] = [];

    // Strategy 1: Max Retail Concentration (same IPO, multiple accounts)
    strategies.push(generateMaxRetailConcentration(userPortfolio, openIPOs));

    // Strategy 2: Diversified Multi-Account (different IPOs)
    strategies.push(generateDiversifiedMultiAccount(userPortfolio, openIPOs));

    // Strategy 3: Hybrid (some concentration + some diversification)
    strategies.push(generateHybridMultiAccount(userPortfolio, openIPOs));

    // Strategy 4: GMP-focused multi-account
    strategies.push(generateGMPMultiAccount(userPortfolio, openIPOs));

    // Strategy 5: If HNI capable, mix retail + HNI
    if (userPortfolio.hasHNICapability) {
        strategies.push(generateRetailPlusHNI(userPortfolio, openIPOs));
    }

    // Sort by expected value
    return strategies
        .filter(s => s.applications.length > 0)
        .sort((a, b) => calculateExpectedValue(a) - calculateExpectedValue(b))
        .reverse();
}

/**
 * Strategy 1: Apply to SAME high-probability IPO with ALL retail accounts
 * Example: 5 family members = 5 retail applications in ABC IPO
 */
function generateMaxRetailConcentration(
    userPortfolio: UserPortfolio,
    openIPOs: IPO[]
): ApplicationStrategy {
    const retailAccounts = generateRetailAccounts(userPortfolio);
    const applications: Application[] = [];

    // Find best IPO for retail (highest probability √ó GMP)
    const bestIPO = findBestRetailIPO(openIPOs);
    if (!bestIPO) {
        return createEmptyStrategy('max-retail-concentration');
    }

    const marketType = bestIPO.category.toLowerCase() as MarketType;
    const category: ApplicationCategory = 'retail';
    const requirements = getCategoryRequirements(bestIPO, category);
    const costPerLot = bestIPO.max_price * bestIPO.lot_size;

    // Apply with each retail account
    for (const account of retailAccounts) {
        const optimalLots = getOptimalLots(account.availableCapital, bestIPO, category);

        // Validate retail limit (‚Çπ2L per person)
        if (!validateRetailLimit(bestIPO, optimalLots)) {
            // Adjust to fit retail limit
            const maxLotsForLimit = Math.floor(200000 / costPerLot);
            const adjustedLots = Math.min(optimalLots, maxLotsForLimit);

            if (adjustedLots < requirements.minLots) continue; // Skip if can't meet minimum
        }

        const finalLots = Math.min(
            optimalLots,
            Math.floor(200000 / costPerLot) // Retail limit
        );

        if (canAfford(account.availableCapital, bestIPO, category, finalLots)) {
            const totalCost = costPerLot * finalLots;
            const probability = calculateAllotmentProbability(bestIPO, category, marketType);
            const expectedProfit = calculateExpectedProfit(bestIPO, category, finalLots, probability);

            applications.push({
                ipo: bestIPO,
                category,
                marketType,
                numLots: finalLots,
                costPerLot,
                totalCost,
                allotmentProbability: probability,
                expectedLots: calculateExpectedLots(finalLots, probability),
                profitPerLot: bestIPO.gmp_amount * bestIPO.lot_size,
                expectedProfit,
                subscription: getSubscriptionForCategory(bestIPO, category, marketType)
            });
        }
    }

    // Calculate combined probability
    if (applications.length > 0) {
        const singleProb = applications[0].allotmentProbability;
        const combinedProb = calculateMultiAccountProbability(singleProb, applications.length);

        return {
            strategyId: 'max-retail-concentration',
            strategyName: `üéØ ${applications.length}x Retail Power Play`,
            description: `Apply to ${bestIPO.company_name} with all ${applications.length} retail accounts. ${combinedProb.toFixed(1)}% chance of getting at least one allotment!`,
            totalCost: applications.reduce((sum, app) => sum + app.totalCost, 0),
            applications,
            expectedProfit: applications.reduce((sum, app) => sum + app.expectedProfit, 0),
            weightedProbability: combinedProb,
            riskScore: applications.length >= 4 ? 'LOW' : applications.length >= 2 ? 'MEDIUM' : 'HIGH',
            recommendation: `With ${applications.length} independent applications, you have a ${combinedProb.toFixed(1)}% chance of winning. Even if only 1-2 accounts get allotment, profit is ‚Çπ${(applications[0].expectedProfit * 2).toFixed(0)}+`,
            diversificationScore: 20 // Low diversification (single IPO)
        };
    }

    return createEmptyStrategy('max-retail-concentration');
}

/**
 * Strategy 2: Spread accounts across different IPOs
 * Example: Account 1 ‚Üí IPO A, Account 2 ‚Üí IPO B, etc.
 */
function generateDiversifiedMultiAccount(
    userPortfolio: UserPortfolio,
    openIPOs: IPO[]
): ApplicationStrategy {
    const retailAccounts = generateRetailAccounts(userPortfolio);
    const applications: Application[] = [];

    // Rank IPOs by score
    const rankedIPOs = rankIPOsForRetail(openIPOs);

    // Assign each account to best available IPO
    for (let i = 0; i < retailAccounts.length; i++) {
        const account = retailAccounts[i];
        const ipo = rankedIPOs[i % rankedIPOs.length]; // Cycle through IPOs if more accounts than IPOs

        if (!ipo) continue;

        const marketType = ipo.category.toLowerCase() as MarketType;
        const category: ApplicationCategory = 'retail';
        const optimalLots = getOptimalLots(account.availableCapital, ipo, category);
        const costPerLot = ipo.max_price * ipo.lot_size;
        const totalCost = costPerLot * optimalLots;

        if (canAfford(account.availableCapital, ipo, category, optimalLots)) {
            const probability = calculateAllotmentProbability(ipo, category, marketType);
            const expectedProfit = calculateExpectedProfit(ipo, category, optimalLots, probability);

            applications.push({
                ipo,
                category,
                marketType,
                numLots: optimalLots,
                costPerLot,
                totalCost,
                allotmentProbability: probability,
                expectedLots: calculateExpectedLots(optimalLots, probability),
                profitPerLot: ipo.gmp_amount * ipo.lot_size,
                expectedProfit,
                subscription: getSubscriptionForCategory(ipo, category, marketType)
            });
        }
    }

    const probabilities = applications.map(app => app.allotmentProbability);
    const weightedProb = calculateWeightedProbability(probabilities);
    const avgProb = probabilities.reduce((a, b) => a + b, 0) / probabilities.length || 0;

    return {
        strategyId: 'diversified-multi-account',
        strategyName: 'üåü Maximum Diversification',
        description: `Spread ${applications.length} retail accounts across top ${new Set(applications.map(a => a.ipo.slug)).size} IPOs for optimal risk distribution`,
        totalCost: applications.reduce((sum, app) => sum + app.totalCost, 0),
        applications,
        expectedProfit: applications.reduce((sum, app) => sum + app.expectedProfit, 0),
        weightedProbability: weightedProb,
        riskScore: calculateRiskScore(applications.length, avgProb, applications.reduce((sum, app) => sum + app.totalCost, 0)),
        recommendation: `Diversification across multiple IPOs reduces risk. ${weightedProb.toFixed(1)}% chance of getting at least one allotment.`,
        diversificationScore: Math.min(100, applications.length * 25)
    };
}

/**
 * Strategy 3: Hybrid - concentrate 2-3 accounts on best IPO, spread rest
 */
function generateHybridMultiAccount(
    userPortfolio: UserPortfolio,
    openIPOs: IPO[]
): ApplicationStrategy {
    const retailAccounts = generateRetailAccounts(userPortfolio);
    const applications: Application[] = [];

    if (retailAccounts.length < 2) {
        return createEmptyStrategy('hybrid-multi-account');
    }

    const rankedIPOs = rankIPOsForRetail(openIPOs);
    const bestIPO = rankedIPOs[0];

    if (!bestIPO) {
        return createEmptyStrategy('hybrid-multi-account');
    }

    // Allocate first 50% of accounts to best IPO
    const concentrateCount = Math.max(2, Math.floor(retailAccounts.length / 2));
    const marketType = bestIPO.category.toLowerCase() as MarketType;
    const category: ApplicationCategory = 'retail';

    // Concentrated applications
    for (let i = 0; i < concentrateCount; i++) {
        const account = retailAccounts[i];
        const optimalLots = getOptimalLots(account.availableCapital, bestIPO, category);
        const costPerLot = bestIPO.max_price * bestIPO.lot_size;
        const totalCost = costPerLot * optimalLots;

        if (canAfford(account.availableCapital, bestIPO, category, optimalLots)) {
            const probability = calculateAllotmentProbability(bestIPO, category, marketType);
            const expectedProfit = calculateExpectedProfit(bestIPO, category, optimalLots, probability);

            applications.push({
                ipo: bestIPO,
                category,
                marketType,
                numLots: optimalLots,
                costPerLot,
                totalCost,
                allotmentProbability: probability,
                expectedLots: calculateExpectedLots(optimalLots, probability),
                profitPerLot: bestIPO.gmp_amount * bestIPO.lot_size,
                expectedProfit,
                subscription: getSubscriptionForCategory(bestIPO, category, marketType)
            });
        }
    }

    // Diversified applications
    for (let i = concentrateCount; i < retailAccounts.length; i++) {
        const account = retailAccounts[i];
        const ipoIndex = (i - concentrateCount) % (rankedIPOs.length - 1);
        const ipo = rankedIPOs[ipoIndex + 1]; // Skip bestIPO (index 0)

        if (!ipo) continue;

        const ipoMarketType = ipo.category.toLowerCase() as MarketType;
        const optimalLots = getOptimalLots(account.availableCapital, ipo, category);
        const costPerLot = ipo.max_price * ipo.lot_size;
        const totalCost = costPerLot * optimalLots;

        if (canAfford(account.availableCapital, ipo, category, optimalLots)) {
            const probability = calculateAllotmentProbability(ipo, category, ipoMarketType);
            const expectedProfit = calculateExpectedProfit(ipo, category, optimalLots, probability);

            applications.push({
                ipo,
                category,
                marketType: ipoMarketType,
                numLots: optimalLots,
                costPerLot,
                totalCost,
                allotmentProbability: probability,
                expectedLots: calculateExpectedLots(optimalLots, probability),
                profitPerLot: ipo.gmp_amount * ipo.lot_size,
                expectedProfit,
                subscription: getSubscriptionForCategory(ipo, category, ipoMarketType)
            });
        }
    }

    const probabilities = applications.map(app => app.allotmentProbability);
    const weightedProb = calculateWeightedProbability(probabilities);
    const avgProb = probabilities.reduce((a, b) => a + b, 0) / probabilities.length || 0;

    return {
        strategyId: 'hybrid-multi-account',
        strategyName: '‚öñÔ∏è Hybrid Power Strategy',
        description: `Concentrate ${concentrateCount} accounts on ${bestIPO.company_name}, spread remaining across other top IPOs`,
        totalCost: applications.reduce((sum, app) => sum + app.totalCost, 0),
        applications,
        expectedProfit: applications.reduce((sum, app) => sum + app.expectedProfit, 0),
        weightedProbability: weightedProb,
        riskScore: calculateRiskScore(applications.length, avgProb, applications.reduce((sum, app) => sum + app.totalCost, 0)),
        recommendation: `Best of both worlds: High probability from concentration + safety from diversification`,
        diversificationScore: 50 // Medium diversification
    };
}

/**
 * Strategy 4: Apply all accounts to highest GMP IPO
 */
function generateGMPMultiAccount(
    userPortfolio: UserPortfolio,
    openIPOs: IPO[]
): ApplicationStrategy {
    const retailAccounts = generateRetailAccounts(userPortfolio);
    const applications: Application[] = [];

    // Find IPO with highest GMP
    const bestGMPIPO = [...openIPOs].sort((a, b) =>
        b.gmp_percentage - a.gmp_percentage
    )[0];

    if (!bestGMPIPO) {
        return createEmptyStrategy('gmp-multi-account');
    }

    const marketType = bestGMPIPO.category.toLowerCase() as MarketType;
    const category: ApplicationCategory = 'retail';

    for (const account of retailAccounts) {
        const optimalLots = getOptimalLots(account.availableCapital, bestGMPIPO, category);
        const costPerLot = bestGMPIPO.max_price * bestGMPIPO.lot_size;
        const totalCost = costPerLot * optimalLots;

        if (canAfford(account.availableCapital, bestGMPIPO, category, optimalLots)) {
            const probability = calculateAllotmentProbability(bestGMPIPO, category, marketType);
            const expectedProfit = calculateExpectedProfit(bestGMPIPO, category, optimalLots, probability);

            applications.push({
                ipo: bestGMPIPO,
                category,
                marketType,
                numLots: optimalLots,
                costPerLot,
                totalCost,
                allotmentProbability: probability,
                expectedLots: calculateExpectedLots(optimalLots, probability),
                profitPerLot: bestGMPIPO.gmp_amount * bestGMPIPO.lot_size,
                expectedProfit,
                subscription: getSubscriptionForCategory(bestGMPIPO, category, marketType)
            });
        }
    }

    const singleProb = applications.length > 0 ? applications[0].allotmentProbability : 0;
    const combinedProb = calculateMultiAccountProbability(singleProb, applications.length);

    return {
        strategyId: 'gmp-multi-account',
        strategyName: 'üöÄ GMP Maximizer',
        description: `All ${applications.length} accounts on ${bestGMPIPO.company_name} (${bestGMPIPO.gmp_percentage}% GMP) for maximum profit`,
        totalCost: applications.reduce((sum, app) => sum + app.totalCost, 0),
        applications,
        expectedProfit: applications.reduce((sum, app) => sum + app.expectedProfit, 0),
        weightedProbability: combinedProb,
        riskScore: singleProb > 50 ? 'MEDIUM' : 'HIGH',
        recommendation: `High-risk, high-reward play. Best GMP in market with ${combinedProb.toFixed(1)}% multi-account probability`,
        diversificationScore: 10 // Very low diversification
    };
}

/**
 * Strategy 5: Retail accounts + one HNI application (if capable)
 */
function generateRetailPlusHNI(
    userPortfolio: UserPortfolio,
    openIPOs: IPO[]
): ApplicationStrategy {
    const retailAccounts = generateRetailAccounts(userPortfolio);
    const { hniCapital } = userPortfolio;
    const applications: Application[] = [];

    if (!hniCapital || hniCapital < 200000) {
        return createEmptyStrategy('retail-plus-hni');
    }

    const rankedIPOs = rankIPOsForRetail(openIPOs);

    // Add retail applications (diversified)
    const retailIPOs = rankedIPOs.slice(0, Math.min(3, retailAccounts.length));

    for (let i = 0; i < retailAccounts.length && i < retailIPOs.length; i++) {
        const account = retailAccounts[i];
        const ipo = retailIPOs[i];
        const marketType = ipo.category.toLowerCase() as MarketType;
        const category: ApplicationCategory = 'retail';
        const optimalLots = getOptimalLots(account.availableCapital, ipo, category);
        const costPerLot = ipo.max_price * ipo.lot_size;
        const totalCost = costPerLot * optimalLots;

        if (canAfford(account.availableCapital, ipo, category, optimalLots)) {
            const probability = calculateAllotmentProbability(ipo, category, marketType);
            const expectedProfit = calculateExpectedProfit(ipo, category, optimalLots, probability);

            applications.push({
                ipo,
                category,
                marketType,
                numLots: optimalLots,
                costPerLot,
                totalCost,
                allotmentProbability: probability,
                expectedLots: calculateExpectedLots(optimalLots, probability),
                profitPerLot: ipo.gmp_amount * ipo.lot_size,
                expectedProfit,
                subscription: getSubscriptionForCategory(ipo, category, marketType)
            });
        }
    }

    // Add one HNI application
    const bestHNIIPO = findBestHNIIPO(openIPOs, hniCapital);
    if (bestHNIIPO) {
        const marketType = bestHNIIPO.category.toLowerCase() as MarketType;
        const hniCategory: ApplicationCategory = hniCapital >= 1000000 ? 'bhni' : 'shni';
        const optimalLots = getOptimalLots(hniCapital, bestHNIIPO, hniCategory);
        const costPerLot = bestHNIIPO.max_price * bestHNIIPO.lot_size;
        const totalCost = costPerLot * optimalLots;

        if (canAfford(hniCapital, bestHNIIPO, hniCategory, optimalLots)) {
            const probability = calculateAllotmentProbability(bestHNIIPO, hniCategory, marketType);
            const expectedProfit = calculateExpectedProfit(bestHNIIPO, hniCategory, optimalLots, probability);

            applications.push({
                ipo: bestHNIIPO,
                category: hniCategory,
                marketType,
                numLots: optimalLots,
                costPerLot,
                totalCost,
                allotmentProbability: probability,
                expectedLots: calculateExpectedLots(optimalLots, probability),
                profitPerLot: bestHNIIPO.gmp_amount * bestHNIIPO.lot_size,
                expectedProfit,
                subscription: getSubscriptionForCategory(bestHNIIPO, hniCategory, marketType)
            });
        }
    }

    const probabilities = applications.map(app => app.allotmentProbability);
    const weightedProb = calculateWeightedProbability(probabilities);
    const avgProb = probabilities.reduce((a, b) => a + b, 0) / probabilities.length || 0;

    return {
        strategyId: 'retail-plus-hni',
        strategyName: 'üíé Retail + HNI Combo',
        description: `${retailAccounts.length} retail applications + 1 HNI play for balanced high returns`,
        totalCost: applications.reduce((sum, app) => sum + app.totalCost, 0),
        applications,
        expectedProfit: applications.reduce((sum, app) => sum + app.expectedProfit, 0),
        weightedProbability: weightedProb,
        riskScore: calculateRiskScore(applications.length, avgProb, applications.reduce((sum, app) => sum + app.totalCost, 0)),
        recommendation: `Leverage both retail safety and HNI profit potential for optimal returns`,
        diversificationScore: 60
    };
}

/**
 * Helper: Find best IPO for retail applications
 */
function findBestRetailIPO(ipos: IPO[]): IPO | null {
    if (ipos.length === 0) return null;

    return [...ipos].sort((a, b) => {
        const marketTypeA = a.category.toLowerCase() as MarketType;
        const marketTypeB = b.category.toLowerCase() as MarketType;

        const probA = calculateAllotmentProbability(a, 'retail', marketTypeA);
        const probB = calculateAllotmentProbability(b, 'retail', marketTypeB);

        const scoreA = probA * a.gmp_percentage;
        const scoreB = probB * b.gmp_percentage;

        return scoreB - scoreA;
    })[0];
}

/**
 * Helper: Rank all IPOs for retail category
 */
function rankIPOsForRetail(ipos: IPO[]): IPO[] {
    return [...ipos].sort((a, b) => {
        const marketTypeA = a.category.toLowerCase() as MarketType;
        const marketTypeB = b.category.toLowerCase() as MarketType;

        const probA = calculateAllotmentProbability(a, 'retail', marketTypeA);
        const probB = calculateAllotmentProbability(b, 'retail', marketTypeB);

        const scoreA = (probA * 0.6) + (a.gmp_percentage * 0.4);
        const scoreB = (probB * 0.6) + (b.gmp_percentage * 0.4);

        return scoreB - scoreA;
    });
}

/**
 * Helper: Find best HNI IPO
 */
function findBestHNIIPO(ipos: IPO[], capital: number): IPO | null {
    const category: ApplicationCategory = capital >= 1000000 ? 'bhni' : 'shni';

    return [...ipos]
        .filter(ipo => {
            const requirements = getCategoryRequirements(ipo, category);
            return capital >= requirements.minInvestment;
        })
        .sort((a, b) => {
            const marketTypeA = a.category.toLowerCase() as MarketType;
            const marketTypeB = b.category.toLowerCase() as MarketType;

            const probA = calculateAllotmentProbability(a, category, marketTypeA);
            const probB = calculateAllotmentProbability(b, category, marketTypeB);

            const scoreA = probA * a.gmp_amount * a.lot_size;
            const scoreB = probB * b.gmp_amount * b.lot_size;

            return scoreB - scoreA;
        })[0] || null;
}

/**
 * Helper: Create empty strategy
 */
function createEmptyStrategy(id: string): ApplicationStrategy {
    return {
        strategyId: id,
        strategyName: 'No Strategy Available',
        description: 'Insufficient capital or no suitable IPOs',
        totalCost: 0,
        applications: [],
        expectedProfit: 0,
        weightedProbability: 0,
        riskScore: 'HIGH',
        recommendation: 'N/A',
        diversificationScore: 0
    };
}

/**
 * Calculate expected value with risk adjustment
 */
function calculateExpectedValue(strategy: ApplicationStrategy): number {
    const baseEV = strategy.expectedProfit;

    const riskMultiplier = {
        'LOW': 1.1,
        'MEDIUM': 1.0,
        'HIGH': 0.85
    }[strategy.riskScore];

    const diversificationBonus = strategy.diversificationScore / 500;

    return baseEV * riskMultiplier * (1 + diversificationBonus);
}
</file>

<file path="frontend/lib/portfolio/probabilityCalculator.ts">
// probabilityCalculator.ts - Core probability calculation logic

import { IPO, ApplicationCategory, MarketType, CategoryRequirements } from './types';

/**
 * Calculate allotment probability for a specific IPO category
 */
export function calculateAllotmentProbability(
    ipo: IPO,
    category: ApplicationCategory,
    marketType: MarketType
): number {
    const subscription = getSubscriptionForCategory(ipo, category, marketType);

    // If no subscription data or undersubscribed, assume 100% probability
    if (subscription === 0 || subscription === null) return 100;
    if (subscription < 1) return 100;

    // Base probability (inverse of subscription)
    let baseProbability = Math.min(100, (1 / subscription) * 100);

    // Category-specific multipliers based on historical allotment patterns
    const categoryMultipliers: Record<MarketType, Record<ApplicationCategory, number>> = {
        mainboard: {
            retail: 1.0,    // Retail gets standard allocation
            shni: 0.85,     // sHNI slightly lower due to higher competition
            bhni: 0.75      // bHNI much lower due to concentrated applications
        },
        sme: {
            retail: 1.15,   // SME retail often has better odds
            shni: 0.90,     // SME sHNI moderate
            bhni: 0.80      // SME bHNI competitive
        }
    };

    const multiplier = categoryMultipliers[marketType]?.[category] ?? 1.0;
    let probability = baseProbability * multiplier;

    // Oversubscription penalty (heavily oversubscribed = lower chance)
    if (subscription > 50) {
        probability *= 0.85; // Additional 15% reduction for super-hot IPOs
    } else if (subscription > 100) {
        probability *= 0.70; // 30% reduction for extremely oversubscribed
    }

    // Ensure probability is within bounds
    return Math.min(100, Math.max(0.1, probability));
}

/**
 * Get subscription rate for specific category
 */
export function getSubscriptionForCategory(
    ipo: IPO,
    category: ApplicationCategory,
    marketType: MarketType
): number {
    const subscriptionMap: Record<ApplicationCategory, number> = {
        retail: ipo.subscription_retail || 0,
        shni: ipo.subscription_nii || 0,  // NII = Non-Institutional Investors (sHNI)
        bhni: ipo.subscription_bnii || 0  // bNII = Big Non-Institutional Investors (bHNI)
    };

    return subscriptionMap[category];
}

/**
 * Calculate expected number of lots that will be allotted
 */
export function calculateExpectedLots(
    appliedLots: number,
    probability: number
): number {
    // In lottery system, probability applies per application
    // Expected lots = Applied lots √ó Probability
    return (appliedLots * probability) / 100;
}

/**
 * Calculate expected profit from an application
 */
export function calculateExpectedProfit(
    ipo: IPO,
    category: ApplicationCategory,
    appliedLots: number,
    probability: number
): number {
    const profitPerLot = ipo.gmp_amount * ipo.lot_size;
    const expectedLots = calculateExpectedLots(appliedLots, probability);
    return expectedLots * profitPerLot;
}

/**
 * Get minimum and maximum lot requirements for a category
 * Uses actual IPO data if available, otherwise defaults
 */
export function getCategoryRequirements(
    ipo: IPO,
    category: ApplicationCategory
): CategoryRequirements {
    const costPerLot = ipo.max_price * ipo.lot_size;
    const marketType = ipo.category.toLowerCase() as MarketType;

    // Try to use IPO-specific limits first
    if (category === 'retail') {
        const minLots = ipo.retail_min_lots ?? 1;
        const maxLots = ipo.retail_max_lots ?? (marketType === 'mainboard' ? 13 : 10);

        return {
            minLots,
            maxLots,
            minInvestment: costPerLot * minLots
        };
    }

    if (category === 'shni') {
        const minLots = ipo.shni_min_lots ?? 2;
        const maxLots = ipo.shni_max_lots ?? (marketType === 'mainboard' ? 14 : 20);

        return {
            minLots,
            maxLots,
            minInvestment: costPerLot * minLots
        };
    }

    if (category === 'bhni') {
        const minLots = ipo.bhni_min_lots ?? (marketType === 'mainboard' ? 10 : 5);
        const maxLots = 1000; // Usually no upper limit for bHNI

        return {
            minLots,
            maxLots,
            minInvestment: costPerLot * minLots
        };
    }

    // Fallback
    return {
        minLots: 1,
        maxLots: 10,
        minInvestment: costPerLot
    };
}

/**
 * Calculate ROI (Return on Investment) percentage
 */
export function calculateROI(
    expectedProfit: number,
    investment: number
): number {
    if (investment === 0) return 0;
    return (expectedProfit / investment) * 100;
}

/**
 * Calculate a composite score for ranking applications
 * Score = (Probability √ó Weight1) + (ROI √ó Weight2) + (GMP% √ó Weight3)
 */
export function calculateApplicationScore(
    probability: number,
    roi: number,
    gmpPercentage: number,
    preferProbability: boolean = true
): number {
    // If preferProbability is true, weight probability more heavily
    const weights = preferProbability
        ? { probability: 0.5, roi: 0.3, gmp: 0.2 }
        : { probability: 0.3, roi: 0.4, gmp: 0.3 };

    return (
        (probability * weights.probability) +
        (Math.min(roi, 100) * weights.roi) +  // Cap ROI at 100 for scoring
        (Math.min(gmpPercentage, 100) * weights.gmp)
    );
}

/**
 * Calculate risk score based on diversification and probability
 */
export function calculateRiskScore(
    numApplications: number,
    avgProbability: number,
    totalInvestment: number
): 'LOW' | 'MEDIUM' | 'HIGH' {
    let riskPoints = 0;

    // Factor 1: Diversification (more apps = lower risk)
    if (numApplications >= 4) riskPoints += 3;
    else if (numApplications >= 2) riskPoints += 2;
    else riskPoints += 0;

    // Factor 2: Average probability (higher = lower risk)
    if (avgProbability >= 70) riskPoints += 3;
    else if (avgProbability >= 50) riskPoints += 2;
    else if (avgProbability >= 30) riskPoints += 1;
    else riskPoints += 0;

    // Factor 3: Capital concentration (spreading = lower risk)
    const maxAppCost = totalInvestment / numApplications;
    if (maxAppCost < totalInvestment * 0.4) riskPoints += 2;
    else if (maxAppCost < totalInvestment * 0.6) riskPoints += 1;

    // Determine risk level
    if (riskPoints >= 7) return 'LOW';
    if (riskPoints >= 4) return 'MEDIUM';
    return 'HIGH';
}

/**
 * Calculate weighted probability across multiple applications
 * Accounts for the fact that getting at least one allocation is more likely
 */
export function calculateWeightedProbability(probabilities: number[]): number {
    if (probabilities.length === 0) return 0;
    if (probabilities.length === 1) return probabilities[0];

    // Calculate probability of getting at least one allotment
    // P(at least one) = 1 - P(none)
    // P(none) = (1-p1) √ó (1-p2) √ó ... √ó (1-pn)
    const probNone = probabilities.reduce(
        (product, prob) => product * (1 - prob / 100),
        1
    );

    return (1 - probNone) * 100;
}

/**
 * Determine if capital is sufficient for an application
 */
export function canAfford(
    capital: number,
    ipo: IPO,
    category: ApplicationCategory,
    numLots: number = 1
): boolean {
    const costPerLot = ipo.max_price * ipo.lot_size;
    const totalCost = costPerLot * numLots;
    const requirements = getCategoryRequirements(ipo, category);

    return (
        capital >= totalCost &&
        numLots >= requirements.minLots &&
        numLots <= requirements.maxLots
    );
}

/**
 * Get optimal number of lots for given capital and category
 */
export function getOptimalLots(
    availableCapital: number,
    ipo: IPO,
    category: ApplicationCategory
): number {
    const requirements = getCategoryRequirements(ipo, category);
    const costPerLot = ipo.max_price * ipo.lot_size;

    // Calculate max lots we can afford
    const maxAffordable = Math.floor(availableCapital / costPerLot);

    // Return the minimum of what we can afford and category limits
    return Math.max(
        requirements.minLots,
        Math.min(maxAffordable, requirements.maxLots)
    );
}

/**
 * Calculate combined probability when applying with multiple retail accounts
 * Each retail application is independent, so we calculate probability of getting at least one allotment
 */
export function calculateMultiAccountProbability(
    singleAccountProbability: number,
    numAccounts: number
): number {
    if (numAccounts === 1) return singleAccountProbability;

    // Probability of getting at least one allotment across N accounts
    // P(at least one) = 1 - P(none)
    // P(none) = (1 - p)^n
    const probNone = Math.pow(1 - (singleAccountProbability / 100), numAccounts);
    const probAtLeastOne = (1 - probNone) * 100;

    return Math.min(100, probAtLeastOne);
}

/**
 * Calculate expected lots across multiple retail accounts
 */
export function calculateMultiAccountExpectedLots(
    lotsPerAccount: number,
    probability: number,
    numAccounts: number
): number {
    // Each account applies independently
    // Expected total lots = sum of expected lots per account
    const expectedPerAccount = (lotsPerAccount * probability) / 100;
    return expectedPerAccount * numAccounts;
}

/**
 * Validate if retail limit is respected (max ‚Çπ2L per person typically)
 */
export function validateRetailLimit(
    ipo: IPO,
    numLots: number,
    retailLimitInr: number = 200000
): boolean {
    const totalCost = ipo.max_price * ipo.lot_size * numLots;
    return totalCost <= retailLimitInr;
}
</file>

<file path="frontend/lib/portfolio/strategyGenerator.ts">
// strategyGenerator.ts - Generate optimal IPO application strategies

import {
  IPO,
  ApplicationCategory,
  MarketType,
  Application,
  ApplicationStrategy,
  IPOAnalysis,
  CategoryAnalysis,
  StrategyComparison
} from './types';

import {
  calculateAllotmentProbability,
  calculateExpectedProfit,
  calculateExpectedLots,
  getCategoryRequirements,
  calculateROI,
  calculateApplicationScore,
  calculateRiskScore,
  calculateWeightedProbability,
  canAfford,
  getOptimalLots,
  getSubscriptionForCategory
} from './probabilityCalculator';

/**
 * Main function: Generate all possible strategies for given capital
 */
export async function generateAllStrategies(
  capital: number,
  openIPOs: IPO[]
): Promise<StrategyComparison> {
  // First, analyze all IPOs across all categories
  const ipoAnalyses = analyzeAllIPOs(openIPOs);

  // Generate different strategy types
  const strategies: ApplicationStrategy[] = [
    generateMaxRetailStrategy(capital, ipoAnalyses),
    generateConcentratedHNIStrategy(capital, ipoAnalyses),
    generateMixedStrategy(capital, ipoAnalyses),
    generateGMPFocusedStrategy(capital, ipoAnalyses),
    generateProbabilityMaxStrategy(capital, ipoAnalyses),
    generateBalancedStrategy(capital, ipoAnalyses)
  ].filter(s => s.applications.length > 0); // Remove empty strategies

  // Sort by expected value (expected profit adjusted for risk)
  const sorted = strategies.sort((a, b) => {
    const evA = calculateExpectedValue(a);
    const evB = calculateExpectedValue(b);
    return evB - evA;
  });

  return {
    strategies: sorted,
    bestForProfit: sorted.reduce((best, s) =>
      s.expectedProfit > best.expectedProfit ? s : best
    ),
    bestForProbability: sorted.reduce((best, s) =>
      s.weightedProbability > best.weightedProbability ? s : best
    ),
    bestForRisk: sorted.find(s => s.riskScore === 'LOW') || sorted[0],
    recommended: sorted[0]
  };
}

/**
 * Analyze all IPOs across all applicable categories
 */
function analyzeAllIPOs(ipos: IPO[]): IPOAnalysis[] {
  return ipos.map(ipo => {
    const marketType = ipo.category.toLowerCase() as MarketType;
    const categories = ['retail', 'shni', 'bhni'] as ApplicationCategory[];

    const categoryAnalyses: any = {};

    for (const category of categories) {
      const requirements = getCategoryRequirements(ipo, category);
      const subscription = getSubscriptionForCategory(ipo, category, marketType);
      const probability = calculateAllotmentProbability(ipo, category, marketType);
      const expectedLots = calculateExpectedLots(requirements.minLots, probability);
      const profitPerLot = ipo.gmp_amount * ipo.lot_size;
      const expectedProfit = calculateExpectedProfit(ipo, category, requirements.minLots, probability);
      const roi = calculateROI(expectedProfit, requirements.minInvestment);
      const score = calculateApplicationScore(probability, roi, ipo.gmp_percentage);

      categoryAnalyses[category] = {
        category,
        marketType,
        minInvestment: requirements.minInvestment,
        maxInvestment: requirements.minInvestment * requirements.maxLots,
        requiredLots: requirements.minLots,
        subscription,
        allotmentProbability: probability,
        expectedLots,
        profitPerLot,
        expectedProfit,
        roi,
        score
      } as CategoryAnalysis;
    }

    // Calculate overall score (average of category scores)
    const overallScore = Object.values(categoryAnalyses)
      .reduce((sum: number, cat: any) => sum + cat.score, 0) / 3;

    return {
      ipo,
      categories: categoryAnalyses,
      overallScore,
      recommendation: generateIPORecommendation(ipo, categoryAnalyses)
    };
  });
}

/**
 * Strategy 1: Maximum Retail Applications (Diversification Focus)
 */
function generateMaxRetailStrategy(
  capital: number,
  analyses: IPOAnalysis[]
): ApplicationStrategy {
  const applications: Application[] = [];
  let remainingCapital = capital;

  // Sort by retail category score
  const sorted = [...analyses].sort((a, b) =>
    b.categories.retail.score - a.categories.retail.score
  );

  for (const analysis of sorted) {
    const { ipo, categories } = analysis;
    const category = 'retail';
    const marketType = ipo.category.toLowerCase() as MarketType;
    const catAnalysis = categories[category];

    if (canAfford(remainingCapital, ipo, category, catAnalysis.requiredLots)) {
      applications.push(createApplication(ipo, category, marketType, catAnalysis));
      remainingCapital -= catAnalysis.minInvestment;
    }
  }

  return createStrategy(
    'max-retail',
    'üéØ Maximum Retail Diversification',
    'Apply to as many IPOs as possible in retail category for maximum diversification and high success probability',
    capital,
    applications
  );
}

/**
 * Strategy 2: Concentrated HNI (High Profit Potential)
 */
function generateConcentratedHNIStrategy(
  capital: number,
  analyses: IPOAnalysis[]
): ApplicationStrategy {
  const applications: Application[] = [];
  let remainingCapital = capital;

  // Find best HNI opportunity (bhni or shni based on capital)
  const iposByHNIScore = [...analyses].sort((a, b) => {
    const scoreA = Math.max(a.categories.shni.score, a.categories.bhni.score);
    const scoreB = Math.max(b.categories.shni.score, b.categories.bhni.score);
    return scoreB - scoreA;
  });

  for (const analysis of iposByHNIScore) {
    const { ipo, categories } = analysis;
    const marketType = ipo.category.toLowerCase() as MarketType;

    // Try bHNI first, fall back to sHNI
    const preferredCategories: ApplicationCategory[] = ['bhni', 'shni'];

    for (const category of preferredCategories) {
      const catAnalysis = categories[category];
      const optimalLots = getOptimalLots(remainingCapital, ipo, category);

      if (canAfford(remainingCapital, ipo, category, optimalLots)) {
        const costPerLot = ipo.max_price * ipo.lot_size;
        const totalCost = costPerLot * optimalLots;
        const probability = calculateAllotmentProbability(ipo, category, marketType);
        const expectedProfit = calculateExpectedProfit(ipo, category, optimalLots, probability);

        applications.push({
          ipo,
          category,
          marketType,
          numLots: optimalLots,
          costPerLot,
          totalCost,
          allotmentProbability: probability,
          expectedLots: calculateExpectedLots(optimalLots, probability),
          profitPerLot: ipo.gmp_amount * ipo.lot_size,
          expectedProfit,
          subscription: getSubscriptionForCategory(ipo, category, marketType)
        });

        remainingCapital -= totalCost;
        break; // Only one HNI application
      }
    }

    if (applications.length > 0) break; // Found our concentrated pick
  }

  return createStrategy(
    'concentrated-hni',
    'üíé Concentrated HNI Power Play',
    'Single high-value application in HNI category for maximum lot allocation potential',
    capital,
    applications
  );
}

/**
 * Strategy 3: Mixed Approach (Balance)
 */
function generateMixedStrategy(
  capital: number,
  analyses: IPOAnalysis[]
): ApplicationStrategy {
  const applications: Application[] = [];
  let remainingCapital = capital;

  // Allocate to top retail IPOs first (60% of capital)
  const retailBudget = capital * 0.6;
  const hniBudget = capital * 0.4;

  // Get top 2-3 retail applications
  const topRetail = [...analyses]
    .sort((a, b) => b.categories.retail.score - a.categories.retail.score)
    .slice(0, 3);

  for (const analysis of topRetail) {
    const { ipo, categories } = analysis;
    const category = 'retail';
    const marketType = ipo.category.toLowerCase() as MarketType;
    const catAnalysis = categories[category];

    if (canAfford(remainingCapital, ipo, category, catAnalysis.requiredLots) &&
      catAnalysis.minInvestment <= retailBudget) {
      applications.push(createApplication(ipo, category, marketType, catAnalysis));
      remainingCapital -= catAnalysis.minInvestment;
    }
  }

  // Add one HNI application if budget allows
  const topHNI = [...analyses]
    .sort((a, b) => {
      const scoreA = Math.max(a.categories.shni.score, a.categories.bhni.score);
      const scoreB = Math.max(b.categories.shni.score, b.categories.bhni.score);
      return scoreB - scoreA;
    })
    .slice(0, 2);

  for (const analysis of topHNI) {
    const { ipo, categories } = analysis;
    const marketType = ipo.category.toLowerCase() as MarketType;

    // Try sHNI (more likely to fit budget)
    const category: ApplicationCategory = 'shni';
    const catAnalysis = categories[category];
    const optimalLots = getOptimalLots(remainingCapital, ipo, category);

    if (canAfford(remainingCapital, ipo, category, optimalLots)) {
      const costPerLot = ipo.max_price * ipo.lot_size;
      const totalCost = costPerLot * optimalLots;
      const probability = calculateAllotmentProbability(ipo, category, marketType);
      const expectedProfit = calculateExpectedProfit(ipo, category, optimalLots, probability);

      applications.push({
        ipo,
        category,
        marketType,
        numLots: optimalLots,
        costPerLot,
        totalCost,
        allotmentProbability: probability,
        expectedLots: calculateExpectedLots(optimalLots, probability),
        profitPerLot: ipo.gmp_amount * ipo.lot_size,
        expectedProfit,
        subscription: getSubscriptionForCategory(ipo, category, marketType)
      });

      remainingCapital -= totalCost;
      break;
    }
  }

  return createStrategy(
    'mixed',
    '‚öñÔ∏è Balanced Mixed Approach',
    'Combination of retail applications for safety and one HNI play for higher returns',
    capital,
    applications
  );
}

/**
 * Strategy 4: GMP-Focused (Profit Maximization)
 */
function generateGMPFocusedStrategy(
  capital: number,
  analyses: IPOAnalysis[]
): ApplicationStrategy {
  const applications: Application[] = [];
  let remainingCapital = capital;

  // Sort by GMP percentage
  const byGMP = [...analyses].sort((a, b) =>
    b.ipo.gmp_percentage - a.ipo.gmp_percentage
  );

  // Pick best GMP IPOs across any category
  for (const analysis of byGMP) {
    const { ipo, categories } = analysis;
    const marketType = ipo.category.toLowerCase() as MarketType;

    // Find best category for this IPO (highest expected profit)
    const bestCategory = (['retail', 'shni', 'bhni'] as ApplicationCategory[])
      .map(cat => ({ category: cat, analysis: categories[cat] }))
      .sort((a, b) => b.analysis.expectedProfit - a.analysis.expectedProfit)[0];

    const category = bestCategory.category;
    const catAnalysis = bestCategory.analysis;
    const optimalLots = getOptimalLots(remainingCapital, ipo, category);

    if (canAfford(remainingCapital, ipo, category, optimalLots)) {
      const costPerLot = ipo.max_price * ipo.lot_size;
      const totalCost = costPerLot * optimalLots;
      const probability = calculateAllotmentProbability(ipo, category, marketType);
      const expectedProfit = calculateExpectedProfit(ipo, category, optimalLots, probability);

      applications.push({
        ipo,
        category,
        marketType,
        numLots: optimalLots,
        costPerLot,
        totalCost,
        allotmentProbability: probability,
        expectedLots: calculateExpectedLots(optimalLots, probability),
        profitPerLot: ipo.gmp_amount * ipo.lot_size,
        expectedProfit,
        subscription: getSubscriptionForCategory(ipo, category, marketType)
      });

      remainingCapital -= totalCost;
    }
  }

  return createStrategy(
    'gmp-focused',
    'üöÄ GMP Chaser Strategy',
    'Target IPOs with highest grey market premium for maximum profit potential (higher risk)',
    capital,
    applications
  );
}

/**
 * Strategy 5: Probability Maximization (Safety First)
 */
function generateProbabilityMaxStrategy(
  capital: number,
  analyses: IPOAnalysis[]
): ApplicationStrategy {
  const applications: Application[] = [];
  let remainingCapital = capital;

  // Sort by probability (retail category usually has best odds)
  const byProbability = [...analyses]
    .map(a => ({
      analysis: a,
      maxProbability: Math.max(
        a.categories.retail.allotmentProbability,
        a.categories.shni.allotmentProbability,
        a.categories.bhni.allotmentProbability
      )
    }))
    .sort((a, b) => b.maxProbability - a.maxProbability);

  for (const { analysis } of byProbability) {
    const { ipo, categories } = analysis;
    const marketType = ipo.category.toLowerCase() as MarketType;

    // Find category with highest probability
    const bestCategory = (['retail', 'shni', 'bhni'] as ApplicationCategory[])
      .map(cat => ({ category: cat, probability: categories[cat].allotmentProbability }))
      .sort((a, b) => b.probability - a.probability)[0];

    const category = bestCategory.category;
    const catAnalysis = categories[category];

    if (canAfford(remainingCapital, ipo, category, catAnalysis.requiredLots)) {
      applications.push(createApplication(ipo, category, marketType, catAnalysis));
      remainingCapital -= catAnalysis.minInvestment;
    }
  }

  return createStrategy(
    'probability-max',
    'üéØ Maximum Probability Strategy',
    'Focus on IPOs with highest allotment probability for assured returns (conservative)',
    capital,
    applications
  );
}

/**
 * Strategy 6: Balanced Optimal (AI Recommendation)
 */
function generateBalancedStrategy(
  capital: number,
  analyses: IPOAnalysis[]
): ApplicationStrategy {
  const applications: Application[] = [];
  let remainingCapital = capital;

  // Use composite scoring (probability + profit + diversification)
  const scored = analyses.map(analysis => ({
    analysis,
    compositeScore: calculateCompositeScore(analysis)
  })).sort((a, b) => b.compositeScore - a.compositeScore);

  for (const { analysis } of scored) {
    const { ipo, categories } = analysis;
    const marketType = ipo.category.toLowerCase() as MarketType;

    // Choose best category for this capital level
    const affordableCategories = (['retail', 'shni', 'bhni'] as ApplicationCategory[])
      .filter(cat => categories[cat].minInvestment <= remainingCapital)
      .map(cat => ({ category: cat, analysis: categories[cat] }))
      .sort((a, b) => {
        const scoreA = calculateApplicationScore(
          a.analysis.allotmentProbability,
          a.analysis.roi,
          ipo.gmp_percentage
        );
        const scoreB = calculateApplicationScore(
          b.analysis.allotmentProbability,
          b.analysis.roi,
          ipo.gmp_percentage
        );
        return scoreB - scoreA;
      });

    if (affordableCategories.length > 0) {
      const best = affordableCategories[0];
      const category = best.category;
      const catAnalysis = best.analysis;
      const optimalLots = getOptimalLots(remainingCapital, ipo, category);

      if (canAfford(remainingCapital, ipo, category, optimalLots)) {
        const costPerLot = ipo.max_price * ipo.lot_size;
        const totalCost = costPerLot * optimalLots;
        const probability = calculateAllotmentProbability(ipo, category, marketType);
        const expectedProfit = calculateExpectedProfit(ipo, category, optimalLots, probability);

        applications.push({
          ipo,
          category,
          marketType,
          numLots: optimalLots,
          costPerLot,
          totalCost,
          allotmentProbability: probability,
          expectedLots: calculateExpectedLots(optimalLots, probability),
          profitPerLot: ipo.gmp_amount * ipo.lot_size,
          expectedProfit,
          subscription: getSubscriptionForCategory(ipo, category, marketType)
        });

        remainingCapital -= totalCost;
      }
    }
  }

  return createStrategy(
    'ai-balanced',
    'ü§ñ AI-Optimized Strategy',
    'Data-driven optimal allocation balancing probability, profit, and risk (recommended)',
    capital,
    applications
  );
}

/**
 * Helper: Create Application object from analysis
 */
function createApplication(
  ipo: IPO,
  category: ApplicationCategory,
  marketType: MarketType,
  analysis: CategoryAnalysis
): Application {
  return {
    ipo,
    category,
    marketType,
    numLots: analysis.requiredLots,
    costPerLot: ipo.max_price * ipo.lot_size,
    totalCost: analysis.minInvestment,
    allotmentProbability: analysis.allotmentProbability,
    expectedLots: analysis.expectedLots,
    profitPerLot: analysis.profitPerLot,
    expectedProfit: analysis.expectedProfit,
    subscription: analysis.subscription
  };
}

/**
 * Helper: Create Strategy object
 */
function createStrategy(
  id: string,
  name: string,
  description: string,
  capital: number,
  applications: Application[]
): ApplicationStrategy {
  const totalCost = applications.reduce((sum, app) => sum + app.totalCost, 0);
  const expectedProfit = applications.reduce((sum, app) => sum + app.expectedProfit, 0);
  const probabilities = applications.map(app => app.allotmentProbability);
  const weightedProbability = calculateWeightedProbability(probabilities);
  const avgProbability = probabilities.reduce((a, b) => a + b, 0) / probabilities.length || 0;
  const riskScore = calculateRiskScore(applications.length, avgProbability, totalCost);
  const diversificationScore = Math.min(100, applications.length * 20);

  return {
    strategyId: id,
    strategyName: name,
    description,
    totalCost,
    applications,
    expectedProfit,
    weightedProbability,
    riskScore,
    recommendation: generateStrategyRecommendation(applications, riskScore),
    diversificationScore
  };
}

/**
 * Calculate expected value with risk adjustment
 */
function calculateExpectedValue(strategy: ApplicationStrategy): number {
  const baseEV = strategy.expectedProfit;

  // Risk premium/penalty
  const riskMultiplier = {
    'LOW': 1.1,      // 10% bonus for low risk
    'MEDIUM': 1.0,   // No adjustment
    'HIGH': 0.85     // 15% penalty for high risk
  }[strategy.riskScore];

  // Diversification bonus
  const diversificationBonus = Math.min(strategy.diversificationScore / 100, 0.2);

  return baseEV * riskMultiplier * (1 + diversificationBonus);
}

/**
 * Calculate composite score for balanced strategy
 */
function calculateCompositeScore(analysis: IPOAnalysis): number {
  const { categories, ipo } = analysis;

  // Average score across categories, weighted by affordability
  const retailScore = categories.retail.score * 1.2;  // Prefer retail
  const shniScore = categories.shni.score * 1.0;
  const bhniScore = categories.bhni.score * 0.8;      // Penalize high capital requirement

  return (retailScore + shniScore + bhniScore) / 3;
}

/**
 * Generate recommendation text for strategy
 */
function generateStrategyRecommendation(
  applications: Application[],
  riskScore: 'LOW' | 'MEDIUM' | 'HIGH'
): string {
  const numApps = applications.length;
  const avgProb = applications.reduce((sum, app) => sum + app.allotmentProbability, 0) / numApps;

  if (riskScore === 'LOW' && numApps >= 3) {
    return `Excellent diversification across ${numApps} IPOs with ${avgProb.toFixed(0)}% average success rate. Low risk, steady returns.`;
  } else if (riskScore === 'HIGH' && numApps === 1) {
    return `High-risk concentrated play. Potential for significant returns but ${(100 - avgProb).toFixed(0)}% chance of no allotment.`;
  } else {
    return `Balanced approach with ${numApps} applications. Good risk-reward ratio with ${avgProb.toFixed(0)}% success probability.`;
  }
}

/**
 * Generate recommendation for individual IPO
 */
function generateIPORecommendation(
  ipo: IPO,
  categories: Record<ApplicationCategory, CategoryAnalysis>
): string {
  const bestCategory = (['retail', 'shni', 'bhni'] as ApplicationCategory[])
    .map(cat => ({ category: cat, score: categories[cat].score }))
    .sort((a, b) => b.score - a.score)[0];

  const catName = {
    'retail': 'Retail',
    'shni': 'sHNI',
    'bhni': 'bHNI'
  }[bestCategory.category];

  return `Best applied in ${catName} category with ${categories[bestCategory.category].allotmentProbability.toFixed(0)}% probability`;
}
</file>

<file path="frontend/lib/portfolio/types.ts">
// types.ts - TypeScript interfaces for Portfolio Optimizer

export interface IPO {
  slug: string;
  ipo_name: string;
  company_name: string;
  category: 'Mainboard' | 'SME';
  min_price: number;
  max_price: number;
  lot_size: number;
  issue_size_cr: number;
  
  // Subscription data (live from backend)
  subscription_retail: number;
  subscription_nii: number;      // sHNI for Mainboard
  subscription_bnii: number;     // bHNI for Mainboard
  subscription_qib: number;
  subscription_total: number;
  subscription_updated_at?: string;
  
  // GMP data (live from backend)
  gmp_amount: number;
  gmp_percentage: number;
  expected_listing_price: number;
  gmp_updated_at?: string;
  
  // Additional constraints from IPO
  retail_min_lots?: number;      // Usually 1
  retail_max_lots?: number;      // Usually 13-15 (up to ‚Çπ2L)
  shni_min_lots?: number;        // Usually 2
  shni_max_lots?: number;        // Varies by IPO
  bhni_min_lots?: number;        // Usually 10+
  
  // Dates
  open_date: string;
  close_date: string;
  listing_date?: string;
  status: 'open' | 'upcoming' | 'closed';
}

export type ApplicationCategory = 'retail' | 'shni' | 'bhni';
export type MarketType = 'mainboard' | 'sme';

export interface CategoryRequirements {
  minLots: number;
  maxLots: number;
  minInvestment: number;
}

export interface Application {
  ipo: IPO;
  category: ApplicationCategory;
  marketType: MarketType;
  numLots: number;
  costPerLot: number;
  totalCost: number;
  allotmentProbability: number;
  expectedLots: number;
  profitPerLot: number;
  expectedProfit: number;
  subscription: number;
}

export interface ApplicationStrategy {
  strategyId: string;
  strategyName: string;
  description: string;
  totalCost: number;
  applications: Application[];
  expectedProfit: number;
  weightedProbability: number;
  riskScore: 'LOW' | 'MEDIUM' | 'HIGH';
  recommendation: string;
  diversificationScore: number;
}

export interface IPOAnalysis {
  ipo: IPO;
  categories: {
    [key in ApplicationCategory]: CategoryAnalysis;
  };
  overallScore: number;
  recommendation: string;
}

export interface CategoryAnalysis {
  category: ApplicationCategory;
  marketType: MarketType;
  minInvestment: number;
  maxInvestment: number;
  requiredLots: number;
  subscription: number;
  allotmentProbability: number;
  expectedLots: number;
  profitPerLot: number;
  expectedProfit: number;
  roi: number;
  score: number;
}

export interface StrategyComparison {
  strategies: ApplicationStrategy[];
  bestForProfit: ApplicationStrategy;
  bestForProbability: ApplicationStrategy;
  bestForRisk: ApplicationStrategy;
  recommended: ApplicationStrategy;
}

export interface CapitalAllocation {
  totalCapital: number;
  allocated: number;
  remaining: number;
  utilizationPercent: number;
}

/**
 * User's portfolio configuration - SIMPLIFIED
 * Just ask: How many people? How much total money?
 */
export interface UserPortfolio {
  totalCapital: number;
  numRetailAccounts: number;  // Number of family members (1-6)
  
  // HNI capability (optional)
  hasHNICapability?: boolean;
  hniCapital?: number;
  
  // Preferences (optional)
  riskTolerance?: 'conservative' | 'moderate' | 'aggressive';
  preferMainboard?: boolean;
  preferSME?: boolean;
}

/**
 * Retail account representation (auto-generated from numRetailAccounts)
 * System will auto-distribute capital optimally across accounts
 */
export interface RetailAccount {
  accountId: string;
  accountName: string;  // e.g., "Account 1", "Account 2", etc.
  allocatedCapital: number;  // Auto-calculated by optimizer
}

/**
 * Multi-account application strategy
 * Can have multiple retail applications in same IPO
 */
export interface MultiAccountApplication {
  ipo: IPO;
  retailApplications: RetailApplicationDetails[];
  hniApplication?: Application;
  totalInvestment: number;
  totalExpectedProfit: number;
  combinedProbability: number;
}

export interface RetailApplicationDetails {
  account: RetailAccount;
  numLots: number;
  totalCost: number;
  allotmentProbability: number;
  expectedLots: number;
  expectedProfit: number;
}
</file>

<file path="backend/ipo-data-pipeline/scrapers/comprehensive_ipo_scraper.py">
import os
import re
import time
import random
import requests
from bs4 import BeautifulSoup
from supabase import create_client
from dotenv import load_dotenv
from datetime import datetime
import json
import sys
sys.path.append('../..')
from scraper import fetch_gmp_data as old_scraper_gmp, fetch_dates_data as old_scraper_dates


load_dotenv()
supabase = create_client(os.getenv("SUPABASE_URL"), os.getenv("SUPABASE_KEY"))

class SafeScraper:
    """Base scraper with anti-ban measures"""
    
    USER_AGENTS = [
        "Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/120.0.0.0 Safari/537.36",
        "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) Safari/605.1.15",
        "Mozilla/5.0 (X11; Linux x86_64) Firefox/122.0"
    ]
    
    @staticmethod
    def random_delay():
        """Random delay between 2-5 seconds"""
        time.sleep(random.uniform(2, 5))
    
    @staticmethod
    def get_headers():
        return {
            "User-Agent": random.choice(SafeScraper.USER_AGENTS),
            "Accept": "text/html,application/xhtml+xml,application/xml",
            "Accept-Language": "en-US,en;q=0.9",
            "Accept-Encoding": "gzip, deflate",
            "Connection": "keep-alive",
            "Upgrade-Insecure-Requests": "1"
        }
    
    @staticmethod
    def fetch_url(url, max_retries=2):
        for attempt in range(max_retries):
            try:
                resp = requests.get(url, headers=SafeScraper.get_headers(), timeout=15)
                if resp.status_code == 200:
                    return resp
                time.sleep(3)
            except:
                time.sleep(3)
        return None

def clean_text(text):
    if not text: return ""
    return text.replace('\n', '').replace('\t', '').strip()

def parse_number(text):
    if not text or text == "-": return None
    text = str(text).replace(',', '').replace('‚Çπ', '').replace('Rs.', '')
    match = re.search(r'[\d.]+', text)
    return float(match.group()) if match else None

def create_slug(name):
    slug = name.lower()
    slug = re.sub(r'\(sme\)|\(mainboard\)|ipo|limited|ltd\.?|pvt\.?', '', slug)
    slug = re.sub(r'[^a-z0-9]+', '-', slug)
    return slug.strip('-')

def parse_date(date_str):
    """Parse various date formats to YYYY-MM-DD"""
    if not date_str or date_str == "-":
        return None
    try:
        date_str = clean_text(date_str)
        for fmt in ['%b %d, %Y', '%d %b %Y', '%d-%b-%Y', '%d/%m/%Y', '%Y-%m-%d']:
            try:
                return datetime.strptime(date_str, fmt).strftime('%Y-%m-%d')
            except:
                continue
    except:
        pass
    return None

# ==================== SOURCE 1: NSE OFFICIAL API ====================
def scrape_nse_api():
    """NSE Official API - Free, No Rate Limit Issues"""
    print("\nüì° Fetching from NSE Official API...")
    
    url = "https://www.nseindia.com/api/ipo-current-issues"
    
    # NSE requires cookies, so we simulate browser session
    session = requests.Session()
    session.get("https://www.nseindia.com", headers=SafeScraper.get_headers())
    SafeScraper.random_delay()
    
    try:
        resp = session.get(url, headers=SafeScraper.get_headers(), timeout=10)
        data = resp.json()
        
        ipos = []
        for ipo in data.get('data', []):
            try:
                ipos.append({
                    "ipo_name": ipo.get('companyName', '') + " IPO",
                    "company_name": ipo.get('companyName', ''),
                    "slug": create_slug(ipo.get('companyName', '')),
                    "category": "Mainboard",
                    "issue_size_cr": parse_number(ipo.get('issueSize')),
                    "min_price": int(parse_number(ipo.get('priceRangeMin')) or 0),
                    "max_price": int(parse_number(ipo.get('priceRangeMax')) or 0),
                    "lot_size": int(parse_number(ipo.get('lotSize')) or 1),
                    "open_date": parse_date(ipo.get('issueStartDate')),
                    "close_date": parse_date(ipo.get('issueEndDate')),
                    "listing_date": parse_date(ipo.get('listingDate')),
                    "status": "open" if ipo.get('status') == 'Active' else "upcoming"
                })
            except Exception as e:
                print(f"  ‚ö†Ô∏è Error parsing NSE IPO: {e}")
        
        print(f"  ‚úÖ Got {len(ipos)} IPOs from NSE")
        return ipos
        
    except Exception as e:
        print(f"  ‚ùå NSE API failed: {e}")
        return []

# ==================== SOURCE 2: CHITTORGARH ====================
def scrape_chittorgarh():
    """Chittorgarh - Comprehensive IPO data"""
    print("\nüîÑ Scraping Chittorgarh...")
    
    url = "https://www.chittorgarh.com/ipo/ipo_dashboard.asp"
    resp = SafeScraper.fetch_url(url)
    
    if not resp:
        print("  ‚ùå Failed to fetch")
        return []
    
    soup = BeautifulSoup(resp.text, 'html.parser')
    table = soup.find('table', {'class': 'table'})
    
    if not table:
        print("  ‚ùå Table not found")
        return []
    
    ipos = []
    rows = table.find_all('tr')[1:]
    
    for row in rows[:15]:  # Limit to avoid scraping too much
        try:
            cols = row.find_all('td')
            if len(cols) < 6: continue
            
            ipo_name = clean_text(cols[0].text)
            category = "SME" if "SME" in ipo_name else "Mainboard"
            
            # Extract price range
            price_text = clean_text(cols[3].text)
            prices = re.findall(r'\d+', price_text)
            
            ipos.append({
                "ipo_name": ipo_name,
                "company_name": ipo_name.replace(" IPO", "").replace(" (SME)", ""),
                "slug": create_slug(ipo_name),
                "category": category,
                "min_price": int(prices[0]) if len(prices) > 0 else None,
                "max_price": int(prices[-1]) if len(prices) > 0 else None,
                "lot_size": int(parse_number(cols[4].text) or 100),
                "open_date": parse_date(cols[1].text),
                "close_date": parse_date(cols[2].text),
                "issue_size_cr": parse_number(cols[5].text) if len(cols) > 5 else None,
                "status": "upcoming"
            })
            
        except Exception as e:
            continue
    
    print(f"  ‚úÖ Got {len(ipos)} IPOs from Chittorgarh")
    SafeScraper.random_delay()
    return ipos

# ==================== SOURCE 3: GMP FROM IPOWATCH ====================
def scrape_gmp_data():
    """IPOWatch - GMP and Kostak"""
    print("\nüí∞ Scraping GMP from IPOWatch...")
    
    url = "https://ipowatch.in/ipo-grey-market-premium-latest-ipo-gmp/"
    resp = SafeScraper.fetch_url(url)
    
    if not resp:
        return {}
    
    soup = BeautifulSoup(resp.text, 'html.parser')
    table = soup.find('table')
    
    if not table:
        return {}
    
    gmp_dict = {}
    rows = table.find_all('tr')[1:]
    
    for row in rows[:20]:  # Limit rows
        try:
            cols = row.find_all('td')
            if len(cols) < 3: continue
            
            name = clean_text(cols[0].text)
            slug = create_slug(name)
            
            gmp_text = clean_text(cols[1].text)
            gmp_amount = int(parse_number(gmp_text) or 0)
            
            # Extract percentage if present
            gmp_pct = None
            if '(' in gmp_text and '%' in gmp_text:
                pct_match = re.search(r'\(([\d.]+)%\)', gmp_text)
                if pct_match:
                    gmp_pct = float(pct_match.group(1))
            
            # Try to get kostak/sauda from additional columns
            kostak = None
            sauda = None
            if len(cols) > 3:
                kostak = int(parse_number(cols[3].text) or 0)
            if len(cols) > 4:
                sauda = int(parse_number(cols[4].text) or 0)
            
            gmp_dict[slug] = {
                "gmp_amount": gmp_amount,
                "gmp_percentage": gmp_pct,
                "kostak_rate": kostak,
                "subject_to_sauda": sauda,
                "gmp_updated_at": datetime.now().isoformat()
            }
            
        except Exception as e:
            continue
    
    print(f"  ‚úÖ Got GMP for {len(gmp_dict)} IPOs")
    SafeScraper.random_delay()
    return gmp_dict

# ==================== SOURCE 4: SUBSCRIPTION DATA ====================
def scrape_subscription_data():
    """Chittorgarh - Live subscription"""
    print("\nüìä Scraping Subscription Data...")
    
    url = "https://www.chittorgarh.com/ipo/ipo_subscription_status_live.asp"
    resp = SafeScraper.fetch_url(url)
    
    if not resp:
        return {}
    
    soup = BeautifulSoup(resp.text, 'html.parser')
    table = soup.find('table', {'class': 'table'})
    
    if not table:
        return {}
    
    sub_dict = {}
    rows = table.find_all('tr')[1:]
    
    for row in rows[:10]:
        try:
            cols = row.find_all('td')
            if len(cols) < 6: continue
            
            name = clean_text(cols[0].text)
            slug = create_slug(name)
            
            sub_dict[slug] = {
                "subscription_retail": parse_number(cols[1].text) or 0,
                "subscription_nii": parse_number(cols[2].text) or 0,
                "subscription_qib": parse_number(cols[3].text) or 0,
                "subscription_total": parse_number(cols[4].text) or 0,
                "subscription_updated_at": datetime.now().isoformat()
            }
            
        except:
            continue
    
    print(f"  ‚úÖ Got subscription for {len(sub_dict)} IPOs")
    SafeScraper.random_delay()
    return sub_dict

# ==================== SOURCE 5: FINANCIAL DATA (INVESTORGAIN) ====================
def scrape_financials():
    """InvestorGain - Company financials"""
    print("\nüíº Scraping Financial Data...")
    
    url = "https://www.investorgain.com/report/live-ipo-gmp/331/"
    resp = SafeScraper.fetch_url(url)
    
    if not resp:
        return {}
    
    soup = BeautifulSoup(resp.text, 'html.parser')
    
    # InvestorGain has detailed pages per IPO
    # For now, we'll just grab basic data from listing page
    financials = {}
    
    try:
        rows = soup.find_all('tr')
        for row in rows[:15]:
            cols = row.find_all('td')
            if len(cols) < 4: continue
            
            name = clean_text(cols[0].text)
            slug = create_slug(name)
            
            # Try to extract PE ratio, issue size, etc.
            financials[slug] = {
                "issue_size_cr": parse_number(cols[2].text) if len(cols) > 2 else None,
                # More fields can be added by parsing individual IPO pages
            }
    except:
        pass
    
    print(f"  ‚úÖ Got financials for {len(financials)} IPOs")
    SafeScraper.random_delay()
    return financials

# ==================== SOURCE 6: REGISTRAR & ALLOTMENT ====================
def scrape_registrar_info():
    """Get registrar details from Chittorgarh"""
    print("\nüìã Scraping Registrar Info...")
    
    url = "https://www.chittorgarh.com/ipo/ipo_registrars_list.asp"
    resp = SafeScraper.fetch_url(url)
    
    if not resp:
        return {}
    
    soup = BeautifulSoup(resp.text, 'html.parser')
    
    registrar_map = {
        "link": "Link Intime India Pvt Ltd",
        "kfin": "KFin Technologies Ltd",
        "bigshare": "Bigshare Services Pvt Ltd"
    }
    
    # This would need to match IPO names to registrars
    # For simplicity, returning common registrars
    
    SafeScraper.random_delay()
    return {}

# ==================== MERGE & UPLOAD ====================
def merge_all_sources():
    print("\nüîÑ Using working scrapers as fallback...")
    
    # Use your existing working scraper
    gmp_data = old_scraper_gmp()
    date_data = old_scraper_dates()
    
    ipos = []
    for item in gmp_data:
        slug = create_slug(item['ipo_name'])
        
        ipos.append({
            "ipo_name": item['ipo_name'],
            "company_name": item['ipo_name'].replace(' IPO', ''),
            "slug": slug,
            "category": item['category'],
            "status": "upcoming",
            "max_price": int(parse_number(item['ipo_price']) or 0),
            "lot_size": 100,
            "gmp_amount": int(parse_number(item['ipo_gmp']) or 0),
            "open_date": date_data.get(slug, {}).get('open_date'),
            "close_date": date_data.get(slug, {}).get('close_date')
        })
    
    return ipos


def upload_to_supabase(ipos):
    """Upload with proper error handling"""
    print(f"\nüì§ Uploading {len(ipos)} IPOs to Supabase...")
    
    try:
        # Upsert (insert or update based on slug)
        result = supabase.table('ipos').upsert(
            ipos,
            on_conflict='slug'
        ).execute()
        
        print(f"‚úÖ SUCCESS! Database updated")
        print(f"\nüìä Sample Records:")
        for ipo in ipos[:3]:
            print(f"  ‚Ä¢ {ipo['ipo_name']} | {ipo['status']} | GMP: ‚Çπ{ipo.get('gmp_amount', 0)}")
        
        return True
        
    except Exception as e:
        print(f"‚ùå Upload Error: {e}")
        print(f"\nüîç First record (for debugging):")
        if ipos:
            print(json.dumps(ipos[0], indent=2, default=str))
        return False

def main():
    """Main execution"""
    ipos = merge_all_sources()
    
    if ipos:
        upload_to_supabase(ipos)

    else:
        print("\n‚ùå No data collected!")

if __name__ == "__main__":
    main()
</file>

<file path="backend/ipo-data-pipeline/scrapers/core/base_scraper.py">
import os
import time
import random
import requests
from bs4 import BeautifulSoup
from abc import ABC, abstractmethod
from supabase import create_client, Client
from dotenv import load_dotenv
from functools import wraps

load_dotenv()

class BaseScraper(ABC):
    """Base class for all scrapers with common functionality"""
    
    def __init__(self):
        self.supabase: Client = create_client(
            os.getenv("SUPABASE_URL"), 
            os.getenv("SUPABASE_KEY")
        )
        self.session = requests.Session()
        self.user_agents = [
            "Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/120.0.0.0 Safari/537.36",
            "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) Safari/537.36",
            "Mozilla/5.0 (X11; Linux x86_64) Firefox/121.0"
        ]
        
    def get_headers(self):
        """Rotate user agents to avoid blocking"""
        return {
            "User-Agent": random.choice(self.user_agents),
            "Accept": "text/html,application/json",
            "Accept-Language": "en-US,en;q=0.9"
        }
    
    def fetch_page(self, url, method="GET", data=None, max_retries=3):
        """Fetch page with retry logic"""
        for attempt in range(max_retries):
            try:
                if method == "GET":
                    resp = self.session.get(url, headers=self.get_headers(), timeout=10)
                else:
                    resp = self.session.post(url, headers=self.get_headers(), 
                                            data=data, timeout=10)
                
                if resp.status_code == 200:
                    return resp
                elif resp.status_code == 403:
                    print(f"‚ö†Ô∏è  Blocked! Waiting {2 ** attempt}s...")
                    time.sleep(2 ** attempt)
                else:
                    print(f"‚ùå Status {resp.status_code}")
                    return None
                    
            except Exception as e:
                print(f"‚ö†Ô∏è  Attempt {attempt + 1} failed: {e}")
                time.sleep(2 ** attempt)
        
        return None
    
    @staticmethod
    def clean_text(text):
        """Clean scraped text"""
        if not text:
            return ""
        return text.replace('\n', '').replace('\t', '').strip()
    
    @staticmethod
    def normalize_name(name):
        """Normalize IPO names for matching"""
        import re
        name = name.lower()
        name = re.sub(r'\(sme\)|\(mainboard\)|ipo|limited|ltd\.?|pvt\.?', '', name)
        name = re.sub(r'\s+', ' ', name)
        return name.strip()
    
    @staticmethod
    def parse_number(text):
        """Extract number from text like '5.2x', '‚Çπ150', '50%'"""
        import re
        if not text or text == "-":
            return None
        match = re.search(r'[\d,]+\.?\d*', text.replace(',', ''))
        return float(match.group()) if match else None
    
    def upsert_data(self, table, data, conflict_column='slug'):
        """Insert or update data in Supabase"""
        try:
            result = self.supabase.table(table).upsert(
                data, 
                on_conflict=conflict_column
            ).execute()
            print(f"‚úÖ Upserted {len(data)} rows to {table}")
            return result
        except Exception as e:
            print(f"‚ùå DB Error: {e}")
            return None
    
    @abstractmethod
    def scrape(self):
        """Main scraping logic - must be implemented by child classes"""
        pass
</file>

<file path="backend/ipo-data-pipeline/scrapers/free_api_scraper.py">
import os
import requests
import re
from datetime import datetime
from supabase import create_client
from dotenv import load_dotenv

load_dotenv()

# Initialize Supabase
supabase = create_client(os.getenv("SUPABASE_URL"), os.getenv("SUPABASE_KEY"))

# ==================== DATE PARSING LOGIC ====================

def clean_ordinal_date_string(date_str):
    """
    Parses complex strings like: "2026-01-13 06th ‚Äì 08th Jan 2026"
    Returns standard YYYY-MM-DD strings for start and end dates.
    """
    if not date_str or date_str == '-': return None, None
    try:
        # 1. Clean the string (remove the leading ISO date if present)
        parts = date_str.split(' ', 1)
        text_range = parts[1] if len(parts) > 1 and re.match(r'\d{4}-\d{2}-\d{2}', parts[0]) else date_str

        # 2. Remove ordinals (st, nd, rd, th)
        clean_text = re.sub(r'(?<=\d)(st|nd|rd|th)', '', text_range)
        
        # 3. Split start/end
        if '‚Äì' in clean_text: sep = '‚Äì'
        elif '-' in clean_text: sep = '-'
        else: return None, None

        raw_start, raw_end = clean_text.split(sep, 1)
        raw_start, raw_end = raw_start.strip(), raw_end.strip()

        # 4. Parse End Date
        end_dt = datetime.strptime(raw_end, "%d %b %Y")
        
        # 5. Parse Start Date
        try:
            start_dt = datetime.strptime(raw_start, "%d %b %Y")
        except ValueError:
            # Handle short formats like "06" -> use month/year from end_dt
            day_part = int(re.search(r'\d+', raw_start).group())
            start_dt = end_dt.replace(day=day_part)

        return start_dt.strftime('%Y-%m-%d'), end_dt.strftime('%Y-%m-%d')

    except Exception as e:
        # Silently fail for bad dates so we don't crash
        return None, None

def clean_price(price_str):
    """Parses '‚Çπ76 ‚Äì ‚Çπ81' -> (76, 81)"""
    if not price_str: return None, None
    nums = [int(p) for p in re.findall(r'\d+', str(price_str).replace(',', ''))]
    if not nums: return None, None
    if len(nums) == 1: return nums[0], nums[0]
    return nums[0], nums[-1]

def create_slug(name):
    if not name: return ""
    slug = name.lower()
    slug = re.sub(r'\(sme\)|\(mainboard\)|ipo|limited|ltd\.?|pvt\.?', '', slug)
    slug = re.sub(r'[^a-z0-9]+', '-', slug)
    return slug.strip('-')

# ==================== MAIN SCRAPER ====================

def fetch_rapidapi_ipos():
    print("\nüáÆüá≥ Fetching from RapidAPI (Indian IPOs)...")
    
    api_key = os.getenv("RAPIDAPI_KEY")
    if not api_key: 
        print("‚ùå RAPIDAPI_KEY is missing.")
        return

    host = "indian-ipos1.p.rapidapi.com"
    headers = {
        "x-rapidapi-key": api_key,
        "x-rapidapi-host": host
    }

    # We will fetch both endpoints to populate the DB
    endpoints = [
        {"url": f"https://{host}/upcoming-ipos", "status_tag": "upcoming"},
        {"url": f"https://{host}/closed-ipos", "status_tag": "closed"}
    ]
    
    all_valid_rows = []

    for ep in endpoints:
        try:
            print(f"  üëâ Requesting {ep['status_tag']} IPOs...")
            resp = requests.get(ep['url'], headers=headers, timeout=15)
            
            # API returns a list directly or a dict with data?
            # Based on your logs, likely a list directly.
            raw_data = resp.json()
            
            # Normalize to list
            if isinstance(raw_data, dict) and 'data' in raw_data:
                items = raw_data['data']
            elif isinstance(raw_data, list):
                items = raw_data
            else:
                items = []

            print(f"     Found {len(items)} raw items.")

            for item in items:
                name = item.get('name')
                if not name: continue

                # 1. Strict Date Parsing
                open_date, close_date = clean_ordinal_date_string(item.get('ipoDate'))
                
                # SKIP if dates are missing (Supabase constraint violation)
                if not open_date or not close_date:
                    continue

                # 2. Parse Prices
                min_p, max_p = clean_price(item.get('priceRange'))
                
                # 3. Category & Listing Date
                category = "SME" if "SME" in name or "sme" in item.get('symbol', '').lower() else "Mainboard"
                
                listing_date = None
                if item.get('listingDate'):
                    try:
                        # Clean raw listing date "13 Jan 2026"
                        clean_l_date = re.sub(r'(st|nd|rd|th)', '', item.get('listingDate'))
                        listing_date = datetime.strptime(clean_l_date.strip(), "%d %b %Y").strftime("%Y-%m-%d")
                    except: pass

                # 4. Build Schema-Compliant Row
                row = {
                    "ipo_name": name,
                    "company_name": name,
                    "slug": create_slug(name),
                    "category": category,
                    "status": ep['status_tag'], # 'upcoming' or 'closed'
                    
                    # Financials
                    "min_price": min_p,
                    "max_price": max_p,
                    "lot_size": 1, # Defaulting to 1 as API doesn't provide it
                    
                    # Dates
                    "open_date": open_date,
                    "close_date": close_date,
                    "listing_date": listing_date,
                    
                    # Meta
                    "source": "rapidapi_indian_ipos",
                    "updated_at": datetime.now().isoformat()
                }
                all_valid_rows.append(row)

        except Exception as e:
            print(f"  ‚ùå Error fetching {ep['status_tag']}: {e}")

    # ================= SAVE TO DB =================
    
    if all_valid_rows:
        print(f"\nüíæ Saving {len(all_valid_rows)} IPOs to Supabase...")
        try:
            # Deduplicate by slug before inserting (use the latest one)
            unique_map = {row['slug']: row for row in all_valid_rows}
            unique_rows = list(unique_map.values())
            
            result = supabase.table('ipos').upsert(
                unique_rows, 
                on_conflict='slug'
            ).execute()
            
            print(f"‚úÖ Success! {len(unique_rows)} IPOs synced to database.")
        except Exception as e:
            print(f"‚ùå Database Error: {e}")
            if 'source' in str(e):
                print("üí° Remember to add the 'source' column to your table!")
    else:
        print("\n‚ö†Ô∏è No valid data found to save (check date parsing if items were found).")

if __name__ == "__main__":
    fetch_rapidapi_ipos()
</file>

<file path="backend/ipo-data-pipeline/scrapers/ipo_scrapers/enhanced_gmp_scraper.py">
from core.base_scraper import BaseScraper 
from datetime import datetime
from bs4 import BeautifulSoup

class GMPScraper(BaseScraper):
    """Multi-source GMP scraper with history tracking"""
    
    SOURCES = [
        {
            "name": "IPOWatch",
            "url": "https://ipowatch.in/ipo-grey-market-premium-latest-ipo-gmp/",
            "parser": "parse_ipowatch"
        },
        {
            "name": "InvestorGain",
            "url": "https://www.investorgain.com/report/live-ipo-gmp/331/",
            "parser": "parse_investorgain"
        }
    ]
    
    def scrape(self):
        print("\nüí∞ Starting Multi-Source GMP Scrape...")
        
        all_gmp_data = {}
        
        for source in self.SOURCES:
            print(f"\nüì° Fetching from {source['name']}...")
            data = getattr(self, source['parser'])(source['url'])
            
            # Merge with existing data (average if conflict)
            for slug, gmp_info in data.items():
                if slug in all_gmp_data:
                    # Average the GMP values
                    existing = all_gmp_data[slug]['gmp_amount']
                    new = gmp_info['gmp_amount']
                    all_gmp_data[slug]['gmp_amount'] = int((existing + new) / 2)
                else:
                    all_gmp_data[slug] = gmp_info
        
        # Convert to list and upload
        updates = []
        history_records = []
        
        for slug, data in all_gmp_data.items():
            updates.append({
                "slug": slug,
                "gmp_amount": data['gmp_amount'],
                "gmp_percentage": data['gmp_percentage'],
                "gmp_updated_at": datetime.now().isoformat(),
                "expected_listing_price": data['expected_listing_price'],
                "kostak_rate": data.get('kostak_rate'),
                "subject_to_sauda": data.get('subject_to_sauda')
            })
            
            # Store in history table
            history_records.append({
                "ipo_name": data['ipo_name'],
                "gmp_amount": data['gmp_amount'],
                "gmp_percentage": data['gmp_percentage'],
                "issue_price": data.get('issue_price', 0),
                "expected_listing_price": data['expected_listing_price']
            })
        
        if updates:
            self.upsert_data('ipos', updates)
            # Also insert into history for tracking
            self.supabase.table('gmp_history').insert(history_records).execute()
            print(f"‚úÖ Updated {len(updates)} GMP records\n")
    
    def parse_ipowatch(self, url):
        """Parse IPOWatch format"""
        resp = self.fetch_page(url)
        if not resp:
            return {}
        
        soup = BeautifulSoup(resp.text, 'html.parser')
        table = soup.find('table')
        if not table:
            return {}
        
        result = {}
        rows = table.find_all('tr')[1:]
        
        for row in rows:
            cols = row.find_all('td')
            if len(cols) < 3:
                continue
            
            name = self.clean_text(cols[0].text)
            slug = self.normalize_name(name).replace(' ', '-')
            
            gmp_text = self.clean_text(cols[1].text)
            gmp_amount = self.parse_number(gmp_text) or 0
            
            price_text = self.clean_text(cols[2].text)
            issue_price = self.parse_number(price_text) or 0
            
            expected_price = issue_price + gmp_amount
            gmp_pct = (gmp_amount / issue_price * 100) if issue_price > 0 else 0
            
            result[slug] = {
                "ipo_name": name,
                "gmp_amount": int(gmp_amount),
                "gmp_percentage": round(gmp_pct, 2),
                "issue_price": int(issue_price),
                "expected_listing_price": int(expected_price)
            }
        
        return result
    
    def parse_investorgain(self, url):
        """Parse InvestorGain format (similar logic)"""
        # Implementation similar to above
        return {}
</file>

<file path="backend/ipo-data-pipeline/scrapers/ipo_scrapers/subscription_scraper.py">
from ..core.base_scraper import BaseScraper
from datetime import datetime
import json

class SubscriptionScraper(BaseScraper):
    """Scrape live subscription data from Chittorgarh"""
    
    def scrape(self):
        print("\nüîÑ Starting Subscription Scrape...")
        url = "https://www.chittorgarh.com/ipo/ipo_subscription_status_live.asp"
        
        resp = self.fetch_page(url)
        if not resp:
            print("‚ùå Failed to fetch subscription data")
            return
        
        soup = BeautifulSoup(resp.text, 'html.parser')
        
        # Find the subscription table
        table = soup.find('table', {'class': 'table'})
        if not table:
            print("‚ùå Subscription table not found")
            return
        
        rows = table.find_all('tr')[1:]  # Skip header
        updates = []
        
        for row in rows:
            cols = row.find_all('td')
            if len(cols) < 7:
                continue
            
            try:
                ipo_name = self.clean_text(cols[0].text)
                
                # Parse subscription data
                retail = self.parse_number(cols[1].text) or 0
                nii = self.parse_number(cols[2].text) or 0
                bnii = self.parse_number(cols[3].text) or 0
                qib = self.parse_number(cols[4].text) or 0
                total = self.parse_number(cols[5].text) or 0
                
                # Create day-wise record
                day_record = {
                    "date": datetime.now().strftime("%Y-%m-%d"),
                    "time": datetime.now().strftime("%H:%M"),
                    "retail": retail,
                    "nii": nii,
                    "qib": qib,
                    "total": total
                }
                
                # Create slug
                slug = self.normalize_name(ipo_name).replace(' ', '-')
                
                update = {
                    "slug": slug,
                    "ipo_name": ipo_name,
                    "subscription_retail": retail,
                    "subscription_nii": nii,
                    "subscription_bnii": bnii,
                    "subscription_qib": qib,
                    "subscription_total": total,
                    "subscription_updated_at": datetime.now().isoformat(),
                    "day_wise_subscription": json.dumps([day_record])  # We'll append in next iteration
                }
                
                updates.append(update)
                print(f"üìä {ipo_name}: Total {total}x")
                
            except Exception as e:
                print(f"‚ö†Ô∏è  Error parsing row: {e}")
                continue
        
        # Upload to database
        if updates:
            self.upsert_data('ipos', updates)
        
        print(f"‚úÖ Updated {len(updates)} IPOs\n")
</file>

<file path="backend/ipo-data-pipeline/scrapers/orchestrator.py">
from apscheduler.schedulers.blocking import BlockingScheduler
from ipo_scrapers.subscription_scraper import SubscriptionScraper
from ipo_scrapers.enhanced_gmp_scraper import GMPScraper

def run_subscription_scraper():
    scraper = SubscriptionScraper()
    scraper.scrape()

def run_gmp_scraper():
    scraper = GMPScraper()
    scraper.scrape()

if __name__ == "__main__":
    scheduler = BlockingScheduler()
    
    # Run subscription scraper every 2 hours during market hours
    scheduler.add_job(run_subscription_scraper, 'cron', 
                      hour='9-17/2', day_of_week='mon-fri')
    
    # Run GMP scraper every 6 hours
    scheduler.add_job(run_gmp_scraper, 'interval', hours=6)
    
    print("üöÄ Scheduler started. Press Ctrl+C to exit.")
    scheduler.start()
</file>

<file path="backend/ipo-data-pipeline/scrapers/web_scraper.py">

</file>

<file path="backend/scheduler.py">
from apscheduler.schedulers.blocking import BlockingScheduler
import subprocess
import sys

def run_script(script_name):
    """Run scraper as subprocess"""
    print(f"\n{'='*60}")
    print(f"ü§ñ Running: {script_name}")
    print(f"{'='*60}")
    
    try:
        result = subprocess.run(
            [sys.executable, f"scrapers/{script_name}"],
            capture_output=True,
            text=True,
            timeout=300
        )
        print(result.stdout)
        if result.stderr:
            print(f"‚ö†Ô∏è Errors: {result.stderr}")
    except Exception as e:
        print(f"‚ùå Error: {e}")

def run_api_fetcher():
    run_script("free_api_scraper.py")

def run_web_scraper():
    run_script("comprehensive_ipo_scraper.py")

if __name__ == "__main__":
    scheduler = BlockingScheduler()
    
    # API calls - Every 6 hours (rate limited)
    scheduler.add_job(
        run_api_fetcher,
        'interval',
        hours=6,
        id='api_fetch'
    )
    
    # Web scraping - Every 3 hours (unlimited)
    scheduler.add_job(
        run_web_scraper,
        'interval',
        hours=3,
        id='web_scrape'
    )
    
    print("üöÄ Scheduler Started")
    print("  ‚Ä¢ API Fetch: Every 6 hours")
    print("  ‚Ä¢ Web Scrape: Every 3 hours")
    print("  Press Ctrl+C to stop\n")
    
    try:
        scheduler.start()
    except (KeyboardInterrupt, SystemExit):
        print("\nüëã Stopped")
</file>

<file path="backend/scrape_shareholder.py">
import os
import requests
from bs4 import BeautifulSoup
from supabase import create_client, Client
from dotenv import load_dotenv

# 1. Setup Supabase
load_dotenv()
URL = os.getenv("SUPABASE_URL")
KEY = os.getenv("SUPABASE_KEY")

if not URL or not KEY:
    print("‚ùå Error: Missing Supabase credentials")
    exit()

supabase: Client = create_client(URL, KEY)

def clean_text(text):
    if not text: return ""
    return text.replace('\n', '').strip()

def scrape_shareholder_quota():
    print("--- Starting Shareholder Intel Scrape ---")
    url = "https://ipocentral.in/upcoming-ipos-with-shareholders-quota/"
    
    headers = {
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/120.0.0.0 Safari/537.36"
    }

    try:
        resp = requests.get(url, headers=headers)
        if resp.status_code != 200:
            print(f"‚ùå Error: Website blocked us (Status {resp.status_code})")
            return

        soup = BeautifulSoup(resp.text, 'html.parser')
        
        # Locate the table with "Parent Company" in headers
        tables = soup.find_all('table')
        target_table = None
        
        for table in tables:
            headers_text = [th.get_text(strip=True).lower() for th in table.find_all('tr')[0].find_all(['th', 'td'])]
            if "parent company" in headers_text:
                target_table = table
                break
        
        if not target_table:
            print("‚ùå Error: Could not find the 'Shareholder Quota' table.")
            return

        print("‚úÖ Found Shareholder Table. Parsing...")
        rows = target_table.find_all('tr')[1:] # Skip header
        
        data_to_insert = []
        
        for row in rows:
            cols = row.find_all('td')
            if len(cols) < 3: continue
            
            # Extract Columns based on the website structure:
            # Col 0: Subsidiary IPO Name
            # Col 1: Parent Company
            # Col 2: SEBI IPO Status
            
            ipo_name = clean_text(cols[0].text)
            parent = clean_text(cols[1].text)
            status = clean_text(cols[2].text)
            
            # Logic: Determine "Action Text" based on Status
            action = "Watchlist"
            is_active = True
            
            if "Approved" in status or "Filed" in status:
                action = f"Buy 1 share of {parent} ASAP (RHP likely soon)"
            elif "Awaited" in status:
                action = f"Track {parent} (Early Stage)"
            elif "Returned" in status or "Rejected" in status:
                is_active = False # Don't show these
                
            if is_active:
                data_to_insert.append({
                    "ipo_name": ipo_name,
                    "parent_company": parent,
                    "action_text": action,
                    "is_active": True,
                    # We leave rhp_date null as this site doesn't provide exact dates
                })

        # UPLOAD
        if data_to_insert:
            print(f"üöÄ Inserting {len(data_to_insert)} Opportunities...")
            # Clear old data to prevent duplicates
            supabase.table('shareholder_intel').delete().neq("id", 0).execute()
            # Insert new
            supabase.table('shareholder_intel').insert(data_to_insert).execute()
            print("--- Success! Table Populated ---")
        else:
            print("‚ö†Ô∏è No valid rows found.")

    except Exception as e:
        print(f"‚ùå Critical Error: {e}")

if __name__ == "__main__":
    scrape_shareholder_quota()
</file>

<file path="backend/scraper.py">
import os
import requests
import difflib
from bs4 import BeautifulSoup
from supabase import create_client, Client
from dotenv import load_dotenv

# 1. Setup
load_dotenv()
supabase: Client = create_client(os.getenv("SUPABASE_URL"), os.getenv("SUPABASE_KEY"))

def clean_text(text):
    if not text: return "-"
    return text.replace('\n', '').strip()

# --- SCRAPER A: IPOWatch (For GMP & Price) ---
def fetch_gmp_data():
    print("Step 1: Fetching GMP from IPOWatch...")
    url = "https://ipowatch.in/ipo-grey-market-premium-latest-ipo-gmp/"
    headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/120.0.0.0 Safari/537.36"}
    
    gmp_list = []
    try:
        resp = requests.get(url, headers=headers)
        soup = BeautifulSoup(resp.text, 'html.parser')
        
        # They often change table IDs, so we grab the first table
        tables = soup.find_all('table')
        if not tables: return []

        rows = tables[0].find_all('tr')[1:] # Skip header
        
        for row in rows:
            cols = row.find_all('td')
            if len(cols) < 2: continue
            
            # Extract
            raw_name = clean_text(cols[0].text)
            gmp = clean_text(cols[1].text)
            price = "Check RHP"
            if len(cols) > 2: price = clean_text(cols[2].text) # Try grab price if exists
            
            # --- FIX FOR SME DETECTION ---
            # We look for "SME" in the name OR the category column if it exists
            category = "Mainboard"
            if "SME" in raw_name or "SME" in clean_text(row.text):
                category = "SME"
                
            # Listing Gain Calculation (approximate from text)
            # We extract just the text for now as you requested
            listing_gain = "-"
            if "(" in gmp:
                listing_gain = gmp.split("(")[-1].replace(")", "") # Extracts "50%" from "150 (50%)"
                gmp = gmp.split("(")[0].strip() # Keeps just "150"

            gmp_list.append({
                "match_name": raw_name.lower(), # For matching later
                "ipo_name": raw_name,
                "ipo_price": price,
                "ipo_gmp": gmp,
                "listing_gain": listing_gain,
                "category": category
            })
            
    except Exception as e:
        print(f"Error fetching GMP: {e}")
        
    return gmp_list

# --- SCRAPER B: Chittorgarh (For Dates) ---
def fetch_dates_data():
    print("Step 2: Fetching Dates from Chittorgarh...")
    url = "https://www.chittorgarh.com/ipo/ipo_dashboard.asp"
    headers = {"User-Agent": "Mozilla/5.0"}
    
    date_map = {} # We will store data as { "name": {open, close} }
    try:
        resp = requests.get(url, headers=headers)
        soup = BeautifulSoup(resp.text, 'html.parser')
        
        # Chittorgarh usually has a table with class 'table'
        tables = soup.find_all('table')
        if not tables: return {}
        
        rows = tables[0].find_all('tr')[1:]
        
        for row in rows:
            cols = row.find_all('td')
            if len(cols) < 3: continue
            
            name = clean_text(cols[0].text)
            # Columns: 0=Name, 1=Date, etc. (Structure varies, usually Col 1 is Open Date)
            # Let's assume standard layout. You might need to adjust indices if they change.
            open_date = clean_text(cols[1].text) if len(cols) > 1 else "-"
            close_date = clean_text(cols[2].text) if len(cols) > 2 else "-"
            
            date_map[name.lower()] = {
                "open_date": open_date,
                "close_date": close_date
            }
            
    except Exception as e:
        print(f"Error fetching Dates: {e}")
        
    return date_map

# --- MAIN: COMBINE & UPLOAD ---
def run():
    # 1. Get Data
    gmp_data = fetch_gmp_data()
    date_data = fetch_dates_data()
    
    print(f"Got {len(gmp_data)} GMP records and {len(date_data)} Date records.")
    
    final_list = []
    
    # 2. Merge Loop
    for item in gmp_data:
        # Fuzzy Match: Try to find "Zepto IPO" inside "Zepto Limited"
        # We look for the closest match in the date_data keys
        
        best_match = difflib.get_close_matches(item['match_name'], date_data.keys(), n=1, cutoff=0.4)
        
        open_d = "-"
        close_d = "-"
        
        if best_match:
            matched_key = best_match[0]
            print(f"Matched: '{item['ipo_name']}' <--> '{matched_key}'")
            open_d = date_data[matched_key]['open_date']
            close_d = date_data[matched_key]['close_date']
        
        final_list.append({
            "ipo_name": item['ipo_name'],
            "category": item['category'],
            "ipo_price": item['ipo_price'],
            "ipo_gmp": item['ipo_gmp'],
            "listing_gain": item['listing_gain'],
            "open_date": open_d,
            "close_date": close_d
        })
        
    # 3. Upload
    if final_list:
        print(f"üöÄ Uploading {len(final_list)} combined records...")
        supabase.table('ipo_gmp').delete().neq("id", 0).execute()
        supabase.table('ipo_gmp').insert(final_list).execute()
        print("Done!")

if __name__ == "__main__":
    run()
</file>

<file path="frontend/app/allotment/page.module.css">
/* ============================================
   Check Allotment Page - Shareholders Style Theme
   Teal/Beige/Yellow color scheme with proper layout
   ============================================ */

@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=IBM+Plex+Sans:wght@300;400;500;600&display=swap');

.pageContainer {
    padding: 3rem 2rem;
    min-height: 100vh;
    max-width: 1400px;
    margin: 0 auto;
}

.sectionHeader {
    margin-bottom: 2.5rem;
    animation: slideUp 0.6s ease-out;
}

.sectionTitle {
    font-family: 'Playfair Display', serif;
    font-size: 3rem;
    font-weight: 900;
    margin-bottom: 0.8rem;
    color: #1a3a3a;
    letter-spacing: -0.02em;
}

.sectionSubtitle {
    font-size: 1.1rem;
    color: #2d4a4a;
    font-weight: 400;
    font-family: 'IBM Plex Sans', sans-serif;
    max-width: 600px;
}

.allotmentGrid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
    gap: 1.5rem;
    animation: fadeIn 0.8s ease-out 0.3s both;
}

.allotmentCard {
    background: #f5f5eb;
    border: 2px solid #1a3a3a;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.cardHeader {
    background: #1a3a3a;
    padding: 1rem 1.25rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
}

.titleRow {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex: 1;
}

.companyName {
    font-size: 1.1rem;
    font-family: var(--font-heading);
    font-weight: 700;
    color: #e8e5d6;
    text-transform: uppercase;
    letter-spacing: 0.02em;
    line-height: 1.3;
}

.categoryBadge {
    padding: 0.35rem 0.75rem;
    font-size: 0.7rem;
    font-family: 'IBM Plex Sans', sans-serif;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    white-space: nowrap;
    border-radius: 2px;
}

.smeBadge {
    background: #3b82f6;
    color: white;
}

.mainboardBadge {
    background: #2d5555;
    color: #e8e5d6;
}

.statusBadge {
    padding: 0.35rem 0.75rem;
    font-size: 0.7rem;
    font-family: 'IBM Plex Sans', sans-serif;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border-radius: 2px;
}

.statusOut {
    background: #22c55e;
    color: white;
}

.statusPending {
    background: #fbbf24;
    color: #1a3a3a;
}

.cardBody {
    display: flex;
    flex-direction: column;
    background: #e8e5d6;
}

.infoRow {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.875rem 1.25rem;
    border-bottom: 1px solid #d0cbb8;
}

.infoRow:last-child {
    border-bottom: none;
}

.label {
    font-size: 0.85rem;
    font-family: 'IBM Plex Sans', sans-serif;
    color: #2d4a4a;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.06em;
}

.value {
    font-size: 1rem;
    font-family: 'IBM Plex Sans', sans-serif;
    color: #1a3a3a;
    font-weight: 700;
}

.checkButton {
    background: #1a3a3a;
    color: #fbbf24;
    padding: 1rem 1.5rem;
    font-family: 'IBM Plex Sans', sans-serif;
    font-weight: 700;
    font-size: 0.85rem;
    text-align: center;
    text-decoration: none;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    border-top: 2px solid #1a3a3a;
    cursor: pointer;
    transition: color 0.2s ease;
}

.checkButton:hover {
    color: #ffffff;
}

.checkButtonDisabled {
    background: #6b7280;
    color: #9ca3af;
    padding: 1rem 1.5rem;
    font-family: 'IBM Plex Sans', sans-serif;
    font-weight: 700;
    font-size: 0.85rem;
    text-align: center;
    text-decoration: none;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    border-top: 2px solid #6b7280;
    cursor: not-allowed;
    pointer-events: none;
}

.externalIcon {
    font-size: 1rem;
}

.emptyState {
    text-align: center;
    padding: 3rem 2rem;
    background: #f5f5eb;
    border: 2px dashed #1a3a3a;
    margin-top: 1.5rem;
}

.emptyState p {
    color: #1a3a3a;
    font-size: 1.1rem;
    font-family: 'IBM Plex Sans', sans-serif;
    font-weight: 500;
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@media (max-width: 768px) {
    .pageContainer {
        padding: 2rem 1rem;
    }

    .sectionTitle {
        font-size: 2.2rem;
    }

    .allotmentGrid {
        grid-template-columns: 1fr;
    }

    .cardHeader {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.75rem;
    }

    .titleRow {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
    }
}
</file>

<file path="frontend/app/allotment/page.tsx">
import type { Metadata } from 'next';
import AllotmentClient from './AllotmentClient';

export const metadata: Metadata = {
    title: 'Check IPO Allotment Status - All Registrar Links',
    description: 'Check your IPO allotment status online. Quick links to all registrar websites including Link Intime, KFin Tech, Bigshare Services, and more. Track your IPO application status easily.',
    keywords: ['IPO allotment status', 'check IPO allotment', 'IPO allotment result', 'Link Intime', 'KFin Tech', 'IPO registrar', 'BSE IPO status', 'NSE IPO status'],
    openGraph: {
        title: 'Check IPO Allotment Status - All Registrar Links',
        description: 'Check your IPO allotment status online. Quick links to all registrar websites.',
        type: 'website',
    },
    twitter: {
        card: 'summary_large_image',
        title: 'Check IPO Allotment Status - All Registrar Links',
        description: 'Check your IPO allotment status online with quick registrar links.',
    },
};

export const revalidate = 3600; // Revalidate every 1 hour

export default function AllotmentPage() {
    return <AllotmentClient />;
}
</file>

<file path="frontend/app/gmp/GMPModal.module.css">
/* ============================================
   GMP Modal - Modern Dark Theme
   Matches the new GMP page styling
   ============================================ */

.modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(10, 14, 39, 0.85);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    z-index: 2000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--spacing-lg);
    overflow-y: auto;
    animation: fadeIn 0.3s ease-out;
}

.modalContent {
    background: linear-gradient(145deg, #1e293b 0%, #0f172a 100%);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    padding: var(--spacing-lg);
    max-width: 1200px;
    width: 100%;
    position: relative;
    animation: slideUp 0.4s ease-out;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
    max-height: 90vh;
    overflow-y: auto;
}

.modalClose {
    position: absolute;
    top: var(--spacing-md);
    right: var(--spacing-md);
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: #e2e8f0;
    font-size: var(--font-size-lg);
    cursor: pointer;
    transition: all 0.2s ease;
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    line-height: 1;
}

.modalClose:hover {
    background: rgba(239, 68, 68, 0.2);
    border-color: rgba(239, 68, 68, 0.4);
    color: #f87171;
    transform: rotate(90deg);
}

.modalTitle {
    font-size: var(--font-size-h3);
    font-family: 'Playfair Display', serif;
    font-weight: 700;
    margin-bottom: var(--spacing-xs);
    color: #f8fafc;
    padding-right: 3rem;
    text-transform: none;
}

.modalSubtitle {
    font-size: var(--font-size-md);
    color: #06b6d4;
    margin-bottom: var(--spacing-lg);
    font-weight: 500;
    font-family: 'IBM Plex Sans', sans-serif;
}

.dayWiseSection {
    margin-bottom: var(--spacing-lg);
}

.overallSection {
    margin-bottom: var(--spacing-lg);
}

.dayWiseTable {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    overflow-x: auto;
}

.subscriptionTable {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    overflow: hidden;
}

.table {
    width: 100%;
    border-collapse: collapse;
}

.table thead {
    background: rgba(255, 255, 255, 0.05);
}

.table th {
    padding: var(--spacing-sm);
    text-align: left;
    font-family: 'IBM Plex Sans', sans-serif;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    font-size: var(--font-size-xs);
    color: #e2e8f0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    white-space: nowrap;
}

.table td {
    padding: var(--spacing-sm);
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    color: #94a3b8;
    font-size: var(--font-size-base);
    font-family: 'IBM Plex Sans', sans-serif;
}

.table tbody tr {
    transition: all 0.2s ease;
}

.table tbody tr:hover {
    background: rgba(255, 255, 255, 0.03);
}

.latestDay {
    background: rgba(16, 185, 129, 0.1) !important;
    border-left: 3px solid #10b981;
}

.dateCell {
    font-weight: 500;
}

.dateInfo {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
}

.date {
    font-size: var(--font-size-base);
    color: #f8fafc;
}

.dayLabel {
    font-size: var(--font-size-xs);
    color: #06b6d4;
    font-weight: 600;
    text-transform: uppercase;
}

.highlightRetail {
    color: #10b981 !important;
    font-weight: 700 !important;
}

.highlightTotal {
    color: #06b6d4 !important;
    font-weight: 700 !important;
    font-size: var(--font-size-lg) !important;
}

.subCategory td {
    font-size: var(--font-size-sm);
    color: #94a3b8;
}

.subscriptionValue {
    font-weight: 600;
    color: #06b6d4 !important;
    text-align: right;
    font-family: 'JetBrains Mono', monospace;
}

.totalRow {
    background: rgba(6, 182, 212, 0.1) !important;
    border-top: 1px solid rgba(6, 182, 212, 0.3);
}

.totalRow td {
    padding: var(--spacing-sm);
    font-size: var(--font-size-lg);
    font-weight: 700;
    color: #f8fafc;
}

.calculationsSection {
    margin-top: var(--spacing-lg);
}

.sectionTitle {
    font-size: var(--font-size-xl);
    font-family: 'IBM Plex Sans', sans-serif;
    font-weight: 600;
    color: #f8fafc;
    margin-bottom: var(--spacing-sm);
}

.calculationGrid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: var(--spacing-md);
}

.calculationCard {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: var(--spacing-md);
}

.categoryLabel {
    font-size: var(--font-size-md);
    font-family: 'IBM Plex Sans', sans-serif;
    font-weight: 600;
    color: #06b6d4;
    margin-bottom: var(--spacing-sm);
}

.calcRow {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--spacing-xs) 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.calcRow:last-child {
    border-bottom: none;
}

.finalRow {
    margin-top: var(--spacing-xs);
    padding-top: var(--spacing-sm);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.calcLabel {
    font-size: var(--font-size-base);
    font-family: 'IBM Plex Sans', sans-serif;
    color: #94a3b8;
}

.calcValue {
    font-size: var(--font-size-base);
    font-family: 'JetBrains Mono', monospace;
    font-weight: 600;
    color: #f8fafc;
}

.profit {
    color: #10b981 !important;
}

.loss {
    color: #ef4444 !important;
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(24px) scale(0.98);
    }

    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

@media (max-width: 768px) {
    .modal {
        padding: var(--spacing-sm);
    }

    .modalContent {
        padding: var(--spacing-md);
        max-height: 95vh;
        border-radius: 16px;
    }

    .table th,
    .table td {
        padding: var(--spacing-xs);
    }

    .calculationGrid {
        grid-template-columns: 1fr;
    }

    .modalClose {
        top: var(--spacing-sm);
        right: var(--spacing-sm);
        width: 36px;
        height: 36px;
    }

    .dayWiseTable {
        overflow-x: scroll;
    }
}
</file>

<file path="frontend/app/gmp/GMPModal.tsx">
'use client';

import { useEffect } from 'react';
import styles from './GMPModal.module.css';

interface DayWiseData {
    date: string;
    day: number;
    qibExAnchor?: number;
    nii?: number;
    bNII?: number;
    sNII?: number;
    retail?: number;
    total?: number;
}

interface SubscriptionData {
    anchorInvestors?: number;
    qibExAnchor?: number;
    nonInstitutional?: number;
    bNII?: number;
    sNII?: number;
    retail?: number;
    employee?: number;
    shareholder?: number;
    total?: number;
    dayWise?: DayWiseData[];
}

interface IPOData {
    id: number;
    companyName: string;
    category: string;
    gmp: number;
    percentage: number;
    issuePrice: string;
    expectedListing: string;
    lotSize: string;
    listingDate: string;
    subscription?: SubscriptionData;
}

interface GMPModalProps {
    ipo: IPOData;
    onClose: () => void;
}

export default function GMPModal({ ipo, onClose }: GMPModalProps) {
    useEffect(() => {
        document.body.style.overflow = 'hidden';
        return () => {
            document.body.style.overflow = 'unset';
        };
    }, []);

    const handleBackdropClick = (e: React.MouseEvent) => {
        if (e.target === e.currentTarget) {
            onClose();
        }
    };

    // Extract numeric values
    const issuePrice = parseInt(ipo.issuePrice.replace(/[^0-9]/g, ''));
    const lotSizeNum = parseInt(ipo.lotSize.split(' ')[0]);

    // Calculate lot values and profits
    const retailLotValue = issuePrice * lotSizeNum;
    const sNIILotValue = issuePrice * lotSizeNum;
    const bNIILotValue = issuePrice * lotSizeNum;

    const retailProfit = ipo.gmp * lotSizeNum;
    const sNIIProfit = ipo.gmp * lotSizeNum;
    const bNIIProfit = ipo.gmp * lotSizeNum;

    const retailFinal = retailLotValue + retailProfit;
    const sNIIFinal = sNIILotValue + sNIIProfit;
    const bNIIFinal = bNIILotValue + bNIIProfit;

    const subscription = ipo.subscription || {
        retail: 0,
        total: 0
    };

    return (
        <div className={styles.modal} onClick={handleBackdropClick}>
            <div className={styles.modalContent}>
                <button className={styles.modalClose} onClick={onClose}>
                    &times;
                </button>

                <h2 className={styles.modalTitle}>{ipo.companyName}</h2>
                <p className={styles.modalSubtitle}>Live Subscription Status</p>

                {/* Day-wise Subscription Table */}
                {subscription.dayWise && subscription.dayWise.length > 0 && (
                    <div className={styles.dayWiseSection}>
                        <h3 className={styles.sectionTitle}>üìà Day-wise Subscription Details</h3>
                        <div className={styles.dayWiseTable}>
                            <table className={styles.table}>
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>QIB (Ex Anchor)</th>
                                        <th>NII</th>
                                        <th>NII (&gt; ‚Çπ10L)</th>
                                        <th>NII (&lt; ‚Çπ10L)</th>
                                        <th>Retail</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {subscription.dayWise.map((day, index) => (
                                        <tr key={index} className={index === subscription.dayWise!.length - 1 ? styles.latestDay : ''}>
                                            <td className={styles.dateCell}>
                                                <div className={styles.dateInfo}>
                                                    <span className={styles.date}>{day.date}</span>
                                                    <span className={styles.dayLabel}>Day {day.day}</span>
                                                </div>
                                            </td>
                                            <td className={styles.subscriptionValue}>{day.qibExAnchor?.toFixed(2) || '-'}</td>
                                            <td className={styles.subscriptionValue}>{day.nii?.toFixed(2) || '-'}</td>
                                            <td className={styles.subscriptionValue}>{day.bNII?.toFixed(2) || '-'}</td>
                                            <td className={styles.subscriptionValue}>{day.sNII?.toFixed(2) || '-'}</td>
                                            <td className={`${styles.subscriptionValue} ${styles.highlightRetail}`}>{day.retail?.toFixed(2) || '-'}</td>
                                            <td className={`${styles.subscriptionValue} ${styles.highlightTotal}`}><strong>{day.total?.toFixed(2) || '-'}</strong></td>
                                        </tr>
                                    ))}
                                    <tr className={styles.totalRow}>
                                        <td><strong>Overall Total</strong></td>
                                        <td className={styles.subscriptionValue}><strong>{subscription.qibExAnchor?.toFixed(2) || '-'}</strong></td>
                                        <td className={styles.subscriptionValue}><strong>{subscription.nonInstitutional?.toFixed(2) || '-'}</strong></td>
                                        <td className={styles.subscriptionValue}><strong>{subscription.bNII?.toFixed(2) || '-'}</strong></td>
                                        <td className={styles.subscriptionValue}><strong>{subscription.sNII?.toFixed(2) || '-'}</strong></td>
                                        <td className={`${styles.subscriptionValue} ${styles.highlightRetail}`}><strong>{subscription.retail?.toFixed(2) || '-'}</strong></td>
                                        <td className={`${styles.subscriptionValue} ${styles.highlightTotal}`}><strong>{subscription.total?.toFixed(2) || '-'}</strong></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                )}

                {/* Profit/Loss Calculations */}
                <div className={styles.calculationsSection}>
                    <h3 className={styles.sectionTitle}>Lot Size & Profit Analysis</h3>

                    <div className={styles.calculationCard}>
                        <h4 className={styles.categoryLabel}>Retail Investors</h4>
                        <div className={styles.calcRow}>
                            <span className={styles.calcLabel}>Lot Size:</span>
                            <span className={styles.calcValue}>{lotSizeNum} shares</span>
                        </div>
                        <div className={styles.calcRow}>
                            <span className={styles.calcLabel}>Number of Lots:</span>
                            <span className={styles.calcValue}>1 lot</span>
                        </div>
                        <div className={styles.calcRow}>
                            <span className={styles.calcLabel}>Lot Value:</span>
                            <span className={styles.calcValue}>‚Çπ{retailLotValue.toLocaleString()}</span>
                        </div>
                        <div className={styles.calcRow}>
                            <span className={styles.calcLabel}>Profit/Loss:</span>
                            <span className={`${styles.calcValue} ${retailProfit >= 0 ? styles.profit : styles.loss}`}>
                                {retailProfit >= 0 ? '+' : ''}‚Çπ{retailProfit.toLocaleString()}
                            </span>
                        </div>
                        <div className={`${styles.calcRow} ${styles.finalRow}`}>
                            <span className={styles.calcLabel}><strong>Final Value:</strong></span>
                            <span className={styles.calcValue}><strong>‚Çπ{retailFinal.toLocaleString()}</strong></span>
                        </div>
                    </div>

                    <div className={styles.calculationCard}>
                        <h4 className={styles.categoryLabel}>sNII (bids below ‚Çπ10L)</h4>
                        <div className={styles.calcRow}>
                            <span className={styles.calcLabel}>Lot Size:</span>
                            <span className={styles.calcValue}>{lotSizeNum} shares</span>
                        </div>
                        <div className={styles.calcRow}>
                            <span className={styles.calcLabel}>Number of Lots:</span>
                            <span className={styles.calcValue}>2 lots</span>
                        </div>
                        <div className={styles.calcRow}>
                            <span className={styles.calcLabel}>Lot Value:</span>
                            <span className={styles.calcValue}>‚Çπ{sNIILotValue.toLocaleString()}</span>
                        </div>
                        <div className={styles.calcRow}>
                            <span className={styles.calcLabel}>Profit/Loss:</span>
                            <span className={`${styles.calcValue} ${sNIIProfit >= 0 ? styles.profit : styles.loss}`}>
                                {sNIIProfit >= 0 ? '+' : ''}‚Çπ{sNIIProfit.toLocaleString()}
                            </span>
                        </div>
                        <div className={`${styles.calcRow} ${styles.finalRow}`}>
                            <span className={styles.calcLabel}><strong>Final Value:</strong></span>
                            <span className={styles.calcValue}><strong>‚Çπ{sNIIFinal.toLocaleString()}</strong></span>
                        </div>
                    </div>

                    <div className={styles.calculationCard}>
                        <h4 className={styles.categoryLabel}>bNII (bids above ‚Çπ10L)</h4>
                        <div className={styles.calcRow}>
                            <span className={styles.calcLabel}>Lot Size:</span>
                            <span className={styles.calcValue}>{lotSizeNum} shares</span>
                        </div>
                        <div className={styles.calcRow}>
                            <span className={styles.calcLabel}>Number of Lots:</span>
                            <span className={styles.calcValue}>2 lots</span>
                        </div>
                        <div className={styles.calcRow}>
                            <span className={styles.calcLabel}>Lot Value:</span>
                            <span className={styles.calcValue}>‚Çπ{bNIILotValue.toLocaleString()}</span>
                        </div>
                        <div className={styles.calcRow}>
                            <span className={styles.calcLabel}>Profit/Loss:</span>
                            <span className={`${styles.calcValue} ${bNIIProfit >= 0 ? styles.profit : styles.loss}`}>
                                {bNIIProfit >= 0 ? '+' : ''}‚Çπ{bNIIProfit.toLocaleString()}
                            </span>
                        </div>
                        <div className={`${styles.calcRow} ${styles.finalRow}`}>
                            <span className={styles.calcLabel}><strong>Final Value:</strong></span>
                            <span className={styles.calcValue}><strong>‚Çπ{bNIIFinal.toLocaleString()}</strong></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    );
}
</file>

<file path="frontend/app/gmp/page.tsx">
import type { Metadata } from 'next';
import GMPClient from './GMPClient';

export const metadata: Metadata = {
    title: 'IPO Grey Market Premium (GMP) - Live GMP Rates Today',
    description: 'Check live IPO Grey Market Premium (GMP) rates for all upcoming and recent IPOs. Track GMP trends, expected listing prices, and make informed investment decisions.',
    keywords: ['IPO GMP', 'Grey Market Premium', 'GMP today', 'IPO GMP live', 'IPO expected listing price', 'Kostak rate'],
    openGraph: {
        title: 'IPO Grey Market Premium (GMP) - Live GMP Rates Today',
        description: 'Check live IPO Grey Market Premium (GMP) rates for all upcoming and recent IPOs. Track GMP trends and expected listing prices.',
        type: 'website',
    },
    twitter: {
        card: 'summary_large_image',
        title: 'IPO Grey Market Premium (GMP) - Live GMP Rates Today',
        description: 'Check live IPO Grey Market Premium (GMP) rates for all upcoming and recent IPOs.',
    },
};

export const revalidate = 3600; // Revalidate every 1 hour

export default function GMPPage() {
    return <GMPClient />;
}
</file>

<file path="frontend/app/ipo/[slug]/IPOSchema.tsx">
// JSON-LD Schema Markup Component for IPO Detail Pages

interface IPOSchemaProps {
    companyName: string;
    gmp: number;
    gmpPercentage: number;
    subscription: number;
    priceMin: number;
    priceMax: number;
    openDate: string;
    closeDate: string;
    allotmentDate: string;
    listingDate: string;
    registrar: string;
    registrarLink: string;
    faqs: { q: string; a: string }[];
    slug: string;
}

export default function IPOSchema({
    companyName,
    gmp,
    gmpPercentage,
    subscription,
    priceMin,
    priceMax,
    openDate,
    closeDate,
    allotmentDate,
    listingDate,
    registrar,
    registrarLink,
    faqs,
    slug,
}: IPOSchemaProps) {
    const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || 'https://ipotracker.in';
    const pageUrl = `${baseUrl}/ipo/${slug}`;
    const logoUrl = `${baseUrl}/images/logo.png`;
    const now = new Date().toISOString();

    // FinancialProduct Schema
    const financialProductSchema = {
        '@context': 'https://schema.org',
        '@type': 'FinancialProduct',
        name: `${companyName} IPO`,
        description: `${companyName} Initial Public Offering with live GMP updates, subscription status, and allotment details`,
        url: pageUrl,
        provider: {
            '@type': 'Organization',
            name: companyName,
        },
        offers: {
            '@type': 'Offer',
            price: priceMax,
            priceCurrency: 'INR',
            availability: 'https://schema.org/InStock',
            priceValidUntil: closeDate,
            seller: {
                '@type': 'Organization',
                name: companyName,
            },
        },
        audience: {
            '@type': 'PeopleAudience',
            audienceType: 'Retail Investors, Institutional Investors',
        },
    };

    // FAQ Schema
    const faqSchema = {
        '@context': 'https://schema.org',
        '@type': 'FAQPage',
        mainEntity: [
            {
                '@type': 'Question',
                name: `What is the ${companyName} IPO GMP today?`,
                acceptedAnswer: {
                    '@type': 'Answer',
                    text: `The current Grey Market Premium (GMP) for ${companyName} IPO is ‚Çπ${gmp}, indicating a premium of ${gmpPercentage}% over the issue price.`,
                },
            },
            {
                '@type': 'Question',
                name: `When is ${companyName} IPO opening and closing?`,
                acceptedAnswer: {
                    '@type': 'Answer',
                    text: `${companyName} IPO opens on ${openDate} and closes on ${closeDate}.`,
                },
            },
            {
                '@type': 'Question',
                name: `How to check ${companyName} IPO allotment status?`,
                acceptedAnswer: {
                    '@type': 'Answer',
                    text: `Check ${companyName} IPO allotment status on ${registrar} website at ${registrarLink} using your PAN number or application number.`,
                },
            },
            ...faqs.map(faq => ({
                '@type': 'Question',
                name: faq.q,
                acceptedAnswer: {
                    '@type': 'Answer',
                    text: faq.a,
                },
            })),
        ],
    };

    // Article Schema
    const articleSchema = {
        '@context': 'https://schema.org',
        '@type': 'Article',
        headline: `${companyName} IPO Review: GMP, Subscription & Allotment Details`,
        description: `Comprehensive analysis of ${companyName} IPO including grey market premium, subscription status, financials, and investment recommendation`,
        image: logoUrl,
        datePublished: now,
        dateModified: now,
        author: {
            '@type': 'Organization',
            name: 'IPO Tracker',
        },
        publisher: {
            '@type': 'Organization',
            name: 'IPO Tracker',
            logo: {
                '@type': 'ImageObject',
                url: logoUrl,
            },
        },
    };

    // Breadcrumb Schema
    const breadcrumbSchema = {
        '@context': 'https://schema.org',
        '@type': 'BreadcrumbList',
        itemListElement: [
            {
                '@type': 'ListItem',
                position: 1,
                name: 'Home',
                item: baseUrl,
            },
            {
                '@type': 'ListItem',
                position: 2,
                name: 'IPO',
                item: `${baseUrl}/upcoming-ipos`,
            },
            {
                '@type': 'ListItem',
                position: 3,
                name: `${companyName} IPO`,
                item: pageUrl,
            },
        ],
    };

    return (
        <>
            <script
                type="application/ld+json"
                dangerouslySetInnerHTML={{ __html: JSON.stringify(financialProductSchema) }}
            />
            <script
                type="application/ld+json"
                dangerouslySetInnerHTML={{ __html: JSON.stringify(faqSchema) }}
            />
            <script
                type="application/ld+json"
                dangerouslySetInnerHTML={{ __html: JSON.stringify(articleSchema) }}
            />
            <script
                type="application/ld+json"
                dangerouslySetInnerHTML={{ __html: JSON.stringify(breadcrumbSchema) }}
            />
        </>
    );
}
</file>

<file path="frontend/app/ipo/[slug]/layout.tsx">
import { Metadata } from 'next';

export const revalidate = 3600; // Revalidate every 1 hour

// Mock IPO data for metadata generation - in production, fetch from API
const getIPOData = async (slug: string) => {
    const companyName = slug
        .replace(/-ipo-gmp-allotment-subscription$/, '')
        .split('-')
        .map(word => word.charAt(0).toUpperCase() + word.slice(1))
        .join(' ');

    return {
        companyName,
        gmp: 485,
        gmpPercentage: 96.5,
        subscription: 69.43,
        priceMin: 475,
        priceMax: 500,
        openDate: '2024-11-22',
        closeDate: '2024-11-24',
        allotmentDate: '2024-11-29',
        listingDate: '2024-11-30',
        registrar: 'Link Intime India Pvt Ltd',
        registrarLink: 'https://linkintime.co.in',
    };
};

interface Props {
    params: Promise<{ slug: string }>;
}

export async function generateMetadata({ params }: Props): Promise<Metadata> {
    const { slug } = await params;
    const ipo = await getIPOData(slug);
    const currentYear = new Date().getFullYear();
    const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || 'https://ipotracker.in';
    const pageUrl = `${baseUrl}/ipo/${slug}`;
    const logoUrl = `${baseUrl}/images/ipo/${slug}-logo.png`;

    return {
        title: `${ipo.companyName} IPO GMP, Allotment Status, Subscription, Review ${currentYear}`,
        description: `${ipo.companyName} IPO: Live GMP ‚Çπ${ipo.gmp} (+${ipo.gmpPercentage}%), subscription ${ipo.subscription}x. Check allotment status, issue date, price band ‚Çπ${ipo.priceMin}-${ipo.priceMax}, grey market premium & expert review.`,
        keywords: [
            `${ipo.companyName.toLowerCase()} ipo`,
            `${ipo.companyName.toLowerCase()} ipo gmp`,
            `${ipo.companyName.toLowerCase()} ipo allotment status`,
            `${ipo.companyName.toLowerCase()} ipo subscription`,
            `${ipo.companyName.toLowerCase()} grey market premium`,
            `${ipo.companyName.toLowerCase()} ipo listing date`,
            `${ipo.companyName.toLowerCase()} ipo review`,
            'ipo gmp today',
            'upcoming ipo',
            'ipo allotment',
        ],
        authors: [{ name: 'IPO Tracker' }],
        creator: 'IPO Tracker',
        publisher: 'IPO Tracker',
        robots: {
            index: true,
            follow: true,
            googleBot: {
                index: true,
                follow: true,
                'max-video-preview': -1,
                'max-image-preview': 'large',
                'max-snippet': -1,
            },
        },
        alternates: {
            canonical: pageUrl,
        },
        openGraph: {
            title: `${ipo.companyName} IPO - GMP ‚Çπ${ipo.gmp}, Subscription ${ipo.subscription}x`,
            description: `Get live updates on ${ipo.companyName} IPO. Current GMP, subscription status, allotment date & detailed review.`,
            url: pageUrl,
            siteName: 'IPO Tracker',
            images: [
                {
                    url: logoUrl,
                    width: 1200,
                    height: 630,
                    alt: `${ipo.companyName} IPO`,
                },
            ],
            locale: 'en_IN',
            type: 'article',
        },
        twitter: {
            card: 'summary_large_image',
            title: `${ipo.companyName} IPO - Live GMP & Subscription Status`,
            description: `Track ${ipo.companyName} IPO: GMP ‚Çπ${ipo.gmp}, Subscription ${ipo.subscription}x`,
            images: [logoUrl],
            creator: '@ipotracker',
        },
        other: {
            'article:published_time': new Date().toISOString(),
            'article:modified_time': new Date().toISOString(),
            'article:section': 'Finance',
            'article:tag': 'IPO, Stock Market, Investment',
        },
    };
}

export default function IPOLayout({
    children,
}: {
    children: React.ReactNode;
}) {
    return children;
}
</file>

<file path="frontend/app/ipo/[slug]/page.tsx">
'use client';

import { useState, useEffect } from 'react';
import { useParams } from 'next/navigation';
import Link from 'next/link';
import styles from './page.module.css';
import IPOSchema from './IPOSchema';

// Breadcrumb component for internal linking and SEO
const Breadcrumb = ({ companyName }: { companyName: string }) => (
    <nav aria-label="Breadcrumb" className={styles.breadcrumb}>
        <ol itemScope itemType="https://schema.org/BreadcrumbList" style={{ display: 'flex', gap: '0.5rem', listStyle: 'none', margin: 0, padding: '0.5rem 0', fontSize: '0.875rem', color: 'var(--neutral-200)' }}>
            <li itemProp="itemListElement" itemScope itemType="https://schema.org/ListItem">
                <Link href="/" itemProp="item" style={{ color: 'var(--accent-cyan)' }}><span itemProp="name">Home</span></Link>
                <meta itemProp="position" content="1" />
            </li>
            <li style={{ color: 'var(--neutral-200)' }}>/</li>
            <li itemProp="itemListElement" itemScope itemType="https://schema.org/ListItem">
                <Link href="/upcoming-ipos" itemProp="item" style={{ color: 'var(--accent-cyan)' }}><span itemProp="name">IPOs</span></Link>
                <meta itemProp="position" content="2" />
            </li>
            <li style={{ color: 'var(--neutral-200)' }}>/</li>
            <li itemProp="itemListElement" itemScope itemType="https://schema.org/ListItem">
                <span itemProp="name">{companyName} IPO</span>
                <meta itemProp="position" content="3" />
            </li>
        </ol>
    </nav>
);

// Mock IPO data - will be replaced with API call
const mockIPOData = {
    id: 1,
    slug: 'tata-technologies-ipo-gmp-allotment-subscription',
    companyName: 'Tata Technologies',
    logo: 'TT',
    status: 'Open for Subscription' as const,
    category: 'Mainboard',

    // Hero Metrics
    gmp: 485,
    gmpPercentage: 96.5,
    subscription: 69.43,
    priceMin: 475,
    priceMax: 500,
    lotSize: 30,

    // Quick Facts
    issueType: 'Mainboard',
    issueSize: 3042.51,
    freshIssue: 0,
    ofs: 3042.51,
    minInvestment: 15000,
    openDate: '2024-11-22',
    closeDate: '2024-11-24',
    allotmentDate: '2024-11-29',
    listingDate: '2024-11-30',
    registrar: 'Link Intime India Pvt Ltd',
    registrarLink: 'https://linkintime.co.in',
    leadManagers: ['JM Financial', 'Citigroup', 'BofA Securities'],
    exchanges: ['NSE', 'BSE'],

    // Subscription Details
    subscriptionData: {
        overall: 69.43,
        qib: 200.56,
        nii: 45.23,
        bNII: 38.45,
        sNII: 52.18,
        retail: 12.87,
        employee: 8.45,
        shareholder: 15.23,
    },
    lastUpdated: '2024-11-24T16:30:00',

    // GMP History
    gmpHistory: [
        { date: '2024-11-24', gmp: 485, change: '+25', premium: 96.5 },
        { date: '2024-11-23', gmp: 460, change: '+40', premium: 92.0 },
        { date: '2024-11-22', gmp: 420, change: '+35', premium: 84.0 },
        { date: '2024-11-21', gmp: 385, change: '+20', premium: 77.0 },
        { date: '2024-11-20', gmp: 365, change: '+15', premium: 73.0 },
    ],
    kostakRate: 25000,
    subjectToSauda: 22000,

    // Financials
    financials: {
        revenueFY23: 4414.87,
        revenueFY22: 3530.42,
        revenueFY21: 2485.24,
        patFY23: 624.31,
        patFY22: 438.26,
        patFY21: 169.52,
        netWorth: 2586.43,
        eps: 15.42,
        peRatio: 32.4,
        ronw: 24.1,
        debtToEquity: 0.02,
    },

    // Issue Details
    issueBreakup: {
        freshIssue: 0,
        freshIssuePercent: 0,
        ofs: 3042.51,
        ofsPercent: 100,
        preIpoPlacement: 0,
        totalIssue: 3042.51,
        postIssuePaidUp: 405.18,
        marketCap: 20259,
    },
    useOfFunds: [
        { label: 'General Corporate Purposes', percentage: 100, color: '#2563eb' },
    ],

    // Shareholding
    preIpoShareholding: [
        { label: 'Promoters', percentage: 74.39, color: '#2563eb' },
        { label: 'Public', percentage: 25.61, color: '#06b6d4' },
    ],
    postIpoShareholding: [
        { label: 'Promoters', percentage: 59.15, color: '#2563eb' },
        { label: 'QIB', percentage: 18.42, color: '#10b981' },
        { label: 'NII', percentage: 7.37, color: '#f59e0b' },
        { label: 'Retail', percentage: 9.82, color: '#ef4444' },
        { label: 'Others', percentage: 5.24, color: '#8b5cf6' },
    ],
    promoters: [
        { name: 'Tata Motors Ltd', relationship: 'Holding Company', preIpo: 74.39, postIpo: 59.15 },
    ],
    lockInPeriod: { promoter: 18, preIpo: 6 },

    // Company Info
    about: {
        overview: `Tata Technologies is a global engineering and product development digital services company. The company provides services to automotive and aerospace manufacturers worldwide. With over 11,000 employees across 21 countries, they help clients design, develop, and realize better products.`,
        highlights: [
            'Global leader in engineering and design services',
            'Serving top automotive and aerospace OEMs',
            'Strong presence in EV and sustainable mobility',
            'Robust R&D capabilities with 8 global delivery centers',
            'Part of the Tata Group with strong parentage',
            'High client retention rate of 95%+',
        ],
        industry: 'Engineering Research & Development Services',
        marketSize: 'USD 215 billion globally',
    },

    // Expert Review
    review: {
        overall: 4.2,
        ratings: {
            financial: 4.5,
            valuation: 3.8,
            growth: 4.5,
            management: 4.2,
            industry: 4.0,
        },
        strengths: [
            'Strong parentage with Tata Group brand value',
            'Diversified global client base across geographies',
            'Leadership position in ER&D services segment',
        ],
        concerns: [
            'Premium valuation compared to listed peers',
            'High dependence on automotive sector',
            'Forex exposure due to global operations',
        ],
        recommendation: 'Subscribe for Long-term',
        riskLevel: 'Medium',
        investmentHorizon: 'Long-term (2-3 years)',
    },
    poll: { yes: 78, no: 22, totalVotes: 12543 },

    // Timeline
    timeline: [
        { label: 'IPO Announcement', date: '2024-11-15', status: 'completed' },
        { label: 'Price Band', date: '2024-11-18', status: 'completed' },
        { label: 'IPO Opens', date: '2024-11-22', status: 'active' },
        { label: 'IPO Closes', date: '2024-11-24', status: 'upcoming' },
        { label: 'Allotment', date: '2024-11-29', status: 'upcoming' },
        { label: 'Refunds', date: '2024-11-30', status: 'upcoming' },
        { label: 'Credit to Demat', date: '2024-11-30', status: 'upcoming' },
        { label: 'Listing', date: '2024-12-01', status: 'upcoming' },
    ],

    // FAQs
    faqs: [
        { q: 'What is the Tata Technologies IPO price band?', a: 'The price band for Tata Technologies IPO is ‚Çπ475 to ‚Çπ500 per share. At the upper price band, the minimum investment required is ‚Çπ15,000 for 1 lot (30 shares).' },
        { q: 'When does Tata Technologies IPO open and close?', a: 'Tata Technologies IPO opens on November 22, 2024 and closes on November 24, 2024. The IPO is open for subscription for 3 days.' },
        { q: 'What is the current GMP for Tata Technologies IPO?', a: 'The current Grey Market Premium (GMP) for Tata Technologies IPO is ‚Çπ485, indicating an expected listing gain of approximately 97% over the issue price.' },
        { q: 'How to check Tata Technologies IPO allotment status?', a: 'You can check the allotment status on the registrar website (Link Intime) or on BSE/NSE websites using your PAN number or application number after the allotment date.' },
        { q: 'What is the lot size for Tata Technologies IPO?', a: 'The lot size is 30 shares. Retail investors can apply for minimum 1 lot (‚Çπ15,000) and maximum 13 lots (‚Çπ1,95,000).' },
    ],

    // Related IPOs
    relatedIPOs: [
        { id: 2, name: 'Fedbank Financial', priceRange: '‚Çπ133-140', gmp: 25, subscription: 2.43, logo: 'FF' },
        { id: 3, name: 'Gandhar Oil', priceRange: '‚Çπ160-169', gmp: 45, subscription: 8.76, logo: 'GO' },
        { id: 4, name: 'Flair Writing', priceRange: '‚Çπ288-304', gmp: 65, subscription: 15.23, logo: 'FW' },
    ],

    // Comments
    comments: [
        { id: 1, author: 'Rahul Sharma', date: '2024-11-24', body: 'Great IPO, definitely applying for long term. Tata brand gives confidence.' },
        { id: 2, author: 'Priya Patel', date: '2024-11-23', body: 'GMP is very high, might see some correction post listing. Careful with expectations.' },
        { id: 3, author: 'Amit Kumar', date: '2024-11-22', body: 'Applied from 3 accounts. High hopes for allotment!' },
    ],
};

type IPOStatus = 'Open for Subscription' | 'Closed' | 'Allotment Done' | 'Listed';

const getStatusClass = (status: IPOStatus) => {
    switch (status) {
        case 'Open for Subscription': return styles.statusOpen;
        case 'Closed': return styles.statusClosed;
        case 'Allotment Done': return styles.statusAllotment;
        case 'Listed': return styles.statusListed;
        default: return '';
    }
};

const getProgressColor = (value: number) => {
    if (value < 1) return styles.progressRed;
    if (value < 5) return styles.progressOrange;
    if (value < 10) return styles.progressYellow;
    return styles.progressGreen;
};

const formatDate = (dateStr: string) => {
    const date = new Date(dateStr);
    return date.toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' });
};

const formatCurrency = (amount: number) => `‚Çπ${amount.toLocaleString('en-IN')}`;

export default function IPODetailPage() {
    const params = useParams();
    const [ipo, setIpo] = useState(mockIPOData);
    const [openFaqs, setOpenFaqs] = useState<number[]>([]);
    const [showStickyFooter, setShowStickyFooter] = useState(false);

    useEffect(() => {
        const handleScroll = () => {
            setShowStickyFooter(window.scrollY > 500);
        };
        window.addEventListener('scroll', handleScroll);
        return () => window.removeEventListener('scroll', handleScroll);
    }, []);

    const toggleFaq = (index: number) => {
        setOpenFaqs(prev => prev.includes(index) ? prev.filter(i => i !== index) : [...prev, index]);
    };

    return (
        <div className={styles.pageWrapper}>
            {/* JSON-LD Schema Markup for SEO */}
            <IPOSchema
                companyName={ipo.companyName}
                gmp={ipo.gmp}
                gmpPercentage={ipo.gmpPercentage}
                subscription={ipo.subscription}
                priceMin={ipo.priceMin}
                priceMax={ipo.priceMax}
                openDate={ipo.openDate}
                closeDate={ipo.closeDate}
                allotmentDate={ipo.allotmentDate}
                listingDate={ipo.listingDate}
                registrar={ipo.registrar}
                registrarLink={ipo.registrarLink}
                faqs={ipo.faqs}
                slug={ipo.slug}
            />

            <div className={styles.container}>
                {/* Breadcrumb Navigation */}
                <Breadcrumb companyName={ipo.companyName} />

                {/* SECTION A: Hero */}
                <section className={styles.hero} aria-labelledby="hero-title">
                    <div className={styles.heroHeader}>
                        <div className={styles.heroLeft}>
                            <div className={styles.companyLogo} role="img" aria-label={`${ipo.companyName} logo`}>{ipo.logo}</div>
                            <div>
                                <h1 id="hero-title" className={styles.heroTitle}>{ipo.companyName} IPO - GMP, Subscription, Allotment Status, Review</h1>
                                <span className={`${styles.statusBadge} ${getStatusClass(ipo.status)}`} role="status" aria-live="polite">
                                    ‚óè {ipo.status}
                                </span>
                                <p className={styles.lastUpdated}>Last updated: <time dateTime={ipo.lastUpdated}>{formatDate(ipo.lastUpdated)}</time></p>
                            </div>
                        </div>
                        <button className={styles.alertButton} aria-label={`Set price alert for ${ipo.companyName} IPO`}>üîî Set Alert</button>
                    </div>

                    <div className={styles.metricsGrid}>
                        <div className={styles.metricCard}>
                            <div className={styles.metricLabel}>Grey Market Premium</div>
                            <div className={styles.metricValue}>{formatCurrency(ipo.gmp)}</div>
                            <div className={`${styles.metricChange} ${styles.positive}`}>+{ipo.gmpPercentage}%</div>
                        </div>
                        <div className={styles.metricCard}>
                            <div className={styles.metricLabel}>Subscription</div>
                            <div className={styles.metricValue}>{ipo.subscription}x</div>
                            <div className={`${styles.metricChange} ${styles.positive}`}>times</div>
                        </div>
                        <div className={styles.metricCard}>
                            <div className={styles.metricLabel}>Price Band</div>
                            <div className={styles.metricValue}>{formatCurrency(ipo.priceMin)} - {formatCurrency(ipo.priceMax)}</div>
                        </div>
                        <div className={styles.metricCard}>
                            <div className={styles.metricLabel}>Lot Size</div>
                            <div className={styles.metricValue}>{ipo.lotSize} shares</div>
                            <div className={styles.metricChange}>{formatCurrency(ipo.lotSize * ipo.priceMax)}</div>
                        </div>
                    </div>
                </section>

                {/* SECTION B: Quick Facts */}
                <section className={styles.section}>
                    <h2 className={styles.sectionTitle}><span className={styles.sectionIcon}>üìã</span> Quick Facts</h2>
                    <div className={styles.factsGrid}>
                        <div className={styles.factItem}><span className={styles.factLabel}>üìä Issue Type</span><span className={styles.factValue}>{ipo.issueType}</span></div>
                        <div className={styles.factItem}><span className={styles.factLabel}>üìÖ IPO Open Date</span><span className={styles.factValue}>{formatDate(ipo.openDate)}</span></div>
                        <div className={styles.factItem}><span className={styles.factLabel}>üí∞ Issue Size</span><span className={styles.factValue}>{formatCurrency(ipo.issueSize)} Cr</span></div>
                        <div className={styles.factItem}><span className={styles.factLabel}>üìÖ IPO Close Date</span><span className={styles.factValue}>{formatDate(ipo.closeDate)}</span></div>
                        <div className={styles.factItem}><span className={styles.factLabel}>üÜï Fresh Issue</span><span className={styles.factValue}>{formatCurrency(ipo.freshIssue)} Cr</span></div>
                        <div className={styles.factItem}><span className={styles.factLabel}>üìÖ Allotment Date</span><span className={styles.factValue}>{formatDate(ipo.allotmentDate)}</span></div>
                        <div className={styles.factItem}><span className={styles.factLabel}>üîÑ OFS</span><span className={styles.factValue}>{formatCurrency(ipo.ofs)} Cr</span></div>
                        <div className={styles.factItem}><span className={styles.factLabel}>üìÖ Listing Date</span><span className={styles.factValue}>{formatDate(ipo.listingDate)}</span></div>
                        <div className={styles.factItem}><span className={styles.factLabel}>üíµ Price Band</span><span className={styles.factValue}>{formatCurrency(ipo.priceMin)} - {formatCurrency(ipo.priceMax)}</span></div>
                        <div className={styles.factItem}><span className={styles.factLabel}>üìù Registrar</span><span className={styles.factValue}>{ipo.registrar}</span></div>
                        <div className={styles.factItem}><span className={styles.factLabel}>üì¶ Lot Size</span><span className={styles.factValue}>{ipo.lotSize} shares</span></div>
                        <div className={styles.factItem}><span className={styles.factLabel}>üè¢ Lead Managers</span><span className={styles.factValue}>{ipo.leadManagers.length} managers</span></div>
                        <div className={styles.factItem}><span className={styles.factLabel}>üí∏ Min Investment</span><span className={styles.factValue}>{formatCurrency(ipo.minInvestment)}</span></div>
                        <div className={styles.factItem}><span className={styles.factLabel}>üìà Exchange</span><span className={styles.factValue}>{ipo.exchanges.join(', ')}</span></div>
                    </div>
                </section>

                {/* SECTION C: Subscription Status */}
                <section className={styles.section}>
                    <h2 className={styles.sectionTitle}><span className={styles.sectionIcon}>üìä</span> Live Subscription Status</h2>
                    <div className={styles.subscriptionOverall}>
                        <div className={styles.overallLabel}>Overall Subscription</div>
                        <div className={styles.overallValue}>{ipo.subscriptionData.overall}x</div>
                        <div className={`${styles.overallTrend} ${styles.positive}`}>‚ñ≤ times subscribed</div>
                    </div>

                    <div className={styles.categoryCards}>
                        {[
                            { name: 'QIB', value: ipo.subscriptionData.qib },
                            { name: 'NII (bNII)', value: ipo.subscriptionData.bNII },
                            { name: 'NII (sNII)', value: ipo.subscriptionData.sNII },
                            { name: 'Retail (RII)', value: ipo.subscriptionData.retail },
                            { name: 'Employee', value: ipo.subscriptionData.employee },
                        ].map((cat) => (
                            <div key={cat.name} className={styles.categoryCard}>
                                <div className={styles.categoryName}>{cat.name}</div>
                                <div className={styles.categoryValue}>{cat.value}x</div>
                                <div className={styles.progressBar}>
                                    <div
                                        className={`${styles.progressFill} ${getProgressColor(cat.value)}`}
                                        style={{ width: `${Math.min(cat.value * 10, 100)}%` }}
                                    />
                                </div>
                            </div>
                        ))}
                    </div>

                    <div className={styles.refreshRow}>
                        <span className={styles.timestamp}>Updated: {formatDate(ipo.lastUpdated)}</span>
                        <button className={styles.refreshButton}>üîÑ Refresh Now</button>
                    </div>
                </section>

                {/* SECTION D: GMP Tracker */}
                <section className={styles.section}>
                    <h2 className={styles.sectionTitle}><span className={styles.sectionIcon}>üíπ</span> Grey Market Premium (GMP) Analysis</h2>
                    <div className={styles.gmpGrid}>
                        <div className={styles.gmpMainCard}>
                            <div className={styles.gmpAmount}>{formatCurrency(ipo.gmp)}</div>
                            <div className={styles.gmpRow}><span className={styles.gmpLabel}>GMP Premium</span><span className={`${styles.gmpValue} ${styles.positive}`}>+{ipo.gmpPercentage}%</span></div>
                            <div className={styles.gmpRow}><span className={styles.gmpLabel}>Expected Listing</span><span className={styles.gmpValue}>{formatCurrency(ipo.priceMax + ipo.gmp)}</span></div>
                            <div className={styles.gmpRow}><span className={styles.gmpLabel}>Est. Listing Gain</span><span className={`${styles.gmpValue} ${styles.positive}`}>{formatCurrency(ipo.gmp * ipo.lotSize)}</span></div>
                            <div className={styles.gmpRow}><span className={styles.gmpLabel}>Kostak Rate</span><span className={styles.gmpValue}>{formatCurrency(ipo.kostakRate)}</span></div>
                            <div className={styles.gmpRow}><span className={styles.gmpLabel}>Subject to Sauda</span><span className={styles.gmpValue}>{formatCurrency(ipo.subjectToSauda)}</span></div>
                        </div>

                        <div className={styles.gmpChart}>
                            <div className={styles.chartTitle}>GMP Trend (Last 5 Days)</div>
                            <div className={styles.chartArea}>
                                {ipo.gmpHistory.slice().reverse().map((day, i) => (
                                    <div key={i} className={styles.chartBar} style={{ height: `${(day.gmp / 500) * 100}%` }} title={`${day.date}: ‚Çπ${day.gmp}`} />
                                ))}
                            </div>
                        </div>
                    </div>

                    <div className={styles.gmpHistoryTable}>
                        <table className={styles.historyTable}>
                            <thead>
                                <tr><th>Date</th><th>GMP (‚Çπ)</th><th>Change</th><th>Premium (%)</th></tr>
                            </thead>
                            <tbody>
                                {ipo.gmpHistory.map((day, i) => (
                                    <tr key={i}>
                                        <td>{formatDate(day.date)}</td>
                                        <td>{formatCurrency(day.gmp)}</td>
                                        <td className={styles.positive}>{day.change}</td>
                                        <td>{day.premium}%</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>

                    <div className={styles.disclaimer}>‚ö†Ô∏è GMP Disclaimer: Grey market premiums are unofficial and may not reflect actual listing performance. Invest based on fundamentals.</div>
                </section>

                {/* SECTION E: Allotment Details */}
                <section className={styles.section}>
                    <h2 className={styles.sectionTitle}><span className={styles.sectionIcon}>üéØ</span> IPO Allotment Status & Details</h2>
                    <div className={styles.allotmentGrid}>
                        <div className={styles.allotmentCard}>
                            <h3>Allotment Status</h3>
                            <p style={{ marginBottom: '1rem', color: 'var(--neutral-200)' }}>Expected on: {formatDate(ipo.allotmentDate)}</p>
                            <a href={ipo.registrarLink} target="_blank" rel="noopener noreferrer" className={styles.registrarLink}>
                                üîó Check on {ipo.registrar}
                            </a>
                        </div>
                        <div className={styles.allotmentCard}>
                            <h3>Refund Information</h3>
                            <p style={{ color: 'var(--neutral-200)', marginBottom: '0.5rem' }}>Refund Date: {formatDate(ipo.timeline.find(t => t.label === 'Refunds')?.date || '')}</p>
                            <p style={{ color: 'var(--neutral-200)' }}>Credit to Demat: {formatDate(ipo.listingDate)}</p>
                        </div>
                    </div>
                </section>

                {/* SECTION F: Financials */}
                <section className={styles.section}>
                    <h2 className={styles.sectionTitle}><span className={styles.sectionIcon}>üí∞</span> Company Financial Performance</h2>
                    <div className={styles.financialCards}>
                        {[
                            { label: 'Revenue (FY23)', value: `‚Çπ${ipo.financials.revenueFY23} Cr` },
                            { label: 'PAT (FY23)', value: `‚Çπ${ipo.financials.patFY23} Cr` },
                            { label: 'Net Worth', value: `‚Çπ${ipo.financials.netWorth} Cr` },
                            { label: 'EPS', value: `‚Çπ${ipo.financials.eps}` },
                            { label: 'P/E Ratio', value: `${ipo.financials.peRatio}x` },
                            { label: 'RoNW', value: `${ipo.financials.ronw}%` },
                            { label: 'Debt/Equity', value: `${ipo.financials.debtToEquity}` },
                        ].map((metric) => (
                            <div key={metric.label} className={styles.financialCard}>
                                <div className={styles.financialLabel}>{metric.label}</div>
                                <div className={styles.financialValue}>{metric.value}</div>
                            </div>
                        ))}
                    </div>

                    <table className={styles.financialTable}>
                        <thead><tr><th>Particulars</th><th>FY23</th><th>FY22</th><th>FY21</th><th>Growth</th></tr></thead>
                        <tbody>
                            <tr><td>Revenue (‚Çπ Cr)</td><td>{ipo.financials.revenueFY23}</td><td>{ipo.financials.revenueFY22}</td><td>{ipo.financials.revenueFY21}</td><td className={styles.positive}>+25%</td></tr>
                            <tr><td>PAT (‚Çπ Cr)</td><td>{ipo.financials.patFY23}</td><td>{ipo.financials.patFY22}</td><td>{ipo.financials.patFY21}</td><td className={styles.positive}>+42%</td></tr>
                        </tbody>
                    </table>
                </section>

                {/* SECTION G: Issue Details */}
                <section className={styles.section}>
                    <h2 className={styles.sectionTitle}><span className={styles.sectionIcon}>üìÑ</span> IPO Details</h2>
                    <div className={styles.issueGrid}>
                        <div className={styles.issueBreakup}>
                            <h3>Issue Breakup</h3>
                            {[
                                { label: 'Fresh Issue', value: `‚Çπ${ipo.issueBreakup.freshIssue} Cr (${ipo.issueBreakup.freshIssuePercent}%)` },
                                { label: 'Offer for Sale', value: `‚Çπ${ipo.issueBreakup.ofs} Cr (${ipo.issueBreakup.ofsPercent}%)` },
                                { label: 'Total Issue Size', value: `‚Çπ${ipo.issueBreakup.totalIssue} Cr` },
                                { label: 'Market Cap (Upper)', value: `‚Çπ${ipo.issueBreakup.marketCap} Cr` },
                            ].map((item) => (
                                <div key={item.label} className={styles.breakupItem}>
                                    <span className={styles.breakupLabel}>{item.label}</span>
                                    <span className={styles.breakupValue}>{item.value}</span>
                                </div>
                            ))}
                        </div>
                        <div className={styles.useFunds}>
                            <h3>Use of Funds</h3>
                            <div className={styles.pieChart} style={{ background: `conic-gradient(${ipo.useOfFunds.map((f, i) => `${f.color} ${i === 0 ? 0 : ipo.useOfFunds.slice(0, i).reduce((a, b) => a + b.percentage, 0)}% ${ipo.useOfFunds.slice(0, i + 1).reduce((a, b) => a + b.percentage, 0)}%`).join(', ')})` }} />
                            <div className={styles.pieLegend}>
                                {ipo.useOfFunds.map((fund) => (
                                    <div key={fund.label} className={styles.legendItem}>
                                        <span className={styles.legendColor} style={{ background: fund.color }} />
                                        <span>{fund.label}: {fund.percentage}%</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </section>

                {/* SECTION H: Shareholding */}
                <section className={styles.section}>
                    <h2 className={styles.sectionTitle}><span className={styles.sectionIcon}>üèõÔ∏è</span> Shareholding Pattern</h2>
                    <div className={styles.shareholdingGrid}>
                        <div className={styles.shareholdingCard}>
                            <h3>Pre-IPO Shareholding</h3>
                            <div className={styles.pieChart} style={{ background: `conic-gradient(${ipo.preIpoShareholding.map((s, i) => `${s.color} ${i === 0 ? 0 : ipo.preIpoShareholding.slice(0, i).reduce((a, b) => a + b.percentage, 0)}% ${ipo.preIpoShareholding.slice(0, i + 1).reduce((a, b) => a + b.percentage, 0)}%`).join(', ')})` }} />
                            <div className={styles.pieLegend}>
                                {ipo.preIpoShareholding.map((s) => (
                                    <div key={s.label} className={styles.legendItem}><span className={styles.legendColor} style={{ background: s.color }} /><span>{s.label}: {s.percentage}%</span></div>
                                ))}
                            </div>
                        </div>
                        <div className={styles.shareholdingCard}>
                            <h3>Post-IPO Shareholding</h3>
                            <div className={styles.pieChart} style={{ background: `conic-gradient(${ipo.postIpoShareholding.map((s, i) => `${s.color} ${i === 0 ? 0 : ipo.postIpoShareholding.slice(0, i).reduce((a, b) => a + b.percentage, 0)}% ${ipo.postIpoShareholding.slice(0, i + 1).reduce((a, b) => a + b.percentage, 0)}%`).join(', ')})` }} />
                            <div className={styles.pieLegend}>
                                {ipo.postIpoShareholding.map((s) => (
                                    <div key={s.label} className={styles.legendItem}><span className={styles.legendColor} style={{ background: s.color }} /><span>{s.label}: {s.percentage}%</span></div>
                                ))}
                            </div>
                        </div>
                    </div>
                    <table className={styles.promoterTable}>
                        <thead><tr><th>Promoter Name</th><th>Relationship</th><th>Pre-IPO (%)</th><th>Post-IPO (%)</th></tr></thead>
                        <tbody>
                            {ipo.promoters.map((p, i) => (
                                <tr key={i}><td>{p.name}</td><td>{p.relationship}</td><td>{p.preIpo}%</td><td>{p.postIpo}%</td></tr>
                            ))}
                        </tbody>
                    </table>
                </section>

                {/* SECTION I: About Company */}
                <section className={styles.section}>
                    <h2 className={styles.sectionTitle}><span className={styles.sectionIcon}>üè¢</span> About {ipo.companyName}</h2>
                    <div className={styles.companyOverview}><p>{ipo.about.overview}</p></div>
                    <h3 style={{ marginBottom: '1rem', color: 'var(--neutral-100)' }}>Key Highlights</h3>
                    <div className={styles.highlights}>
                        {ipo.about.highlights.map((h, i) => (
                            <div key={i} className={styles.highlightItem}><span className={styles.highlightIcon}>‚úì</span><span className={styles.highlightText}>{h}</span></div>
                        ))}
                    </div>
                </section>

                {/* SECTION J: Expert Review */}
                <section className={styles.section}>
                    <h2 className={styles.sectionTitle}><span className={styles.sectionIcon}>‚≠ê</span> IPO Review & Recommendation</h2>
                    <div className={styles.reviewHeader}>
                        <div className={styles.overallRating}>
                            <div className={styles.ratingStars}>{'‚òÖ'.repeat(Math.floor(ipo.review.overall))}{'‚òÜ'.repeat(5 - Math.floor(ipo.review.overall))}</div>
                            <div className={styles.ratingLabel}>{ipo.review.overall} out of 5</div>
                        </div>
                        <div className={styles.ratingBars}>
                            {Object.entries(ipo.review.ratings).map(([key, value]) => (
                                <div key={key} className={styles.ratingItem}>
                                    <span className={styles.ratingName}>{key.charAt(0).toUpperCase() + key.slice(1)}</span>
                                    <div className={styles.ratingBar}><div className={styles.ratingFill} style={{ width: `${value * 20}%` }} /></div>
                                    <span className={styles.ratingValue}>{value}/5</span>
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className={styles.prosConsGrid}>
                        <div className={styles.prosSection}>
                            <h3>‚úì Strengths</h3>
                            <ul className={styles.prosList}>{ipo.review.strengths.map((s, i) => <li key={i}><span>‚úì</span> {s}</li>)}</ul>
                        </div>
                        <div className={styles.consSection}>
                            <h3>‚ö† Concerns</h3>
                            <ul className={styles.consList}>{ipo.review.concerns.map((c, i) => <li key={i}><span>‚ö†</span> {c}</li>)}</ul>
                        </div>
                    </div>

                    <div className={styles.recommendationBox}>
                        <div className={styles.recommendationLabel}>Expert Recommendation</div>
                        <div className={styles.recommendationValue}>{ipo.review.recommendation}</div>
                        <p style={{ color: 'var(--neutral-200)', fontSize: '0.875rem' }}>Risk Level: {ipo.review.riskLevel} | Horizon: {ipo.review.investmentHorizon}</p>
                        <div className={styles.poll}>
                            <div className={styles.pollOption}>
                                <div className={styles.pollPercent}>{ipo.poll.yes}%</div>
                                <div className={styles.pollBar}><div className={`${styles.pollFill} ${styles.pollYes}`} style={{ width: `${ipo.poll.yes}%` }} /></div>
                                <div className={styles.pollLabel}>Should Apply</div>
                            </div>
                            <div className={styles.pollOption}>
                                <div className={styles.pollPercent}>{ipo.poll.no}%</div>
                                <div className={styles.pollBar}><div className={`${styles.pollFill} ${styles.pollNo}`} style={{ width: `${ipo.poll.no}%` }} /></div>
                                <div className={styles.pollLabel}>Should Skip</div>
                            </div>
                        </div>
                        <p style={{ marginTop: '1rem', color: 'var(--neutral-200)', fontSize: '0.75rem' }}>{ipo.poll.totalVotes.toLocaleString()} investors voted</p>
                    </div>
                </section>

                {/* SECTION K: Timeline */}
                <section className={styles.section}>
                    <h2 className={styles.sectionTitle}><span className={styles.sectionIcon}>üìÖ</span> IPO Timeline & Important Dates</h2>
                    <div className={styles.timeline}>
                        <div className={styles.timelineTrack}><div className={styles.timelineProgress} style={{ width: '37.5%' }} /></div>
                        <div className={styles.timelineItems}>
                            {ipo.timeline.map((item, i) => (
                                <div key={i} className={styles.timelineItem}>
                                    <div className={`${styles.timelineDot} ${item.status === 'completed' ? styles.completed : item.status === 'active' ? styles.active : ''}`} />
                                    <div><div className={styles.timelineLabel}>{item.label}</div><div className={styles.timelineDate}>{formatDate(item.date)}</div></div>
                                </div>
                            ))}
                        </div>
                    </div>
                    <div className={styles.countdown}>
                        <div className={styles.countdownLabel}>Time to IPO Close</div>
                        <div className={styles.countdownValue}>2 Days 8 Hours 30 Minutes</div>
                    </div>
                </section>

                {/* SECTION L: Registrar */}
                <section className={styles.section}>
                    <h2 className={styles.sectionTitle}><span className={styles.sectionIcon}>üèõÔ∏è</span> Registrar & Lead Managers</h2>
                    <div className={styles.registrarGrid}>
                        <div className={styles.registrarCard}>
                            <h3>Registrar</h3>
                            <div className={styles.registrarInfo}>
                                <p><strong>{ipo.registrar}</strong></p>
                                <p>Website: <a href={ipo.registrarLink} target="_blank" rel="noopener noreferrer" style={{ color: 'var(--accent-cyan)' }}>{ipo.registrarLink}</a></p>
                            </div>
                            <a href={ipo.registrarLink} target="_blank" rel="noopener noreferrer" className={styles.registrarLink} style={{ marginTop: '1rem', display: 'inline-flex' }}>Check Allotment Status</a>
                        </div>
                        <div className={styles.registrarCard}>
                            <h3>Book Running Lead Managers</h3>
                            <div className={styles.leadManagers}>
                                {ipo.leadManagers.map((m, i) => <span key={i} className={styles.managerBadge}>{m}</span>)}
                            </div>
                        </div>
                    </div>
                </section>

                {/* SECTION M: How to Apply */}
                <section className={styles.section}>
                    <h2 className={styles.sectionTitle}><span className={styles.sectionIcon}>üìù</span> How to Apply for {ipo.companyName} IPO</h2>
                    <div className={styles.stepsGrid}>
                        {[
                            { num: 1, title: 'Log in to your Demat Account', desc: 'Access your trading/demat account through your broker app or website.' },
                            { num: 2, title: 'Navigate to IPO Section', desc: 'Find the IPO or New Issues section in your trading platform.' },
                            { num: 3, title: `Select ${ipo.companyName} IPO`, desc: 'Click on the IPO to view details and apply.' },
                            { num: 4, title: 'Choose Number of Lots', desc: `Min: 1 lot (${ipo.lotSize} shares = ${formatCurrency(ipo.minInvestment)})` },
                            { num: 5, title: 'Select UPI ID or ASBA', desc: 'Enter your UPI ID for payment or select ASBA through your bank.' },
                            { num: 6, title: 'Submit Application', desc: 'Review details and submit your application.' },
                            { num: 7, title: 'Approve UPI Request', desc: 'Accept the mandate request in your UPI app within 24 hours.' },
                        ].map((step) => (
                            <div key={step.num} className={styles.step}>
                                <div className={styles.stepNumber}>{step.num}</div>
                                <div className={styles.stepContent}><h4>{step.title}</h4><p>{step.desc}</p>
                                    {step.num === 1 && (
                                        <div className={styles.brokerLinks}>
                                            {['Zerodha', 'Upstox', 'Groww', 'Angel One', 'ICICI Direct'].map((b) => <span key={b} className={styles.brokerLink}>{b}</span>)}
                                        </div>
                                    )}
                                </div>
                            </div>
                        ))}
                    </div>
                </section>

                {/* SECTION N: FAQs */}
                <section className={styles.section} aria-labelledby="faq-heading">
                    <h2 id="faq-heading" className={styles.sectionTitle}><span className={styles.sectionIcon}>‚ùì</span> Frequently Asked Questions</h2>
                    <div className={styles.faqList} role="region" aria-label="FAQ accordion">
                        {ipo.faqs.map((faq, i) => (
                            <div key={i} className={`${styles.faqItem} ${openFaqs.includes(i) ? styles.open : ''}`}>
                                <button
                                    className={styles.faqQuestion}
                                    onClick={() => toggleFaq(i)}
                                    aria-expanded={openFaqs.includes(i)}
                                    aria-controls={`faq-answer-${i}`}
                                    id={`faq-question-${i}`}
                                >
                                    {faq.q}
                                    <span className={styles.faqIcon} aria-hidden="true">+</span>
                                </button>
                                <div
                                    className={styles.faqAnswer}
                                    id={`faq-answer-${i}`}
                                    role="region"
                                    aria-labelledby={`faq-question-${i}`}
                                    hidden={!openFaqs.includes(i)}
                                >
                                    <div className={styles.faqAnswerContent}>{faq.a}</div>
                                </div>
                            </div>
                        ))}
                    </div>
                </section>

                {/* SECTION O: Related IPOs */}
                <section className={styles.section}>
                    <h2 className={styles.sectionTitle}><span className={styles.sectionIcon}>üìà</span> Similar IPOs You Might Be Interested In</h2>
                    <div className={styles.relatedScroll}>
                        {ipo.relatedIPOs.map((related) => (
                            <div key={related.id} className={styles.relatedCard}>
                                <div className={styles.relatedHeader}>
                                    <div className={styles.relatedLogo}>{related.logo}</div>
                                    <div className={styles.relatedName}>{related.name}</div>
                                </div>
                                <div className={styles.relatedMeta}>
                                    <div className={styles.relatedRow}><span className={styles.relatedLabel}>Price</span><span className={styles.relatedValue}>{related.priceRange}</span></div>
                                    <div className={styles.relatedRow}><span className={styles.relatedLabel}>GMP</span><span className={`${styles.relatedValue} ${styles.positive}`}>‚Çπ{related.gmp}</span></div>
                                    <div className={styles.relatedRow}><span className={styles.relatedLabel}>Subscription</span><span className={styles.relatedValue}>{related.subscription}x</span></div>
                                </div>
                                <Link href={`/ipo/${related.name.toLowerCase().replace(/\s+/g, '-')}-ipo-gmp-allotment-subscription`}><button className={styles.viewButton}>View Details</button></Link>
                            </div>
                        ))}
                    </div>
                </section>

                {/* SECTION P: Comments */}
                <section className={styles.section}>
                    <h2 className={styles.sectionTitle}><span className={styles.sectionIcon}>üí¨</span> Investor Discussion & Comments</h2>
                    <p style={{ marginBottom: '1.5rem', color: 'var(--neutral-200)' }}>{ipo.comments.length} investors have shared their views</p>

                    <div className={styles.commentForm}>
                        <div className={styles.formRow}>
                            <div className={styles.formGroup}><label>Name</label><input type="text" placeholder="Your name" /></div>
                            <div className={styles.formGroup}><label>Email</label><input type="email" placeholder="your@email.com" /></div>
                        </div>
                        <div className={styles.formGroup} style={{ marginBottom: '1rem' }}><label>Comment</label><textarea placeholder="Share your views on this IPO..." /></div>
                        <button className={styles.submitButton}>Submit Comment</button>
                    </div>

                    <div className={styles.commentsList}>
                        {ipo.comments.map((comment) => (
                            <div key={comment.id} className={styles.comment}>
                                <div className={styles.commentHeader}><span className={styles.commentAuthor}>{comment.author}</span><span className={styles.commentDate}>{formatDate(comment.date)}</span></div>
                                <div className={styles.commentBody}>{comment.body}</div>
                            </div>
                        ))}
                    </div>
                    <button className={styles.loadMore}>Load More Comments</button>
                </section>
            </div>

            {/* SECTION Q: Sticky Footer */}
            <div className={`${styles.stickyFooter} ${showStickyFooter ? styles.visible : ''}`}>
                <div className={styles.footerContent}>
                    <span className={styles.footerTitle}>Track {ipo.companyName} IPO</span>
                    <div className={styles.footerActions}>
                        <button className={`${styles.footerButton} ${styles.alertBtn}`}>üîî Set Alert</button>
                        <button className={`${styles.footerButton} ${styles.watchlistBtn}`}>‚≠ê Watchlist</button>
                        <button className={`${styles.footerButton} ${styles.shareBtn}`}>üì§ Share</button>
                    </div>
                </div>
            </div>
        </div>
    );
}
</file>

<file path="frontend/app/layout.tsx">
import { Playfair_Display, IBM_Plex_Sans, JetBrains_Mono } from 'next/font/google';
import './globals.css';
import Navigation from '@/components/Navigation';

const playfair = Playfair_Display({
  subsets: ['latin'],
  weight: ['700', '900'],
  variable: '--font-playfair',
});

const ibmPlex = IBM_Plex_Sans({
  subsets: ['latin'],
  weight: ['300', '400', '500', '600'],
  variable: '--font-ibm-plex',
});

const jetbrains = JetBrains_Mono({
  subsets: ['latin'],
  weight: ['400', '500'],
  variable: '--font-jetbrains',
});

import type { Metadata, Viewport } from 'next';

export const viewport: Viewport = {
  width: 'device-width',
  initialScale: 1,
  themeColor: '#0a0a0f',
};

export const metadata: Metadata = {
  title: {
    default: 'IPO Tracker - Live GMP, Subscription & Allotment Status',
    template: '%s | IPO Tracker',
  },
  description: 'Track live IPO Grey Market Premium (GMP), subscription status, allotment dates, and get expert analysis. Your comprehensive IPO investment companion for informed decisions.',
  keywords: ['IPO', 'Grey Market Premium', 'GMP', 'IPO subscription', 'IPO allotment', 'upcoming IPO', 'IPO tracker', 'stock market', 'NSE IPO', 'BSE IPO'],
  authors: [{ name: 'IPO Tracker' }],
  creator: 'IPO Tracker',
  publisher: 'IPO Tracker',
  robots: {
    index: true,
    follow: true,
    googleBot: {
      index: true,
      follow: true,
      'max-video-preview': -1,
      'max-image-preview': 'large',
      'max-snippet': -1,
    },
  },
  openGraph: {
    type: 'website',
    locale: 'en_IN',
    siteName: 'IPO Tracker',
    title: 'IPO Tracker - Live GMP, Subscription & Allotment Status',
    description: 'Track live IPO Grey Market Premium (GMP), subscription status, allotment dates, and get expert analysis.',
    images: [
      {
        url: '/og-image.png',
        width: 1200,
        height: 630,
        alt: 'IPO Tracker - Your IPO Investment Companion',
      },
    ],
  },
  twitter: {
    card: 'summary_large_image',
    title: 'IPO Tracker - Live GMP, Subscription & Allotment Status',
    description: 'Track live IPO Grey Market Premium (GMP), subscription status, allotment dates, and get expert analysis.',
    images: ['/og-image.png'],
  },
  icons: {
    icon: '/favicon.ico',
    apple: '/apple-touch-icon.png',
  },
  manifest: '/manifest.json',
  alternates: {
    canonical: 'https://ipotracker.in',
  },
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      <body className={`${playfair.variable} ${ibmPlex.variable} ${jetbrains.variable}`} suppressHydrationWarning>
        <Navigation />
        <main className="main-content">
          {children}
        </main>
      </body>
    </html>
  );
}
</file>

<file path="frontend/app/portfolio-optimizer/components/AccountManager.tsx">
// Account Manager Component
// TODO: Implement multi-account management UI
</file>

<file path="frontend/app/portfolio-optimizer/components/CapitalInput.tsx">
// Capital Input Component
// TODO: Implement capital input UI
</file>

<file path="frontend/app/portfolio-optimizer/components/ComparisonTable.tsx">
// Comparison Table Component
// TODO: Implement strategy comparison table
</file>

<file path="frontend/app/portfolio-optimizer/components/MultiAccountVisualizer.tsx">
// Multi-Account Visualizer Component
// TODO: Implement multi-account benefits visualization
</file>

<file path="frontend/app/portfolio-optimizer/components/StrategyCard.tsx">
// Strategy Card Component
// TODO: Implement strategy display card
</file>

<file path="frontend/app/portfolio-optimizer/page.module.css">
/* Portfolio Optimizer - Elegant Warm Theme */
/* Colors: #E8E0CC (cream), #D8D1BF (beige), green, black, yellow */

.container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 2rem;
    min-height: 100vh;
    background: #E8E0CC;
}

/* Hero Header */
.header {
    text-align: center;
    margin-bottom: 3rem;
    padding-top: 2rem;
}

.header h1 {
    font-size: 3rem;
    font-weight: 800;
    color: #1a1a1a;
    line-height: 1.2;
    margin-bottom: 1rem;
    font-family: var(--font-heading, 'Archivo Black', sans-serif);
    text-transform: uppercase;
    letter-spacing: -1px;
}

.gradientText {
    background: linear-gradient(135deg, #16a34a 0%, #22c55e 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.headerSubtitle {
    font-size: 1.125rem;
    color: #4a4a4a;
    max-width: 500px;
    margin: 0 auto;
}

/* IPO Status Badge */
.ipoStatus {
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    background: #1a1a1a;
    color: #ffd700;
    padding: 0.75rem 1.5rem;
    border: 3px solid #1a1a1a;
    margin-bottom: 3rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-size: 0.875rem;
}

.statusDot {
    width: 10px;
    height: 10px;
    background: #22c55e;
    border-radius: 50%;
    animation: pulse 2s infinite;
}

@keyframes pulse {

    0%,
    100% {
        opacity: 1;
        transform: scale(1);
    }

    50% {
        opacity: 0.5;
        transform: scale(1.2);
    }
}

/* Input Section Card */
.inputSection {
    background: #ffffff;
    border: 4px solid #1a1a1a;
    padding: 2.5rem;
    margin-bottom: 3rem;
    box-shadow: 6px 6px 0 #1a1a1a;
}

.sectionTitle {
    font-size: 1.5rem;
    font-weight: 700;
    color: #1a1a1a;
    margin-bottom: 2rem;
    font-family: var(--font-heading, 'Archivo Black', sans-serif);
    text-transform: uppercase;
}

/* Capital Input */
.capitalSection {
    margin-bottom: 2.5rem;
}

.inputLabel {
    display: block;
    font-size: 1rem;
    font-weight: 700;
    color: #1a1a1a;
    margin-bottom: 1rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.presetButtons {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
}

.presetBtn {
    padding: 0.625rem 1.25rem;
    background: #D8D1BF;
    color: #1a1a1a;
    border: 3px solid #1a1a1a;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.15s ease;
    text-transform: uppercase;
    font-size: 0.875rem;
}

.presetBtn:hover {
    background: #ffd700;
    transform: rotate(-1deg);
}

.presetBtn.active {
    background: #22c55e;
    color: #ffffff;
}

.capitalInput {
    width: 100%;
    padding: 1rem 1.25rem;
    font-size: 1.25rem;
    background: #E8E0CC;
    border: 3px solid #1a1a1a;
    color: #1a1a1a;
    outline: none;
    font-weight: 600;
    transition: all 0.15s ease;
}

.capitalInput:focus {
    background: #ffd700;
    box-shadow: 4px 4px 0 #1a1a1a;
}

.inputHint {
    font-size: 0.875rem;
    color: #666666;
    margin-top: 0.5rem;
}

/* People/Accounts Selector */
.peopleSection {
    margin-bottom: 2.5rem;
}

.peopleGrid {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 0.75rem;
}

.peopleBtn {
    padding: 1.25rem 0.5rem;
    background: #D8D1BF;
    color: #1a1a1a;
    border: 3px solid #1a1a1a;
    font-size: 1.5rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.15s ease;
}

.peopleBtn:hover {
    background: #ffd700;
    transform: rotate(-2deg);
}

.peopleBtn.active {
    background: #22c55e;
    color: #ffffff;
    transform: scale(1.05);
    box-shadow: 4px 4px 0 #1a1a1a;
}

.multiAccountTip {
    background: #1a1a1a;
    border: 3px solid #1a1a1a;
    padding: 1rem;
    margin-top: 1rem;
    color: #22c55e;
    font-weight: 600;
}

/* Summary Stats */
.summaryCard {
    background: #D8D1BF;
    border: 3px solid #1a1a1a;
    padding: 1.5rem;
    margin-bottom: 2rem;
}

.summaryGrid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
    text-align: center;
}

.summaryItem {
    padding: 0.5rem;
    border-right: 2px solid #1a1a1a;
}

.summaryItem:last-child {
    border-right: none;
}

.summaryLabel {
    font-size: 0.75rem;
    color: #4a4a4a;
    margin-bottom: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-weight: 700;
}

.summaryValue {
    font-size: 1.5rem;
    font-weight: 700;
    color: #1a1a1a;
}

/* Generate Button - CTA */
.generateButton {
    width: 100%;
    padding: 1.25rem;
    font-size: 1.125rem;
    font-weight: 700;
    background: #ffd700;
    color: #1a1a1a;
    border: 4px solid #1a1a1a;
    cursor: pointer;
    transition: all 0.15s ease;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    box-shadow: 4px 4px 0 #1a1a1a;
}

.generateButton:hover:not(:disabled) {
    transform: translate(-2px, -2px);
    box-shadow: 6px 6px 0 #1a1a1a;
    background: #22c55e;
    color: #ffffff;
}

.generateButton:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

/* Results Section */
.resultsSection {
    margin-top: 3rem;
}

.resultsTitle {
    font-size: 1.75rem;
    font-weight: 700;
    color: #1a1a1a;
    text-align: center;
    margin-bottom: 2rem;
    font-family: var(--font-heading, 'Archivo Black', sans-serif);
    text-transform: uppercase;
}

/* Strategy Cards */
.strategyCard {
    background: #ffffff;
    border: 4px solid #1a1a1a;
    padding: 2rem;
    margin-bottom: 1.5rem;
    position: relative;
    transition: all 0.15s ease;
    box-shadow: 4px 4px 0 #1a1a1a;
}

.strategyCard:hover {
    transform: translate(-2px, -2px);
    box-shadow: 6px 6px 0 #1a1a1a;
}

.strategyCard.recommended {
    background: #ffffff;
    border-color: #22c55e;
    box-shadow: 6px 6px 0 #22c55e;
}

.strategyCard.recommended::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 8px;
    background: #22c55e;
}

.recommendedBadge {
    position: absolute;
    top: -16px;
    left: 50%;
    transform: translateX(-50%);
    background: #22c55e;
    color: #ffffff;
    padding: 0.5rem 1.5rem;
    border: 3px solid #1a1a1a;
    font-weight: 700;
    font-size: 0.875rem;
    text-transform: uppercase;
}

.strategyName {
    font-size: 1.375rem;
    font-weight: 700;
    color: #1a1a1a;
    margin-bottom: 0.5rem;
    margin-top: 1rem;
    font-family: var(--font-heading, 'Archivo Black', sans-serif);
    text-transform: uppercase;
}

.strategyDescription {
    color: #4a4a4a;
    margin-bottom: 1.5rem;
    line-height: 1.5;
}

/* Metrics Grid */
.metricsGrid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 0;
    border: 3px solid #1a1a1a;
    margin-bottom: 1.5rem;
}

.metricItem {
    text-align: center;
    padding: 1rem;
    background: #D8D1BF;
    border-right: 2px solid #1a1a1a;
}

.metricItem:last-child {
    border-right: none;
}

.metricLabel {
    font-size: 0.7rem;
    color: #4a4a4a;
    margin-bottom: 0.25rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-weight: 700;
}

.metricValue {
    font-size: 1.25rem;
    font-weight: 700;
    color: #1a1a1a;
}

.metricValue.profit {
    color: #16a34a;
}

.metricValue.low {
    color: #16a34a;
}

.metricValue.medium {
    color: #ca8a04;
}

.metricValue.high {
    color: #dc2626;
}

/* Applications List */
.applicationsCard {
    background: #E8E0CC;
    padding: 1.5rem;
    border: 3px solid #1a1a1a;
    margin-bottom: 1rem;
}

.applicationsTitle {
    font-size: 0.875rem;
    font-weight: 700;
    color: #1a1a1a;
    margin-bottom: 1rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.applicationItem {
    padding: 1rem;
    background: #ffffff;
    border: 2px solid #1a1a1a;
    margin-bottom: 0.75rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.appInfo {
    flex: 1;
}

.appName {
    font-size: 1rem;
    font-weight: 700;
    color: #1a1a1a;
    text-transform: uppercase;
}

.appDetails {
    font-size: 0.8rem;
    color: #666666;
    margin-top: 0.25rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.appProbability {
    text-align: right;
}

.appProbValue {
    font-size: 1.25rem;
    font-weight: 700;
    color: #16a34a;
}

.appProbLabel {
    font-size: 0.65rem;
    color: #666666;
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

/* Recommendation Box */
.recommendationBox {
    background: #ffd700;
    border: 3px solid #1a1a1a;
    padding: 1rem;
    color: #1a1a1a;
    font-weight: 600;
}

/* Loading State */
.loadingContainer {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 4rem;
    color: #4a4a4a;
}

.loader {
    width: 48px;
    height: 48px;
    border: 4px solid #D8D1BF;
    border-top-color: #22c55e;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin-bottom: 1rem;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

/* Responsive */
@media (max-width: 768px) {
    .container {
        padding: 1rem;
    }

    .header h1 {
        font-size: 2rem;
    }

    .inputSection {
        padding: 1.5rem;
        box-shadow: 4px 4px 0 #1a1a1a;
    }

    .peopleGrid {
        grid-template-columns: repeat(3, 1fr);
    }

    .summaryGrid {
        grid-template-columns: 1fr;
        gap: 0;
    }

    .summaryItem {
        border-right: none;
        border-bottom: 2px solid #1a1a1a;
    }

    .summaryItem:last-child {
        border-bottom: none;
    }

    .metricsGrid {
        grid-template-columns: repeat(2, 1fr);
    }

    .metricItem {
        border-bottom: 2px solid #1a1a1a;
    }
}
</file>

<file path="frontend/app/portfolio-optimizer/page.tsx">
import type { Metadata } from 'next';
import PortfolioOptimizerClient from './PortfolioOptimizerClient';

export const metadata: Metadata = {
    title: 'IPO Portfolio Optimizer - Maximize Your Returns',
    description: 'Optimize your IPO investments with our AI-powered portfolio optimizer. Get personalized strategies based on your capital and risk appetite. Maximize allotment chances across multiple accounts.',
    keywords: ['IPO portfolio', 'IPO optimizer', 'IPO investment strategy', 'IPO returns', 'IPO allotment probability', 'multi-account IPO'],
    openGraph: {
        title: 'IPO Portfolio Optimizer - Maximize Your Returns',
        description: 'Optimize your IPO investments with AI-powered strategies. Maximize allotment chances and returns.',
        type: 'website',
    },
    twitter: {
        card: 'summary_large_image',
        title: 'IPO Portfolio Optimizer - Maximize Your Returns',
        description: 'Optimize your IPO investments with AI-powered strategies.',
    },
};

export const revalidate = 3600; // Revalidate every 1 hour

export default function PortfolioOptimizerPage() {
    return <PortfolioOptimizerClient />;
}
</file>

<file path="frontend/app/shareholders/page.module.css">
/* ============================================
   Shareholders Analysis Page - Elegant Theme
   With proper margins and reduced font sizes
   ============================================ */

@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=IBM+Plex+Sans:wght@300;400;500;600&display=swap');

.pageContainer {
    padding: 3rem 2rem;
    min-height: 100vh;
    max-width: 1400px;
    margin: 0 auto;
}

.sectionHeader {
    margin-bottom: 2.5rem;
    animation: slideUp 0.6s ease-out;
}

.sectionTitle {
    font-family: 'Playfair Display', serif;
    font-size: 2.5rem;
    font-weight: 900;
    margin-bottom: 0.8rem;
    color: #1a3a3a;
    letter-spacing: -0.02em;
    text-transform: uppercase;
}

.sectionSubtitle {
    font-size: 1rem;
    color: #2d4a4a;
    font-weight: 400;
    font-family: 'IBM Plex Sans', sans-serif;
    max-width: 600px;
}

.tableContainer {
    background: #f5f5eb;
    border: 2px solid #1a3a3a;
    overflow: hidden;
    animation: slideUp 0.6s ease-out 0.2s both;
}

.table {
    width: 100%;
    border-collapse: collapse;
}

.table thead {
    background: #1a3a3a;
}

.table th {
    padding: 1rem 1.25rem;
    text-align: left;
    font-family: 'IBM Plex Sans', sans-serif;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    font-size: 0.75rem;
    color: #e8e5d6;
    border-bottom: 2px solid #1a3a3a;
}

.table td {
    padding: 1rem 1.25rem;
    border-bottom: 1px solid #d0cbb8;
    color: #2d4a4a;
    font-family: 'IBM Plex Sans', sans-serif;
    font-size: 0.95rem;
}

.table tbody tr {
    transition: all 0.2s ease;
    background: #f5f5eb;
}

.table tbody tr:nth-child(even) {
    background: #e8e5d6;
}

.table tbody tr:hover {
    background: #d0cbb8;
}

.companyName {
    font-weight: 700;
    color: #1a3a3a !important;
    font-size: 1rem;
    font-family: var(--font-heading);
    text-transform: uppercase;
    letter-spacing: -0.01em;
}

.categoryBadge {
    display: inline-block;
    padding: 0.35rem 0.7rem;
    font-size: 0.7rem;
    font-weight: 700;
    font-family: 'IBM Plex Sans', sans-serif;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    background: #1a3a3a;
    color: #e8e5d6;
    border: 1px solid #1a3a3a;
}

.badge {
    display: inline-block;
    padding: 0.35rem 0.7rem;
    font-size: 0.7rem;
    font-weight: 700;
    font-family: 'IBM Plex Sans', sans-serif;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border: 1px solid transparent;
}

.badgeFiled {
    background: #22c55e;
    color: white;
    border-color: #22c55e;
}

.badgePending {
    background: #fbbf24;
    color: #78350f;
    border-color: #fbbf24;
}

.issueSize {
    font-weight: 700;
    font-family: var(--font-mono);
    color: #1a3a3a !important;
    font-size: 0.875rem;
}

.emptyState {
    text-align: center;
    padding: 3rem 2rem;
    background: #f5f5eb;
    border: 2px dashed #1a3a3a;
    margin-top: 1.5rem;
}

.emptyState p {
    color: #1a3a3a;
    font-size: 1rem;
    font-family: 'IBM Plex Sans', sans-serif;
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@media (max-width: 1024px) {
    .pageContainer {
        padding: 2rem 1rem;
    }

    .sectionTitle {
        font-size: 2rem;
    }

    .tableContainer {
        overflow-x: auto;
    }

    .table {
        min-width: 800px;
    }
}
</file>

<file path="frontend/app/shareholders/page.tsx">
'use client';

import { useEffect, useState } from 'react';
import styles from './page.module.css';
import { fetchShareholderData } from '@/lib/api';

interface ShareholderData {
  id: number;
  ipo_name: string;
  parent_company: string | null;
  category: string | null;
  drhp_status: string | null;
  rhp_status: string | null;
  issue_size_cr: string | null;
}

export default function Shareholders() {
  const [shareholderData, setShareholderData] = useState<ShareholderData[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const loadData = async () => {
      try {
        const data = await fetchShareholderData();
        setShareholderData(data);
      } catch (error) {
        console.error('Failed to load shareholder data:', error);
      } finally {
        setLoading(false);
      }
    };

    loadData();
  }, []);

  if (loading) {
    return (
      <div className={styles.pageContainer}>
        <div className={styles.sectionHeader}>
          <h1 className={styles.sectionTitle}>IPO Shareholder Analysis</h1>
          <p className={styles.sectionSubtitle}>Loading...</p>
        </div>
      </div>
    );
  }

  return (
    <div className={styles.pageContainer}>
      <div className={styles.sectionHeader}>
        <h1 className={styles.sectionTitle}>IPO Shareholder Analysis</h1>
        <p className={styles.sectionSubtitle}>
          Track parent companies, shareholder categories, and regulatory filings
        </p>
      </div>

      <div className={styles.tableContainer}>
        <table className={styles.table}>
          <thead>
            <tr>
              <th>Company Name</th>
              <th>Parent Company</th>
              <th>Category</th>
              <th>DRHP Status</th>
              <th>RHP Status</th>
              <th>Issue Size</th>
            </tr>
          </thead>
          <tbody>
            {shareholderData.map((row) => (
              <tr key={row.id}>
                <td className={styles.companyName}>{row.ipo_name}</td>
                <td>{row.parent_company || 'TBA'}</td>
                <td>
                  {row.category ? (
                    <span className={styles.categoryBadge}>{row.category}</span>
                  ) : 'TBA'}
                </td>
                <td>
                  {row.drhp_status ? (
                    <span className={`${styles.badge} ${row.drhp_status === 'filed' ? styles.badgeFiled : styles.badgePending}`}>
                      {row.drhp_status}
                    </span>
                  ) : 'TBA'}
                </td>
                <td>
                  {row.rhp_status ? (
                    <span className={`${styles.badge} ${row.rhp_status === 'filed' ? styles.badgeFiled : styles.badgePending}`}>
                      {row.rhp_status}
                    </span>
                  ) : 'TBA'}
                </td>
                <td className={styles.issueSize}>{row.issue_size_cr ? `‚Çπ${row.issue_size_cr} Cr` : 'TBA'}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      {shareholderData.length === 0 && (
        <div className={styles.emptyState}>
          <p>No shareholder data available at the moment.</p>
        </div>
      )}
    </div>
  );
}
</file>

<file path="frontend/app/upcoming-ipos/page.module.css">
/* ============================================
   Upcoming IPOs Page - Modern Dark Theme
   Matches the GMP page styling exactly
   ============================================ */

@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=IBM+Plex+Sans:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap');

.pageContainer {
    background: linear-gradient(135deg, #0a0e27 0%, #1e293b 100%);
    min-height: 100vh;
    padding: 3rem 2rem;
    margin-left: -1.5rem;
    margin-right: -1.5rem;
    margin-bottom: -1.5rem;
    font-family: 'IBM Plex Sans', sans-serif;
    color: #f8fafc;
    line-height: 1.6;
}

.sectionHeader {
    max-width: 1400px;
    margin: 0 auto 3rem auto;
    animation: slideUp 0.6s ease-out;
}

.sectionTitle {
    font-family: 'Playfair Display', serif;
    font-size: 3rem;
    font-weight: 900;
    margin-bottom: 0.8rem;
    background: linear-gradient(135deg, #ffffff 0%, #06b6d4 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    letter-spacing: -0.02em;
    text-transform: none;
}

.sectionSubtitle {
    font-size: 1.1rem;
    color: #e2e8f0;
    font-weight: 300;
    font-family: 'IBM Plex Sans', sans-serif;
}

.ipoGrid {
    max-width: 1400px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 1.5rem;
    animation: fadeIn 0.8s ease-out 0.3s both;
}

.emptyState {
    max-width: 1400px;
    margin: 0 auto;
    grid-column: 1 / -1;
    text-align: center;
    padding: 4rem 2rem;
    background: rgba(255, 255, 255, 0.03);
    border: 1px dashed rgba(255, 255, 255, 0.2);
    border-radius: 16px;
}

.emptyState p {
    color: #e2e8f0;
    font-size: 1.1rem;
    font-family: 'IBM Plex Sans', sans-serif;
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@media (max-width: 768px) {
    .pageContainer {
        padding: 2rem 1rem;
    }

    .sectionTitle {
        font-size: 2.2rem;
    }

    .ipoGrid {
        grid-template-columns: 1fr;
    }
}
</file>

<file path="frontend/app/upcoming-ipos/page.tsx">
import type { Metadata } from 'next';
import UpcomingIPOsClient from './UpcomingIPOsClient';

export const metadata: Metadata = {
    title: 'Upcoming IPOs 2026 - Complete List with Dates, Price & GMP',
    description: 'Complete list of upcoming IPOs in India with open dates, close dates, price bands, lot sizes, and Grey Market Premium (GMP). Stay updated with the latest IPO launches.',
    keywords: ['upcoming IPO', 'IPO 2026', 'new IPO', 'IPO open date', 'IPO price band', 'IPO list', 'NSE IPO', 'BSE IPO', 'mainboard IPO', 'SME IPO'],
    openGraph: {
        title: 'Upcoming IPOs 2026 - Complete List with Dates, Price & GMP',
        description: 'Complete list of upcoming IPOs in India with open dates, close dates, price bands, lot sizes, and Grey Market Premium.',
        type: 'website',
    },
    twitter: {
        card: 'summary_large_image',
        title: 'Upcoming IPOs 2026 - Complete List with Dates, Price & GMP',
        description: 'Complete list of upcoming IPOs in India with open dates, close dates, price bands, and GMP.',
    },
};

export const revalidate = 3600; // Revalidate every 1 hour

export default function UpcomingIPOsPage() {
    return <UpcomingIPOsClient />;
}
</file>

<file path="frontend/components/GoldCard.tsx">
import React from "react";
import { cn } from "@/lib/utils";
import { AlertTriangle } from "lucide-react";

interface GoldCardProps {
    data: {
        ipo_name: string;
        parent_company: string;
        action_text?: string;
    };
    className?: string;
}

export function GoldCard({ data, className }: GoldCardProps) {
    return (
        <div
            className={cn(
                "relative overflow-hidden rounded-xl border border-yellow-600/30 bg-gradient-to-b from-yellow-900/40 to-black p-6",
                className
            )}
        >
            {/* Glow Effect */}
            <div className="absolute top-0 right-0 h-32 w-32 -translate-y-1/2 translate-x-1/2 rounded-full bg-yellow-500/20 blur-3xl" />

            <div className="relative z-10 flex flex-col gap-4">
                {/* Badge */}
                <div className="w-fit">
                    <span className="relative inline-flex items-center rounded-full border border-yellow-500/50 bg-yellow-500/10 px-3 py-1 text-xs font-medium text-yellow-500">
                        <span className="absolute -left-1 -top-1 h-2 w-2 animate-ping rounded-full bg-yellow-500" />
                        <span className="mr-2 h-1.5 w-1.5 rounded-full bg-yellow-500" />
                        Upcoming
                    </span>
                </div>

                {/* Content */}
                <div>
                    <h3 className="text-xl font-bold text-white">{data.ipo_name}</h3>
                    <p className="mt-1 text-sm text-zinc-400">
                        Parent Company: <span className="text-zinc-300">{data.parent_company}</span>
                    </p>
                </div>

                {/* Footer */}
                <div className="mt-2 flex items-center gap-2 rounded-lg bg-yellow-500/10 p-3 text-sm text-yellow-200/80">
                    <AlertTriangle className="h-4 w-4 text-yellow-500" />
                    <span>{data.action_text || "Buy before RHP filing."}</span>
                </div>
            </div>
        </div>
    );
}
</file>

<file path="frontend/components/homepage/ComparisonTable.module.css">
/* ============================================
   IPO Comparison Table - Brutalist Editorial Style
   ============================================ */

.container {
    background: var(--color-bg-card);
    border: 4px solid var(--black);
    overflow: hidden;
    box-shadow: var(--shadow-card);
}

.loading {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 3rem;
    color: var(--color-text-primary);
    font-size: 1rem;
    font-family: var(--font-body);
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

/* Controls Section */
.controls {
    padding: 1.25rem 1.5rem;
    background: var(--yellow);
    border-bottom: 4px solid var(--black);
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
}

.sortButtons {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.sortButton {
    padding: 0.625rem 1.25rem;
    background-color: var(--white);
    color: var(--black);
    border: 3px solid var(--black);
    font-size: 0.8125rem;
    font-family: var(--font-body);
    font-weight: 700;
    cursor: pointer;
    transition: all 0.15s ease;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.sortButton:hover {
    background-color: var(--black);
    color: var(--yellow);
    transform: rotate(-1deg);
}

.sortButton.active {
    background: var(--black);
    color: var(--yellow);
    box-shadow: var(--shadow-sm);
}

.exportButton {
    padding: 0.625rem 1.25rem;
    background-color: var(--black);
    color: var(--yellow);
    border: 3px solid var(--black);
    font-size: 0.8125rem;
    font-family: var(--font-body);
    font-weight: 700;
    cursor: pointer;
    transition: all 0.15s ease;
    display: flex;
    align-items: center;
    gap: 0.375rem;
    text-transform: uppercase;
}

.exportButton:hover {
    background-color: var(--yellow);
    color: var(--black);
    transform: rotate(-2deg);
}

/* Table Wrapper */
.tableWrapper {
    overflow-x: auto;
}

/* Table Styles */
.table {
    width: 100%;
    border-collapse: collapse;
}

.table thead {
    background: var(--gray);
    border-bottom: 4px solid var(--black);
}

.table thead th {
    padding: 1rem 1.25rem;
    text-align: left;
    font-size: 0.6875rem;
    font-family: var(--font-body);
    font-weight: 700;
    color: var(--black);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    white-space: nowrap;
    border-right: 2px solid var(--color-border-light);
}

.table thead th:last-child {
    border-right: none;
}

.table tbody tr {
    border-bottom: 2px solid var(--color-border-light);
    transition: all 0.15s ease;
}

.table tbody tr:hover {
    background-color: var(--yellow);
}

.table tbody tr:last-child {
    border-bottom: none;
}

.table tbody td {
    padding: 1rem 1.25rem;
    font-size: 0.9375rem;
    font-family: var(--font-body);
    color: var(--color-text-primary);
    vertical-align: middle;
    border-right: 1px solid var(--color-border-light);
}

.table tbody td:last-child {
    border-right: none;
}

/* Company Cell */
.companyCell {
    font-weight: 700;
    color: var(--color-text-primary);
    min-width: 200px;
}

.companyCell strong {
    display: block;
    color: var(--color-text-primary);
    font-family: var(--font-heading);
    text-transform: uppercase;
    font-weight: 400;
}

/* Category Badge */
.badge {
    display: inline-flex;
    align-items: center;
    padding: 0.375rem 0.875rem;
    font-size: 0.5625rem;
    font-family: var(--font-body);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    white-space: nowrap;
    border: 2px solid var(--black);
}

.sme {
    background-color: var(--gray);
    color: var(--black);
}

.mainboard {
    background: var(--black);
    color: var(--yellow);
}

/* Value Styling */
.positive {
    color: var(--blue);
    font-weight: 700;
}

.negative {
    color: var(--red);
    font-weight: 700;
}

.subscribed {
    color: var(--blue);
}

/* View Button */
.viewButton {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.5rem 0.875rem;
    background: var(--black);
    color: var(--yellow);
    border: 3px solid var(--black);
    font-size: 0.75rem;
    font-family: var(--font-body);
    font-weight: 700;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.15s ease;
    text-transform: uppercase;
    white-space: nowrap;
}

.viewButton:hover {
    background: var(--yellow);
    color: var(--black);
    transform: rotate(-2deg);
    box-shadow: var(--shadow-sm);
}

/* Responsive Design */
@media (max-width: 1024px) {
    .controls {
        flex-direction: column;
        align-items: flex-start;
    }

    .sortButtons {
        width: 100%;
    }

    .sortButton {
        flex: 1;
        text-align: center;
    }
}

@media (max-width: 768px) {

    .table thead th,
    .table tbody td {
        padding: 0.875rem 1rem;
        font-size: 0.8125rem;
    }

    .companyCell {
        min-width: 150px;
    }

    .badge {
        font-size: 0.5rem;
        padding: 0.25rem 0.5rem;
    }

    .viewButton {
        padding: 0.5rem 0.875rem;
        font-size: 0.75rem;
    }
}
</file>

<file path="frontend/components/homepage/ComparisonTable.tsx">
'use client';

import { useState, useEffect } from 'react';
import Link from 'next/link';
import styles from './ComparisonTable.module.css';
import { fetchAllIPOsForComparison } from '@/lib/api';

export default function ComparisonTable({ category }: { category: string }) {
    const [ipos, setIpos] = useState<any[]>([]);
    const [loading, setLoading] = useState(true);
    const [sortBy, setSortBy] = useState<'gmp' | 'subscription' | 'date'>('date');

    useEffect(() => {
        loadData();
    }, [category]);

    async function loadData() {
        const data = await fetchAllIPOsForComparison(category);
        setIpos(data);
        setLoading(false);
    }

    const sortedIPOs = [...ipos].sort((a, b) => {
        if (sortBy === 'gmp') return b.gmp_percentage - a.gmp_percentage;
        if (sortBy === 'subscription') return b.subscription_total - a.subscription_total;
        return new Date(b.open_date).getTime() - new Date(a.open_date).getTime();
    });

    if (loading) {
        return <div className={styles.loading}>Loading comparison data...</div>;
    }

    return (
        <div className={styles.container}>
            <div className={styles.controls}>
                <div className={styles.sortButtons}>
                    <button
                        className={`${styles.sortButton} ${sortBy === 'date' ? styles.active : ''}`}
                        onClick={() => setSortBy('date')}
                    >
                        Sort by Date
                    </button>
                    <button
                        className={`${styles.sortButton} ${sortBy === 'gmp' ? styles.active : ''}`}
                        onClick={() => setSortBy('gmp')}
                    >
                        Sort by GMP
                    </button>
                    <button
                        className={`${styles.sortButton} ${sortBy === 'subscription' ? styles.active : ''}`}
                        onClick={() => setSortBy('subscription')}
                    >
                        Sort by Subscription
                    </button>
                </div>
                <button className={styles.exportButton}>
                    üì• Export to CSV
                </button>
            </div>

            <div className={styles.tableWrapper}>
                <table className={styles.table}>
                    <thead>
                        <tr>
                            <th>Company</th>
                            <th>Category</th>
                            <th>Price Band</th>
                            <th>GMP</th>
                            <th>% Gain</th>
                            <th>Lot Size</th>
                            <th>Subscription</th>
                            <th>Open Date</th>
                            <th>Close Date</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {sortedIPOs.map(ipo => (
                            <tr key={ipo.id}>
                                <td className={styles.companyCell}>
                                    <strong>{ipo.company_name || ipo.ipo_name}</strong>
                                </td>
                                <td>
                                    <span className={`${styles.badge} ${ipo.category === 'SME' ? styles.sme : styles.mainboard}`}>
                                        {ipo.category}
                                    </span>
                                </td>
                                <td>‚Çπ{ipo.min_price}-{ipo.max_price}</td>
                                <td className={ipo.gmp_amount >= 0 ? styles.positive : styles.negative}>
                                    ‚Çπ{ipo.gmp_amount}
                                </td>
                                <td className={ipo.gmp_percentage >= 0 ? styles.positive : styles.negative}>
                                    {ipo.gmp_percentage >= 0 ? '+' : ''}{ipo.gmp_percentage.toFixed(1)}%
                                </td>
                                <td>{ipo.lot_size}</td>
                                <td>
                                    <strong className={ipo.subscription_total >= 1 ? styles.subscribed : ''}>
                                        {ipo.subscription_total.toFixed(2)}x
                                    </strong>
                                </td>
                                <td>{new Date(ipo.open_date).toLocaleDateString('en-IN', { month: 'short', day: 'numeric' })}</td>
                                <td>{new Date(ipo.close_date).toLocaleDateString('en-IN', { month: 'short', day: 'numeric' })}</td>
                                <td>
                                    <Link href={`/ipo/${ipo.slug}`} className={styles.viewButton}>
                                        View
                                    </Link>
                                </td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>
        </div>
    );
}
</file>

<file path="frontend/components/homepage/DashboardTabs.module.css">
/* ============================================
   Dashboard Tabs - Brutalist Editorial Style
   ============================================ */

.container {
    background: var(--color-bg-card);
    border: 4px solid var(--black);
    overflow: hidden;
    box-shadow: var(--shadow-card);
}

.loading {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 4rem 2rem;
    color: var(--color-text-primary);
    font-size: 1rem;
    font-family: var(--font-body);
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

/* Tabs */
.tabs {
    display: flex;
    border-bottom: 4px solid var(--black);
    background: var(--gray);
    overflow-x: auto;
    scrollbar-width: none;
    -ms-overflow-style: none;
}

.tabs::-webkit-scrollbar {
    display: none;
}

.tab {
    flex: 1;
    min-width: 140px;
    padding: 1rem 1.25rem;
    background: var(--gray);
    border: none;
    border-right: 2px solid var(--black);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    font-family: var(--font-body);
    font-weight: 700;
    color: var(--color-text-secondary);
    cursor: pointer;
    transition: all 0.15s ease;
    white-space: nowrap;
    position: relative;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.tab:last-child {
    border-right: none;
}

.tab:hover {
    color: var(--black);
    background-color: var(--yellow);
}

.activeTab {
    color: var(--yellow);
    background-color: var(--black);
}

.tabIcon {
    font-size: 1rem;
}

.tabLabel {
    font-size: 0.8125rem;
}

.tabCount {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 22px;
    height: 22px;
    padding: 0 0.5rem;
    font-size: 0.6875rem;
    font-weight: 700;
    background: var(--white);
    color: var(--black);
    border: 2px solid var(--black);
    transition: all 0.15s ease;
}

.activeTab .tabCount {
    background: var(--yellow);
    color: var(--black);
}

/* Content */
.content {
    padding: 1.5rem;
    background: var(--white);
}

.grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 1.5rem;
}

.empty {
    text-align: center;
    padding: 3rem;
    color: var(--color-text-primary);
    font-family: var(--font-body);
    text-transform: uppercase;
}

.empty p {
    font-size: 1rem;
    margin: 0;
    color: var(--color-text-muted);
}

/* IPO Cards */
.ipoCard {
    display: flex;
    flex-direction: column;
    padding: 1.25rem;
    background: var(--color-bg-card);
    border: 3px solid var(--black);
    text-decoration: none;
    transition: all 0.2s ease;
    position: relative;
}

/* Yellow top bar */
.ipoCard::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 6px;
    background: var(--yellow);
}

.ipoCard:hover {
    background: var(--yellow);
    box-shadow: var(--shadow-md);
    transform: rotate(1deg) translateY(-4px);
}

.cardTop {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
    padding-top: 0.5rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid var(--black);
}

.cardInfo {
    flex: 1;
    min-width: 0;
}

.ipoName {
    font-size: 1rem;
    font-family: var(--font-heading);
    color: var(--color-text-primary);
    margin: 0 0 0.5rem 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    text-transform: uppercase;
}

.category {
    display: inline-block;
    padding: 0.375rem 0.75rem;
    font-size: 0.5625rem;
    font-family: var(--font-body);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border: 2px solid var(--black);
}

.mainboard {
    background: var(--black);
    color: var(--yellow);
}

.sme {
    background-color: var(--gray);
    color: var(--black);
}

/* Metrics */
.cardMetrics {
    text-align: right;
}

.metric {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
}

.metricLabel {
    font-size: 0.625rem;
    font-family: var(--font-body);
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    font-weight: 700;
}

.metricValue {
    font-size: 1.375rem;
    font-family: var(--font-body);
    font-weight: 700;
    color: var(--color-text-primary);
}

.metricValue.subscribed {
    color: var(--blue);
}

.daysLeft {
    margin-top: 0.375rem;
    font-size: 0.6875rem;
    font-family: var(--font-body);
    font-weight: 700;
    color: var(--black);
    background: var(--yellow);
    padding: 0.375rem 0.625rem;
    display: inline-block;
    text-transform: uppercase;
    border: 2px solid var(--black);
}

/* Listing Gain */
.listingGain {
    text-align: right;
}

.gainLabel {
    display: block;
    font-size: 0.625rem;
    font-family: var(--font-body);
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    font-weight: 700;
    margin-bottom: 0.125rem;
}

.gainValue {
    font-size: 1.375rem;
    font-family: var(--font-body);
    font-weight: 700;
}

.gainValue.positive {
    color: var(--blue);
}

.gainValue.negative {
    color: var(--red);
}

/* Upcoming Date */
.upcomingDate {
    font-size: 0.875rem;
    font-family: var(--font-body);
    font-weight: 700;
    color: var(--black);
    background: var(--gray);
    padding: 0.5rem 0.875rem;
    border: 2px solid var(--black);
    text-transform: uppercase;
}

/* Card Bottom */
.cardBottom {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.gmpInfo {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.gmpLabel {
    font-size: 0.6875rem;
    font-family: var(--font-body);
    font-weight: 700;
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
}

.gmpValue {
    font-size: 1rem;
    font-family: var(--font-body);
    font-weight: 700;
}

.gmpValue.positive {
    color: var(--blue);
}

.gmpValue.negative {
    color: var(--red);
}

.cardArrow {
    font-size: 1.25rem;
    color: var(--black);
    transition: all 0.15s ease;
}

.ipoCard:hover .cardArrow {
    transform: translateX(4px) rotate(-5deg);
}

/* Responsive Design */
@media (max-width: 768px) {
    .tabs {
        overflow-x: scroll;
        -webkit-overflow-scrolling: touch;
    }

    .tab {
        padding: 0.875rem 1rem;
        min-width: 120px;
    }

    .tabLabel {
        font-size: 0.75rem;
    }

    .content {
        padding: 1.25rem;
    }

    .grid {
        grid-template-columns: 1fr;
    }

    .ipoCard {
        padding: 1rem;
    }
}
</file>

<file path="frontend/components/homepage/FeaturedIPOCard.tsx">
'use client';

import { useState, useEffect } from 'react';
import Link from 'next/link';
import styles from './FeaturedIPOCard.module.css';

interface FeaturedIPOProps {
    id: number;
    ipo_name: string;
    company_name: string;
    slug: string;
    category: 'SME' | 'Mainboard';
    status: string;
    gmp_amount: number;
    gmp_percentage: number;
    subscription_retail: number;
    subscription_total: number;
    close_date: string;
    open_date: string;
    issue_price: number;
    max_price: number;
}

export default function FeaturedIPOCard({ ipo }: { ipo: FeaturedIPOProps }) {
    const [timeLeft, setTimeLeft] = useState('');

    useEffect(() => {
        const calculateTimeLeft = () => {
            const targetDate = ipo.status === 'open' 
                ? new Date(ipo.close_date) 
                : new Date(ipo.open_date);
            const now = new Date();
            const diff = targetDate.getTime() - now.getTime();

            if (diff <= 0) {
                return ipo.status === 'open' ? 'Closed' : 'Opening Soon';
            }

            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));

            if (days > 0) return `${days}d ${hours}h left`;
            if (hours > 0) return `${hours}h ${minutes}m left`;
            return `${minutes}m left`;
        };

        setTimeLeft(calculateTimeLeft());
        const interval = setInterval(() => setTimeLeft(calculateTimeLeft()), 60000);

        return () => clearInterval(interval);
    }, [ipo.close_date, ipo.open_date, ipo.status]);

    const price = ipo.issue_price || ipo.max_price;

    return (
        <Link href={`/ipo/${ipo.slug}`} className={styles.card}>
            <div className={styles.cardHeader}>
                <div className={styles.titleSection}>
                    <h3 className={styles.companyName}>{ipo.company_name || ipo.ipo_name}</h3>
                    <span className={`${styles.badge} ${ipo.category === 'SME' ? styles.smeBadge : styles.mainboardBadge}`}>
                        {ipo.category}
                    </span>
                </div>
                <div className={styles.statusSection}>
                    <span className={`${styles.statusBadge} ${ipo.status === 'open' ? styles.openStatus : styles.upcomingStatus}`}>
                        {ipo.status === 'open' ? 'üî¥ LIVE' : 'üü° Upcoming'}
                    </span>
                </div>
            </div>

            <div className={styles.metricsRow}>
                <div className={styles.metric}>
                    <span className={styles.metricLabel}>GMP</span>
                    <span className={`${styles.metricValue} ${ipo.gmp_amount >= 0 ? styles.positive : styles.negative}`}>
                        ‚Çπ{ipo.gmp_amount}
                    </span>
                </div>
                <div className={styles.metric}>
                    <span className={styles.metricLabel}>Expected Gain</span>
                    <span className={`${styles.metricValue} ${ipo.gmp_percentage >= 0 ? styles.positive : styles.negative}`}>
                        {ipo.gmp_percentage >= 0 ? '+' : ''}{ipo.gmp_percentage.toFixed(1)}%
                    </span>
                </div>
                <div className={styles.metric}>
                    <span className={styles.metricLabel}>Subscription</span>
                    <span className={styles.metricValue}>
                        {ipo.subscription_total.toFixed(2)}x
                    </span>
                </div>
            </div>

            <div className={styles.progressSection}>
                <div className={styles.progressLabel}>
                    <span>Retail: {ipo.subscription_retail.toFixed(2)}x</span>
                    <span className={styles.timer}>{timeLeft}</span>
                </div>
                <div className={styles.progressBar}>
                    <div 
                        className={styles.progressFill}
                        style={{ 
                            width: `${Math.min(100, (ipo.subscription_retail / 5) * 100)}%`,
                            backgroundColor: ipo.subscription_retail >= 1 ? '#22c55e' : '#06b6d4'
                        }}
                    />
                </div>
            </div>

            <div className={styles.footer}>
                <span className={styles.price}>Issue Price: ‚Çπ{price}</span>
                <span className={styles.viewDetails}>View Details ‚Üí</span>
            </div>
        </Link>
    );
}
</file>

<file path="frontend/components/homepage/IPOAnalysisTile.module.css">
/* IPO Analysis Tile - Black and Yellow Theme */

.tile {
    background: linear-gradient(145deg, #0a0a0a 0%, #1a1a1a 100%);
    border: 3px solid #ffed4e;
    border-radius: 0;
    padding: 1.25rem;
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
}

.tile::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #ffed4e, #ffd700, #d4af37);
}

.tile:hover {
    border-color: #ffd700;
    transform: translateY(-4px);
    box-shadow: 0 12px 40px rgba(255, 237, 78, 0.25);
}

/* Header */
.header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
    gap: 0.5rem;
}

.ipoName {
    font-size: 1rem;
    font-family: var(--font-heading, 'Space Grotesk', sans-serif);
    color: #ffed4e;
    margin: 0;
    text-transform: uppercase;
    letter-spacing: 0.02em;
    line-height: 1.2;
    flex: 1;
}

.category {
    font-size: 0.625rem;
    font-family: var(--font-body, 'Inter', sans-serif);
    color: #0a0a0a;
    background: #ffed4e;
    padding: 0.2rem 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    white-space: nowrap;
    font-weight: 600;
}

/* Filter Dropdown */
.filterContainer {
    margin-bottom: 1rem;
}

.filterDropdown {
    width: 100%;
    padding: 0.5rem 0.75rem;
    background: #0a0a0a;
    border: 2px solid #ffed4e;
    border-radius: 0;
    color: #ffed4e;
    font-size: 0.8rem;
    font-family: var(--font-body, 'Inter', sans-serif);
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23ffed4e' d='M6 8L2 4h8z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 0.75rem center;
    padding-right: 2rem;
    text-transform: uppercase;
}

.filterDropdown:hover {
    background: #1a1a1a;
    box-shadow: 0 0 10px rgba(255, 237, 78, 0.3);
}

.filterDropdown:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(255, 237, 78, 0.4);
}

.filterDropdown option {
    background: #0a0a0a;
    color: #ffed4e;
    padding: 0.5rem;
}

/* Chart Container */
.chartContainer {
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 0.75rem;
}

.pieChart {
    width: 160px;
    height: 160px;
    filter: drop-shadow(0 4px 12px rgba(255, 237, 78, 0.2));
}

.pieSlice {
    transform-origin: center;
    animation: sliceAppear 0.5s ease-out forwards;
    opacity: 0;
    transition: transform 0.2s ease;
}

.pieSlice:hover {
    transform: scale(1.02);
    filter: brightness(1.1);
}

@keyframes sliceAppear {
    from {
        opacity: 0;
        transform: scale(0.9);
    }

    to {
        opacity: 1;
        transform: scale(1);
    }
}

/* Slice Labels */
.sliceLabel {
    font-family: var(--font-body, 'Inter', sans-serif);
    pointer-events: none;
}

.sliceLabelValue {
    font-size: 8px;
    font-weight: 700;
}

.sliceLabelPercent {
    font-size: 6px;
    font-weight: 500;
}

/* Total Label */
.totalLabel {
    text-align: center;
    font-size: 0.8rem;
    font-family: var(--font-body, 'Inter', sans-serif);
    color: #ffed4e;
    font-weight: 600;
    padding: 0.5rem;
    background: rgba(255, 237, 78, 0.1);
    border: 1px solid rgba(255, 237, 78, 0.3);
    margin-bottom: 0.75rem;
}

/* Legend */
.legend {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.5rem;
    padding-top: 0.5rem;
    border-top: 1px solid rgba(255, 237, 78, 0.2);
}

.legendItem {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    font-size: 0.7rem;
    font-family: var(--font-body, 'Inter', sans-serif);
}

.legendColor {
    width: 12px;
    height: 12px;
    border-radius: 0;
    flex-shrink: 0;
    border: 1px solid #0a0a0a;
}

.legendLabel {
    color: rgba(255, 255, 255, 0.7);
    flex: 1;
}

.legendValue {
    color: #ffed4e;
    font-weight: 700;
    text-align: right;
}

/* Responsive */
@media (max-width: 768px) {
    .tile {
        padding: 1rem;
    }

    .ipoName {
        font-size: 0.9rem;
    }

    .pieChart {
        width: 140px;
        height: 140px;
    }

    .legend {
        grid-template-columns: 1fr;
    }

    .legendItem {
        font-size: 0.65rem;
    }

    .sliceLabelValue {
        font-size: 7px;
    }

    .sliceLabelPercent {
        font-size: 5px;
    }
}
</file>

<file path="frontend/components/homepage/IPOAnalysisTile.tsx">
'use client';

import { useState } from 'react';
import styles from './IPOAnalysisTile.module.css';

interface IPOData {
    id: number;
    ipo_name: string;
    company_name?: string;
    category?: string;
    issue_size_cr?: number;
    lot_size?: number;
    subscription_retail?: number;
    subscription_nii?: number;
    subscription_qib?: number;
    subscription_total?: number;
}

type FilterType = 'allocation' | 'issueSize' | 'subscription' | 'lots' | 'investors';

interface FilterOption {
    value: FilterType;
    label: string;
}

const filterOptions: FilterOption[] = [
    { value: 'allocation', label: 'Allocation %' },
    { value: 'issueSize', label: 'Issue Size (‚Çπ Cr)' },
    { value: 'subscription', label: 'Subscription Data' },
    { value: 'lots', label: 'Lot Distribution' },
    { value: 'investors', label: 'Investor Count' },
];

// SEBI-defined allocation percentages
const ALLOCATION_PERCENTAGES = {
    retail: 35,
    sNII: 15,
    bNII: 15,
    qib: 35,
};

// Black and Yellow/Gold theme colors
const THEME_COLORS = {
    retail: '#ffed4e',    // Bright Yellow
    sNII: '#d4af37',      // Gold
    bNII: '#b8860b',      // Dark Goldenrod
    qib: '#ffd700',       // Gold
};

interface PieSegment {
    label: string;
    value: number;
    color: string;
    displayValue: string;
    percentage: number;
}

export default function IPOAnalysisTile({ ipo }: { ipo: IPOData }) {
    const [selectedFilter, setSelectedFilter] = useState<FilterType>('allocation');

    const getChartData = (): PieSegment[] => {
        const issueSize = ipo.issue_size_cr || 100;
        const lotSize = ipo.lot_size || 1;
        const retailSub = ipo.subscription_retail || 1;
        const niiSub = ipo.subscription_nii || 1;
        const qibSub = ipo.subscription_qib || 1;

        switch (selectedFilter) {
            case 'allocation':
                return [
                    { label: 'Retail', value: ALLOCATION_PERCENTAGES.retail, color: THEME_COLORS.retail, displayValue: `${ALLOCATION_PERCENTAGES.retail}%`, percentage: ALLOCATION_PERCENTAGES.retail },
                    { label: 'sNII', value: ALLOCATION_PERCENTAGES.sNII, color: THEME_COLORS.sNII, displayValue: `${ALLOCATION_PERCENTAGES.sNII}%`, percentage: ALLOCATION_PERCENTAGES.sNII },
                    { label: 'bNII', value: ALLOCATION_PERCENTAGES.bNII, color: THEME_COLORS.bNII, displayValue: `${ALLOCATION_PERCENTAGES.bNII}%`, percentage: ALLOCATION_PERCENTAGES.bNII },
                    { label: 'QIB', value: ALLOCATION_PERCENTAGES.qib, color: THEME_COLORS.qib, displayValue: `${ALLOCATION_PERCENTAGES.qib}%`, percentage: ALLOCATION_PERCENTAGES.qib },
                ];

            case 'issueSize': {
                const retailCr = (issueSize * ALLOCATION_PERCENTAGES.retail) / 100;
                const sNIICr = (issueSize * ALLOCATION_PERCENTAGES.sNII) / 100;
                const bNIICr = (issueSize * ALLOCATION_PERCENTAGES.bNII) / 100;
                const qibCr = (issueSize * ALLOCATION_PERCENTAGES.qib) / 100;
                return [
                    { label: 'Retail', value: retailCr, color: THEME_COLORS.retail, displayValue: `‚Çπ${retailCr.toFixed(1)}Cr`, percentage: ALLOCATION_PERCENTAGES.retail },
                    { label: 'sNII', value: sNIICr, color: THEME_COLORS.sNII, displayValue: `‚Çπ${sNIICr.toFixed(1)}Cr`, percentage: ALLOCATION_PERCENTAGES.sNII },
                    { label: 'bNII', value: bNIICr, color: THEME_COLORS.bNII, displayValue: `‚Çπ${bNIICr.toFixed(1)}Cr`, percentage: ALLOCATION_PERCENTAGES.bNII },
                    { label: 'QIB', value: qibCr, color: THEME_COLORS.qib, displayValue: `‚Çπ${qibCr.toFixed(1)}Cr`, percentage: ALLOCATION_PERCENTAGES.qib },
                ];
            }

            case 'subscription': {
                const totalSub = retailSub + niiSub + qibSub;
                const retailPct = (retailSub / totalSub) * 100;
                const niiPct = (niiSub / totalSub) * 100;
                const qibPct = (qibSub / totalSub) * 100;
                return [
                    { label: 'Retail', value: retailSub, color: THEME_COLORS.retail, displayValue: `${retailSub.toFixed(2)}x`, percentage: retailPct },
                    { label: 'NII', value: niiSub, color: THEME_COLORS.sNII, displayValue: `${niiSub.toFixed(2)}x`, percentage: niiPct },
                    { label: 'QIB', value: qibSub, color: THEME_COLORS.qib, displayValue: `${qibSub.toFixed(2)}x`, percentage: qibPct },
                ];
            }

            case 'lots': {
                const totalLots = Math.round((issueSize * 10000000) / (lotSize * 100));
                const retailLots = Math.round((totalLots * ALLOCATION_PERCENTAGES.retail) / 100);
                const sNIILots = Math.round((totalLots * ALLOCATION_PERCENTAGES.sNII) / 100);
                const bNIILots = Math.round((totalLots * ALLOCATION_PERCENTAGES.bNII) / 100);
                const qibLots = Math.round((totalLots * ALLOCATION_PERCENTAGES.qib) / 100);
                return [
                    { label: 'Retail', value: retailLots, color: THEME_COLORS.retail, displayValue: `${(retailLots / 1000).toFixed(1)}K`, percentage: ALLOCATION_PERCENTAGES.retail },
                    { label: 'sNII', value: sNIILots, color: THEME_COLORS.sNII, displayValue: `${(sNIILots / 1000).toFixed(1)}K`, percentage: ALLOCATION_PERCENTAGES.sNII },
                    { label: 'bNII', value: bNIILots, color: THEME_COLORS.bNII, displayValue: `${(bNIILots / 1000).toFixed(1)}K`, percentage: ALLOCATION_PERCENTAGES.bNII },
                    { label: 'QIB', value: qibLots, color: THEME_COLORS.qib, displayValue: `${(qibLots / 1000).toFixed(1)}K`, percentage: ALLOCATION_PERCENTAGES.qib },
                ];
            }

            case 'investors': {
                const baseInvestors = 10000;
                const retailInvestors = Math.round(baseInvestors * retailSub);
                const niiInvestors = Math.round((baseInvestors * niiSub) / 10);
                const qibInvestors = Math.round((baseInvestors * qibSub) / 100);
                const totalInvestors = retailInvestors + niiInvestors + qibInvestors;
                return [
                    { label: 'Retail', value: retailInvestors, color: THEME_COLORS.retail, displayValue: `${(retailInvestors / 1000).toFixed(1)}K`, percentage: (retailInvestors / totalInvestors) * 100 },
                    { label: 'NII', value: niiInvestors, color: THEME_COLORS.sNII, displayValue: `${(niiInvestors / 1000).toFixed(1)}K`, percentage: (niiInvestors / totalInvestors) * 100 },
                    { label: 'QIB', value: qibInvestors, color: THEME_COLORS.qib, displayValue: `${qibInvestors}`, percentage: (qibInvestors / totalInvestors) * 100 },
                ];
            }

            default:
                return [];
        }
    };

    const chartData = getChartData();
    const total = chartData.reduce((sum, segment) => sum + segment.value, 0);

    // Generate SVG pie chart paths with labels
    const generatePieSlices = () => {
        let currentAngle = -90;
        const centerX = 100;
        const centerY = 100;
        const radius = 85;
        const labelRadius = 55; // Radius for labels inside the pie

        return chartData.map((segment, index) => {
            const sliceAngle = (segment.value / total) * 360;
            const startAngle = currentAngle;
            const endAngle = currentAngle + sliceAngle;
            const midAngle = (startAngle + endAngle) / 2;

            currentAngle = endAngle;

            // Convert angles to radians
            const startRad = (startAngle * Math.PI) / 180;
            const endRad = (endAngle * Math.PI) / 180;
            const midRad = (midAngle * Math.PI) / 180;

            // Calculate arc points
            const x1 = centerX + radius * Math.cos(startRad);
            const y1 = centerY + radius * Math.sin(startRad);
            const x2 = centerX + radius * Math.cos(endRad);
            const y2 = centerY + radius * Math.sin(endRad);

            // Label position (inside the slice)
            const labelX = centerX + labelRadius * Math.cos(midRad);
            const labelY = centerY + labelRadius * Math.sin(midRad);

            // Large arc flag
            const largeArc = sliceAngle > 180 ? 1 : 0;

            const pathData = `
                M ${centerX} ${centerY}
                L ${x1} ${y1}
                A ${radius} ${radius} 0 ${largeArc} 1 ${x2} ${y2}
                Z
            `;

            // Only show label if slice is big enough (> 10%)
            const showLabel = segment.percentage > 10;

            return (
                <g key={index}>
                    <path
                        d={pathData}
                        fill={segment.color}
                        stroke="#0a0a0a"
                        strokeWidth="2"
                        className={styles.pieSlice}
                        style={{ animationDelay: `${index * 0.1}s` }}
                    />
                    {showLabel && (
                        <text
                            x={labelX}
                            y={labelY}
                            textAnchor="middle"
                            dominantBaseline="middle"
                            className={styles.sliceLabel}
                            fill="#0a0a0a"
                        >
                            <tspan x={labelX} dy="-0.4em" className={styles.sliceLabelValue}>{segment.displayValue}</tspan>
                            <tspan x={labelX} dy="1.1em" className={styles.sliceLabelPercent}>({segment.percentage.toFixed(0)}%)</tspan>
                        </text>
                    )}
                </g>
            );
        });
    };

    const getTotalLabel = (): string => {
        switch (selectedFilter) {
            case 'issueSize':
                return `Total: ‚Çπ${ipo.issue_size_cr || 0} Cr`;
            case 'subscription':
                return `Total: ${(ipo.subscription_total || 0).toFixed(2)}x`;
            default:
                return '';
        }
    };

    return (
        <div className={styles.tile}>
            <div className={styles.header}>
                <h3 className={styles.ipoName}>{ipo.ipo_name}</h3>
                <span className={styles.category}>{ipo.category || 'Mainboard'}</span>
            </div>

            <div className={styles.filterContainer}>
                <select
                    value={selectedFilter}
                    onChange={(e) => setSelectedFilter(e.target.value as FilterType)}
                    className={styles.filterDropdown}
                >
                    {filterOptions.map((option) => (
                        <option key={option.value} value={option.value}>
                            {option.label}
                        </option>
                    ))}
                </select>
            </div>

            <div className={styles.chartContainer}>
                <svg viewBox="0 0 200 200" className={styles.pieChart}>
                    {generatePieSlices()}
                </svg>
            </div>

            {getTotalLabel() && (
                <div className={styles.totalLabel}>{getTotalLabel()}</div>
            )}

            <div className={styles.legend}>
                {chartData.map((segment, index) => (
                    <div key={index} className={styles.legendItem}>
                        <span
                            className={styles.legendColor}
                            style={{ backgroundColor: segment.color }}
                        />
                        <span className={styles.legendLabel}>{segment.label}</span>
                        <span className={styles.legendValue}>{segment.displayValue}</span>
                    </div>
                ))}
            </div>
        </div>
    );
}
</file>

<file path="frontend/components/homepage/IPOCalendarWidget.tsx">
'use client';

import { useState, useEffect } from 'react';
import Link from 'next/link';
import styles from './IPOCalendarWidget.module.css';
import { fetchCalendarEvents } from '@/lib/api';

export default function IPOCalendarWidget() {
    const [currentDate, setCurrentDate] = useState<Date | null>(null);
    const [events, setEvents] = useState<any[]>([]);
    const [loading, setLoading] = useState(true);
    const [mounted, setMounted] = useState(false);

    // Initialize date on client-side only to avoid hydration mismatch
    useEffect(() => {
        setCurrentDate(new Date());
        setMounted(true);
    }, []);

    useEffect(() => {
        if (currentDate) {
            loadEvents();
        }
    }, [currentDate]);

    async function loadEvents() {
        if (!currentDate) return;
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth() + 1;
        const data = await fetchCalendarEvents(year, month);
        setEvents(data);
        setLoading(false);
    }

    // Don't render until we're mounted on client
    if (!mounted || !currentDate) {
        return (
            <div className={styles.container}>
                <div className={styles.loading}>Loading calendar...</div>
            </div>
        );
    }

    const getDaysInMonth = () => {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startingDayOfWeek = firstDay.getDay();

        return { daysInMonth, startingDayOfWeek };
    };

    const getEventsForDay = (day: number) => {
        const dateStr = new Date(
            currentDate.getFullYear(),
            currentDate.getMonth(),
            day
        ).toISOString().split('T')[0];

        return events.filter(event => event.event_date === dateStr);
    };

    const { daysInMonth, startingDayOfWeek } = getDaysInMonth();
    const days = Array.from({ length: daysInMonth }, (_, i) => i + 1);
    const blanks = Array.from({ length: startingDayOfWeek }, (_, i) => i);

    const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

    return (
        <div className={styles.container}>
            <div className={styles.header}>
                <button
                    className={styles.navButton}
                    onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1))}
                >
                    ‚Üê
                </button>
                <h3 className={styles.monthYear}>
                    {monthNames[currentDate.getMonth()]} {currentDate.getFullYear()}
                </h3>
                <button
                    className={styles.navButton}
                    onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1))}
                >
                    ‚Üí
                </button>
            </div>

            <div className={styles.calendar}>
                <div className={styles.weekdays}>
                    {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (
                        <div key={day} className={styles.weekday}>{day}</div>
                    ))}
                </div>

                <div className={styles.days}>
                    {blanks.map(i => (
                        <div key={`blank-${i}`} className={styles.blankDay} />
                    ))}
                    {days.map(day => {
                        const dayEvents = getEventsForDay(day);
                        const hasEvents = dayEvents.length > 0;
                        const today = new Date();
                        const isToday =
                            day === today.getDate() &&
                            currentDate.getMonth() === today.getMonth() &&
                            currentDate.getFullYear() === today.getFullYear();

                        return (
                            <div
                                key={day}
                                className={`${styles.day} ${hasEvents ? styles.hasEvents : ''} ${isToday ? styles.today : ''}`}
                                title={hasEvents ? dayEvents.map(e => e.event_title).join(', ') : ''}
                            >
                                <span className={styles.dayNumber}>{day}</span>
                                {hasEvents && (
                                    <div className={styles.eventDots}>
                                        {dayEvents.slice(0, 3).map((event, i) => (
                                            <div key={i} className={styles.eventDot} />
                                        ))}
                                    </div>
                                )}
                            </div>
                        );
                    })}
                </div>
            </div>

            {events.length > 0 && (
                <div className={styles.upcomingEvents}>
                    <h4 className={styles.eventsTitle}>Upcoming Events</h4>
                    <div className={styles.eventsList}>
                        {events.slice(0, 5).map((event, i) => (
                            <Link
                                key={i}
                                href={`/ipo/${event.ipos?.slug || '#'}`}
                                className={styles.eventItem}
                            >
                                <span className={styles.eventDate}>
                                    {new Date(event.event_date).getDate()}
                                </span>
                                <div className={styles.eventInfo}>
                                    <span className={styles.eventTitle}>{event.event_title}</span>
                                    <span className={styles.eventType}>{event.event_type}</span>
                                </div>
                            </Link>
                        ))}
                    </div>
                </div>
            )}
        </div>
    );
}
</file>

<file path="frontend/components/homepage/IPOFilters.module.css">
/* ============================================
   IPO Filters - Brutalist Editorial Style
   ============================================ */

.filtersContainer {
    background: var(--color-bg-card);
    border: 4px solid var(--black);
    padding: 2rem;
    box-shadow: var(--shadow-card);
}

.filtersHeader {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 3px solid var(--black);
}

.filtersTitle {
    font-size: 1.25rem;
    font-family: var(--font-heading);
    color: var(--color-text-primary);
    text-transform: uppercase;
    background: var(--yellow);
    padding: 0.375rem 1rem;
    transform: rotate(-1deg);
}

.clearButton {
    padding: 0.625rem 1.25rem;
    background-color: var(--white);
    color: var(--black);
    border: 3px solid var(--black);
    font-size: 0.875rem;
    font-family: var(--font-body);
    font-weight: 700;
    cursor: pointer;
    transition: all 0.15s ease;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.clearButton:hover {
    background-color: var(--black);
    color: var(--yellow);
    transform: rotate(-2deg);
}

.filterGroup {
    margin-bottom: 1.5rem;
}

.filterGroup:last-child {
    margin-bottom: 0;
}

.filterLabel {
    font-size: 0.75rem;
    font-family: var(--font-body);
    font-weight: 700;
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 0.75rem;
    display: block;
}

.filterOptions {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
}

.filterButton {
    padding: 0.75rem 1.5rem;
    background-color: var(--white);
    color: var(--black);
    border: 3px solid var(--black);
    font-size: 0.9375rem;
    font-family: var(--font-body);
    font-weight: 700;
    cursor: pointer;
    transition: all 0.15s ease;
    white-space: nowrap;
    text-transform: uppercase;
}

.filterButton:hover {
    background-color: var(--yellow);
    transform: rotate(-1deg);
}

.filterButton.active {
    background: var(--black);
    color: var(--yellow);
}

.filterButton .count {
    display: inline-block;
    margin-left: 0.5rem;
    padding: 0.125rem 0.5rem;
    background-color: var(--gray);
    font-size: 0.75rem;
    border: 1px solid var(--black);
}

.filterButton.active .count {
    background-color: var(--yellow);
    color: var(--black);
}

.searchBox {
    width: 100%;
    padding: 1rem 1.25rem;
    padding-left: 3.5rem;
    border: 3px solid var(--black);
    font-size: 0.9375rem;
    font-family: var(--font-body);
    color: var(--color-text-primary);
    background-color: var(--white);
    background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16zM19 19l-4.35-4.35' stroke='%23000000' stroke-width='2.5' stroke-linecap='square' stroke-linejoin='miter'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: 1.25rem center;
    transition: all 0.15s ease;
}

.searchBox:hover {
    background-color: var(--gray);
}

.searchBox:focus {
    outline: none;
    background-color: var(--yellow);
}

.searchBox::placeholder {
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.rangeFilter {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: 1rem;
    align-items: center;
}

.rangeInput {
    padding: 1rem 1.25rem;
    border: 3px solid var(--black);
    font-size: 0.9375rem;
    font-family: var(--font-body);
    color: var(--color-text-primary);
    background-color: var(--white);
    transition: all 0.15s ease;
}

.rangeInput:hover {
    background-color: var(--gray);
}

.rangeInput:focus {
    outline: none;
    background-color: var(--yellow);
}

.rangeSeparator {
    font-size: 1rem;
    font-family: var(--font-body);
    color: var(--black);
    font-weight: 700;
}

.checkboxGroup {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.checkboxLabel {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    cursor: pointer;
    font-size: 0.9375rem;
    font-family: var(--font-body);
    color: var(--color-text-primary);
    transition: color 0.15s ease;
    text-transform: uppercase;
}

.checkboxLabel:hover {
    color: var(--black);
}

.checkbox {
    width: 24px;
    height: 24px;
    border: 3px solid var(--black);
    cursor: pointer;
    transition: all 0.15s ease;
    appearance: none;
    position: relative;
    background-color: var(--white);
}

.checkbox:hover {
    background-color: var(--gray);
}

.checkbox:checked {
    background: var(--black);
}

.checkbox:checked::after {
    content: '';
    position: absolute;
    top: 3px;
    left: 7px;
    width: 6px;
    height: 10px;
    border: solid var(--yellow);
    border-width: 0 3px 3px 0;
    transform: rotate(45deg);
}

.activeFiltersBar {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem;
    background-color: var(--gray);
    border: 3px solid var(--black);
    margin-top: 1.5rem;
    flex-wrap: wrap;
}

.activeFiltersLabel {
    font-size: 0.75rem;
    font-family: var(--font-body);
    font-weight: 700;
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

.activeFilterTag {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: var(--black);
    color: var(--yellow);
    font-size: 0.875rem;
    font-family: var(--font-body);
    font-weight: 700;
    text-transform: uppercase;
}

.removeFilterButton {
    background: none;
    border: none;
    color: var(--yellow);
    cursor: pointer;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 16px;
    height: 16px;
    transition: transform 0.15s ease;
}

.removeFilterButton:hover {
    transform: rotate(90deg);
}

@media (max-width: 768px) {
    .filtersContainer {
        padding: 1.5rem;
    }

    .filtersHeader {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }

    .filterOptions {
        gap: 0.5rem;
    }

    .filterButton {
        padding: 0.625rem 1rem;
        font-size: 0.8125rem;
    }

    .rangeFilter {
        grid-template-columns: 1fr;
    }

    .rangeSeparator {
        display: none;
    }
}
</file>

<file path="frontend/components/homepage/IPOFilters.tsx">
'use client';

import styles from './IPOFilters.module.css';

interface IPOFiltersProps {
    selectedCategory: string;
    onCategoryChange: (category: string) => void;
}

export default function IPOFilters({ selectedCategory, onCategoryChange }: IPOFiltersProps) {
    const categories = [
        { id: 'all', label: 'All IPOs', icon: 'üìä' },
        { id: 'Mainboard', label: 'Mainboard', icon: 'üè¢' },
        { id: 'SME', label: 'SME', icon: 'üè™' }
    ];

    const sortOptions = [
        { id: 'date', label: 'By Date' },
        { id: 'gmp', label: 'By GMP' },
        { id: 'subscription', label: 'By Subscription' }
    ];

    return (
        <div className={styles.container}>
            <div className={styles.categoryFilters}>
                {categories.map(category => (
                    <button
                        key={category.id}
                        className={`${styles.filterButton} ${selectedCategory === category.id ? styles.active : ''}`}
                        onClick={() => onCategoryChange(category.id)}
                    >
                        <span className={styles.icon}>{category.icon}</span>
                        <span>{category.label}</span>
                    </button>
                ))}
            </div>

            <div className={styles.sortSection}>
                <label className={styles.sortLabel}>Sort by:</label>
                <select className={styles.sortSelect}>
                    {sortOptions.map(option => (
                        <option key={option.id} value={option.id}>
                            {option.label}
                        </option>
                    ))}
                </select>
            </div>
        </div>
    );
}
</file>

<file path="frontend/components/homepage/MarketSentimentGauge.module.css">
/* ============================================
   Market Sentiment Gauge - Brutalist Editorial Style
   ============================================ */

.gauge {
    background: var(--color-bg-card);
    border: 4px solid var(--black);
    padding: 1.5rem;
    text-align: center;
    box-shadow: var(--shadow-card);
}

.title {
    font-size: 1.125rem;
    font-family: var(--font-heading);
    color: var(--black);
    margin: 0 0 1.5rem 0;
    text-transform: uppercase;
    background: var(--yellow);
    display: inline-block;
    padding: 0.375rem 1rem;
    transform: rotate(-1deg);
}

/* Loading State */
.loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    gap: 1rem;
    color: var(--color-text-primary);
}

.loadingSpinner {
    width: 40px;
    height: 40px;
    border: 4px solid var(--gray);
    border-top-color: var(--black);
    animation: spin 0.8s linear infinite;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

.loading p {
    font-size: 0.9375rem;
    font-family: var(--font-body);
    margin: 0;
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

/* Gauge Visual */
.gaugeVisual {
    position: relative;
    width: 200px;
    height: 110px;
    margin: 0 auto 1.25rem;
}

.gaugeSvg {
    width: 100%;
    height: 100%;
    overflow: visible;
}

.gaugeFill {
    transition: stroke-dasharray 0.8s ease;
}

.needle {
    transition: transform 0.8s ease;
}

/* Sentiment Label */
.sentimentLabel {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
}

.icon {
    font-size: 1.75rem;
}

.text {
    font-size: 1.5rem;
    font-family: var(--font-heading);
    font-weight: 400;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.score {
    font-size: 1rem;
    font-family: var(--font-body);
    font-weight: 700;
    padding: 0.375rem 0.875rem;
    background: var(--yellow);
    border: 3px solid var(--black);
}

/* Stats Grid */
.stats {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0;
    border: 3px solid var(--black);
}

.statItem {
    display: flex;
    flex-direction: column;
    gap: 0.375rem;
    padding: 1rem;
    background: var(--gray);
    transition: all 0.15s ease;
    border-right: 3px solid var(--black);
}

.statItem:last-child {
    border-right: none;
}

.statItem:hover {
    background: var(--yellow);
}

.statLabel {
    font-size: 0.625rem;
    font-family: var(--font-body);
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-weight: 700;
}

.statValue {
    font-size: 1.375rem;
    font-family: var(--font-body);
    font-weight: 700;
    color: var(--color-text-primary);
}

/* Positive/Negative value styling */
.statValue.positive {
    color: var(--blue);
}

.statValue.negative {
    color: var(--red);
}

/* Responsive Design */
@media (max-width: 768px) {
    .gauge {
        padding: 1.25rem;
    }

    .title {
        font-size: 1rem;
        margin-bottom: 1.25rem;
    }

    .gaugeVisual {
        width: 160px;
        height: 88px;
    }

    .sentimentLabel {
        gap: 0.5rem;
    }

    .icon {
        font-size: 1.25rem;
    }

    .text {
        font-size: 1.25rem;
    }

    .score {
        font-size: 0.875rem;
        padding: 0.25rem 0.625rem;
    }

    .stats {
        grid-template-columns: 1fr;
    }

    .statItem {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
        border-right: none;
        border-bottom: 3px solid var(--black);
    }

    .statItem:last-child {
        border-bottom: none;
    }
}
</file>

<file path="frontend/components/homepage/MarketSentimentGauge.tsx">
'use client';

import styles from './MarketSentimentGauge.module.css';

interface MarketSentimentProps {
    overall_sentiment: 'Bullish' | 'Neutral' | 'Bearish';
    sentiment_score: number;
    avg_gmp_mainboard: number;
    avg_gmp_sme: number;
    positive_gmp_count: number;
    total_open_ipos: number;
}

export default function MarketSentimentGauge({ data }: { data: MarketSentimentProps | null }) {
    if (!data) {
        return (
            <div className={styles.gauge}>
                <h3 className={styles.title}>üìä Market Sentiment</h3>
                <div className={styles.loading}>
                    <div className={styles.loadingSpinner}></div>
                    <p>Loading market data...</p>
                </div>
            </div>
        );
    }

    const { overall_sentiment, sentiment_score, avg_gmp_mainboard, avg_gmp_sme, positive_gmp_count, total_open_ipos } = data;

    const getSentimentColor = () => {
        if (overall_sentiment === 'Bullish') return '#22c55e';
        if (overall_sentiment === 'Bearish') return '#ef4444';
        return '#f59e0b';
    };

    const getSentimentIcon = () => {
        if (overall_sentiment === 'Bullish') return 'üìà';
        if (overall_sentiment === 'Bearish') return 'üìâ';
        return '‚ûñ';
    };

    const needleRotation = (sentiment_score / 100) * 180 - 90;

    return (
        <div className={styles.gauge}>
            <h3 className={styles.title}>üìä Market Sentiment</h3>

            <div className={styles.gaugeVisual}>
                <svg viewBox="0 0 200 110" className={styles.gaugeSvg}>
                    {/* Background arcs */}
                    <path
                        d="M 20 90 A 70 70 0 0 1 180 90"
                        fill="none"
                        stroke="#ef4444"
                        strokeWidth="15"
                        strokeLinecap="round"
                        opacity="0.2"
                    />
                    <path
                        d="M 20 90 A 70 70 0 0 1 180 90"
                        fill="none"
                        stroke="#f59e0b"
                        strokeWidth="15"
                        strokeLinecap="round"
                        strokeDasharray="110 330"
                        strokeDashoffset="0"
                        opacity="0.2"
                    />
                    <path
                        d="M 20 90 A 70 70 0 0 1 180 90"
                        fill="none"
                        stroke="#22c55e"
                        strokeWidth="15"
                        strokeLinecap="round"
                        strokeDasharray="110 330"
                        strokeDashoffset="-220"
                        opacity="0.2"
                    />

                    {/* Active arc */}
                    <path
                        d="M 20 90 A 70 70 0 0 1 180 90"
                        fill="none"
                        stroke={getSentimentColor()}
                        strokeWidth="15"
                        strokeLinecap="round"
                        strokeDasharray={`${(sentiment_score / 100) * 220} 220`}
                        className={styles.gaugeFill}
                    />

                    {/* Needle */}
                    <line
                        x1="100"
                        y1="90"
                        x2="100"
                        y2="35"
                        stroke={getSentimentColor()}
                        strokeWidth="3"
                        strokeLinecap="round"
                        transform={`rotate(${needleRotation} 100 90)`}
                        className={styles.needle}
                    />
                    <circle cx="100" cy="90" r="6" fill={getSentimentColor()} />
                    <circle cx="100" cy="90" r="3" fill="#0a0e27" />
                </svg>
            </div>

            <div className={styles.sentimentLabel} style={{ color: getSentimentColor() }}>
                <span className={styles.icon}>{getSentimentIcon()}</span>
                <span className={styles.text}>{overall_sentiment}</span>
                <span className={styles.score}>{sentiment_score.toFixed(0)}/100</span>
            </div>

            <div className={styles.stats}>
                <div className={styles.statItem}>
                    <span className={styles.statLabel}>Mainboard GMP</span>
                    <span className={styles.statValue}>+{avg_gmp_mainboard.toFixed(1)}%</span>
                </div>
                <div className={styles.statItem}>
                    <span className={styles.statLabel}>SME GMP</span>
                    <span className={styles.statValue}>+{avg_gmp_sme.toFixed(1)}%</span>
                </div>
                <div className={styles.statItem}>
                    <span className={styles.statLabel}>Positive IPOs</span>
                    <span className={styles.statValue}>{positive_gmp_count}/{total_open_ipos}</span>
                </div>
            </div>
        </div>
    );
}
</file>

<file path="frontend/components/homepage/QuickActionButtons.module.css">
/* ============================================
   Quick Action Buttons - Brutalist Editorial Style
   ============================================ */

.container {
    background: var(--color-bg-card);
    border: 4px solid var(--black);
    padding: 1.5rem;
    box-shadow: var(--shadow-card);
}

.title {
    font-size: 1.125rem;
    font-family: var(--font-heading);
    color: var(--black);
    margin: 0 0 1.25rem 0;
    text-transform: uppercase;
    background: var(--yellow);
    display: inline-block;
    padding: 0.375rem 1rem;
    transform: rotate(-1deg);
}

.buttonsGrid {
    display: flex;
    flex-direction: column;
    gap: 0.875rem;
}

.actionButton {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.25rem 1.5rem;
    background: var(--black);
    border: 3px solid var(--black);
    text-decoration: none;
    transition: all 0.15s ease;
    position: relative;
    overflow: hidden;
}

.actionButton::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 6px;
    background: var(--yellow);
}

.actionButton:hover {
    background: var(--yellow);
    transform: rotate(-2deg);
    box-shadow: var(--shadow-md);
}

.actionButton:hover::before {
    background: var(--black);
}

.icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    background: var(--yellow);
    font-size: 1.5rem;
    flex-shrink: 0;
    transition: all 0.15s ease;
}

.actionButton:hover .icon {
    background: var(--black);
    color: var(--yellow);
    transform: rotate(5deg);
}

.content {
    flex: 1;
    min-width: 0;
}

.actionTitle {
    font-size: 1rem;
    font-family: var(--font-heading);
    color: var(--yellow);
    margin: 0 0 0.25rem 0;
    text-transform: uppercase;
}

.actionButton:hover .actionTitle {
    color: var(--black);
}

.actionDesc {
    font-size: 0.8125rem;
    font-family: var(--font-body);
    color: var(--gray);
    margin: 0;
    line-height: 1.4;
    text-transform: uppercase;
    letter-spacing: 0.02em;
}

.actionButton:hover .actionDesc {
    color: var(--color-text-secondary);
}

.arrow {
    font-size: 1.5rem;
    color: var(--yellow);
    transition: all 0.15s ease;
}

.actionButton:hover .arrow {
    color: var(--black);
    transform: translateX(4px) rotate(-5deg);
}

/* Responsive Design */
@media (max-width: 768px) {
    .container {
        padding: 1.25rem;
    }

    .title {
        font-size: 1rem;
        margin-bottom: 1rem;
    }

    .actionButton {
        padding: 1rem 1.25rem;
    }

    .icon {
        width: 44px;
        height: 44px;
        font-size: 1.25rem;
    }

    .actionTitle {
        font-size: 0.9375rem;
    }

    .actionDesc {
        font-size: 0.75rem;
    }
}
</file>

<file path="frontend/components/homepage/QuickActionButtons.tsx">
'use client';

import Link from 'next/link';
import styles from './QuickActionButtons.module.css';

export default function QuickActionButtons() {
    const actions = [
        {
            title: 'Check Allotment',
            description: 'View IPO allotment status',
            icon: 'üéØ',
            href: '/allotment',
            color: '#22c55e'
        },
        {
            title: 'Open IPOs',
            description: 'Currently open for bidding',
            icon: 'üìä',
            href: '/upcoming-ipos',
            color: '#06b6d4'
        },
        {
            title: 'GMP Tracker',
            description: 'Live grey market premium',
            icon: 'üíπ',
            href: '/gmp',
            color: '#a855f7'
        }
    ];

    return (
        <div className={styles.container}>
            <h3 className={styles.title}>Quick Actions</h3>
            <div className={styles.buttonsGrid}>
                {actions.map((action, index) => (
                    <Link 
                        key={index}
                        href={action.href} 
                        className={styles.actionButton}
                        style={{
                            '--button-color': action.color
                        } as React.CSSProperties}
                    >
                        <span className={styles.icon}>{action.icon}</span>
                        <div className={styles.content}>
                            <h4 className={styles.actionTitle}>{action.title}</h4>
                            <p className={styles.actionDesc}>{action.description}</p>
                        </div>
                        <span className={styles.arrow}>‚Üí</span>
                    </Link>
                ))}
            </div>
        </div>
    );
}
</file>

<file path="frontend/components/homepage/ShouldIApplyCalculator.module.css">
/* ============================================
   Should I Apply Calculator - Brutalist Editorial Style
   ============================================ */

.container {
    background: var(--color-bg-card);
    border: 4px solid var(--black);
    overflow: hidden;
    box-shadow: var(--shadow-card);
    padding: 1.5rem;
}

/* Input Section */
.inputs {
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
}

.inputGroup {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.label {
    font-size: 0.8125rem;
    font-family: var(--font-body);
    font-weight: 700;
    color: var(--color-text-primary);
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

.select,
.input {
    padding: 1rem 1.25rem;
    border: 3px solid var(--black);
    font-size: 0.9375rem;
    font-family: var(--font-body);
    color: var(--color-text-primary);
    background-color: var(--white);
    transition: all 0.15s ease;
    width: 100%;
}

.select:hover,
.input:hover {
    background-color: var(--gray);
}

.select:focus,
.input:focus {
    outline: none;
    background-color: var(--yellow);
}

.select {
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1.5L6 6.5L11 1.5' stroke='%23000000' stroke-width='2.5' stroke-linecap='square' stroke-linejoin='miter'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 1.25rem center;
    padding-right: 3.5rem;
}

.calculateButton {
    padding: 1.125rem;
    background: var(--black);
    color: var(--yellow);
    border: 3px solid var(--black);
    font-size: 1rem;
    font-family: var(--font-body);
    font-weight: 700;
    cursor: pointer;
    transition: all 0.15s ease;
    margin-top: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

.calculateButton:hover {
    background: var(--yellow);
    color: var(--black);
    transform: rotate(-2deg);
    box-shadow: var(--shadow-md);
}

.calculateButton:disabled {
    background: var(--gray);
    color: var(--color-text-muted);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
    border-color: var(--color-border-light);
}

/* Results Section */
.results {
    margin-top: 1.5rem;
    padding-top: 1.5rem;
    border-top: 4px solid var(--black);
}

.recommendation {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem 1.25rem;
    background: var(--yellow);
    border: 3px solid var(--black);
    margin-bottom: 1.25rem;
}

.recIcon {
    font-size: 1.75rem;
}

.recText {
    font-size: 1rem;
    font-family: var(--font-heading);
    font-weight: 400;
    color: var(--black);
    text-transform: uppercase;
}

.metricsGrid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0;
    border: 3px solid var(--black);
}

.resultCard {
    display: flex;
    flex-direction: column;
    gap: 0.375rem;
    padding: 1rem;
    background-color: var(--gray);
    transition: all 0.15s ease;
    border-right: 3px solid var(--black);
    border-bottom: 3px solid var(--black);
}

.resultCard:nth-child(2n) {
    border-right: none;
}

.resultCard:nth-last-child(-n+2) {
    border-bottom: none;
}

.resultCard:hover {
    background: var(--yellow);
}

.resultLabel {
    font-size: 0.625rem;
    font-family: var(--font-body);
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-weight: 700;
}

.resultValue {
    font-size: 1.375rem;
    font-family: var(--font-body);
    font-weight: 700;
    color: var(--color-text-primary);
}

.profit {
    color: var(--blue);
}

.loss {
    color: var(--red);
}

/* Responsive Design */
@media (max-width: 768px) {
    .container {
        padding: 1.25rem;
    }

    .metricsGrid {
        grid-template-columns: 1fr;
    }

    .resultCard {
        border-right: none;
        border-bottom: 3px solid var(--black);
    }

    .resultCard:last-child {
        border-bottom: none;
    }

    .resultCard {
        padding: 0.875rem;
    }

    .resultValue {
        font-size: 1.125rem;
    }
}
</file>

<file path="frontend/components/homepage/ShouldIApplyCalculator.tsx">
'use client';

import { useState } from 'react';
import styles from './ShouldIApplyCalculator.module.css';
import { calculateExpectedReturns } from '@/lib/api';

export default function ShouldIApplyCalculator({ ipos }: { ipos: any[] }) {
    const [selectedIPO, setSelectedIPO] = useState<any>(null);
    const [investment, setInvestment] = useState('15000');
    const [category, setCategory] = useState<'retail' | 'sNII' | 'bNII'>('retail');
    const [result, setResult] = useState<any>(null);

    const handleCalculate = () => {
        if (!selectedIPO || !investment) return;

        const investmentAmount = parseFloat(investment);
        const issuePrice = selectedIPO.issue_price || selectedIPO.max_price;

        const calculation = calculateExpectedReturns(
            investmentAmount,
            selectedIPO.gmp_amount,
            issuePrice,
            selectedIPO.lot_size,
            category,
            category === 'retail' ? selectedIPO.subscription_retail :
                category === 'sNII' ? selectedIPO.subscription_snii :
                    selectedIPO.subscription_bnii
        );

        setResult(calculation);
    };

    return (
        <div className={styles.container}>
            <div className={styles.inputs}>
                <div className={styles.inputGroup}>
                    <label className={styles.label}>Select IPO</label>
                    <select
                        className={styles.select}
                        onChange={(e) => {
                            const ipo = ipos.find(i => i.id === parseInt(e.target.value));
                            setSelectedIPO(ipo);
                            setResult(null);
                        }}
                    >
                        <option value="">Choose an IPO...</option>
                        {ipos.map(ipo => (
                            <option key={ipo.id} value={ipo.id}>
                                {ipo.company_name || ipo.ipo_name}
                            </option>
                        ))}
                    </select>
                </div>

                <div className={styles.inputGroup}>
                    <label className={styles.label}>Investment Amount (‚Çπ)</label>
                    <input
                        type="number"
                        className={styles.input}
                        value={investment}
                        onChange={(e) => setInvestment(e.target.value)}
                        placeholder="15000"
                    />
                </div>

                <div className={styles.inputGroup}>
                    <label className={styles.label}>Category</label>
                    <select
                        className={styles.select}
                        value={category}
                        onChange={(e) => setCategory(e.target.value as any)}
                    >
                        <option value="retail">Retail (1 lot)</option>
                        <option value="sNII">sNII (&lt; ‚Çπ10L)</option>
                        <option value="bNII">bNII (&gt; ‚Çπ10L)</option>
                    </select>
                </div>

                <button className={styles.calculateButton} onClick={handleCalculate}>
                    Calculate Returns
                </button>
            </div>

            {result && (
                <div className={styles.results}>
                    <div className={styles.recommendation} style={{ borderColor: result.recommendation.color }}>
                        <span className={styles.recIcon}>{result.recommendation.icon}</span>
                        <span className={styles.recText}>{result.recommendation.text}</span>
                    </div>

                    <div className={styles.metricsGrid}>
                        <div className={styles.resultCard}>
                            <span className={styles.resultLabel}>Lots Applied</span>
                            <span className={styles.resultValue}>{result.numLots}</span>
                        </div>
                        <div className={styles.resultCard}>
                            <span className={styles.resultLabel}>Total Shares</span>
                            <span className={styles.resultValue}>{result.numShares}</span>
                        </div>
                        <div className={styles.resultCard}>
                            <span className={styles.resultLabel}>Total Investment</span>
                            <span className={styles.resultValue}>‚Çπ{result.totalInvestment.toLocaleString()}</span>
                        </div>
                        <div className={styles.resultCard}>
                            <span className={styles.resultLabel}>Expected Profit</span>
                            <span className={`${styles.resultValue} ${result.totalProfit >= 0 ? styles.profit : styles.loss}`}>
                                ‚Çπ{result.totalProfit.toLocaleString()}
                            </span>
                        </div>
                        <div className={styles.resultCard}>
                            <span className={styles.resultLabel}>Allotment Probability</span>
                            <span className={styles.resultValue}>{result.allotmentProb.toFixed(1)}%</span>
                        </div>
                        <div className={styles.resultCard}>
                            <span className={styles.resultLabel}>Expected Return</span>
                            <span className={`${styles.resultValue} ${result.expectedProfit >= 0 ? styles.profit : styles.loss}`}>
                                ‚Çπ{result.expectedProfit.toLocaleString()}
                            </span>
                        </div>
                    </div>
                </div>
            )}
        </div>
    );
}
</file>

<file path="frontend/components/IPOCard.module.css">
/* ============================================
   IPO Card - Modern Dark Theme
   Matches GMP card styling exactly
   ============================================ */

@import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap');

.ipoCard {
  background: rgba(255, 255, 255, 0.03);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 1.8rem;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.ipoCard::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, #10b981, #06b6d4);
  transform: scaleX(0);
  transition: transform 0.3s ease;
}

.ipoCard:hover {
  transform: translateY(-5px);
  border-color: rgba(6, 182, 212, 0.4);
  background: rgba(255, 255, 255, 0.05);
}

.ipoCard:hover::before {
  transform: scaleX(1);
}

.ipoCard::after {
  display: none;
}

.ipoHeader {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 1.5rem;
  gap: 0.8rem;
}

.ipoName {
  font-size: 1.3rem;
  font-family: 'IBM Plex Sans', sans-serif;
  font-weight: 600;
  color: #f8fafc;
  margin-bottom: 0.5rem;
  line-height: 1.3;
  text-transform: none;
}

.ipoCategory {
  font-size: 0.75rem;
  font-family: 'IBM Plex Sans', sans-serif;
  color: #c084fc;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  background: rgba(168, 85, 247, 0.15);
  padding: 0.4rem 0.9rem;
  border-radius: 20px;
  border: 1px solid rgba(168, 85, 247, 0.3);
  display: inline-block;
}

.ipoStatus {
  padding: 0.4rem 0.9rem;
  font-size: 0.75rem;
  font-family: 'IBM Plex Sans', sans-serif;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  white-space: nowrap;
  border-radius: 20px;
}

.statusUpcoming {
  background: rgba(249, 115, 22, 0.15);
  color: #fb923c;
  border: 1px solid rgba(249, 115, 22, 0.3);
}

.statusOpen {
  background: rgba(34, 197, 94, 0.15);
  color: #4ade80;
  border: 1px solid rgba(34, 197, 94, 0.3);
}

.statusClosed {
  background: rgba(239, 68, 68, 0.15);
  color: #f87171;
  border: 1px solid rgba(239, 68, 68, 0.3);
}

.ipoDetails {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1rem;
  padding-top: 1.5rem;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.detailItem {
  display: flex;
  flex-direction: column;
}

.detailLabel {
  font-size: 0.8rem;
  font-family: 'IBM Plex Sans', sans-serif;
  color: #e2e8f0;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  margin-bottom: 0.3rem;
  font-weight: 500;
}

.detailValue {
  font-size: 1rem;
  font-family: 'JetBrains Mono', monospace;
  font-weight: 600;
  color: #06b6d4;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

@media (max-width: 768px) {
  .ipoCard {
    padding: 1.5rem;
  }

  .ipoHeader {
    flex-direction: column;
    gap: 0.75rem;
  }

  .ipoName {
    font-size: 1.125rem;
  }

  .ipoDetails {
    gap: 0.75rem;
  }
}
</file>

<file path="frontend/components/IPOCard.tsx">
'use client';

import { useState } from 'react';
import styles from './IPOCard.module.css';
import IPOModal from './IPOModal';

export interface IPOData {
  id: number;
  name: string;
  status: 'upcoming' | 'open' | 'closed';
  openDate: string;
  closeDate: string;
  priceRange: string;
  lotSize: string;
  issueSize: string;
  listingDate: string;
  parentCompany: string;
  category: string;
  drhp: 'filed' | 'pending';
  rhp: 'filed' | 'pending';
  gmp?: number;
  expectedListing?: string;
}

interface IPOCardProps {
  ipo: any;
}

export default function IPOCard({ ipo }: IPOCardProps) {
  const [isModalOpen, setIsModalOpen] = useState(false);

  // Handle both camelCase (old) and snake_case (database) field names
  const name = ipo.name || ipo.company_name || ipo.ipo_name || '';
  const category = ipo.category || 'Mainboard';
  const status = ipo.status || 'upcoming';
  const openDate = ipo.openDate || ipo.open_date || 'TBA';
  const closeDate = ipo.closeDate || ipo.close_date || 'TBA';
  const priceRange = ipo.priceRange || ipo.price_range || 'TBA';
  const issueSize = ipo.issueSize || ipo.issue_size || 'TBA';

  return (
    <>
      <div className={styles.ipoCard} onClick={() => setIsModalOpen(true)}>
        <div className={styles.ipoHeader}>
          <div>
            <h3 className={styles.ipoName}>{name}</h3>
            <p className={styles.ipoCategory}>{category}</p>
          </div>
          <span className={`${styles.ipoStatus} ${styles[`status${status.charAt(0).toUpperCase() + status.slice(1)}`]}`}>
            {status}
          </span>
        </div>

        <div className={styles.ipoDetails}>
          <div className={styles.detailItem}>
            <span className={styles.detailLabel}>Open Date</span>
            <span className={styles.detailValue}>{openDate}</span>
          </div>
          <div className={styles.detailItem}>
            <span className={styles.detailLabel}>Close Date</span>
            <span className={styles.detailValue}>{closeDate}</span>
          </div>
          <div className={styles.detailItem}>
            <span className={styles.detailLabel}>Price Range</span>
            <span className={styles.detailValue}>{priceRange}</span>
          </div>
          <div className={styles.detailItem}>
            <span className={styles.detailLabel}>Issue Size</span>
            <span className={styles.detailValue}>{issueSize}</span>
          </div>
        </div>
      </div>

      {isModalOpen && (
        <IPOModal ipo={ipo} onClose={() => setIsModalOpen(false)} />
      )}
    </>
  );
}
</file>

<file path="frontend/components/IPOModal.module.css">
.modalOverlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  padding: 1.5rem;
  animation: fadeIn 0.2s ease;
}

.modalContent {
  background: var(--color-bg-card);
  border-radius: var(--radius-lg);
  max-width: 800px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: var(--shadow-xl);
  animation: slideUp 0.3s ease;
  border: 1px solid var(--color-border);
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }

  to {
    opacity: 1;
  }
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(24px) scale(0.98);
  }

  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.modalHeader {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  padding: 2rem;
  border-bottom: 1px solid var(--color-border-light);
}

.modalTitle {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--color-text-primary);
  margin-bottom: 0.5rem;
}

.modalSubtitle {
  font-size: 0.9375rem;
  color: var(--color-text-secondary);
}

.closeButton {
  background-color: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  cursor: pointer;
  padding: 0.625rem;
  color: var(--color-text-secondary);
  transition: var(--transition-base);
  display: flex;
  align-items: center;
  justify-content: center;
}

.closeButton:hover {
  color: var(--color-text-primary);
  background-color: var(--color-bg-tertiary);
  border-color: var(--color-border);
}

.closeButton svg {
  width: 20px;
  height: 20px;
}

.modalBody {
  padding: 2rem;
}

.section {
  margin-bottom: 2rem;
}

.section:last-child {
  margin-bottom: 0;
}

.sectionTitle {
  font-size: 1.125rem;
  font-weight: 600;
  color: var(--color-text-primary);
  margin-bottom: 1rem;
  padding-bottom: 0.75rem;
  border-bottom: 1px solid var(--color-border-light);
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.sectionTitle::before {
  content: '';
  width: 3px;
  height: 18px;
  background: var(--gradient-primary);
  border-radius: 2px;
}

.infoGrid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1.5rem;
}

.infoItem {
  display: flex;
  flex-direction: column;
  gap: 0.375rem;
}

.infoLabel {
  font-size: 0.8125rem;
  color: var(--color-text-muted);
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.03em;
}

.infoValue {
  font-size: 1rem;
  color: var(--color-text-primary);
  font-weight: 600;
}

.statusBadge {
  display: inline-flex;
  align-items: center;
  padding: 0.5rem 1rem;
  border-radius: 9999px;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  width: fit-content;
}

.statusOpen {
  background-color: var(--color-success-light);
  color: #047857;
}

.statusClosed {
  background-color: var(--color-bg-tertiary);
  color: var(--color-text-secondary);
}

.statusUpcoming {
  background-color: var(--color-warning-light);
  color: #b45309;
}

.gmpCard {
  padding: 1.75rem;
  background: linear-gradient(135deg, rgba(79, 70, 229, 0.04) 0%, rgba(139, 92, 246, 0.04) 100%);
  border: 1px solid rgba(79, 70, 229, 0.1);
  border-radius: var(--radius-md);
  text-align: center;
}

.gmpLabel {
  font-size: 0.8125rem;
  color: var(--color-text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  font-weight: 600;
  margin-bottom: 0.75rem;
}

.gmpValue {
  font-size: 2.75rem;
  font-weight: 700;
  line-height: 1;
  margin-bottom: 0.5rem;
}

.gmpPositive {
  color: var(--color-success);
}

.gmpNegative {
  color: var(--color-error);
}

.gmpNeutral {
  color: var(--color-text-secondary);
}

.gmpPercentage {
  font-size: 1rem;
  color: var(--color-text-secondary);
  font-weight: 500;
}

.subscriptionBar {
  width: 100%;
  height: 10px;
  background-color: var(--color-bg-tertiary);
  border-radius: 10px;
  overflow: hidden;
  margin-top: 1rem;
}

.subscriptionFill {
  height: 100%;
  background: linear-gradient(90deg, var(--color-success) 0%, #34d399 100%);
  transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  border-radius: 10px;
}

.subscriptionInfo {
  display: flex;
  justify-content: space-between;
  margin-top: 0.5rem;
  font-size: 0.8125rem;
  color: var(--color-text-secondary);
}

.timelineList {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.timelineItem {
  display: flex;
  gap: 1rem;
  align-items: flex-start;
}

.timelineDot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: var(--gradient-primary);
  margin-top: 0.25rem;
  flex-shrink: 0;
  box-shadow: 0 2px 6px rgba(79, 70, 229, 0.3);
}

.timelineContent {
  flex: 1;
}

.timelineDate {
  font-size: 0.9375rem;
  color: var(--color-text-primary);
  font-weight: 600;
  margin-bottom: 0.25rem;
}

.timelineEvent {
  font-size: 0.875rem;
  color: var(--color-text-secondary);
}

.documentsList {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.documentItem {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1rem;
  background-color: var(--color-bg-secondary);
  border: 1px solid var(--color-border-light);
  border-radius: var(--radius-md);
  transition: var(--transition-base);
}

.documentItem:hover {
  background-color: var(--color-bg-card);
  box-shadow: var(--shadow-sm);
  border-color: rgba(79, 70, 229, 0.15);
}

.documentInfo {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.documentIcon {
  width: 40px;
  height: 40px;
  background: linear-gradient(135deg, var(--color-bg-tertiary) 0%, var(--color-border) 100%);
  border-radius: var(--radius-md);
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--color-text-secondary);
}

.documentName {
  font-size: 0.9375rem;
  color: var(--color-text-primary);
  font-weight: 600;
}

.downloadButton {
  padding: 0.5rem 1rem;
  background: var(--gradient-primary);
  color: #ffffff;
  border: none;
  border-radius: var(--radius-sm);
  font-size: 0.875rem;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition-base);
  box-shadow: 0 2px 6px rgba(79, 70, 229, 0.2);
}

.downloadButton:hover {
  box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
  transform: translateY(-1px);
}

.modalFooter {
  padding: 1.5rem 2rem;
  border-top: 1px solid var(--color-border-light);
  display: flex;
  gap: 1rem;
  justify-content: flex-end;
}

.footerButton {
  padding: 0.75rem 1.5rem;
  border-radius: var(--radius-md);
  font-size: 0.9375rem;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition-base);
}

.primaryButton {
  background: var(--gradient-primary);
  color: #ffffff;
  border: none;
  box-shadow: 0 2px 8px rgba(79, 70, 229, 0.25);
}

.primaryButton:hover {
  box-shadow: 0 4px 16px rgba(79, 70, 229, 0.35);
  transform: translateY(-1px);
}

.secondaryButton {
  background-color: var(--color-bg-secondary);
  color: var(--color-text-secondary);
  border: 1px solid var(--color-border);
}

.secondaryButton:hover {
  background-color: var(--color-bg-tertiary);
  border-color: var(--color-primary);
  color: var(--color-primary);
}

@media (max-width: 768px) {
  .modalOverlay {
    padding: 0;
  }

  .modalContent {
    max-height: 100vh;
    border-radius: 0;
  }

  .modalHeader,
  .modalBody,
  .modalFooter {
    padding: 1.5rem;
  }

  .infoGrid {
    grid-template-columns: 1fr;
    gap: 1rem;
  }

  .gmpValue {
    font-size: 2.25rem;
  }

  .modalFooter {
    flex-direction: column;
  }

  .footerButton {
    width: 100%;
  }
}
</file>

<file path="frontend/components/IPOModal.tsx">
'use client';

import { useEffect } from 'react';
import styles from './IPOModal.module.css';
import { IPOData } from './IPOCard';

interface IPOModalProps {
  ipo: IPOData;
  onClose: () => void;
}

export default function IPOModal({ ipo, onClose }: IPOModalProps) {
  useEffect(() => {
    document.body.style.overflow = 'hidden';
    return () => {
      document.body.style.overflow = 'unset';
    };
  }, []);

  const handleBackdropClick = (e: React.MouseEvent) => {
    if (e.target === e.currentTarget) {
      onClose();
    }
  };

  return (
    <div className={styles.modal} onClick={handleBackdropClick}>
      <div className={styles.modalContent}>
        <button className={styles.modalClose} onClick={onClose}>
          &times;
        </button>

        <h2 className={styles.modalTitle}>{ipo.name}</h2>
        <p className={styles.modalCategory}>{ipo.category}</p>

        <div className={styles.modalDetails}>
          <div className={styles.modalDetailGroup}>
            <h3 className={styles.groupTitle}>Issue Details</h3>
            <div className={styles.detailRow}>
              <span className={styles.detailLabel}>Open Date</span>
              <span className={styles.detailValue}>{ipo.openDate}</span>
            </div>
            <div className={styles.detailRow}>
              <span className={styles.detailLabel}>Close Date</span>
              <span className={styles.detailValue}>{ipo.closeDate}</span>
            </div>
            <div className={styles.detailRow}>
              <span className={styles.detailLabel}>Listing Date</span>
              <span className={styles.detailValue}>{ipo.listingDate}</span>
            </div>
            <div className={styles.detailRow}>
              <span className={styles.detailLabel}>Price Range</span>
              <span className={styles.detailValue}>{ipo.priceRange}</span>
            </div>
          </div>

          <div className={styles.modalDetailGroup}>
            <h3 className={styles.groupTitle}>Investment Info</h3>
            <div className={styles.detailRow}>
              <span className={styles.detailLabel}>Lot Size</span>
              <span className={styles.detailValue}>{ipo.lotSize}</span>
            </div>
            <div className={styles.detailRow}>
              <span className={styles.detailLabel}>Issue Size</span>
              <span className={styles.detailValue}>{ipo.issueSize}</span>
            </div>
            {ipo.gmp && (
              <>
                <div className={styles.detailRow}>
                  <span className={styles.detailLabel}>GMP</span>
                  <span className={styles.detailValue}>‚Çπ{ipo.gmp}</span>
                </div>
                <div className={styles.detailRow}>
                  <span className={styles.detailLabel}>Expected Listing</span>
                  <span className={styles.detailValue}>{ipo.expectedListing}</span>
                </div>
              </>
            )}
          </div>

          <div className={styles.modalDetailGroup}>
            <h3 className={styles.groupTitle}>Company Info</h3>
            <div className={styles.detailRow}>
              <span className={styles.detailLabel}>Parent Company</span>
              <span className={styles.detailValue}>{ipo.parentCompany}</span>
            </div>
            <div className={styles.detailRow}>
              <span className={styles.detailLabel}>Category</span>
              <span className={styles.detailValue}>{ipo.category}</span>
            </div>
          </div>

          <div className={styles.modalDetailGroup}>
            <h3 className={styles.groupTitle}>Regulatory Filings</h3>
            <div className={styles.detailRow}>
              <span className={styles.detailLabel}>DRHP Status</span>
              <span className={`${styles.badge} ${ipo.drhp === 'filed' ? styles.badgeFiled : styles.badgePending}`}>
                {ipo.drhp}
              </span>
            </div>
            <div className={styles.detailRow}>
              <span className={styles.detailLabel}>RHP Status</span>
              <span className={`${styles.badge} ${ipo.rhp === 'filed' ? styles.badgeFiled : styles.badgePending}`}>
                {ipo.rhp}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="frontend/components/Navbar.tsx">
import React from "react";
import { LineChart, Send } from "lucide-react";

export function Navbar() {
  return (
    <nav className="border-b border-white/10 bg-black/50 backdrop-blur-xl sticky top-0 z-50">
      <div className="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
        {/* Logo */}
        <div className="flex items-center gap-2">
          <div className="p-2 bg-gradient-to-br from-green-500 to-blue-600 rounded-lg">
            <LineChart className="w-5 h-5 text-white" />
          </div>
          <h1 className="text-xl font-bold bg-gradient-to-r from-white to-gray-400 bg-clip-text text-transparent">
            IPO<span className="text-green-500">Track</span>
          </h1>
        </div>

        {/* Action Button */}
        <button className="flex items-center gap-2 px-4 py-2 bg-white text-black text-sm font-bold rounded-full hover:bg-gray-200 transition-all hover:scale-105 active:scale-95">
          <Send size={14} />
          <span>Join Channel</span>
        </button>
      </div>
    </nav>
  );
}
</file>

<file path="frontend/eslint.config.mjs">
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;
</file>

<file path="frontend/lib/supabase.ts">
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;
const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;

if (!supabaseUrl || !supabaseAnonKey) {
    throw new Error('Missing Supabase environment variables');
}

export const supabase = createClient(supabaseUrl, supabaseAnonKey);

// Database Types
export interface IPODetail {
    id: number;
    ipo_name: string;
    company_name?: string;
    category?: string;
    issue_size?: string;
    issue_size_numeric?: number;
    price_range?: string;
    min_price?: number;
    max_price?: number;
    lot_size?: number;
    open_date?: string;
    close_date?: string;
    listing_date?: string;
    allotment_date?: string;
    status?: 'upcoming' | 'open' | 'closed' | 'listed';
    drhp_status?: 'filed' | 'pending' | 'approved';
    rhp_status?: 'filed' | 'pending' | 'approved';
    parent_company?: string;
    description?: string;
    website_url?: string;
    lead_managers?: string[];
    registrar?: string;
    exchange?: string[];
    subscription_retail?: number;
    subscription_nii?: number;
    subscription_qib?: number;
    subscription_total?: number;
    created_at?: string;
    updated_at?: string;
}

export interface IPOGMP {
    id: number;
    ipo_name: string;
    gmp?: number;
    price?: number;
    gain_percent?: number;
    subject?: string;
    ipo_date?: string;
    open_date?: string;
    close_date?: string;
    allotment_date?: string;
    listing_date?: string;
    created_at?: string;
    updated_at?: string;
}

export interface ShareholderIntel {
    id: number;
    ipo_name: string;
    parent_company?: string;
    sebi_status?: string;
    created_at?: string;
    updated_at?: string;
}

export interface AllotmentLink {
    id: number;
    ipo_name: string;
    registrar: string;
    link_url: string;
    link_type?: 'allotment' | 'refund' | 'status';
    is_active?: boolean;
    created_at?: string;
    updated_at?: string;
}

export interface GMPHistory {
    id: number;
    ipo_name: string;
    gmp: number;
    price: number;
    gain_percent?: number;
    recorded_at?: string;
}
</file>

<file path="frontend/lib/utils.ts">
import { clsx, type ClassValue } from "clsx";
import { twMerge } from "tailwind-merge";

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}
</file>

<file path="frontend/next-env.d.ts">
/// <reference types="next" />
/// <reference types="next/image-types/global" />
/// <reference path="./.next/types/routes.d.ts" />

// NOTE: This file should not be edited
// see https://nextjs.org/docs/app/api-reference/config/typescript for more information.
</file>

<file path="frontend/next.config.js">
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
}

module.exports = nextConfig
</file>

<file path="frontend/next.config.ts">
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
};

export default nextConfig;
</file>

<file path="frontend/package.json">
{
  "name": "ipo-tracker",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint"
  },
  "dependencies": {
    "@supabase/supabase-js": "^2.89.0",
    "clsx": "^2.1.1",
    "lucide-react": "^0.562.0",
    "next": "^15.1.3",
    "react": "^19.0.0",
    "react-dom": "^19.0.0",
    "tailwind-merge": "^3.4.0"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4.1.18",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "autoprefixer": "^10.4.23",
    "postcss": "^8.5.6",
    "tailwindcss": "^4.1.18",
    "typescript": "^5"
  }
}
</file>

<file path="frontend/postcss.config.mjs">
/** @type {import('postcss-load-config').Config} */
const config = {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};

export default config;
</file>

<file path="frontend/public/file.svg">
<svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z" clip-rule="evenodd" fill="#666" fill-rule="evenodd"/></svg>
</file>

<file path="frontend/public/globe.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g clip-path="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1" fill="#666"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"/></clipPath></defs></svg>
</file>

<file path="frontend/public/next.svg">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>
</file>

<file path="frontend/public/vercel.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1155 1000"><path d="m577.3 0 577.4 1000H0z" fill="#fff"/></svg>
</file>

<file path="frontend/public/window.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5" fill="#666"/></svg>
</file>

<file path="frontend/README.md">
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.
</file>

<file path="frontend/scripts/seed-data.sql">
-- =============================================
-- DUMMY DATA FOR IPO TRACKER
-- Run this in Supabase SQL Editor
-- =============================================

-- Update existing IPOs with more complete data
UPDATE public.ipos SET
    parent_company = 'Tata Motors Ltd',
    drhp_status = 'approved',
    rhp_status = 'approved',
    sebi_status = 'Approved',
    pre_ipo_promoter_holding_percent = 74.39,
    post_ipo_promoter_holding_percent = 59.15,
    company_description = 'Tata Technologies is a global engineering and product development digital services company. The company provides services to automotive and aerospace manufacturers worldwide.',
    industry_sector = 'IT Services & Consulting',
    key_highlights = '["Global leader in engineering and design services", "Serving top automotive and aerospace OEMs", "Strong presence in EV and sustainable mobility", "8 global delivery centers"]'::jsonb,
    strengths = '["Strong parentage with Tata Group brand value", "Diversified global client base", "Leadership in ER&D services", "High client retention rate of 95%+"]'::jsonb,
    concerns = '["Premium valuation compared to peers", "High dependence on automotive sector", "Forex exposure due to global operations"]'::jsonb,
    expert_rating = 4.2,
    rating_financial_performance = 4.5,
    rating_valuation = 3.8,
    rating_growth_prospects = 4.5,
    rating_management_quality = 4.2,
    rating_industry_outlook = 4.0,
    expert_recommendation = 'Subscribe for Long-term',
    risk_level = 'Medium',
    investment_horizon = 'Long-term',
    should_apply_yes_votes = 9823,
    should_apply_no_votes = 2720
WHERE ipo_name ILIKE '%Tata Technologies%';

UPDATE public.ipos SET
    parent_company = 'Honasa Consumer Pvt Ltd',
    drhp_status = 'approved',
    rhp_status = 'approved',
    sebi_status = 'Approved',
    pre_ipo_promoter_holding_percent = 35.72,
    post_ipo_promoter_holding_percent = 32.95,
    company_description = 'Mamaearth is a leading direct-to-consumer (D2C) beauty and personal care brand in India, known for its toxin-free products.',
    industry_sector = 'FMCG - Personal Care',
    key_highlights = '["#1 D2C beauty brand in India", "Toxin-free & sustainable products", "Strong digital presence", "Celebrity-backed brand"]'::jsonb,
    strengths = '["Strong brand recognition", "High growth trajectory", "Omnichannel distribution", "Repeat customer base"]'::jsonb,
    concerns = '["High marketing expenses", "Intense competition from FMCG giants", "Path to profitability unclear"]'::jsonb,
    expert_rating = 3.5,
    rating_financial_performance = 3.0,
    rating_valuation = 3.2,
    rating_growth_prospects = 4.2,
    rating_management_quality = 3.8,
    rating_industry_outlook = 4.0,
    expert_recommendation = 'Subscribe for Long-term',
    risk_level = 'High',
    investment_horizon = 'Long-term'
WHERE ipo_name ILIKE '%Mamaearth%' OR ipo_name ILIKE '%Honasa%';

UPDATE public.ipos SET
    parent_company = 'Jio Financial Services Ltd',
    drhp_status = 'approved',
    rhp_status = 'approved',
    sebi_status = 'Approved',
    pre_ipo_promoter_holding_percent = 100,
    post_ipo_promoter_holding_percent = 92.5,
    company_description = 'Jio Financial Services is a financial services company part of Reliance Industries, offering lending, insurance, and wealth management services.',
    industry_sector = 'Financial Services',
    key_highlights = '["Backed by Reliance Industries", "Tech-first financial services", "Pan-India digital reach", "Partnership with BlackRock"]'::jsonb,
    strengths = '["Strong parent company support", "Digital-first approach", "Massive customer base from Jio", "Low cost of acquisition"]'::jsonb,
    concerns = '["New entrant in financial services", "Competition from established players", "Regulatory uncertainties"]'::jsonb,
    expert_rating = 4.0,
    rating_financial_performance = 3.5,
    rating_valuation = 3.8,
    rating_growth_prospects = 4.5,
    rating_management_quality = 4.2,
    rating_industry_outlook = 4.0,
    expert_recommendation = 'Subscribe',
    risk_level = 'Medium',
    investment_horizon = 'Long-term'
WHERE ipo_name ILIKE '%Jio Financial%';

UPDATE public.ipos SET
    parent_company = 'Hyundai Motor Company, South Korea',
    drhp_status = 'approved',
    rhp_status = 'approved',
    sebi_status = 'Approved',
    pre_ipo_promoter_holding_percent = 100,
    post_ipo_promoter_holding_percent = 82.5,
    company_description = 'Hyundai Motor India is the second-largest car manufacturer in India, offering a wide range of vehicles from hatchbacks to SUVs.',
    industry_sector = 'Automobile',
    key_highlights = '["#2 car manufacturer in India", "Strong SUV portfolio (Creta, Venue)", "EV leadership with Ioniq", "Export hub for Hyundai global"]'::jsonb,
    strengths = '["Market leader in SUV segment", "Strong brand recall", "Wide dealer network", "Profitability leader in auto sector"]'::jsonb,
    concerns = '["Competition from Tata, Maruti", "EV transition challenges", "Chip shortage impact"]'::jsonb,
    expert_rating = 4.5,
    rating_financial_performance = 4.8,
    rating_valuation = 4.0,
    rating_growth_prospects = 4.2,
    rating_management_quality = 4.5,
    rating_industry_outlook = 4.0,
    expert_recommendation = 'Subscribe',
    risk_level = 'Low',
    investment_horizon = 'Long-term'
WHERE ipo_name ILIKE '%Hyundai%';

UPDATE public.ipos SET
    parent_company = 'NTPC Ltd',
    drhp_status = 'approved', 
    rhp_status = 'approved',
    sebi_status = 'Approved',
    pre_ipo_promoter_holding_percent = 100,
    post_ipo_promoter_holding_percent = 88.25,
    company_description = 'NTPC Green Energy is the renewable energy arm of NTPC, focusing on solar, wind, and green hydrogen projects.',
    industry_sector = 'Renewable Energy',
    key_highlights = '["Backed by NTPC (Maharatna PSU)", "15 GW renewable capacity target", "Green hydrogen focus", "Government backing for renewables"]'::jsonb,
    strengths = '["Strong parent company", "Government push for green energy", "Massive project pipeline", "Tech expertise from NTPC"]'::jsonb,
    concerns = '["Execution risks in renewable projects", "Land acquisition challenges", "Policy dependency"]'::jsonb,
    expert_rating = 4.0,
    rating_financial_performance = 3.5,
    rating_valuation = 4.0,
    rating_growth_prospects = 4.5,
    rating_management_quality = 4.0,
    rating_industry_outlook = 4.5,
    expert_recommendation = 'Subscribe for Long-term',
    risk_level = 'Medium',
    investment_horizon = 'Long-term'
WHERE ipo_name ILIKE '%NTPC Green%';

UPDATE public.ipos SET
    parent_company = 'Bundl Technologies Pvt Ltd',
    drhp_status = 'approved',
    rhp_status = 'approved',
    sebi_status = 'Approved',
    pre_ipo_promoter_holding_percent = 8.82,
    post_ipo_promoter_holding_percent = 6.51,
    company_description = 'Swiggy is one of leading food delivery and quick commerce platforms in India, operating Swiggy Food, Instamart, and Dineout.',
    industry_sector = 'E-commerce - Food Tech',
    key_highlights = '["Top 2 food delivery platform in India", "Quick commerce through Instamart", "Restaurant discovery via Dineout", "Strong unit economics improvements"]'::jsonb,
    strengths = '["Strong brand recognition", "Multiple revenue streams", "Improving unit economics", "Large customer base"]'::jsonb,
    concerns = '["Path to profitability", "Intense competition with Zomato", "High cash burn", "Gig worker regulations"]'::jsonb,
    expert_rating = 3.8,
    rating_financial_performance = 3.0,
    rating_valuation = 3.5,
    rating_growth_prospects = 4.5,
    rating_management_quality = 4.0,
    rating_industry_outlook = 4.0,
    expert_recommendation = 'Subscribe for Long-term',
    risk_level = 'High',
    investment_horizon = 'Long-term'
WHERE ipo_name ILIKE '%Swiggy%';

-- Insert sample GMP history
INSERT INTO public.gmp_history (ipo_id, ipo_name, gmp_amount, gmp_percentage, issue_price, expected_listing_price, recorded_at)
SELECT 
    id,
    ipo_name,
    FLOOR(RANDOM() * 100 + 20)::int,
    ROUND((RANDOM() * 30 + 5)::numeric, 2),
    max_price,
    max_price + FLOOR(RANDOM() * 100 + 20)::int,
    NOW() - (INTERVAL '1 day' * generate_series)
FROM public.ipos,
     generate_series(1, 10)
WHERE ipo_name ILIKE '%Tata Technologies%'
ON CONFLICT DO NOTHING;

-- Insert sample comments
INSERT INTO public.ipo_comments (ipo_id, user_name, user_email, comment_text, should_apply_vote, is_approved, created_at)
SELECT 
    id,
    'Investor ' || (ROW_NUMBER() OVER ()),
    'investor' || (ROW_NUMBER() OVER ()) || '@example.com',
    CASE (ROW_NUMBER() OVER ()) % 5
        WHEN 0 THEN 'Great IPO, strong fundamentals. Definitely applying!'
        WHEN 1 THEN 'Valuation seems stretched but long-term prospects are good.'
        WHEN 2 THEN 'Applied from multiple demat accounts. Hoping for allotment!'
        WHEN 3 THEN 'GMP is very high, might correct post listing. Be careful.'
        WHEN 4 THEN 'Solid company with good management. Subscribe for long term.'
    END,
    CASE WHEN RANDOM() > 0.3 THEN 'Yes' ELSE 'No' END,
    true,
    NOW() - (INTERVAL '1 hour' * (ROW_NUMBER() OVER ()))
FROM public.ipos
LIMIT 20
ON CONFLICT DO NOTHING;

-- Update allotment links with ipo_id
UPDATE public.ipo_allotment_links al
SET ipo_id = i.id
FROM public.ipos i
WHERE al.ipo_name ILIKE i.ipo_name
AND al.ipo_id IS NULL;

SELECT 'Data update complete! Check your tables.' as status;
</file>

<file path="frontend/tsconfig.json">
{
  "compilerOptions": {
    
    "target": "ES2017",
    "lib": [
      "dom",
      "dom.iterable",
      "esnext"
    ],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": [
        "./*"
      ]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts"
  ],
  "exclude": [
    "node_modules"
  ]
}
</file>

<file path="README.md">
# ipo
</file>

<file path=".gitignore">
# Environments
.env
.env.local
.env.*.local
backend/.env
frontend/.env.local

# Python
backend/venv/
__pycache__/

# Node
frontend/node_modules/
# frontend build artifacts
frontend/.next
frontend/node_modules
frontend/tsconfig.tsbuildinfo
</file>

<file path="backend/repomix-output.xml">
This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
ipo-data-pipeline/scrapers/comprehensive_ipo_scraper.py
ipo-data-pipeline/scrapers/core/base_scraper.py
ipo-data-pipeline/scrapers/free_api_scraper.py
ipo-data-pipeline/scrapers/ipo_scrapers/enhanced_gmp_scraper.py
ipo-data-pipeline/scrapers/ipo_scrapers/subscription_scraper.py
ipo-data-pipeline/scrapers/orchestrator.py
ipo-data-pipeline/scrapers/web_scraper.py
requirements.txt
scheduler.py
scrape_shareholder.py
scraper.py
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="ipo-data-pipeline/scrapers/comprehensive_ipo_scraper.py">
import os
import re
import time
import random
import requests
from bs4 import BeautifulSoup
from supabase import create_client
from dotenv import load_dotenv
from datetime import datetime
import json
import sys
sys.path.append('../..')
from scraper import fetch_gmp_data as old_scraper_gmp, fetch_dates_data as old_scraper_dates


load_dotenv()
supabase = create_client(os.getenv("SUPABASE_URL"), os.getenv("SUPABASE_KEY"))

class SafeScraper:
    """Base scraper with anti-ban measures"""
    
    USER_AGENTS = [
        "Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/120.0.0.0 Safari/537.36",
        "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) Safari/605.1.15",
        "Mozilla/5.0 (X11; Linux x86_64) Firefox/122.0"
    ]
    
    @staticmethod
    def random_delay():
        """Random delay between 2-5 seconds"""
        time.sleep(random.uniform(2, 5))
    
    @staticmethod
    def get_headers():
        return {
            "User-Agent": random.choice(SafeScraper.USER_AGENTS),
            "Accept": "text/html,application/xhtml+xml,application/xml",
            "Accept-Language": "en-US,en;q=0.9",
            "Accept-Encoding": "gzip, deflate",
            "Connection": "keep-alive",
            "Upgrade-Insecure-Requests": "1"
        }
    
    @staticmethod
    def fetch_url(url, max_retries=2):
        for attempt in range(max_retries):
            try:
                resp = requests.get(url, headers=SafeScraper.get_headers(), timeout=15)
                if resp.status_code == 200:
                    return resp
                time.sleep(3)
            except:
                time.sleep(3)
        return None

def clean_text(text):
    if not text: return ""
    return text.replace('\n', '').replace('\t', '').strip()

def parse_number(text):
    if not text or text == "-": return None
    text = str(text).replace(',', '').replace('‚Çπ', '').replace('Rs.', '')
    match = re.search(r'[\d.]+', text)
    return float(match.group()) if match else None

def create_slug(name):
    slug = name.lower()
    slug = re.sub(r'\(sme\)|\(mainboard\)|ipo|limited|ltd\.?|pvt\.?', '', slug)
    slug = re.sub(r'[^a-z0-9]+', '-', slug)
    return slug.strip('-')

def parse_date(date_str):
    """Parse various date formats to YYYY-MM-DD"""
    if not date_str or date_str == "-":
        return None
    try:
        date_str = clean_text(date_str)
        for fmt in ['%b %d, %Y', '%d %b %Y', '%d-%b-%Y', '%d/%m/%Y', '%Y-%m-%d']:
            try:
                return datetime.strptime(date_str, fmt).strftime('%Y-%m-%d')
            except:
                continue
    except:
        pass
    return None

# ==================== SOURCE 1: NSE OFFICIAL API ====================
def scrape_nse_api():
    """NSE Official API - Free, No Rate Limit Issues"""
    print("\nüì° Fetching from NSE Official API...")
    
    url = "https://www.nseindia.com/api/ipo-current-issues"
    
    # NSE requires cookies, so we simulate browser session
    session = requests.Session()
    session.get("https://www.nseindia.com", headers=SafeScraper.get_headers())
    SafeScraper.random_delay()
    
    try:
        resp = session.get(url, headers=SafeScraper.get_headers(), timeout=10)
        data = resp.json()
        
        ipos = []
        for ipo in data.get('data', []):
            try:
                ipos.append({
                    "ipo_name": ipo.get('companyName', '') + " IPO",
                    "company_name": ipo.get('companyName', ''),
                    "slug": create_slug(ipo.get('companyName', '')),
                    "category": "Mainboard",
                    "issue_size_cr": parse_number(ipo.get('issueSize')),
                    "min_price": int(parse_number(ipo.get('priceRangeMin')) or 0),
                    "max_price": int(parse_number(ipo.get('priceRangeMax')) or 0),
                    "lot_size": int(parse_number(ipo.get('lotSize')) or 1),
                    "open_date": parse_date(ipo.get('issueStartDate')),
                    "close_date": parse_date(ipo.get('issueEndDate')),
                    "listing_date": parse_date(ipo.get('listingDate')),
                    "status": "open" if ipo.get('status') == 'Active' else "upcoming"
                })
            except Exception as e:
                print(f"  ‚ö†Ô∏è Error parsing NSE IPO: {e}")
        
        print(f"  ‚úÖ Got {len(ipos)} IPOs from NSE")
        return ipos
        
    except Exception as e:
        print(f"  ‚ùå NSE API failed: {e}")
        return []

# ==================== SOURCE 2: CHITTORGARH ====================
def scrape_chittorgarh():
    """Chittorgarh - Comprehensive IPO data"""
    print("\nüîÑ Scraping Chittorgarh...")
    
    url = "https://www.chittorgarh.com/ipo/ipo_dashboard.asp"
    resp = SafeScraper.fetch_url(url)
    
    if not resp:
        print("  ‚ùå Failed to fetch")
        return []
    
    soup = BeautifulSoup(resp.text, 'html.parser')
    table = soup.find('table', {'class': 'table'})
    
    if not table:
        print("  ‚ùå Table not found")
        return []
    
    ipos = []
    rows = table.find_all('tr')[1:]
    
    for row in rows[:15]:  # Limit to avoid scraping too much
        try:
            cols = row.find_all('td')
            if len(cols) < 6: continue
            
            ipo_name = clean_text(cols[0].text)
            category = "SME" if "SME" in ipo_name else "Mainboard"
            
            # Extract price range
            price_text = clean_text(cols[3].text)
            prices = re.findall(r'\d+', price_text)
            
            ipos.append({
                "ipo_name": ipo_name,
                "company_name": ipo_name.replace(" IPO", "").replace(" (SME)", ""),
                "slug": create_slug(ipo_name),
                "category": category,
                "min_price": int(prices[0]) if len(prices) > 0 else None,
                "max_price": int(prices[-1]) if len(prices) > 0 else None,
                "lot_size": int(parse_number(cols[4].text) or 100),
                "open_date": parse_date(cols[1].text),
                "close_date": parse_date(cols[2].text),
                "issue_size_cr": parse_number(cols[5].text) if len(cols) > 5 else None,
                "status": "upcoming"
            })
            
        except Exception as e:
            continue
    
    print(f"  ‚úÖ Got {len(ipos)} IPOs from Chittorgarh")
    SafeScraper.random_delay()
    return ipos

# ==================== SOURCE 3: GMP FROM IPOWATCH ====================
def scrape_gmp_data():
    """IPOWatch - GMP and Kostak"""
    print("\nüí∞ Scraping GMP from IPOWatch...")
    
    url = "https://ipowatch.in/ipo-grey-market-premium-latest-ipo-gmp/"
    resp = SafeScraper.fetch_url(url)
    
    if not resp:
        return {}
    
    soup = BeautifulSoup(resp.text, 'html.parser')
    table = soup.find('table')
    
    if not table:
        return {}
    
    gmp_dict = {}
    rows = table.find_all('tr')[1:]
    
    for row in rows[:20]:  # Limit rows
        try:
            cols = row.find_all('td')
            if len(cols) < 3: continue
            
            name = clean_text(cols[0].text)
            slug = create_slug(name)
            
            gmp_text = clean_text(cols[1].text)
            gmp_amount = int(parse_number(gmp_text) or 0)
            
            # Extract percentage if present
            gmp_pct = None
            if '(' in gmp_text and '%' in gmp_text:
                pct_match = re.search(r'\(([\d.]+)%\)', gmp_text)
                if pct_match:
                    gmp_pct = float(pct_match.group(1))
            
            # Try to get kostak/sauda from additional columns
            kostak = None
            sauda = None
            if len(cols) > 3:
                kostak = int(parse_number(cols[3].text) or 0)
            if len(cols) > 4:
                sauda = int(parse_number(cols[4].text) or 0)
            
            gmp_dict[slug] = {
                "gmp_amount": gmp_amount,
                "gmp_percentage": gmp_pct,
                "kostak_rate": kostak,
                "subject_to_sauda": sauda,
                "gmp_updated_at": datetime.now().isoformat()
            }
            
        except Exception as e:
            continue
    
    print(f"  ‚úÖ Got GMP for {len(gmp_dict)} IPOs")
    SafeScraper.random_delay()
    return gmp_dict

# ==================== SOURCE 4: SUBSCRIPTION DATA ====================
def scrape_subscription_data():
    """Chittorgarh - Live subscription"""
    print("\nüìä Scraping Subscription Data...")
    
    url = "https://www.chittorgarh.com/ipo/ipo_subscription_status_live.asp"
    resp = SafeScraper.fetch_url(url)
    
    if not resp:
        return {}
    
    soup = BeautifulSoup(resp.text, 'html.parser')
    table = soup.find('table', {'class': 'table'})
    
    if not table:
        return {}
    
    sub_dict = {}
    rows = table.find_all('tr')[1:]
    
    for row in rows[:10]:
        try:
            cols = row.find_all('td')
            if len(cols) < 6: continue
            
            name = clean_text(cols[0].text)
            slug = create_slug(name)
            
            sub_dict[slug] = {
                "subscription_retail": parse_number(cols[1].text) or 0,
                "subscription_nii": parse_number(cols[2].text) or 0,
                "subscription_qib": parse_number(cols[3].text) or 0,
                "subscription_total": parse_number(cols[4].text) or 0,
                "subscription_updated_at": datetime.now().isoformat()
            }
            
        except:
            continue
    
    print(f"  ‚úÖ Got subscription for {len(sub_dict)} IPOs")
    SafeScraper.random_delay()
    return sub_dict

# ==================== SOURCE 5: FINANCIAL DATA (INVESTORGAIN) ====================
def scrape_financials():
    """InvestorGain - Company financials"""
    print("\nüíº Scraping Financial Data...")
    
    url = "https://www.investorgain.com/report/live-ipo-gmp/331/"
    resp = SafeScraper.fetch_url(url)
    
    if not resp:
        return {}
    
    soup = BeautifulSoup(resp.text, 'html.parser')
    
    # InvestorGain has detailed pages per IPO
    # For now, we'll just grab basic data from listing page
    financials = {}
    
    try:
        rows = soup.find_all('tr')
        for row in rows[:15]:
            cols = row.find_all('td')
            if len(cols) < 4: continue
            
            name = clean_text(cols[0].text)
            slug = create_slug(name)
            
            # Try to extract PE ratio, issue size, etc.
            financials[slug] = {
                "issue_size_cr": parse_number(cols[2].text) if len(cols) > 2 else None,
                # More fields can be added by parsing individual IPO pages
            }
    except:
        pass
    
    print(f"  ‚úÖ Got financials for {len(financials)} IPOs")
    SafeScraper.random_delay()
    return financials

# ==================== SOURCE 6: REGISTRAR & ALLOTMENT ====================
def scrape_registrar_info():
    """Get registrar details from Chittorgarh"""
    print("\nüìã Scraping Registrar Info...")
    
    url = "https://www.chittorgarh.com/ipo/ipo_registrars_list.asp"
    resp = SafeScraper.fetch_url(url)
    
    if not resp:
        return {}
    
    soup = BeautifulSoup(resp.text, 'html.parser')
    
    registrar_map = {
        "link": "Link Intime India Pvt Ltd",
        "kfin": "KFin Technologies Ltd",
        "bigshare": "Bigshare Services Pvt Ltd"
    }
    
    # This would need to match IPO names to registrars
    # For simplicity, returning common registrars
    
    SafeScraper.random_delay()
    return {}

# ==================== MERGE & UPLOAD ====================
def merge_all_sources():
    print("\nüîÑ Using working scrapers as fallback...")
    
    # Use your existing working scraper
    gmp_data = old_scraper_gmp()
    date_data = old_scraper_dates()
    
    ipos = []
    for item in gmp_data:
        slug = create_slug(item['ipo_name'])
        
        ipos.append({
            "ipo_name": item['ipo_name'],
            "company_name": item['ipo_name'].replace(' IPO', ''),
            "slug": slug,
            "category": item['category'],
            "status": "upcoming",
            "max_price": int(parse_number(item['ipo_price']) or 0),
            "lot_size": 100,
            "gmp_amount": int(parse_number(item['ipo_gmp']) or 0),
            "open_date": date_data.get(slug, {}).get('open_date'),
            "close_date": date_data.get(slug, {}).get('close_date')
        })
    
    return ipos


def upload_to_supabase(ipos):
    """Upload with proper error handling"""
    print(f"\nüì§ Uploading {len(ipos)} IPOs to Supabase...")
    
    try:
        # Upsert (insert or update based on slug)
        result = supabase.table('ipos').upsert(
            ipos,
            on_conflict='slug'
        ).execute()
        
        print(f"‚úÖ SUCCESS! Database updated")
        print(f"\nüìä Sample Records:")
        for ipo in ipos[:3]:
            print(f"  ‚Ä¢ {ipo['ipo_name']} | {ipo['status']} | GMP: ‚Çπ{ipo.get('gmp_amount', 0)}")
        
        return True
        
    except Exception as e:
        print(f"‚ùå Upload Error: {e}")
        print(f"\nüîç First record (for debugging):")
        if ipos:
            print(json.dumps(ipos[0], indent=2, default=str))
        return False

def main():
    """Main execution"""
    ipos = merge_all_sources()
    
    if ipos:
        upload_to_supabase(ipos)

    else:
        print("\n‚ùå No data collected!")

if __name__ == "__main__":
    main()
</file>

<file path="ipo-data-pipeline/scrapers/core/base_scraper.py">
import os
import time
import random
import requests
from bs4 import BeautifulSoup
from abc import ABC, abstractmethod
from supabase import create_client, Client
from dotenv import load_dotenv
from functools import wraps

load_dotenv()

class BaseScraper(ABC):
    """Base class for all scrapers with common functionality"""
    
    def __init__(self):
        self.supabase: Client = create_client(
            os.getenv("SUPABASE_URL"), 
            os.getenv("SUPABASE_KEY")
        )
        self.session = requests.Session()
        self.user_agents = [
            "Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/120.0.0.0 Safari/537.36",
            "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) Safari/537.36",
            "Mozilla/5.0 (X11; Linux x86_64) Firefox/121.0"
        ]
        
    def get_headers(self):
        """Rotate user agents to avoid blocking"""
        return {
            "User-Agent": random.choice(self.user_agents),
            "Accept": "text/html,application/json",
            "Accept-Language": "en-US,en;q=0.9"
        }
    
    def fetch_page(self, url, method="GET", data=None, max_retries=3):
        """Fetch page with retry logic"""
        for attempt in range(max_retries):
            try:
                if method == "GET":
                    resp = self.session.get(url, headers=self.get_headers(), timeout=10)
                else:
                    resp = self.session.post(url, headers=self.get_headers(), 
                                            data=data, timeout=10)
                
                if resp.status_code == 200:
                    return resp
                elif resp.status_code == 403:
                    print(f"‚ö†Ô∏è  Blocked! Waiting {2 ** attempt}s...")
                    time.sleep(2 ** attempt)
                else:
                    print(f"‚ùå Status {resp.status_code}")
                    return None
                    
            except Exception as e:
                print(f"‚ö†Ô∏è  Attempt {attempt + 1} failed: {e}")
                time.sleep(2 ** attempt)
        
        return None
    
    @staticmethod
    def clean_text(text):
        """Clean scraped text"""
        if not text:
            return ""
        return text.replace('\n', '').replace('\t', '').strip()
    
    @staticmethod
    def normalize_name(name):
        """Normalize IPO names for matching"""
        import re
        name = name.lower()
        name = re.sub(r'\(sme\)|\(mainboard\)|ipo|limited|ltd\.?|pvt\.?', '', name)
        name = re.sub(r'\s+', ' ', name)
        return name.strip()
    
    @staticmethod
    def parse_number(text):
        """Extract number from text like '5.2x', '‚Çπ150', '50%'"""
        import re
        if not text or text == "-":
            return None
        match = re.search(r'[\d,]+\.?\d*', text.replace(',', ''))
        return float(match.group()) if match else None
    
    def upsert_data(self, table, data, conflict_column='slug'):
        """Insert or update data in Supabase"""
        try:
            result = self.supabase.table(table).upsert(
                data, 
                on_conflict=conflict_column
            ).execute()
            print(f"‚úÖ Upserted {len(data)} rows to {table}")
            return result
        except Exception as e:
            print(f"‚ùå DB Error: {e}")
            return None
    
    @abstractmethod
    def scrape(self):
        """Main scraping logic - must be implemented by child classes"""
        pass
</file>

<file path="ipo-data-pipeline/scrapers/free_api_scraper.py">
import os
import requests
import re
from datetime import datetime
from supabase import create_client
from dotenv import load_dotenv

load_dotenv()

# Initialize Supabase
supabase = create_client(os.getenv("SUPABASE_URL"), os.getenv("SUPABASE_KEY"))

# ==================== DATE PARSING LOGIC ====================

def clean_ordinal_date_string(date_str):
    """
    Parses complex strings like: "2026-01-13 06th ‚Äì 08th Jan 2026"
    Returns standard YYYY-MM-DD strings for start and end dates.
    """
    if not date_str or date_str == '-': return None, None
    try:
        # 1. Clean the string (remove the leading ISO date if present)
        parts = date_str.split(' ', 1)
        text_range = parts[1] if len(parts) > 1 and re.match(r'\d{4}-\d{2}-\d{2}', parts[0]) else date_str

        # 2. Remove ordinals (st, nd, rd, th)
        clean_text = re.sub(r'(?<=\d)(st|nd|rd|th)', '', text_range)
        
        # 3. Split start/end
        if '‚Äì' in clean_text: sep = '‚Äì'
        elif '-' in clean_text: sep = '-'
        else: return None, None

        raw_start, raw_end = clean_text.split(sep, 1)
        raw_start, raw_end = raw_start.strip(), raw_end.strip()

        # 4. Parse End Date
        end_dt = datetime.strptime(raw_end, "%d %b %Y")
        
        # 5. Parse Start Date
        try:
            start_dt = datetime.strptime(raw_start, "%d %b %Y")
        except ValueError:
            # Handle short formats like "06" -> use month/year from end_dt
            day_part = int(re.search(r'\d+', raw_start).group())
            start_dt = end_dt.replace(day=day_part)

        return start_dt.strftime('%Y-%m-%d'), end_dt.strftime('%Y-%m-%d')

    except Exception as e:
        # Silently fail for bad dates so we don't crash
        return None, None

def clean_price(price_str):
    """Parses '‚Çπ76 ‚Äì ‚Çπ81' -> (76, 81)"""
    if not price_str: return None, None
    nums = [int(p) for p in re.findall(r'\d+', str(price_str).replace(',', ''))]
    if not nums: return None, None
    if len(nums) == 1: return nums[0], nums[0]
    return nums[0], nums[-1]

def create_slug(name):
    if not name: return ""
    slug = name.lower()
    slug = re.sub(r'\(sme\)|\(mainboard\)|ipo|limited|ltd\.?|pvt\.?', '', slug)
    slug = re.sub(r'[^a-z0-9]+', '-', slug)
    return slug.strip('-')

# ==================== MAIN SCRAPER ====================

def fetch_rapidapi_ipos():
    print("\nüáÆüá≥ Fetching from RapidAPI (Indian IPOs)...")
    
    api_key = os.getenv("RAPIDAPI_KEY")
    if not api_key: 
        print("‚ùå RAPIDAPI_KEY is missing.")
        return

    host = "indian-ipos1.p.rapidapi.com"
    headers = {
        "x-rapidapi-key": api_key,
        "x-rapidapi-host": host
    }

    # We will fetch both endpoints to populate the DB
    endpoints = [
        {"url": f"https://{host}/upcoming-ipos", "status_tag": "upcoming"},
        {"url": f"https://{host}/closed-ipos", "status_tag": "closed"}
    ]
    
    all_valid_rows = []

    for ep in endpoints:
        try:
            print(f"  üëâ Requesting {ep['status_tag']} IPOs...")
            resp = requests.get(ep['url'], headers=headers, timeout=15)
            
            # API returns a list directly or a dict with data?
            # Based on your logs, likely a list directly.
            raw_data = resp.json()
            
            # Normalize to list
            if isinstance(raw_data, dict) and 'data' in raw_data:
                items = raw_data['data']
            elif isinstance(raw_data, list):
                items = raw_data
            else:
                items = []

            print(f"     Found {len(items)} raw items.")

            for item in items:
                name = item.get('name')
                if not name: continue

                # 1. Strict Date Parsing
                open_date, close_date = clean_ordinal_date_string(item.get('ipoDate'))
                
                # SKIP if dates are missing (Supabase constraint violation)
                if not open_date or not close_date:
                    continue

                # 2. Parse Prices
                min_p, max_p = clean_price(item.get('priceRange'))
                
                # 3. Category & Listing Date
                category = "SME" if "SME" in name or "sme" in item.get('symbol', '').lower() else "Mainboard"
                
                listing_date = None
                if item.get('listingDate'):
                    try:
                        # Clean raw listing date "13 Jan 2026"
                        clean_l_date = re.sub(r'(st|nd|rd|th)', '', item.get('listingDate'))
                        listing_date = datetime.strptime(clean_l_date.strip(), "%d %b %Y").strftime("%Y-%m-%d")
                    except: pass

                # 4. Build Schema-Compliant Row
                row = {
                    "ipo_name": name,
                    "company_name": name,
                    "slug": create_slug(name),
                    "category": category,
                    "status": ep['status_tag'], # 'upcoming' or 'closed'
                    
                    # Financials
                    "min_price": min_p,
                    "max_price": max_p,
                    "lot_size": 1, # Defaulting to 1 as API doesn't provide it
                    
                    # Dates
                    "open_date": open_date,
                    "close_date": close_date,
                    "listing_date": listing_date,
                    
                    # Meta
                    "source": "rapidapi_indian_ipos",
                    "updated_at": datetime.now().isoformat()
                }
                all_valid_rows.append(row)

        except Exception as e:
            print(f"  ‚ùå Error fetching {ep['status_tag']}: {e}")

    # ================= SAVE TO DB =================
    
    if all_valid_rows:
        print(f"\nüíæ Saving {len(all_valid_rows)} IPOs to Supabase...")
        try:
            # Deduplicate by slug before inserting (use the latest one)
            unique_map = {row['slug']: row for row in all_valid_rows}
            unique_rows = list(unique_map.values())
            
            result = supabase.table('ipos').upsert(
                unique_rows, 
                on_conflict='slug'
            ).execute()
            
            print(f"‚úÖ Success! {len(unique_rows)} IPOs synced to database.")
        except Exception as e:
            print(f"‚ùå Database Error: {e}")
            if 'source' in str(e):
                print("üí° Remember to add the 'source' column to your table!")
    else:
        print("\n‚ö†Ô∏è No valid data found to save (check date parsing if items were found).")

if __name__ == "__main__":
    fetch_rapidapi_ipos()
</file>

<file path="ipo-data-pipeline/scrapers/ipo_scrapers/enhanced_gmp_scraper.py">
from core.base_scraper import BaseScraper 
from datetime import datetime
from bs4 import BeautifulSoup

class GMPScraper(BaseScraper):
    """Multi-source GMP scraper with history tracking"""
    
    SOURCES = [
        {
            "name": "IPOWatch",
            "url": "https://ipowatch.in/ipo-grey-market-premium-latest-ipo-gmp/",
            "parser": "parse_ipowatch"
        },
        {
            "name": "InvestorGain",
            "url": "https://www.investorgain.com/report/live-ipo-gmp/331/",
            "parser": "parse_investorgain"
        }
    ]
    
    def scrape(self):
        print("\nüí∞ Starting Multi-Source GMP Scrape...")
        
        all_gmp_data = {}
        
        for source in self.SOURCES:
            print(f"\nüì° Fetching from {source['name']}...")
            data = getattr(self, source['parser'])(source['url'])
            
            # Merge with existing data (average if conflict)
            for slug, gmp_info in data.items():
                if slug in all_gmp_data:
                    # Average the GMP values
                    existing = all_gmp_data[slug]['gmp_amount']
                    new = gmp_info['gmp_amount']
                    all_gmp_data[slug]['gmp_amount'] = int((existing + new) / 2)
                else:
                    all_gmp_data[slug] = gmp_info
        
        # Convert to list and upload
        updates = []
        history_records = []
        
        for slug, data in all_gmp_data.items():
            updates.append({
                "slug": slug,
                "gmp_amount": data['gmp_amount'],
                "gmp_percentage": data['gmp_percentage'],
                "gmp_updated_at": datetime.now().isoformat(),
                "expected_listing_price": data['expected_listing_price'],
                "kostak_rate": data.get('kostak_rate'),
                "subject_to_sauda": data.get('subject_to_sauda')
            })
            
            # Store in history table
            history_records.append({
                "ipo_name": data['ipo_name'],
                "gmp_amount": data['gmp_amount'],
                "gmp_percentage": data['gmp_percentage'],
                "issue_price": data.get('issue_price', 0),
                "expected_listing_price": data['expected_listing_price']
            })
        
        if updates:
            self.upsert_data('ipos', updates)
            # Also insert into history for tracking
            self.supabase.table('gmp_history').insert(history_records).execute()
            print(f"‚úÖ Updated {len(updates)} GMP records\n")
    
    def parse_ipowatch(self, url):
        """Parse IPOWatch format"""
        resp = self.fetch_page(url)
        if not resp:
            return {}
        
        soup = BeautifulSoup(resp.text, 'html.parser')
        table = soup.find('table')
        if not table:
            return {}
        
        result = {}
        rows = table.find_all('tr')[1:]
        
        for row in rows:
            cols = row.find_all('td')
            if len(cols) < 3:
                continue
            
            name = self.clean_text(cols[0].text)
            slug = self.normalize_name(name).replace(' ', '-')
            
            gmp_text = self.clean_text(cols[1].text)
            gmp_amount = self.parse_number(gmp_text) or 0
            
            price_text = self.clean_text(cols[2].text)
            issue_price = self.parse_number(price_text) or 0
            
            expected_price = issue_price + gmp_amount
            gmp_pct = (gmp_amount / issue_price * 100) if issue_price > 0 else 0
            
            result[slug] = {
                "ipo_name": name,
                "gmp_amount": int(gmp_amount),
                "gmp_percentage": round(gmp_pct, 2),
                "issue_price": int(issue_price),
                "expected_listing_price": int(expected_price)
            }
        
        return result
    
    def parse_investorgain(self, url):
        """Parse InvestorGain format (similar logic)"""
        # Implementation similar to above
        return {}
</file>

<file path="ipo-data-pipeline/scrapers/ipo_scrapers/subscription_scraper.py">
from ..core.base_scraper import BaseScraper
from datetime import datetime
import json

class SubscriptionScraper(BaseScraper):
    """Scrape live subscription data from Chittorgarh"""
    
    def scrape(self):
        print("\nüîÑ Starting Subscription Scrape...")
        url = "https://www.chittorgarh.com/ipo/ipo_subscription_status_live.asp"
        
        resp = self.fetch_page(url)
        if not resp:
            print("‚ùå Failed to fetch subscription data")
            return
        
        soup = BeautifulSoup(resp.text, 'html.parser')
        
        # Find the subscription table
        table = soup.find('table', {'class': 'table'})
        if not table:
            print("‚ùå Subscription table not found")
            return
        
        rows = table.find_all('tr')[1:]  # Skip header
        updates = []
        
        for row in rows:
            cols = row.find_all('td')
            if len(cols) < 7:
                continue
            
            try:
                ipo_name = self.clean_text(cols[0].text)
                
                # Parse subscription data
                retail = self.parse_number(cols[1].text) or 0
                nii = self.parse_number(cols[2].text) or 0
                bnii = self.parse_number(cols[3].text) or 0
                qib = self.parse_number(cols[4].text) or 0
                total = self.parse_number(cols[5].text) or 0
                
                # Create day-wise record
                day_record = {
                    "date": datetime.now().strftime("%Y-%m-%d"),
                    "time": datetime.now().strftime("%H:%M"),
                    "retail": retail,
                    "nii": nii,
                    "qib": qib,
                    "total": total
                }
                
                # Create slug
                slug = self.normalize_name(ipo_name).replace(' ', '-')
                
                update = {
                    "slug": slug,
                    "ipo_name": ipo_name,
                    "subscription_retail": retail,
                    "subscription_nii": nii,
                    "subscription_bnii": bnii,
                    "subscription_qib": qib,
                    "subscription_total": total,
                    "subscription_updated_at": datetime.now().isoformat(),
                    "day_wise_subscription": json.dumps([day_record])  # We'll append in next iteration
                }
                
                updates.append(update)
                print(f"üìä {ipo_name}: Total {total}x")
                
            except Exception as e:
                print(f"‚ö†Ô∏è  Error parsing row: {e}")
                continue
        
        # Upload to database
        if updates:
            self.upsert_data('ipos', updates)
        
        print(f"‚úÖ Updated {len(updates)} IPOs\n")
</file>

<file path="ipo-data-pipeline/scrapers/orchestrator.py">
from apscheduler.schedulers.blocking import BlockingScheduler
from ipo_scrapers.subscription_scraper import SubscriptionScraper
from ipo_scrapers.enhanced_gmp_scraper import GMPScraper

def run_subscription_scraper():
    scraper = SubscriptionScraper()
    scraper.scrape()

def run_gmp_scraper():
    scraper = GMPScraper()
    scraper.scrape()

if __name__ == "__main__":
    scheduler = BlockingScheduler()
    
    # Run subscription scraper every 2 hours during market hours
    scheduler.add_job(run_subscription_scraper, 'cron', 
                      hour='9-17/2', day_of_week='mon-fri')
    
    # Run GMP scraper every 6 hours
    scheduler.add_job(run_gmp_scraper, 'interval', hours=6)
    
    print("üöÄ Scheduler started. Press Ctrl+C to exit.")
    scheduler.start()
</file>

<file path="ipo-data-pipeline/scrapers/web_scraper.py">

</file>

<file path="requirements.txt">
flask
requests
beautifulsoup4
supabase
python-dotenv
anthropic
PyPDF2
apscheduler
</file>

<file path="scheduler.py">
from apscheduler.schedulers.blocking import BlockingScheduler
import subprocess
import sys

def run_script(script_name):
    """Run scraper as subprocess"""
    print(f"\n{'='*60}")
    print(f"ü§ñ Running: {script_name}")
    print(f"{'='*60}")
    
    try:
        result = subprocess.run(
            [sys.executable, f"scrapers/{script_name}"],
            capture_output=True,
            text=True,
            timeout=300
        )
        print(result.stdout)
        if result.stderr:
            print(f"‚ö†Ô∏è Errors: {result.stderr}")
    except Exception as e:
        print(f"‚ùå Error: {e}")

def run_api_fetcher():
    run_script("free_api_scraper.py")

def run_web_scraper():
    run_script("comprehensive_ipo_scraper.py")

if __name__ == "__main__":
    scheduler = BlockingScheduler()
    
    # API calls - Every 6 hours (rate limited)
    scheduler.add_job(
        run_api_fetcher,
        'interval',
        hours=6,
        id='api_fetch'
    )
    
    # Web scraping - Every 3 hours (unlimited)
    scheduler.add_job(
        run_web_scraper,
        'interval',
        hours=3,
        id='web_scrape'
    )
    
    print("üöÄ Scheduler Started")
    print("  ‚Ä¢ API Fetch: Every 6 hours")
    print("  ‚Ä¢ Web Scrape: Every 3 hours")
    print("  Press Ctrl+C to stop\n")
    
    try:
        scheduler.start()
    except (KeyboardInterrupt, SystemExit):
        print("\nüëã Stopped")
</file>

<file path="scrape_shareholder.py">
import os
import requests
from bs4 import BeautifulSoup
from supabase import create_client, Client
from dotenv import load_dotenv

# 1. Setup Supabase
load_dotenv()
URL = os.getenv("SUPABASE_URL")
KEY = os.getenv("SUPABASE_KEY")

if not URL or not KEY:
    print("‚ùå Error: Missing Supabase credentials")
    exit()

supabase: Client = create_client(URL, KEY)

def clean_text(text):
    if not text: return ""
    return text.replace('\n', '').strip()

def scrape_shareholder_quota():
    print("--- Starting Shareholder Intel Scrape ---")
    url = "https://ipocentral.in/upcoming-ipos-with-shareholders-quota/"
    
    headers = {
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/120.0.0.0 Safari/537.36"
    }

    try:
        resp = requests.get(url, headers=headers)
        if resp.status_code != 200:
            print(f"‚ùå Error: Website blocked us (Status {resp.status_code})")
            return

        soup = BeautifulSoup(resp.text, 'html.parser')
        
        # Locate the table with "Parent Company" in headers
        tables = soup.find_all('table')
        target_table = None
        
        for table in tables:
            headers_text = [th.get_text(strip=True).lower() for th in table.find_all('tr')[0].find_all(['th', 'td'])]
            if "parent company" in headers_text:
                target_table = table
                break
        
        if not target_table:
            print("‚ùå Error: Could not find the 'Shareholder Quota' table.")
            return

        print("‚úÖ Found Shareholder Table. Parsing...")
        rows = target_table.find_all('tr')[1:] # Skip header
        
        data_to_insert = []
        
        for row in rows:
            cols = row.find_all('td')
            if len(cols) < 3: continue
            
            # Extract Columns based on the website structure:
            # Col 0: Subsidiary IPO Name
            # Col 1: Parent Company
            # Col 2: SEBI IPO Status
            
            ipo_name = clean_text(cols[0].text)
            parent = clean_text(cols[1].text)
            status = clean_text(cols[2].text)
            
            # Logic: Determine "Action Text" based on Status
            action = "Watchlist"
            is_active = True
            
            if "Approved" in status or "Filed" in status:
                action = f"Buy 1 share of {parent} ASAP (RHP likely soon)"
            elif "Awaited" in status:
                action = f"Track {parent} (Early Stage)"
            elif "Returned" in status or "Rejected" in status:
                is_active = False # Don't show these
                
            if is_active:
                data_to_insert.append({
                    "ipo_name": ipo_name,
                    "parent_company": parent,
                    "action_text": action,
                    "is_active": True,
                    # We leave rhp_date null as this site doesn't provide exact dates
                })

        # UPLOAD
        if data_to_insert:
            print(f"üöÄ Inserting {len(data_to_insert)} Opportunities...")
            # Clear old data to prevent duplicates
            supabase.table('shareholder_intel').delete().neq("id", 0).execute()
            # Insert new
            supabase.table('shareholder_intel').insert(data_to_insert).execute()
            print("--- Success! Table Populated ---")
        else:
            print("‚ö†Ô∏è No valid rows found.")

    except Exception as e:
        print(f"‚ùå Critical Error: {e}")

if __name__ == "__main__":
    scrape_shareholder_quota()
</file>

<file path="scraper.py">
import os
import requests
import difflib
from bs4 import BeautifulSoup
from supabase import create_client, Client
from dotenv import load_dotenv

# 1. Setup
load_dotenv()
supabase: Client = create_client(os.getenv("SUPABASE_URL"), os.getenv("SUPABASE_KEY"))

def clean_text(text):
    if not text: return "-"
    return text.replace('\n', '').strip()

# --- SCRAPER A: IPOWatch (For GMP & Price) ---
def fetch_gmp_data():
    print("Step 1: Fetching GMP from IPOWatch...")
    url = "https://ipowatch.in/ipo-grey-market-premium-latest-ipo-gmp/"
    headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/120.0.0.0 Safari/537.36"}
    
    gmp_list = []
    try:
        resp = requests.get(url, headers=headers)
        soup = BeautifulSoup(resp.text, 'html.parser')
        
        # They often change table IDs, so we grab the first table
        tables = soup.find_all('table')
        if not tables: return []

        rows = tables[0].find_all('tr')[1:] # Skip header
        
        for row in rows:
            cols = row.find_all('td')
            if len(cols) < 2: continue
            
            # Extract
            raw_name = clean_text(cols[0].text)
            gmp = clean_text(cols[1].text)
            price = "Check RHP"
            if len(cols) > 2: price = clean_text(cols[2].text) # Try grab price if exists
            
            # --- FIX FOR SME DETECTION ---
            # We look for "SME" in the name OR the category column if it exists
            category = "Mainboard"
            if "SME" in raw_name or "SME" in clean_text(row.text):
                category = "SME"
                
            # Listing Gain Calculation (approximate from text)
            # We extract just the text for now as you requested
            listing_gain = "-"
            if "(" in gmp:
                listing_gain = gmp.split("(")[-1].replace(")", "") # Extracts "50%" from "150 (50%)"
                gmp = gmp.split("(")[0].strip() # Keeps just "150"

            gmp_list.append({
                "match_name": raw_name.lower(), # For matching later
                "ipo_name": raw_name,
                "ipo_price": price,
                "ipo_gmp": gmp,
                "listing_gain": listing_gain,
                "category": category
            })
            
    except Exception as e:
        print(f"Error fetching GMP: {e}")
        
    return gmp_list

# --- SCRAPER B: Chittorgarh (For Dates) ---
def fetch_dates_data():
    print("Step 2: Fetching Dates from Chittorgarh...")
    url = "https://www.chittorgarh.com/ipo/ipo_dashboard.asp"
    headers = {"User-Agent": "Mozilla/5.0"}
    
    date_map = {} # We will store data as { "name": {open, close} }
    try:
        resp = requests.get(url, headers=headers)
        soup = BeautifulSoup(resp.text, 'html.parser')
        
        # Chittorgarh usually has a table with class 'table'
        tables = soup.find_all('table')
        if not tables: return {}
        
        rows = tables[0].find_all('tr')[1:]
        
        for row in rows:
            cols = row.find_all('td')
            if len(cols) < 3: continue
            
            name = clean_text(cols[0].text)
            # Columns: 0=Name, 1=Date, etc. (Structure varies, usually Col 1 is Open Date)
            # Let's assume standard layout. You might need to adjust indices if they change.
            open_date = clean_text(cols[1].text) if len(cols) > 1 else "-"
            close_date = clean_text(cols[2].text) if len(cols) > 2 else "-"
            
            date_map[name.lower()] = {
                "open_date": open_date,
                "close_date": close_date
            }
            
    except Exception as e:
        print(f"Error fetching Dates: {e}")
        
    return date_map

# --- MAIN: COMBINE & UPLOAD ---
def run():
    # 1. Get Data
    gmp_data = fetch_gmp_data()
    date_data = fetch_dates_data()
    
    print(f"Got {len(gmp_data)} GMP records and {len(date_data)} Date records.")
    
    final_list = []
    
    # 2. Merge Loop
    for item in gmp_data:
        # Fuzzy Match: Try to find "Zepto IPO" inside "Zepto Limited"
        # We look for the closest match in the date_data keys
        
        best_match = difflib.get_close_matches(item['match_name'], date_data.keys(), n=1, cutoff=0.4)
        
        open_d = "-"
        close_d = "-"
        
        if best_match:
            matched_key = best_match[0]
            print(f"Matched: '{item['ipo_name']}' <--> '{matched_key}'")
            open_d = date_data[matched_key]['open_date']
            close_d = date_data[matched_key]['close_date']
        
        final_list.append({
            "ipo_name": item['ipo_name'],
            "category": item['category'],
            "ipo_price": item['ipo_price'],
            "ipo_gmp": item['ipo_gmp'],
            "listing_gain": item['listing_gain'],
            "open_date": open_d,
            "close_date": close_d
        })
        
    # 3. Upload
    if final_list:
        print(f"üöÄ Uploading {len(final_list)} combined records...")
        supabase.table('ipo_gmp').delete().neq("id", 0).execute()
        supabase.table('ipo_gmp').insert(final_list).execute()
        print("Done!")

if __name__ == "__main__":
    run()
</file>

</files>
</file>

<file path="backend/requirements.txt">
flask
requests
beautifulsoup4
supabase
python-dotenv
anthropic
PyPDF2
apscheduler
</file>

<file path="frontend/app/gmp/page.module.css">
/* ============================================
   GMP Page - Modern Dark Theme
   Glassmorphism cards with gradient accents
   ============================================ */

@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=IBM+Plex+Sans:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap');

/* GMP Page Container - Override global background */
.pageContainer {
  background: linear-gradient(135deg, #0a0e27 0%, #1e293b 100%);
  min-height: 100vh;
  padding: 3rem 2rem;
  margin-left: -1.5rem;
  margin-right: -1.5rem;
  margin-bottom: -1.5rem;
  font-family: 'IBM Plex Sans', sans-serif;
  color: #f8fafc;
  line-height: 1.6;
}

.container {
  max-width: 1400px;
  margin: 0 auto;
}

.sectionHeader {
  max-width: 1400px;
  margin: 0 auto 3rem auto;
  animation: slideUp 0.6s ease-out;
}

.sectionTitle {
  font-family: 'Playfair Display', serif;
  font-size: 3rem;
  font-weight: 900;
  margin-bottom: 0.8rem;
  background: linear-gradient(135deg, #ffffff 0%, #06b6d4 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  letter-spacing: -0.02em;
  text-transform: none;
}

.sectionSubtitle {
  font-size: 1.1rem;
  color: #e2e8f0;
  font-weight: 300;
  font-family: 'IBM Plex Sans', sans-serif;
}

.categorySection {
  max-width: 1400px;
  margin: 0 auto 4rem auto;
}

.categoryTitle {
  font-size: 1.8rem;
  font-family: 'IBM Plex Sans', sans-serif;
  font-weight: 700;
  color: #f8fafc;
  margin-bottom: 1.5rem;
  display: flex;
  align-items: center;
  gap: 0.8rem;
  text-transform: none;
}

.categoryIcon {
  font-size: 2rem;
}

.categoryCount {
  font-size: 1.2rem;
  color: #e2e8f0;
  font-weight: 400;
}

.gmpGrid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 1.5rem;
  animation: fadeIn 0.8s ease-out 0.3s both;
}

.gmpCard {
  background: rgba(255, 255, 255, 0.03);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 1.8rem;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.gmpCard::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, #10b981, #06b6d4);
  transform: scaleX(0);
  transition: transform 0.3s ease;
}

.gmpCard:hover {
  transform: translateY(-5px);
  border-color: rgba(6, 182, 212, 0.4);
  background: rgba(255, 255, 255, 0.05);
}

.gmpCard:hover::before {
  transform: scaleX(1);
}

.gmpHeader {
  margin-bottom: 1.5rem;
  cursor: pointer;
}

.headerTop {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 1rem;
  gap: 0.8rem;
}

.badgeStack {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  align-items: flex-end;
}

.gmpCompany {
  font-size: 1.3rem;
  font-family: 'IBM Plex Sans', sans-serif;
  font-weight: 600;
  color: #f8fafc;
  flex: 1;
  text-transform: none;
  line-height: 1.3;
}

.categoryBadge {
  padding: 0.4rem 0.9rem;
  border-radius: 20px;
  font-size: 0.75rem;
  font-family: 'IBM Plex Sans', sans-serif;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  white-space: nowrap;
}

.smeBadge {
  background: rgba(59, 130, 246, 0.15);
  color: #60a5fa;
  border: 1px solid rgba(59, 130, 246, 0.3);
}

.mainboardBadge {
  background: rgba(168, 85, 247, 0.15);
  color: #c084fc;
  border: 1px solid rgba(168, 85, 247, 0.3);
}

.statusBadge {
  padding: 0.4rem 0.9rem;
  border-radius: 20px;
  font-size: 0.75rem;
  font-family: 'IBM Plex Sans', sans-serif;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  white-space: nowrap;
}

.statusOpen {
  background: rgba(34, 197, 94, 0.15);
  color: #4ade80;
  border: 1px solid rgba(34, 197, 94, 0.3);
}

.statusOpeningSoon {
  background: rgba(249, 115, 22, 0.15);
  color: #fb923c;
  border: 1px solid rgba(249, 115, 22, 0.3);
}

.statusClosed {
  background: rgba(239, 68, 68, 0.15);
  color: #f87171;
  border: 1px solid rgba(239, 68, 68, 0.3);
}

.gmpValue {
  font-size: 2.5rem;
  font-family: 'JetBrains Mono', monospace;
  font-weight: 700;
  color: #10b981;
  margin-bottom: 0.5rem;
  line-height: 1;
}

.gmpValue.negative {
  color: #ef4444;
}

.gmpPercentage {
  font-size: 1.3rem;
  font-family: 'IBM Plex Sans', sans-serif;
  font-weight: 600;
  margin-bottom: 0.3rem;
}

.profitText {
  color: #10b981;
}

.lossText {
  color: #ef4444;
}

.gmpInfo {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1rem;
  padding-top: 1.5rem;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.infoItem {
  display: flex;
  flex-direction: column;
}

.infoLabel {
  font-size: 0.8rem;
  font-family: 'IBM Plex Sans', sans-serif;
  color: #e2e8f0;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  margin-bottom: 0.3rem;
  font-weight: 500;
}

.infoValue {
  font-size: 1rem;
  font-family: 'JetBrains Mono', monospace;
  font-weight: 600;
  color: #06b6d4;
}

.emptyState {
  max-width: 1400px;
  margin: 0 auto;
  text-align: center;
  padding: 4rem 2rem;
  background: rgba(255, 255, 255, 0.03);
  border: 1px dashed rgba(255, 255, 255, 0.2);
  border-radius: 16px;
}

.emptyState p {
  color: #e2e8f0;
  font-size: 1.1rem;
  font-family: 'IBM Plex Sans', sans-serif;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@media (max-width: 768px) {
  .pageContainer {
    padding: 2rem 1rem;
  }

  .sectionTitle {
    font-size: 2.2rem;
  }

  .categoryTitle {
    font-size: 1.5rem;
  }

  .gmpGrid {
    grid-template-columns: 1fr;
  }

  .gmpCard {
    padding: 1.5rem;
  }

  .gmpValue {
    font-size: 2rem;
  }

  .gmpPercentage {
    font-size: 1.1rem;
  }
}
</file>

<file path="frontend/app/ipo/[slug]/page.module.css">
/* IPO Detail Page Styles - Premium Light Theme */

/* ===== LAYOUT ===== */
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 1rem;
}

.pageWrapper {
  padding-bottom: 100px;
}

/* ===== HERO SECTION ===== */
.hero {
  background: linear-gradient(135deg, rgba(79, 70, 229, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%);
  border-radius: var(--radius-xl);
  padding: 2.5rem;
  margin-bottom: 2rem;
  border: 1px solid var(--color-border);
  box-shadow: var(--shadow-card);
}

.heroHeader {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.heroLeft {
  display: flex;
  align-items: center;
  gap: 1.5rem;
}

.companyLogo {
  width: 80px;
  height: 80px;
  border-radius: var(--radius-lg);
  background: var(--gradient-primary);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  font-weight: 700;
  color: white;
  box-shadow: 0 4px 12px rgba(79, 70, 229, 0.25);
}

.heroTitle {
  font-size: 2rem;
  font-weight: 700;
  color: var(--color-text-primary);
  margin-bottom: 0.5rem;
}

.statusBadge {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  border-radius: 9999px;
  font-size: 0.875rem;
  font-weight: 600;
}

.statusOpen {
  background: var(--color-success-light);
  color: #047857;
}

.statusClosed {
  background: var(--color-bg-tertiary);
  color: var(--color-text-secondary);
}

.statusAllotment {
  background: var(--color-info-light);
  color: #1d4ed8;
}

.statusListed {
  background: #f3e8ff;
  color: #7c3aed;
}

.alertButton {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem 1.5rem;
  background: var(--gradient-primary);
  border: none;
  border-radius: var(--radius-md);
  color: white;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition-base);
  box-shadow: 0 4px 12px rgba(79, 70, 229, 0.25);
}

.alertButton:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(79, 70, 229, 0.35);
}

.lastUpdated {
  font-size: 0.75rem;
  color: var(--color-text-muted);
  margin-top: 0.5rem;
}

/* Metric Cards */
.metricsGrid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 1rem;
}

.metricCard {
  background: var(--color-bg-card);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  padding: 1.25rem;
  text-align: center;
  transition: var(--transition-base);
  box-shadow: var(--shadow-xs);
}

.metricCard:hover {
  transform: translateY(-4px);
  box-shadow: var(--shadow-md);
  border-color: rgba(79, 70, 229, 0.2);
}

.metricLabel {
  font-size: 0.75rem;
  color: var(--color-text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 0.5rem;
  font-weight: 600;
}

.metricValue {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--color-text-primary);
}

.metricChange {
  font-size: 0.875rem;
  margin-top: 0.25rem;
  font-weight: 600;
}

.positive {
  color: var(--color-success);
}

.negative {
  color: var(--color-error);
}

/* ===== SECTION STYLES ===== */
.section {
  background: var(--color-bg-card);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-xl);
  padding: 2rem;
  margin-bottom: 2rem;
  box-shadow: var(--shadow-card);
}

.sectionTitle {
  font-size: 1.375rem;
  font-weight: 700;
  color: var(--color-text-primary);
  margin-bottom: 1.5rem;
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.sectionIcon {
  font-size: 1.25rem;
}

/* ===== QUICK FACTS TABLE ===== */
.factsGrid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 0;
}

.factItem {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 1.25rem;
  border-bottom: 1px solid var(--color-border-light);
}

.factItem:nth-child(odd) {
  background: var(--color-bg-secondary);
}

.factLabel {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 0.875rem;
  color: var(--color-text-secondary);
}

.factValue {
  font-weight: 600;
  color: var(--color-text-primary);
  text-align: right;
}

/* ===== SUBSCRIPTION STATUS ===== */
.subscriptionOverall {
  text-align: center;
  padding: 2rem;
  background: linear-gradient(135deg, rgba(79, 70, 229, 0.05) 0%, rgba(139, 92, 246, 0.03) 100%);
  border-radius: var(--radius-lg);
  margin-bottom: 1.5rem;
}

.overallLabel {
  font-size: 0.875rem;
  color: var(--color-text-secondary);
  margin-bottom: 0.5rem;
}

.overallValue {
  font-size: 3rem;
  font-weight: 700;
  color: var(--color-primary);
}

.overallTrend {
  font-size: 1rem;
  margin-top: 0.25rem;
}

.categoryCards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
}

.categoryCard {
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border-light);
  border-radius: var(--radius-md);
  padding: 1.25rem;
}

.categoryName {
  font-size: 0.75rem;
  color: var(--color-text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 0.75rem;
  font-weight: 600;
}

.categoryValue {
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--color-text-primary);
  margin-bottom: 0.75rem;
}

.progressBar {
  height: 8px;
  background: var(--color-bg-tertiary);
  border-radius: 4px;
  overflow: hidden;
}

.progressFill {
  height: 100%;
  border-radius: 4px;
  transition: width 0.5s ease;
}

.progressRed {
  background: linear-gradient(90deg, #ef4444, #f87171);
}

.progressOrange {
  background: linear-gradient(90deg, #f59e0b, #fbbf24);
}

.progressYellow {
  background: linear-gradient(90deg, #eab308, #facc15);
}

.progressGreen {
  background: linear-gradient(90deg, #10b981, #34d399);
}

.refreshRow {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 1.5rem;
  padding-top: 1rem;
  border-top: 1px solid var(--color-border-light);
}

.timestamp {
  font-size: 0.75rem;
  color: var(--color-text-muted);
}

.refreshButton {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  background: rgba(79, 70, 229, 0.1);
  border: 1px solid rgba(79, 70, 229, 0.2);
  border-radius: var(--radius-sm);
  color: var(--color-primary);
  font-size: 0.875rem;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition-base);
}

.refreshButton:hover {
  background: rgba(79, 70, 229, 0.15);
}

/* ===== GMP TRACKER ===== */
.gmpGrid {
  display: grid;
  grid-template-columns: 1fr 2fr;
  gap: 1.5rem;
}

.gmpMainCard {
  background: linear-gradient(135deg, rgba(16, 185, 129, 0.08) 0%, rgba(16, 185, 129, 0.03) 100%);
  border: 1px solid rgba(16, 185, 129, 0.2);
  border-radius: var(--radius-lg);
  padding: 1.5rem;
}

.gmpAmount {
  font-size: 2.5rem;
  font-weight: 700;
  color: var(--color-success);
  margin-bottom: 0.5rem;
}

.gmpRow {
  display: flex;
  justify-content: space-between;
  padding: 0.5rem 0;
  border-bottom: 1px solid var(--color-border-light);
}

.gmpRow:last-child {
  border-bottom: none;
}

.gmpLabel {
  font-size: 0.875rem;
  color: var(--color-text-secondary);
}

.gmpValue {
  font-weight: 600;
  color: var(--color-text-primary);
}

.gmpChart {
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border-light);
  border-radius: var(--radius-lg);
  padding: 1.5rem;
  min-height: 200px;
  display: flex;
  flex-direction: column;
}

.chartTitle {
  font-size: 0.875rem;
  color: var(--color-text-secondary);
  margin-bottom: 1rem;
  font-weight: 600;
}

.chartArea {
  flex: 1;
  display: flex;
  align-items: flex-end;
  gap: 4px;
  padding: 1rem 0;
}

.chartBar {
  flex: 1;
  background: var(--gradient-primary);
  border-radius: 4px 4px 0 0;
  min-height: 10px;
  transition: height 0.3s;
}

.gmpHistoryTable {
  margin-top: 1.5rem;
}

.historyTable {
  width: 100%;
  border-collapse: collapse;
}

.historyTable th,
.historyTable td {
  padding: 0.75rem 1rem;
  text-align: left;
  border-bottom: 1px solid var(--color-border-light);
}

.historyTable th {
  font-size: 0.75rem;
  color: var(--color-text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-weight: 600;
}

.historyTable td {
  font-size: 0.875rem;
  color: var(--color-text-primary);
}

.disclaimer {
  margin-top: 1rem;
  padding: 1rem;
  background: var(--color-warning-light);
  border: 1px solid rgba(245, 158, 11, 0.3);
  border-radius: var(--radius-sm);
  font-size: 0.75rem;
  color: #b45309;
}

/* ===== ALLOTMENT SECTION ===== */
.allotmentGrid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1.5rem;
}

.allotmentCard {
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border-light);
  border-radius: var(--radius-lg);
  padding: 1.5rem;
}

.allotmentCard h3 {
  font-size: 1rem;
  color: var(--color-text-primary);
  margin-bottom: 1rem;
}

.registrarLink {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem 1.25rem;
  background: var(--gradient-primary);
  border-radius: var(--radius-md);
  color: white;
  text-decoration: none;
  font-weight: 600;
  font-size: 0.875rem;
  transition: var(--transition-base);
  box-shadow: 0 2px 8px rgba(79, 70, 229, 0.25);
}

.registrarLink:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 16px rgba(79, 70, 229, 0.35);
}

/* ===== FINANCIALS ===== */
.financialCards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 1rem;
  margin-bottom: 2rem;
}

.financialCard {
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border-light);
  border-radius: var(--radius-md);
  padding: 1rem;
  text-align: center;
}

.financialLabel {
  font-size: 0.75rem;
  color: var(--color-text-muted);
  margin-bottom: 0.5rem;
  font-weight: 600;
}

.financialValue {
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--color-text-primary);
}

.financialTable {
  width: 100%;
  border-collapse: collapse;
  margin-top: 1.5rem;
}

.financialTable th,
.financialTable td {
  padding: 1rem;
  text-align: center;
  border-bottom: 1px solid var(--color-border-light);
}

.financialTable th {
  font-size: 0.75rem;
  color: var(--color-text-muted);
  text-transform: uppercase;
  background: var(--color-bg-secondary);
  font-weight: 600;
}

.financialTable td:first-child {
  text-align: left;
  color: var(--color-text-secondary);
}

/* ===== ISSUE DETAILS ===== */
.issueGrid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 2rem;
}

.issueBreakup h3,
.useFunds h3 {
  font-size: 1rem;
  color: var(--color-text-primary);
  margin-bottom: 1.25rem;
}

.breakupItem {
  display: flex;
  justify-content: space-between;
  padding: 0.75rem 0;
  border-bottom: 1px solid var(--color-border-light);
}

.breakupLabel {
  color: var(--color-text-secondary);
  font-size: 0.875rem;
}

.breakupValue {
  font-weight: 600;
  color: var(--color-text-primary);
}

.pieChart {
  width: 200px;
  height: 200px;
  border-radius: 50%;
  margin: 0 auto 1.5rem;
  position: relative;
}

.pieLegend {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.legendItem {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 0.875rem;
}

.legendColor {
  width: 12px;
  height: 12px;
  border-radius: 3px;
}

/* ===== SHAREHOLDING ===== */
.shareholdingGrid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 2rem;
}

.shareholdingCard {
  text-align: center;
}

.shareholdingCard h3 {
  font-size: 1rem;
  color: var(--color-text-primary);
  margin-bottom: 1.5rem;
}

.promoterTable {
  width: 100%;
  border-collapse: collapse;
  margin-top: 2rem;
}

.promoterTable th,
.promoterTable td {
  padding: 1rem;
  text-align: left;
  border-bottom: 1px solid var(--color-border-light);
}

.promoterTable th {
  font-size: 0.75rem;
  color: var(--color-text-muted);
  text-transform: uppercase;
  font-weight: 600;
}

/* ===== ABOUT COMPANY ===== */
.companyOverview {
  font-size: 1rem;
  line-height: 1.8;
  color: var(--color-text-secondary);
  margin-bottom: 2rem;
}

.companyOverview p {
  margin-bottom: 1rem;
}

.highlights {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1rem;
}

.highlightItem {
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
  padding: 1rem;
  background: var(--color-bg-secondary);
  border-radius: var(--radius-md);
}

.highlightIcon {
  color: var(--color-success);
  font-size: 1.25rem;
}

.highlightText {
  font-size: 0.875rem;
  color: var(--color-text-primary);
}

/* ===== EXPERT REVIEW ===== */
.reviewHeader {
  display: flex;
  align-items: center;
  gap: 2rem;
  margin-bottom: 2rem;
  padding-bottom: 1.5rem;
  border-bottom: 1px solid var(--color-border-light);
}

.overallRating {
  text-align: center;
}

.ratingStars {
  font-size: 2rem;
  margin-bottom: 0.5rem;
}

.ratingLabel {
  font-size: 0.875rem;
  color: var(--color-text-secondary);
}

.ratingBars {
  flex: 1;
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 0.75rem;
}

.ratingItem {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.ratingName {
  font-size: 0.75rem;
  color: var(--color-text-secondary);
  min-width: 100px;
}

.ratingBar {
  flex: 1;
  height: 8px;
  background: var(--color-bg-tertiary);
  border-radius: 4px;
  overflow: hidden;
}

.ratingFill {
  height: 100%;
  background: var(--gradient-primary);
  border-radius: 4px;
}

.ratingValue {
  font-size: 0.75rem;
  color: var(--color-text-primary);
  min-width: 30px;
  font-weight: 600;
}

.prosConsGrid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 2rem;
  margin-bottom: 2rem;
}

.prosSection h3,
.consSection h3 {
  font-size: 1rem;
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.prosSection h3 {
  color: var(--color-success);
}

.consSection h3 {
  color: var(--color-warning);
}

.prosList,
.consList {
  list-style: none;
  padding: 0;
}

.prosList li,
.consList li {
  padding: 0.75rem 0;
  border-bottom: 1px solid var(--color-border-light);
  font-size: 0.875rem;
  color: var(--color-text-primary);
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
}

.recommendationBox {
  background: linear-gradient(135deg, rgba(79, 70, 229, 0.05) 0%, rgba(139, 92, 246, 0.03) 100%);
  border: 1px solid rgba(79, 70, 229, 0.15);
  border-radius: var(--radius-lg);
  padding: 1.5rem;
  text-align: center;
}

.recommendationLabel {
  font-size: 0.875rem;
  color: var(--color-text-secondary);
  margin-bottom: 0.5rem;
}

.recommendationValue {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--color-success);
  margin-bottom: 1rem;
}

.poll {
  display: flex;
  justify-content: center;
  gap: 2rem;
  margin-top: 1.5rem;
  padding-top: 1.5rem;
  border-top: 1px solid var(--color-border-light);
}

.pollOption {
  text-align: center;
}

.pollBar {
  width: 100px;
  height: 8px;
  background: var(--color-bg-tertiary);
  border-radius: 4px;
  overflow: hidden;
  margin-top: 0.5rem;
}

.pollFill {
  height: 100%;
  border-radius: 4px;
}

.pollApply {
  background: var(--color-success);
}

.pollAvoid {
  background: var(--color-error);
}

.pollLabel {
  font-size: 0.75rem;
  color: var(--color-text-muted);
  margin-bottom: 0.25rem;
}

.pollValue {
  font-size: 1rem;
  font-weight: 700;
  color: var(--color-text-primary);
}

/* ===== TIMELINE ===== */
.timeline {
  position: relative;
  padding-left: 2rem;
}

.timeline::before {
  content: '';
  position: absolute;
  left: 8px;
  top: 0;
  bottom: 0;
  width: 2px;
  background: var(--color-border);
}

.timelineItem {
  position: relative;
  padding-bottom: 1.5rem;
}

.timelineItem::before {
  content: '';
  position: absolute;
  left: -2rem;
  top: 0.25rem;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: var(--gradient-primary);
  border: 3px solid var(--color-bg-card);
  box-shadow: var(--shadow-sm);
}

.timelineDate {
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--color-text-primary);
  margin-bottom: 0.25rem;
}

.timelineEvent {
  font-size: 0.875rem;
  color: var(--color-text-secondary);
}

/* ===== FAQ SECTION ===== */
.faqList {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.faqItem {
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border-light);
  border-radius: var(--radius-md);
  overflow: hidden;
}

.faqQuestion {
  padding: 1.25rem;
  font-size: 1rem;
  font-weight: 600;
  color: var(--color-text-primary);
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: var(--transition-base);
}

.faqQuestion:hover {
  background: var(--color-bg-tertiary);
}

.faqAnswer {
  padding: 0 1.25rem 1.25rem;
  font-size: 0.9375rem;
  color: var(--color-text-secondary);
  line-height: 1.7;
}

/* ===== FLOATING CTA ===== */
.floatingCta {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: var(--color-bg-card);
  border-top: 1px solid var(--color-border);
  padding: 1rem 2rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.08);
  z-index: 100;
}

.ctaInfo {
  display: flex;
  align-items: center;
  gap: 2rem;
}

.ctaLabel {
  font-size: 0.75rem;
  color: var(--color-text-muted);
  text-transform: uppercase;
  font-weight: 600;
}

.ctaValue {
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--color-text-primary);
}

.ctaButtons {
  display: flex;
  gap: 1rem;
}

.ctaButton {
  padding: 0.875rem 2rem;
  border-radius: var(--radius-md);
  font-weight: 600;
  font-size: 0.9375rem;
  cursor: pointer;
  transition: var(--transition-base);
}

.ctaPrimary {
  background: var(--gradient-primary);
  color: white;
  border: none;
  box-shadow: 0 4px 12px rgba(79, 70, 229, 0.25);
}

.ctaPrimary:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(79, 70, 229, 0.35);
}

.ctaSecondary {
  background: transparent;
  color: var(--color-text-secondary);
  border: 1px solid var(--color-border);
}

.ctaSecondary:hover {
  background: var(--color-bg-secondary);
  border-color: var(--color-primary);
  color: var(--color-primary);
}

/* ===== RESPONSIVE ===== */

/* Large tablets */
@media (max-width: 1024px) {
  .metricsGrid {
    grid-template-columns: repeat(2, 1fr);
  }

  .gmpGrid {
    grid-template-columns: 1fr;
  }

  .issueGrid,
  .shareholdingGrid,
  .allotmentGrid,
  .prosConsGrid {
    grid-template-columns: 1fr;
  }

  .section {
    padding: 1.5rem;
  }

  .hero {
    padding: 2rem;
  }
}

/* Tablets */
@media (max-width: 768px) {
  .container {
    padding: 0 0.75rem;
  }

  .hero {
    padding: 1.5rem;
    margin-bottom: 1.5rem;
  }

  .heroHeader {
    flex-direction: column;
    gap: 1rem;
  }

  .heroLeft {
    flex-direction: column;
    align-items: flex-start;
    gap: 1rem;
  }

  .companyLogo {
    width: 64px;
    height: 64px;
    font-size: 1.5rem;
  }

  .heroTitle {
    font-size: 1.5rem;
  }

  .metricsGrid {
    grid-template-columns: 1fr;
    gap: 0.75rem;
  }

  .metricCard {
    padding: 1rem;
  }

  .metricValue {
    font-size: 1.25rem;
  }

  .section {
    padding: 1.25rem;
    margin-bottom: 1.5rem;
  }

  .sectionTitle {
    font-size: 1.125rem;
    margin-bottom: 1rem;
  }

  .factsGrid {
    grid-template-columns: 1fr;
  }

  .factItem {
    padding: 0.75rem 1rem;
  }

  .highlights {
    grid-template-columns: 1fr;
  }

  .ratingBars {
    grid-template-columns: 1fr;
  }

  .reviewHeader {
    flex-direction: column;
    text-align: center;
  }

  .financialCards {
    grid-template-columns: repeat(2, 1fr);
  }

  .categoryCards {
    grid-template-columns: 1fr;
  }

  .floatingCta {
    flex-direction: column;
    gap: 1rem;
    padding: 1rem;
  }

  .ctaInfo {
    gap: 1rem;
  }

  .ctaButtons {
    width: 100%;
  }

  .ctaButton {
    flex: 1;
    text-align: center;
  }
}

/* Mobile phones */
@media (max-width: 480px) {
  .container {
    padding: 0 0.5rem;
  }

  .hero {
    padding: 1rem;
    border-radius: var(--radius-md);
  }

  .heroHeader {
    gap: 0.75rem;
  }

  .companyLogo {
    width: 56px;
    height: 56px;
    font-size: 1.25rem;
  }

  .heroTitle {
    font-size: 1.25rem;
    margin-bottom: 0.375rem;
  }

  .statusBadge {
    padding: 0.375rem 0.75rem;
    font-size: 0.75rem;
  }

  .alertButton {
    padding: 0.625rem 1rem;
    font-size: 0.8125rem;
  }

  .metricsGrid {
    gap: 0.5rem;
  }

  .metricCard {
    padding: 0.875rem;
  }

  .metricLabel {
    font-size: 0.6875rem;
    margin-bottom: 0.25rem;
  }

  .metricValue {
    font-size: 1.125rem;
  }

  .section {
    padding: 1rem;
    margin-bottom: 1rem;
    border-radius: var(--radius-md);
  }

  .sectionTitle {
    font-size: 1rem;
    margin-bottom: 0.875rem;
    gap: 0.5rem;
  }

  .sectionIcon {
    font-size: 1rem;
  }

  .factLabel {
    font-size: 0.8125rem;
  }

  .factValue {
    font-size: 0.875rem;
  }

  .subscriptionOverall {
    padding: 1.25rem;
  }

  .overallValue {
    font-size: 2.25rem;
  }

  .categoryCard {
    padding: 1rem;
  }

  .categoryName {
    font-size: 0.6875rem;
  }

  .categoryValue {
    font-size: 1rem;
  }

  .gmpMainCard {
    padding: 1rem;
  }

  .gmpAmount {
    font-size: 2rem;
  }

  .financialCards {
    grid-template-columns: 1fr;
    gap: 0.5rem;
  }

  .financialCard {
    padding: 0.75rem;
  }

  .financialLabel {
    font-size: 0.6875rem;
  }

  .financialValue {
    font-size: 1rem;
  }

  .highlightItem {
    padding: 0.75rem;
    gap: 0.5rem;
  }

  .highlightIcon {
    font-size: 1rem;
  }

  .highlightText {
    font-size: 0.8125rem;
  }

  .ratingStars {
    font-size: 1.5rem;
  }

  .ratingName {
    min-width: 80px;
    font-size: 0.6875rem;
  }

  .prosList li,
  .consList li {
    padding: 0.625rem 0;
    font-size: 0.8125rem;
  }

  .recommendationBox {
    padding: 1rem;
  }

  .floatingCta {
    padding: 0.75rem;
    gap: 0.75rem;
  }

  .ctaInfo {
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .ctaButton,
  .ctaSecondary {
    padding: 0.625rem 1rem;
    font-size: 0.8125rem;
  }
}
</file>

<file path="frontend/components/homepage/DashboardTabs.tsx">
'use client';

import { useState, useEffect } from 'react';
import Link from 'next/link';
import styles from './DashboardTabs.module.css';
import {
    fetchOpenIPOs,
    fetchClosingSoonIPOs,
    fetchRecentlyListedIPOs,
    fetchUpcomingThisWeek
} from '@/lib/api';

type TabType = 'open' | 'closing' | 'listed' | 'upcoming';

export default function DashboardTabs() {
    const [activeTab, setActiveTab] = useState<TabType>('open');
    const [data, setData] = useState<any>({
        open: [],
        closing: [],
        listed: [],
        upcoming: []
    });
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        loadAllData();
        const interval = setInterval(loadAllData, 60000); // Refresh every minute
        return () => clearInterval(interval);
    }, []);

    async function loadAllData() {
        const [open, closing, listed, upcoming] = await Promise.all([
            fetchOpenIPOs(),
            fetchClosingSoonIPOs(),
            fetchRecentlyListedIPOs(),
            fetchUpcomingThisWeek()
        ]);

        setData({ open, closing, listed, upcoming });
        setLoading(false);
    }

    const tabs = [
        { id: 'open' as TabType, label: 'Currently Open', count: data.open.length, icon: 'üü¢' },
        { id: 'listed' as TabType, label: 'Recently Listed', count: data.listed.length, icon: 'üìà' },
        { id: 'upcoming' as TabType, label: 'Upcoming This Week', count: data.upcoming.length, icon: 'üìÖ' },
        { id: 'closing' as TabType, label: 'Closed', count: data.closing.length, icon: 'üî¥' }
    ];

    const renderIPOCard = (ipo: any, type: TabType) => {
        const daysLeft = type === 'open' || type === 'closing'
            ? Math.ceil((new Date(ipo.close_date).getTime() - Date.now()) / (1000 * 60 * 60 * 24))
            : null;

        const listingGain = type === 'listed' && ipo.listing_gain_percent
            ? ipo.listing_gain_percent
            : null;

        return (
            <Link href={`/ipo/${ipo.slug}`} key={ipo.id} className={styles.ipoCard}>
                <div className={styles.cardTop}>
                    <div className={styles.cardInfo}>
                        <h4 className={styles.ipoName}>{ipo.company_name || ipo.ipo_name}</h4>
                        <span className={`${styles.category} ${ipo.category === 'SME' ? styles.sme : styles.mainboard}`}>
                            {ipo.category}
                        </span>
                    </div>

                    {type === 'open' || type === 'closing' ? (
                        <div className={styles.cardMetrics}>
                            <div className={styles.metric}>
                                <span className={styles.metricLabel}>Subscription</span>
                                <span className={`${styles.metricValue} ${ipo.subscription_total >= 1 ? styles.subscribed : ''}`}>
                                    {ipo.subscription_total.toFixed(2)}x
                                </span>
                            </div>
                            {daysLeft !== null && (
                                <div className={styles.daysLeft}>
                                    {daysLeft > 0 ? `${daysLeft}d left` : 'Closes Today'}
                                </div>
                            )}
                        </div>
                    ) : type === 'listed' ? (
                        <div className={styles.listingGain}>
                            <span className={styles.gainLabel}>Listing Gain</span>
                            <span className={`${styles.gainValue} ${listingGain && listingGain > 0 ? styles.positive : styles.negative}`}>
                                {listingGain !== null ? `${listingGain > 0 ? '+' : ''}${listingGain.toFixed(1)}%` : 'N/A'}
                            </span>
                        </div>
                    ) : (
                        <div className={styles.upcomingDate}>
                            Opens: {new Date(ipo.open_date).toLocaleDateString('en-IN', { month: 'short', day: 'numeric' })}
                        </div>
                    )}
                </div>

                <div className={styles.cardBottom}>
                    <div className={styles.gmpInfo}>
                        <span className={styles.gmpLabel}>GMP</span>
                        <span className={`${styles.gmpValue} ${ipo.gmp_amount >= 0 ? styles.positive : styles.negative}`}>
                            ‚Çπ{ipo.gmp_amount} ({ipo.gmp_percentage >= 0 ? '+' : ''}{ipo.gmp_percentage.toFixed(1)}%)
                        </span>
                    </div>
                    <div className={styles.cardArrow}>‚Üí</div>
                </div>
            </Link>
        );
    };

    if (loading) {
        return (
            <div className={styles.container}>
                <div className={styles.loading}>Loading dashboard...</div>
            </div>
        );
    }

    const activeData = data[activeTab];

    return (
        <div className={styles.container}>
            <div className={styles.tabs}>
                {tabs.map(tab => (
                    <button
                        key={tab.id}
                        className={`${styles.tab} ${activeTab === tab.id ? styles.activeTab : ''}`}
                        onClick={() => setActiveTab(tab.id)}
                    >
                        <span className={styles.tabIcon}>{tab.icon}</span>
                        <span className={styles.tabLabel}>{tab.label}</span>
                        <span className={styles.tabCount}>{tab.count}</span>
                    </button>
                ))}
            </div>

            <div className={styles.content}>
                {activeData.length > 0 ? (
                    <div className={styles.grid}>
                        {activeData.map((ipo: any) => renderIPOCard(ipo, activeTab))}
                    </div>
                ) : (
                    <div className={styles.empty}>
                        <p>No IPOs in this category at the moment</p>
                    </div>
                )}
            </div>
        </div>
    );
}
</file>

<file path="frontend/components/homepage/IPOCalendarWidget.module.css">
/* ============================================
   IPO Calendar Widget - Brutalist Editorial Style
   ============================================ */

.container {
    background: var(--color-bg-card);
    border: 4px solid var(--black);
    overflow: hidden;
    box-shadow: var(--shadow-card);
    display: flex;
    flex-direction: column;
    height: 100%;
}

.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 1rem;
    background: var(--yellow);
    border-bottom: 3px solid var(--black);
}

.monthYear {
    font-size: 1rem;
    font-family: var(--font-heading);
    color: var(--black);
    margin: 0;
    text-transform: uppercase;
}

.navButton {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: var(--white);
    border: 2px solid var(--black);
    cursor: pointer;
    transition: all 0.15s ease;
    color: var(--black);
    font-size: 0.875rem;
}

.navButton:hover {
    background: var(--black);
    color: var(--yellow);
    transform: rotate(-3deg);
}

.calendar {
    background-color: var(--white);
}

.weekdays {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    background-color: var(--gray);
    border-bottom: 3px solid var(--black);
}

.weekday {
    padding: 0.875rem 0.5rem;
    text-align: center;
    font-size: 0.6875rem;
    font-family: var(--font-body);
    font-weight: 700;
    color: var(--black);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    border-right: 1px solid var(--color-border-light);
}

.weekday:last-child {
    border-right: none;
}

.days {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
}

.blankDay {
    aspect-ratio: 1;
    background-color: var(--gray);
    border-right: 1px solid var(--color-border-light);
    border-bottom: 1px solid var(--color-border-light);
}

.blankDay:nth-child(7n) {
    border-right: none;
}

.day {
    aspect-ratio: 1;
    padding: 0.5rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    border-right: 1px solid var(--color-border-light);
    border-bottom: 1px solid var(--color-border-light);
    cursor: pointer;
    transition: all 0.15s ease;
    position: relative;
    background-color: var(--white);
}

.day:nth-child(7n) {
    border-right: none;
}

.day:hover {
    background-color: var(--yellow);
}

.dayNumber {
    font-size: 0.875rem;
    font-family: var(--font-body);
    font-weight: 700;
    color: var(--color-text-primary);
}

.today {
    background: var(--yellow);
}

.today .dayNumber {
    background: var(--black);
    color: var(--yellow);
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
}

.hasEvents {
    background-color: rgba(255, 237, 78, 0.3);
}

.hasEvents .dayNumber {
    color: var(--black);
    font-weight: 700;
}

.eventDots {
    display: flex;
    gap: 4px;
    margin-top: 0.375rem;
}

.eventDot {
    width: 8px;
    height: 8px;
    background: var(--black);
}

/* Upcoming Events Section */
.upcomingEvents {
    padding: 1.5rem;
    border-top: 4px solid var(--black);
    background: var(--gray);
}

.eventsTitle {
    font-size: 1rem;
    font-family: var(--font-heading);
    color: var(--black);
    margin: 0 0 1rem 0;
    text-transform: uppercase;
    background: var(--yellow);
    display: inline-block;
    padding: 0.25rem 0.75rem;
    transform: rotate(-1deg);
}

.eventsList {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.eventItem {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background-color: var(--white);
    border: 3px solid var(--black);
    transition: all 0.15s ease;
    text-decoration: none;
}

.eventItem:hover {
    box-shadow: var(--shadow-sm);
    transform: translateX(4px) rotate(-1deg);
    background: var(--yellow);
}

.eventDate {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 40px;
    height: 40px;
    background: var(--black);
    color: var(--yellow);
    font-size: 1rem;
    font-family: var(--font-body);
    font-weight: 700;
}

.eventInfo {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
    flex: 1;
    min-width: 0;
}

.eventTitle {
    font-size: 0.875rem;
    font-family: var(--font-body);
    font-weight: 700;
    color: var(--color-text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    text-transform: uppercase;
}

.eventType {
    font-size: 0.6875rem;
    font-family: var(--font-body);
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

/* Responsive Design */
@media (max-width: 768px) {
    .header {
        padding: 1rem 1.25rem;
    }

    .monthYear {
        font-size: 1rem;
    }

    .weekday {
        padding: 0.625rem 0.25rem;
        font-size: 0.5625rem;
    }

    .day {
        padding: 0.375rem;
    }

    .dayNumber {
        font-size: 0.75rem;
    }

    .today .dayNumber {
        width: 24px;
        height: 24px;
    }

    .eventDots {
        gap: 3px;
    }

    .eventDot {
        width: 6px;
        height: 6px;
    }

    .upcomingEvents {
        padding: 1.25rem;
    }

    .eventItem {
        padding: 0.75rem;
    }

    .eventDate {
        min-width: 36px;
        height: 36px;
        font-size: 0.875rem;
    }
}
</file>

<file path="frontend/components/homepage/IPOCategoryChart.module.css">
/* IPO Category Chart Section - Template Style */

.chartSection {
    background: linear-gradient(145deg, #ebe4d1 0%, #e5dcc5 100%);
    border-radius: 8px;
    padding: 1.5rem 2rem;
    margin-bottom: 3rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

.chartSection:hover {
    /* Removed rotation change */
}

.loading {
    text-align: center;
    padding: 3rem;
    font-size: 1rem;
    color: #666;
}

/* Header */
.chartHeader {
    margin-bottom: 1rem;
}

.chartTitle {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--black, #0a0a0a);
    margin: 0 0 0.25rem 0;
    font-family: var(--font-heading, 'Inter', sans-serif);
}

.chartSubtitle {
    font-size: 0.8rem;
    color: #666;
    margin: 0;
}

/* Dropdown Row */
.dropdownRow {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
}

.dropdownGroup {
    flex: 1;
}

.dropdownLabel {
    display: block;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #666;
    margin-bottom: 0.5rem;
}

.dropdown {
    width: 100%;
    padding: 0.875rem 1rem;
    background: rgba(58, 58, 58, 0.09);
    border: 2px solid var(--black, #0a0a0a);
    border-radius: 4px;
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--black, #0a0a0a);
    cursor: pointer;
    transition: all 0.2s ease;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%230a0a0a' d='M6 8L2 4h8z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 1rem center;
    padding-right: 2.5rem;
}

.dropdown:hover {
    background: #f0f0f0;
}

.dropdown:focus {
    outline: none;
    border-color: var(--yellow, #ffed4e);
    box-shadow: 0 0 0 3px rgba(255, 237, 78, 0.3);
}

.dropdown option {
    background: white;
    color: var(--black, #0a0a0a);
}

/* Chart Container */
.chartContainer {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    align-items: center;
}

/* Pie Chart Wrapper */
.pieChartWrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
}

.pieSvg {
    display: block;
}

.pieSlice {
    transition: all 0.3s ease;
    cursor: pointer;
}

.pieSlice:hover {
    opacity: 0.85;
    filter: brightness(1.05);
}

/* Slice Labels */
.sliceLabel {
    font-family: 'JetBrains Mono', 'Courier New', monospace;
    pointer-events: none;
}

/* Total displayed below the pie chart */
.totalBelow {
    text-align: center;
    margin-top: 0;
    padding: 0.75rem 1.5rem;
    background: rgba(26, 58, 58, 0.08);
    border-radius: 10px;
    border: 1px solid rgba(26, 58, 58, 0.15);
}

.totalValue {
    font-family: 'JetBrains Mono', 'Courier New', monospace;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--teal-dark, #1a3a3a);
    line-height: 1.2;
}

.totalLabel {
    font-size: 0.65rem;
    color: #4a6a6a;
    margin-top: 0.125rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

/* Legend */
.chartLegend {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.legendItem {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.5rem 0.75rem;
    background: rgba(58, 58, 58, 0.09);
    border-radius: 6px;
    transition: all 0.2s ease;
    cursor: pointer;
}

.legendItem:hover {
    background: #f0f0f0;
    transform: translateX(4px);
}

.legendColor {
    width: 40px;
    height: 40px;
    border-radius: 6px;
    flex-shrink: 0;
}

.legendInfo {
    flex: 1;
}

.legendLabel {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--black, #0a0a0a);
    margin-bottom: 0.25rem;
}

.legendValue {
    font-family: 'JetBrains Mono', 'Courier New', monospace;
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--black, #0a0a0a);
}

.legendPercent {
    font-size: 0.75rem;
    color: #666;
    margin-left: 0.5rem;
    font-family: var(--font-body, 'Inter', sans-serif);
}

/* Responsive */
@media (max-width: 768px) {
    .chartSection {
        padding: 1.5rem;
        margin-bottom: 3rem;
    }

    .chartTitle {
        font-size: 1.25rem;
    }

    .chartSubtitle {
        font-size: 0.8125rem;
    }

    .dropdownRow {
        flex-direction: column;
        gap: 1rem;
    }

    .chartContainer {
        grid-template-columns: 1fr;
        gap: 2rem;
    }

    .pieChart {
        width: 240px;
        height: 240px;
    }

    .pieCenter {
        width: 80px;
        height: 80px;
    }

    .pieCenterValue {
        font-size: 1.125rem;
    }

    .pieCenterLabel {
        font-size: 0.5625rem;
    }

    .legendItem {
        padding: 0.75rem;
    }

    .legendColor {
        width: 32px;
        height: 32px;
    }

    .legendLabel {
        font-size: 0.75rem;
    }

    .legendValue {
        font-size: 1rem;
    }
}

@media (max-width: 480px) {
    .chartSection {
        padding: 1rem;
        margin-bottom: 2rem;
    }

    .chartTitle {
        font-size: 1.125rem;
    }

    .dropdown {
        padding: 0.75rem;
        font-size: 0.8125rem;
    }

    .pieChart {
        width: 200px;
        height: 200px;
    }

    .pieCenter {
        width: 70px;
        height: 70px;
    }

    .pieCenterValue {
        font-size: 1rem;
    }

    .legendItem {
        padding: 0.625rem;
        gap: 0.75rem;
    }

    .legendColor {
        width: 28px;
        height: 28px;
    }

    .legendLabel {
        font-size: 0.6875rem;
    }

    .legendValue {
        font-size: 0.875rem;
    }

    .legendPercent {
        font-size: 0.625rem;
    }
}
</file>

<file path="frontend/components/homepage/IPOCategoryChart.tsx">
'use client';

import React, { useState, useEffect } from 'react';
import styles from './IPOCategoryChart.module.css';
import { fetchFeaturedIPOs, fetchOpenIPOs } from '@/lib/api';

interface IPOData {
    id: number;
    ipo_name: string;
    company_name?: string;
    category?: string;
    issue_size_cr?: number;
    lot_size?: number;
    subscription_retail?: number;
    subscription_nii?: number;
    subscription_qib?: number;
    subscription_total?: number;
}

type FilterType = 'allocation' | 'issueSize' | 'subscription';

interface FilterOption {
    value: FilterType;
    label: string;
}

const filterOptions: FilterOption[] = [
    { value: 'allocation', label: 'Allocation %' },
    { value: 'issueSize', label: 'Issue Size (‚Çπ Cr)' },
    { value: 'subscription', label: 'Subscription Data' },
];

// Dynamic color palette
const CHART_COLORS = [
    '#FFED4E', // Yellow
    '#FF9500', // Orange
    '#007AFF', // Blue
    '#AF52DE', // Purple
    '#5AC8FA', // Teal
    '#34C759', // Green
    '#FF3B30', // Red
    '#FF6F61', // Coral
];

function getChartColor(index: number): string {
    return CHART_COLORS[index % CHART_COLORS.length];
}

// SEBI-defined allocation percentages
const ALLOCATION_PERCENTAGES = {
    retail: 35,
    qib: 50,
    nii: 15,
};

interface PieSegment {
    label: string;
    value: number;
    color: string;
    displayValue: string;
    subscribed?: string;
}

export default function IPOCategoryChart() {
    const [ipos, setIpos] = useState<IPOData[]>([]);
    const [selectedIPO, setSelectedIPO] = useState<IPOData | null>(null);
    const [selectedFilter, setSelectedFilter] = useState<FilterType>('allocation');
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        loadIPOs();
    }, []);

    async function loadIPOs() {
        try {
            const [featured, open] = await Promise.all([
                fetchFeaturedIPOs(),
                fetchOpenIPOs(),
            ]);
            const allIPOs = [...featured, ...open];
            const uniqueIPOs = allIPOs.filter((ipo, index, self) =>
                index === self.findIndex((t) => t.id === ipo.id)
            );
            setIpos(uniqueIPOs);
            if (uniqueIPOs.length > 0) {
                setSelectedIPO(uniqueIPOs[0]);
            }
        } catch (error) {
            console.error('Error loading IPOs:', error);
        } finally {
            setLoading(false);
        }
    }

    const getChartData = (): PieSegment[] => {
        if (!selectedIPO) return [];

        const issueSize = selectedIPO.issue_size_cr || 100;
        const retailSub = selectedIPO.subscription_retail || 0;
        const niiSub = selectedIPO.subscription_nii || 0;
        const qibSub = selectedIPO.subscription_qib || 0;

        switch (selectedFilter) {
            case 'allocation':
                return [
                    { label: 'Retail', value: ALLOCATION_PERCENTAGES.retail, color: getChartColor(0), displayValue: `${ALLOCATION_PERCENTAGES.retail}%`, subscribed: `${retailSub.toFixed(2)}x` },
                    { label: 'QIB', value: ALLOCATION_PERCENTAGES.qib, color: getChartColor(1), displayValue: `${ALLOCATION_PERCENTAGES.qib}%`, subscribed: `${qibSub.toFixed(2)}x` },
                    { label: 'NII', value: ALLOCATION_PERCENTAGES.nii, color: getChartColor(2), displayValue: `${ALLOCATION_PERCENTAGES.nii}%`, subscribed: `${niiSub.toFixed(2)}x` },
                ];

            case 'issueSize': {
                const retailCr = (issueSize * ALLOCATION_PERCENTAGES.retail) / 100;
                const qibCr = (issueSize * ALLOCATION_PERCENTAGES.qib) / 100;
                const niiCr = (issueSize * ALLOCATION_PERCENTAGES.nii) / 100;
                return [
                    { label: 'Retail', value: retailCr, color: getChartColor(0), displayValue: `‚Çπ${retailCr.toFixed(1)}Cr` },
                    { label: 'QIB', value: qibCr, color: getChartColor(1), displayValue: `‚Çπ${qibCr.toFixed(1)}Cr` },
                    { label: 'NII', value: niiCr, color: getChartColor(2), displayValue: `‚Çπ${niiCr.toFixed(1)}Cr` },
                ];
            }

            case 'subscription': {
                return [
                    { label: 'Retail', value: retailSub || 0.01, color: getChartColor(0), displayValue: `${retailSub.toFixed(2)}x` },
                    { label: 'QIB', value: qibSub || 0.01, color: getChartColor(1), displayValue: `${qibSub.toFixed(2)}x` },
                    { label: 'NII', value: niiSub || 0.01, color: getChartColor(2), displayValue: `${niiSub.toFixed(2)}x` },
                ];
            }

            default:
                return [];
        }
    };

    const chartData = getChartData();
    const total = chartData.reduce((sum, segment) => sum + segment.value, 0) || 1;

    const centerX = 170;
    const centerY = 160;
    const radius = 100;
    const innerLabelRadius = 55; // For labels inside the slice
    const labelRadius = 112; // For label line start (outside edge)
    const outerLabelRadius = 130; // For label line bend point

    // Threshold: slices with more than 25% get labels inside
    const INSIDE_LABEL_THRESHOLD = 0.25;

    // Generate filled pie slices and labels with smart placement
    const generatePieChart = () => {
        let currentAngle = -90;
        const slices: React.JSX.Element[] = [];
        const labels: React.JSX.Element[] = [];

        chartData.forEach((segment, index) => {
            const percentage = segment.value / total;
            const sliceAngle = percentage * 360;
            const startAngle = currentAngle;
            const endAngle = currentAngle + sliceAngle;
            const midAngle = startAngle + sliceAngle / 2;

            currentAngle = endAngle;

            // Convert angles to radians
            const startRad = (startAngle * Math.PI) / 180;
            const endRad = (endAngle * Math.PI) / 180;
            const midRad = (midAngle * Math.PI) / 180;

            // Calculate arc points for slice
            const x1 = centerX + radius * Math.cos(startRad);
            const y1 = centerY + radius * Math.sin(startRad);
            const x2 = centerX + radius * Math.cos(endRad);
            const y2 = centerY + radius * Math.sin(endRad);

            const largeArc = sliceAngle > 180 ? 1 : 0;

            // Filled pie slice path
            const pathData = `
                M ${centerX} ${centerY}
                L ${x1} ${y1}
                A ${radius} ${radius} 0 ${largeArc} 1 ${x2} ${y2}
                Z
            `;

            slices.push(
                <path
                    key={`slice-${index}`}
                    d={pathData}
                    fill={segment.color}
                    stroke="#1a3a3a"
                    strokeWidth="2"
                    className={styles.pieSlice}
                />
            );

            // Smart label placement based on slice size
            if (percentage >= INSIDE_LABEL_THRESHOLD) {
                // Large slice: place label INSIDE with name on top, value below
                const labelX = centerX + innerLabelRadius * Math.cos(midRad);
                const labelY = centerY + innerLabelRadius * Math.sin(midRad);

                labels.push(
                    <text
                        key={`label-${index}`}
                        x={labelX}
                        y={labelY}
                        textAnchor="middle"
                        className={styles.sliceLabel}
                        fill="#1a3a3a"
                    >
                        <tspan x={labelX} dy="-0.5em" fontSize="13" fontWeight="600">
                            {segment.label}
                        </tspan>
                        <tspan x={labelX} dy="1.2em" fontSize="15" fontWeight="700">
                            {segment.displayValue}
                        </tspan>
                    </text>
                );
            } else {
                // Small slice: place label OUTSIDE with connecting lines
                const edgeX = centerX + labelRadius * Math.cos(midRad);
                const edgeY = centerY + labelRadius * Math.sin(midRad);
                const outerX = centerX + outerLabelRadius * Math.cos(midRad);
                const outerY = centerY + outerLabelRadius * Math.sin(midRad);

                // Horizontal extension for the label
                const isRightSide = midAngle > -90 && midAngle < 90;
                const horizontalExtend = isRightSide ? 30 : -30;
                const textAnchor = isRightSide ? 'start' : 'end';
                const textX = outerX + horizontalExtend + (isRightSide ? 5 : -5);

                labels.push(
                    <g key={`label-${index}`}>
                        {/* First line: from edge to outer point */}
                        <line
                            x1={edgeX}
                            y1={edgeY}
                            x2={outerX}
                            y2={outerY}
                            stroke="#1a3a3a"
                            strokeWidth="1.5"
                        />
                        {/* Second line: horizontal extension */}
                        <line
                            x1={outerX}
                            y1={outerY}
                            x2={outerX + horizontalExtend}
                            y2={outerY}
                            stroke="#1a3a3a"
                            strokeWidth="1.5"
                        />
                        {/* Label text - stacked */}
                        <text
                            x={textX}
                            y={outerY}
                            textAnchor={textAnchor}
                            className={styles.sliceLabel}
                            fill="#1a3a3a"
                        >
                            <tspan x={textX} dy="-0.4em" fontSize="11" fontWeight="600">
                                {segment.label}
                            </tspan>
                            <tspan x={textX} dy="1.1em" fontSize="13" fontWeight="700">
                                {segment.displayValue}
                            </tspan>
                        </text>
                    </g>
                );
            }
        });

        return { slices, labels };
    };

    const getCenterValue = (): string => {
        switch (selectedFilter) {
            case 'allocation':
                return '100%';
            case 'issueSize':
                return `‚Çπ${selectedIPO?.issue_size_cr || 0}Cr`;
            case 'subscription':
                return `${(selectedIPO?.subscription_total || 0).toFixed(2)}x`;
            default:
                return '100%';
        }
    };

    const getCenterLabel = (): string => {
        switch (selectedFilter) {
            case 'allocation':
                return 'Total Allocation';
            case 'issueSize':
                return 'Total Issue Size';
            case 'subscription':
                return 'Total Subscribed';
            default:
                return 'Total';
        }
    };

    if (loading) {
        return (
            <div className={styles.chartSection}>
                <div className={styles.loading}>Loading IPO data...</div>
            </div>
        );
    }

    const { slices, labels } = generatePieChart();

    return (
        <div className={styles.chartSection}>
            <div className={styles.chartHeader}>
                <h2 className={styles.chartTitle}>IPO Category Distribution</h2>
                <p className={styles.chartSubtitle}>Breakdown by subscription category</p>
            </div>

            {/* Dropdowns */}
            <div className={styles.dropdownRow}>
                <div className={styles.dropdownGroup}>
                    <label className={styles.dropdownLabel}>Select IPO</label>
                    <select
                        value={selectedIPO?.id || ''}
                        onChange={(e) => {
                            const ipo = ipos.find(i => i.id === Number(e.target.value));
                            if (ipo) setSelectedIPO(ipo);
                        }}
                        className={styles.dropdown}
                    >
                        {ipos.map((ipo) => (
                            <option key={ipo.id} value={ipo.id}>
                                {ipo.ipo_name}
                            </option>
                        ))}
                    </select>
                </div>

                <div className={styles.dropdownGroup}>
                    <label className={styles.dropdownLabel}>Filter By</label>
                    <select
                        value={selectedFilter}
                        onChange={(e) => setSelectedFilter(e.target.value as FilterType)}
                        className={styles.dropdown}
                    >
                        {filterOptions.map((option) => (
                            <option key={option.value} value={option.value}>
                                {option.label}
                            </option>
                        ))}
                    </select>
                </div>
            </div>

            <div className={styles.chartContainer}>
                {/* Pie Chart with labels */}
                <div className={styles.pieChartWrapper}>
                    <svg width="340" height="340" viewBox="0 0 340 320" className={styles.pieSvg}>
                        {slices}
                        {labels}
                    </svg>
                    {/* Total displayed below the pie chart */}
                    <div className={styles.totalBelow}>
                        <div className={styles.totalValue}>{getCenterValue()}</div>
                        <div className={styles.totalLabel}>{getCenterLabel()}</div>
                    </div>
                </div>

                {/* Legend */}
                <div className={styles.chartLegend}>
                    {chartData.map((segment, index) => (
                        <div key={index} className={styles.legendItem}>
                            <div
                                className={styles.legendColor}
                                style={{ backgroundColor: segment.color }}
                            />
                            <div className={styles.legendInfo}>
                                <div className={styles.legendLabel}>{segment.label}</div>
                                <div className={styles.legendValue}>
                                    {segment.displayValue}
                                    {segment.subscribed && (
                                        <span className={styles.legendPercent}> ({segment.subscribed} subscribed)</span>
                                    )}
                                </div>
                            </div>
                        </div>
                    ))}
                </div>
            </div>
        </div>
    );
}
</file>

<file path="frontend/components/homepage/SubscriptionHeatmap.tsx">
'use client';

import { useState, useEffect, useMemo } from 'react';
import Link from 'next/link';
import styles from './SubscriptionHeatmap.module.css';
import { fetchCombinedIPOData } from '@/lib/api';

type MetricType = 'ipoSize' | 'gmpPercent' | 'retailSub' | 'shniSub' | 'bhniSub' | 'employeeSub' | 'totalSub' | 'listingGain' | 'priceBand';
type CategoryType = 'all' | 'SME' | 'Mainboard';
type StatusType = 'all' | 'open' | 'closed' | 'upcoming' | 'listed';
type DateRangeType = '7d' | '30d' | '3m' | '6m' | '1y' | 'all' | 'custom';

interface IPOData {
    id: number;
    slug: string;
    ipo_name: string;
    company_name?: string;
    category?: string;
    issue_size_cr?: number;
    price_band_low?: number;
    price_band_high?: number;
    gmp_percentage?: number;
    gmp_amount?: number;
    subscription_retail?: number;
    subscription_nii?: number;
    subscription_qib?: number;
    subscription_total?: number;
    subscription_employee?: number;
    listing_gain_percent?: number;
    open_date?: string;
    close_date?: string;
    listing_date?: string;
    status?: string;
}

const metricOptions = [
    { value: 'ipoSize', label: 'IPO Size (‚Çπ Cr)' },
    { value: 'gmpPercent', label: 'GMP Percentage' },
    { value: 'retailSub', label: 'Retail Subscription' },
    { value: 'shniSub', label: 'sHNI Subscription' },
    { value: 'bhniSub', label: 'bHNI Subscription' },
    { value: 'employeeSub', label: 'Employee Subscription' },
    { value: 'totalSub', label: 'Total Subscription' },
    { value: 'listingGain', label: 'Listing Gain %' },
    { value: 'priceBand', label: 'Price Band (‚Çπ)' },
];

const categoryOptions = [
    { value: 'all', label: 'All Categories' },
    { value: 'SME', label: 'SME' },
    { value: 'Mainboard', label: 'Mainboard' },
];

const statusOptions = [
    { value: 'all', label: 'All Status' },
    { value: 'open', label: 'Open' },
    { value: 'closed', label: 'Closed' },
    { value: 'upcoming', label: 'Upcoming' },
    { value: 'listed', label: 'Recently Listed' },
];

const dateRangeOptions = [
    { value: 'all', label: 'All Time' },
    { value: '7d', label: 'Last 7 Days' },
    { value: '30d', label: 'Last 30 Days' },
    { value: '3m', label: 'Last 3 Months' },
    { value: '6m', label: 'Last 6 Months' },
    { value: '1y', label: 'Last 1 Year' },
    { value: 'custom', label: 'Custom Range' },
];

// Dynamic legend labels based on metric
const getLegendLabels = (metric: MetricType) => {
    switch (metric) {
        case 'gmpPercent':
        case 'listingGain':
            return ['< 0%', '0-10%', '10-30%', '30%+'];
        case 'retailSub':
        case 'shniSub':
        case 'bhniSub':
        case 'employeeSub':
        case 'totalSub':
            return ['< 1x', '1-3x', '3-5x', '5x+'];
        case 'ipoSize':
            return ['< ‚Çπ50Cr', '‚Çπ50-200Cr', '‚Çπ200-500Cr', '‚Çπ500Cr+'];
        case 'priceBand':
            return ['< ‚Çπ100', '‚Çπ100-300', '‚Çπ300-500', '‚Çπ500+'];
        default:
            return ['Low', 'Below Avg', 'Average', 'High'];
    }
};

export default function SubscriptionHeatmap() {
    const [ipos, setIpos] = useState<IPOData[]>([]);
    const [loading, setLoading] = useState(true);
    const [selectedMetric, setSelectedMetric] = useState<MetricType>('totalSub');
    const [selectedCategory, setSelectedCategory] = useState<CategoryType>('all');
    const [selectedStatus, setSelectedStatus] = useState<StatusType>('all');
    const [selectedDateRange, setSelectedDateRange] = useState<DateRangeType>('all');
    const [customStartDate, setCustomStartDate] = useState<string>('');
    const [customEndDate, setCustomEndDate] = useState<string>('');

    useEffect(() => {
        loadData();
        // Set default custom dates
        const today = new Date();
        const thirtyDaysAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);
        setCustomEndDate(today.toISOString().split('T')[0]);
        setCustomStartDate(thirtyDaysAgo.toISOString().split('T')[0]);
    }, []);

    async function loadData() {
        try {
            const data = await fetchCombinedIPOData();
            setIpos(data || []);
        } catch (error) {
            console.error('Error loading IPO data:', error);
        } finally {
            setLoading(false);
        }
    }

    // Get metric value for an IPO
    const getMetricValue = (ipo: IPOData): number => {
        switch (selectedMetric) {
            case 'ipoSize': return ipo.issue_size_cr || 0;
            case 'gmpPercent': return ipo.gmp_percentage || 0;
            case 'retailSub': return ipo.subscription_retail || 0;
            case 'shniSub': return (ipo.subscription_nii || 0) * 0.5;
            case 'bhniSub': return (ipo.subscription_nii || 0) * 0.5;
            case 'employeeSub': return ipo.subscription_employee || 0;
            case 'totalSub': return ipo.subscription_total || 0;
            case 'listingGain': return ipo.listing_gain_percent || 0;
            case 'priceBand': return ((ipo.price_band_low || 0) + (ipo.price_band_high || 0)) / 2;
            default: return 0;
        }
    };

    // Get display string for metric
    const getMetricDisplay = (ipo: IPOData): string => {
        const value = getMetricValue(ipo);
        switch (selectedMetric) {
            case 'ipoSize': return `‚Çπ${value.toFixed(0)}Cr`;
            case 'gmpPercent': return `${value >= 0 ? '+' : ''}${value.toFixed(1)}%`;
            case 'retailSub':
            case 'shniSub':
            case 'bhniSub':
            case 'employeeSub':
            case 'totalSub': return `${value.toFixed(2)}x`;
            case 'listingGain': return `${value >= 0 ? '+' : ''}${value.toFixed(1)}%`;
            case 'priceBand': return `‚Çπ${value.toFixed(0)}`;
            default: return value.toString();
        }
    };

    // Get IPO status
    const getIPOStatus = (ipo: IPOData): StatusType => {
        const now = new Date();
        const openDate = ipo.open_date ? new Date(ipo.open_date) : null;
        const closeDate = ipo.close_date ? new Date(ipo.close_date) : null;
        const listingDate = ipo.listing_date ? new Date(ipo.listing_date) : null;

        if (listingDate && listingDate <= now) return 'listed';
        if (closeDate && closeDate < now) return 'closed';
        if (openDate && closeDate && openDate <= now && closeDate >= now) return 'open';
        if (openDate && openDate > now) return 'upcoming';
        return 'all';
    };

    // Filter IPOs
    const filteredIpos = useMemo(() => {
        console.log('Total IPOs loaded:', ipos.length);
        console.log('IPO dates:', ipos.map(ipo => ({
            name: ipo.ipo_name,
            open: ipo.open_date,
            close: ipo.close_date,
            listing: ipo.listing_date
        })));

        const now = new Date();
        let startDate: Date | null = null;
        let endDate: Date = now;

        if (selectedDateRange === 'all') {
            // Skip date filtering
            console.log('Date range: All Time (no filter)');
        } else if (selectedDateRange === 'custom' && customStartDate && customEndDate) {
            startDate = new Date(customStartDate);
            endDate = new Date(customEndDate);
            console.log('Date range:', startDate.toISOString(), 'to', endDate.toISOString());
        } else {
            let daysBack = 30;
            if (selectedDateRange === '7d') daysBack = 7;
            else if (selectedDateRange === '3m') daysBack = 90;
            else if (selectedDateRange === '6m') daysBack = 180;
            else if (selectedDateRange === '1y') daysBack = 365;
            startDate = new Date(now.getTime() - daysBack * 24 * 60 * 60 * 1000);
            console.log('Date range:', startDate.toISOString(), 'to', endDate.toISOString());
        }

        const result = ipos.filter(ipo => {
            // Date filter - skip if 'all' selected or no date available
            if (startDate !== null) {
                const relevantDate = ipo.listing_date || ipo.close_date || ipo.open_date;
                if (relevantDate) {
                    const ipoDate = new Date(relevantDate);
                    const inRange = ipoDate >= startDate && ipoDate <= endDate;
                    console.log(`${ipo.ipo_name}: ${relevantDate} -> ${inRange ? 'PASS' : 'FILTERED OUT'}`);
                    if (!inRange) return false;
                }
            }

            // Category filter
            if (selectedCategory !== 'all' && ipo.category !== selectedCategory) return false;

            // Status filter
            if (selectedStatus !== 'all' && getIPOStatus(ipo) !== selectedStatus) return false;

            return true;
        });

        console.log('Filtered IPOs:', result.length);
        return result;
    }, [ipos, selectedDateRange, customStartDate, customEndDate, selectedCategory, selectedStatus]);

    // Calculate box sizes (treemap-style)
    const boxData = useMemo(() => {
        if (filteredIpos.length === 0) return [];

        const values = filteredIpos.map(ipo => ({
            ipo,
            value: Math.abs(getMetricValue(ipo)),
            displayValue: getMetricDisplay(ipo),
        }));

        values.sort((a, b) => b.value - a.value);
        const maxValue = Math.max(...values.map(v => v.value), 1);

        return values.map(item => ({
            ...item,
            size: Math.max(1, Math.ceil((item.value / maxValue) * 5)),
        }));
    }, [filteredIpos, selectedMetric]);

    // Get color based on metric value
    const getBoxColor = (ipo: IPOData): string => {
        const value = getMetricValue(ipo);

        if (selectedMetric === 'gmpPercent' || selectedMetric === 'listingGain') {
            if (value < 0) return '#ef4444';
            if (value < 10) return '#f59e0b';
            if (value < 30) return '#eab308';
            return '#22c55e';
        }

        if (selectedMetric.includes('Sub')) {
            if (value < 1) return '#ef4444';
            if (value < 3) return '#f59e0b';
            if (value < 5) return '#eab308';
            return '#22c55e';
        }

        if (selectedMetric === 'ipoSize') {
            if (value < 50) return '#ef4444';
            if (value < 200) return '#f59e0b';
            if (value < 500) return '#eab308';
            return '#22c55e';
        }

        if (selectedMetric === 'priceBand') {
            if (value < 100) return '#ef4444';
            if (value < 300) return '#f59e0b';
            if (value < 500) return '#eab308';
            return '#22c55e';
        }

        const normalized = Math.min(value / 500, 1);
        const hue = 200 + normalized * 60;
        return `hsl(${hue}, 70%, 45%)`;
    };

    const legendLabels = getLegendLabels(selectedMetric);

    if (loading) {
        return (
            <div className={styles.container}>
                <div className={styles.loading}>Loading heatmap data...</div>
            </div>
        );
    }

    return (
        <div className={styles.container}>
            {/* Filter Controls */}
            <div className={styles.filterRow}>
                <div className={styles.filterGroup}>
                    <label className={styles.filterLabel}>Date Range</label>
                    <select
                        value={selectedDateRange}
                        onChange={(e) => setSelectedDateRange(e.target.value as DateRangeType)}
                        className={styles.filterSelect}
                    >
                        {dateRangeOptions.map(opt => (
                            <option key={opt.value} value={opt.value}>{opt.label}</option>
                        ))}
                    </select>
                </div>

                {selectedDateRange === 'custom' && (
                    <>
                        <div className={styles.filterGroup}>
                            <label className={styles.filterLabel}>From</label>
                            <input
                                type="date"
                                value={customStartDate}
                                onChange={(e) => setCustomStartDate(e.target.value)}
                                className={styles.filterSelect}
                            />
                        </div>
                        <div className={styles.filterGroup}>
                            <label className={styles.filterLabel}>To</label>
                            <input
                                type="date"
                                value={customEndDate}
                                onChange={(e) => setCustomEndDate(e.target.value)}
                                className={styles.filterSelect}
                            />
                        </div>
                    </>
                )}

                <div className={styles.filterGroup}>
                    <label className={styles.filterLabel}>Category</label>
                    <select
                        value={selectedCategory}
                        onChange={(e) => setSelectedCategory(e.target.value as CategoryType)}
                        className={styles.filterSelect}
                    >
                        {categoryOptions.map(opt => (
                            <option key={opt.value} value={opt.value}>{opt.label}</option>
                        ))}
                    </select>
                </div>

                <div className={styles.filterGroup}>
                    <label className={styles.filterLabel}>Status</label>
                    <select
                        value={selectedStatus}
                        onChange={(e) => setSelectedStatus(e.target.value as StatusType)}
                        className={styles.filterSelect}
                    >
                        {statusOptions.map(opt => (
                            <option key={opt.value} value={opt.value}>{opt.label}</option>
                        ))}
                    </select>
                </div>

                <div className={styles.filterGroup}>
                    <label className={styles.filterLabel}>Metric</label>
                    <select
                        value={selectedMetric}
                        onChange={(e) => setSelectedMetric(e.target.value as MetricType)}
                        className={styles.filterSelect}
                    >
                        {metricOptions.map(opt => (
                            <option key={opt.value} value={opt.value}>{opt.label}</option>
                        ))}
                    </select>
                </div>
            </div>

            {/* Dynamic Legend */}
            <div className={styles.legend}>
                <div className={styles.legendItem}>
                    <div className={styles.legendBox} style={{ backgroundColor: '#ef4444' }} />
                    <span>{legendLabels[0]}</span>
                </div>
                <div className={styles.legendItem}>
                    <div className={styles.legendBox} style={{ backgroundColor: '#f59e0b' }} />
                    <span>{legendLabels[1]}</span>
                </div>
                <div className={styles.legendItem}>
                    <div className={styles.legendBox} style={{ backgroundColor: '#eab308' }} />
                    <span>{legendLabels[2]}</span>
                </div>
                <div className={styles.legendItem}>
                    <div className={styles.legendBox} style={{ backgroundColor: '#22c55e' }} />
                    <span>{legendLabels[3]}</span>
                </div>
            </div>

            {/* Treemap Grid */}
            {boxData.length > 0 ? (
                <div className={styles.treemap}>
                    {boxData.map(({ ipo, displayValue, size }) => (
                        <Link
                            key={ipo.id}
                            href={`/ipo/${ipo.slug}`}
                            className={`${styles.heatBox} ${styles[`size${size}`]}`}
                            style={{
                                backgroundColor: getBoxColor(ipo),
                            }}
                            title={`${ipo.company_name || ipo.ipo_name}: ${displayValue}`}
                        >
                            <div className={styles.boxContent}>
                                <span className={styles.companyName}>
                                    {ipo.company_name || ipo.ipo_name}
                                </span>
                                <span className={styles.metricValue}>{displayValue}</span>
                                <span className={styles.categoryBadge}>{ipo.category}</span>
                            </div>
                        </Link>
                    ))}
                </div>
            ) : (
                <div className={styles.empty}>
                    <p>No IPOs match the selected filters</p>
                </div>
            )}
        </div>
    );
}
</file>

<file path="frontend/lib/api.ts">
// frontend/lib/api.ts
import { supabase } from './supabase';

// ============================================
// EXISTING FUNCTIONS (Keep these as they are)
// ============================================

export async function fetchUpcomingIPOs() {
    const { data, error } = await supabase
        .from('ipos')
        .select('*')
        .eq('status', 'upcoming')
        .order('open_date', { ascending: true });

    if (error) {
        console.error('Error fetching upcoming IPOs:', error);
        return [];
    }
    return data || [];
}

export async function fetchGMPData() {
    const { data, error } = await supabase
        .from('ipos')
        .select('*')
        .in('status', ['open', 'upcoming', 'closed'])
        .order('listing_date', { ascending: true });

    if (error) {
        console.error('Error fetching GMP data:', error);
        return [];
    }
    return data || [];
}

export async function fetchAllotmentLinks() {
    const { data, error } = await supabase
        .from('ipo_allotment_links')
        .select('*')
        .eq('is_active', true)
        .order('id', { ascending: false });

    if (error) {
        console.error('Error fetching allotment links:', error);
        return [];
    }
    return data || [];
}

export async function fetchShareholderData() {
    // Query from ipos table since shareholder_intel table doesn't exist
    // This returns parent company and regulatory filing data
    const { data, error } = await supabase
        .from('ipos')
        .select('id, ipo_name, parent_company, category, drhp_status, rhp_status, issue_size_cr')
        .in('status', ['upcoming', 'open', 'closed', 'listed'])
        .order('id', { ascending: false });

    if (error) {
        console.error('Error fetching shareholder data:', error);
        return [];
    }
    return data || [];
}

// ============================================
// NEW FUNCTIONS FOR HOMEPAGE REDESIGN
// ============================================

export async function fetchCombinedIPOData() {
    const { data, error } = await supabase
        .from('ipos')
        .select('*')
        .in('status', ['upcoming', 'open', 'closed'])
        .order('open_date', { ascending: true });

    if (error) {
        console.error('Error fetching combined IPO data:', error);
        return [];
    }
    return data || [];
}

export async function fetchFeaturedIPOs() {
    const { data, error } = await supabase
        .from('ipos')
        .select('*')
        .eq('is_featured', true)
        .in('status', ['open', 'upcoming'])
        .order('trending_score', { ascending: false })
        .limit(3);

    if (error) {
        console.error('Error fetching featured IPOs:', error);
        return [];
    }
    return data || [];
}

export async function fetchMarketSentiment() {
    const { data, error } = await supabase
        .from('market_sentiment')
        .select('*')
        .order('date', { ascending: false })
        .limit(1)
        .single();

    if (error) {
        console.error('Error fetching market sentiment:', error);
        return null;
    }
    return data;
}

export async function fetchOpenIPOs() {
    const { data, error } = await supabase
        .from('ipos')
        .select('*')
        .eq('status', 'open')
        .order('close_date', { ascending: true });

    if (error) {
        console.error('Error fetching open IPOs:', error);
        return [];
    }
    return data || [];
}

export async function fetchClosingSoonIPOs() {
    const today = new Date().toISOString().split('T')[0];
    const twoDaysLater = new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];

    const { data, error } = await supabase
        .from('ipos')
        .select('*')
        .eq('status', 'open')
        .lte('close_date', twoDaysLater)
        .gte('close_date', today)
        .order('close_date', { ascending: true });

    if (error) {
        console.error('Error fetching closing soon IPOs:', error);
        return [];
    }
    return data || [];
}

export async function fetchRecentlyListedIPOs() {
    const thirtyDaysAgo = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];

    const { data, error } = await supabase
        .from('ipos')
        .select('*')
        .eq('status', 'listed')
        .gte('listing_date', thirtyDaysAgo)
        .order('listing_date', { ascending: false })
        .limit(10);

    if (error) {
        console.error('Error fetching recently listed IPOs:', error);
        return [];
    }
    return data || [];
}

export async function fetchUpcomingThisWeek() {
    const today = new Date().toISOString().split('T')[0];
    const nextWeek = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];

    const { data, error } = await supabase
        .from('ipos')
        .select('*')
        .eq('status', 'upcoming')
        .gte('open_date', today)
        .lte('open_date', nextWeek)
        .order('open_date', { ascending: true });

    if (error) {
        console.error('Error fetching upcoming IPOs this week:', error);
        return [];
    }
    return data || [];
}

export async function fetchCalendarEvents(year: number, month: number) {
    const startDate = new Date(year, month - 1, 1).toISOString().split('T')[0];
    const endDate = new Date(year, month, 0).toISOString().split('T')[0];

    const { data, error } = await supabase
        .from('ipo_calendar_events')
        .select(`
            *,
            ipos (
                ipo_name,
                company_name,
                category,
                slug
            )
        `)
        .gte('event_date', startDate)
        .lte('event_date', endDate)
        .order('event_date', { ascending: true });

    if (error) {
        console.error('Error fetching calendar events:', error);
        return [];
    }
    return data || [];
}

export async function fetchAllIPOsForComparison(category: string = 'all') {
    let query = supabase
        .from('ipos')
        .select('*')
        .in('status', ['open', 'upcoming', 'closed']);

    if (category !== 'all') {
        query = query.eq('category', category);
    }

    const { data, error } = await query.order('open_date', { ascending: false });

    if (error) {
        console.error('Error fetching IPOs for comparison:', error);
        return [];
    }
    return data || [];
}

// Calculate allotment probability
export function calculateAllotmentProbability(
    category: 'retail' | 'sNII' | 'bNII',
    subscription: number,
    lots: number
): number {
    if (subscription <= 1) return 100;

    if (category === 'retail') {
        if (subscription < 2) return 95;
        if (subscription < 5) return 60;
        if (subscription < 10) return 30;
        if (subscription < 20) return 15;
        return Math.max(5, 100 / subscription);
    }

    const baseProb = Math.min(100, (100 / subscription) * lots);

    if (category === 'sNII') {
        return Math.max(10, baseProb * 1.2);
    }

    return Math.max(5, baseProb * 0.8);
}

// Calculate expected returns
export function calculateExpectedReturns(
    investment: number,
    gmp: number,
    issuePrice: number,
    lotSize: number,
    category: 'retail' | 'sNII' | 'bNII',
    subscription: number
) {
    const numLots = Math.floor(investment / (issuePrice * lotSize));
    const numShares = numLots * lotSize;
    const totalInvestment = numShares * issuePrice;

    const expectedListingPrice = issuePrice + gmp;
    const profitPerShare = gmp;
    const totalProfit = profitPerShare * numShares;
    const profitPercentage = (profitPerShare / issuePrice) * 100;

    const allotmentProb = calculateAllotmentProbability(category, subscription, numLots);
    const expectedProfit = (totalProfit * allotmentProb) / 100;

    return {
        numLots,
        numShares,
        totalInvestment,
        expectedListingPrice,
        profitPerShare,
        totalProfit,
        profitPercentage,
        allotmentProb,
        expectedProfit,
        recommendation: getRecommendation(profitPercentage, allotmentProb, subscription)
    };
}

function getRecommendation(profitPercentage: number, allotmentProb: number, subscription: number) {
    if (profitPercentage > 30 && allotmentProb > 50) {
        return { text: 'Strong Buy', color: '#22c55e', icon: 'üöÄ' };
    }
    if (profitPercentage > 15 && allotmentProb > 30) {
        return { text: 'Buy', color: '#4ade80', icon: '‚úÖ' };
    }
    if (profitPercentage > 0 && subscription < 10) {
        return { text: 'Consider', color: '#facc15', icon: '‚ö†Ô∏è' };
    }
    if (profitPercentage < 0) {
        return { text: 'Avoid', color: '#ef4444', icon: '‚ùå' };
    }
    return { text: 'Neutral', color: '#9ca3af', icon: '‚ûñ' };
}

// ============================================
// REAL-TIME SUBSCRIPTIONS
// ============================================

export function subscribeToIPOUpdates(callback: (payload: any) => void) {
    const subscription = supabase
        .channel('ipos-changes')
        .on(
            'postgres_changes',
            {
                event: '*',
                schema: 'public',
                table: 'ipos'
            },
            (payload) => {
                console.log('IPO table changed:', payload);
                callback(payload);
            }
        )
        .subscribe();

    return subscription;
}
</file>

<file path="frontend/repomix-output.xml">
This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
app/allotment/page.module.css
app/allotment/page.tsx
app/favicon.ico
app/globals.css
app/gmp/GMPModal.module.css
app/gmp/GMPModal.tsx
app/gmp/page.module.css
app/gmp/page.tsx
app/ipo/[slug]/IPOSchema.tsx
app/ipo/[slug]/layout.tsx
app/ipo/[slug]/page.module.css
app/ipo/[slug]/page.tsx
app/layout.tsx
app/page.module.css
app/page.tsx
app/shareholders/page.module.css
app/shareholders/page.tsx
app/upcoming-ipos/page.module.css
app/upcoming-ipos/page.tsx
components/GoldCard.tsx
components/homepage/ComparisonTable.module.css
components/homepage/ComparisonTable.tsx
components/homepage/DashboardTabs.module.css
components/homepage/DashboardTabs.tsx
components/homepage/FeaturedIPOCard.module.css
components/homepage/FeaturedIPOCard.tsx
components/homepage/IPOAnalysisTile.module.css
components/homepage/IPOAnalysisTile.tsx
components/homepage/IPOCalendarWidget.module.css
components/homepage/IPOCalendarWidget.tsx
components/homepage/IPOCategoryChart.module.css
components/homepage/IPOCategoryChart.tsx
components/homepage/IPOFilters.module.css
components/homepage/IPOFilters.tsx
components/homepage/MarketSentimentGauge.module.css
components/homepage/MarketSentimentGauge.tsx
components/homepage/QuickActionButtons.module.css
components/homepage/QuickActionButtons.tsx
components/homepage/ShouldIApplyCalculator.module.css
components/homepage/ShouldIApplyCalculator.tsx
components/homepage/SubscriptionHeatmap.module.css
components/homepage/SubscriptionHeatmap.tsx
components/IPOCard.module.css
components/IPOCard.tsx
components/IPOModal.module.css
components/IPOModal.tsx
components/Navbar.tsx
components/Navigation.module.css
components/Navigation.tsx
eslint.config.mjs
lib/api.ts
lib/supabase.ts
lib/utils.ts
next-env.d.ts
next.config.js
next.config.ts
package.json
postcss.config.mjs
public/file.svg
public/globe.svg
public/next.svg
public/vercel.svg
public/window.svg
README.md
scripts/seed-data.sql
tsconfig.json
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="app/allotment/page.module.css">
.sectionHeader {
    margin-bottom: 3rem;
    animation: slideUp 0.6s ease-out;
}

.sectionTitle {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.75rem;
    color: var(--color-text-primary);
    letter-spacing: -0.02em;
}

.sectionSubtitle {
    font-size: 1.125rem;
    color: var(--color-text-secondary);
    font-weight: 400;
}

.allotmentGrid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 1.5rem;
    animation: fadeIn 0.8s ease-out 0.3s both;
}

.allotmentCard {
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: 1.75rem;
    transition: var(--transition-slow);
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    box-shadow: var(--shadow-card);
}

.allotmentCard:hover {
    transform: translateY(-4px);
    border-color: rgba(79, 70, 229, 0.2);
    box-shadow: var(--shadow-card-hover);
}

.cardHeader {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.titleRow {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 1rem;
}

.companyName {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--color-text-primary);
    flex: 1;
}

.categoryBadge {
    padding: 0.375rem 0.875rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    white-space: nowrap;
}

.smeBadge {
    background-color: var(--color-info-light);
    color: #1d4ed8;
}

.mainboardBadge {
    background-color: #f3e8ff;
    color: #7c3aed;
}

.statusBadge {
    padding: 0.5rem 1rem;
    border-radius: 9999px;
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    display: inline-block;
    width: fit-content;
}

.statusOut {
    background-color: var(--color-success-light);
    color: #047857;
}

.statusPending {
    background-color: var(--color-warning-light);
    color: #b45309;
}

.cardBody {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    padding: 1rem 0;
    border-top: 1px solid var(--color-border-light);
    border-bottom: 1px solid var(--color-border-light);
}

.infoRow {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.label {
    font-size: 0.9375rem;
    color: var(--color-text-secondary);
    font-weight: 500;
}

.value {
    font-size: 0.9375rem;
    color: var(--color-primary);
    font-weight: 600;
}

.checkButton {
    background: var(--gradient-primary);
    color: #ffffff;
    padding: 1rem 1.5rem;
    border-radius: var(--radius-md);
    font-weight: 600;
    font-size: 0.9375rem;
    text-align: center;
    text-decoration: none;
    transition: var(--transition-base);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    box-shadow: 0 4px 12px rgba(79, 70, 229, 0.25);
}

.checkButton:hover {
    box-shadow: 0 6px 20px rgba(79, 70, 229, 0.35);
    transform: translateY(-2px);
}

.externalIcon {
    font-size: 1.125rem;
    transition: transform 0.3s ease;
}

.checkButton:hover .externalIcon {
    transform: translate(2px, -2px);
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

@media (max-width: 768px) {
    .sectionTitle {
        font-size: 1.875rem;
    }

    .allotmentGrid {
        grid-template-columns: 1fr;
    }

    .companyName {
        font-size: 1.125rem;
    }
}
</file>

<file path="app/allotment/page.tsx">
'use client';

import { useEffect, useState } from 'react';
import styles from './page.module.css';
import { fetchAllotmentLinks } from '@/lib/api';

interface AllotmentData {
    id: number;
    ipo_name: string;
    registrar: string;
    link_url: string;
    allotment_date: string | null;
    status: string | null;
    category: string | null;
}

export default function CheckAllotment() {
    const [allotmentData, setAllotmentData] = useState<AllotmentData[]>([]);
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        const loadData = async () => {
            try {
                const data = await fetchAllotmentLinks();
                setAllotmentData(data);
            } catch (error) {
                console.error('Failed to load allotment data:', error);
            } finally {
                setLoading(false);
            }
        };

        loadData();
    }, []);

    const formatDate = (dateString: string | null) => {
        if (!dateString) return 'TBD';
        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    };

    if (loading) {
        return (
            <div className={styles.sectionHeader}>
                <h1 className={styles.sectionTitle}>Check IPO Allotment</h1>
                <p className={styles.sectionSubtitle}>Loading...</p>
            </div>
        );
    }

    return (
        <>
            <div className={styles.sectionHeader}>
                <h1 className={styles.sectionTitle}>Check IPO Allotment</h1>
                <p className={styles.sectionSubtitle}>
                    Check your IPO allotment status directly from registrar websites
                </p>
            </div>

            <div className={styles.allotmentGrid}>
                {allotmentData.map((ipo) => (
                    <div key={ipo.id} className={styles.allotmentCard}>
                        <div className={styles.cardHeader}>
                            <div className={styles.titleRow}>
                                <h3 className={styles.companyName}>{ipo.ipo_name}</h3>
                                {ipo.category && (
                                    <span className={`${styles.categoryBadge} ${ipo.category === 'SME' ? styles.smeBadge : styles.mainboardBadge}`}>
                                        {ipo.category}
                                    </span>
                                )}
                            </div>
                            {ipo.status && (
                                <span className={`${styles.statusBadge} ${ipo.status === 'Allotment Out' ? styles.statusOut : styles.statusPending}`}>
                                    {ipo.status}
                                </span>
                            )}
                        </div>

                        <div className={styles.cardBody}>
                            <div className={styles.infoRow}>
                                <span className={styles.label}>Registrar:</span>
                                <span className={styles.value}>{ipo.registrar}</span>
                            </div>
                            <div className={styles.infoRow}>
                                <span className={styles.label}>Allotment Date:</span>
                                <span className={styles.value}>{formatDate(ipo.allotment_date)}</span>
                            </div>
                        </div>

                        <a
                            href={ipo.link_url}
                            target="_blank"
                            rel="noopener noreferrer"
                            className={styles.checkButton}
                        >
                            Check Allotment Status
                            <span className={styles.externalIcon}>‚Üó</span>
                        </a>
                    </div>
                ))}
            </div>

            {allotmentData.length === 0 && (
                <div className={styles.emptyState}>
                    <p>No allotment links available at the moment.</p>
                </div>
            )}
        </>
    );
}
</file>

<file path="app/globals.css">
/* Google Fonts Import */
@import url('https://fonts.googleapis.com/css2?family=Archivo+Black&family=Inter:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap');

* {
  box-sizing: border-box;
  padding: 0;
  margin: 0;
}

:root {
  /* Elegant Theme Color Palette */
  --beige: #e8e5d6;
  --beige-dark: #d0cbb8;
  --teal-dark: #1a3a3a;
  --teal-mid: #2d4a4a;
  --teal-light: #2d5555;
  --accent-green: #22c55e;
  --accent-blue: #3b82f6;

  /* Core Colors (mapped to elegant theme) */
  --yellow: #e8e5d6;
  --red: #FF3B30;
  --blue: #007AFF;
  --black: #1a3a3a;
  --white: #FFFFFF;
  --gray: #e8e5d6;
  --dark-bg: #e8e5d6;

  /* Semantic Colors */
  --color-primary: var(--yellow);
  --color-accent: var(--red);
  --color-positive: var(--blue);
  --color-negative: var(--red);

  /* Text Colors */
  --color-text-primary: var(--black);
  --color-text-secondary: #333333;
  --color-text-muted: #666666;

  /* Background Colors */
  --color-bg-primary: var(--white);
  --color-bg-secondary: var(--gray);
  --color-bg-tertiary: #EBEBEB;
  --color-bg-card: #f5f5eb;

  /* Border Colors */
  --color-border: var(--black);
  --color-border-light: #CCCCCC;

  /* Status Colors */
  --color-success: #10b981;
  --color-success-light: #d1fae5;
  --color-warning: #f59e0b;
  --color-warning-light: #fef3c7;
  --color-error: var(--red);
  --color-error-light: #fee2e2;
  --color-info: var(--blue);
  --color-info-light: #dbeafe;

  /* Spacing */
  --spacing-xs: 0.5rem;
  --spacing-sm: 1rem;
  --spacing-md: 1.5rem;
  --spacing-lg: 2rem;
  --spacing-xl: 3rem;

  /* Border Radius - Brutalist is sharp */
  --radius-sm: 0;
  --radius-md: 0;
  --radius-lg: 0;
  --radius-xl: 0;

  /* Brutalist Shadows - Hard offset shadows */
  --shadow-xs: 2px 2px 0 var(--black);
  --shadow-sm: 3px 3px 0 var(--black);
  --shadow-md: 4px 4px 0 var(--black);
  --shadow-lg: 6px 6px 0 var(--black);
  --shadow-xl: 8px 8px 0 var(--black);
  --shadow-card: 4px 4px 0 var(--black);
  --shadow-card-hover: 6px 6px 0 var(--black);

  /* Transitions */
  --transition-fast: all 0.1s ease;
  --transition-base: all 0.15s ease;
  --transition-slow: all 0.2s ease;

  /* Typography */
  --font-heading: 'Archivo Black', sans-serif;
  --font-body: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  --font-mono: 'Space Mono', monospace;
}

html,
body {
  max-width: 100vw;
  overflow-x: hidden;
  font-family: var(--font-body);
  color: var(--color-text-primary);
  background: var(--color-bg-secondary);
  line-height: 1.6;
  font-size: 15px;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

a {
  color: inherit;
  text-decoration: none;
  transition: var(--transition-base);
}

a:hover {
  color: var(--color-text-primary);
}

button {
  cursor: pointer;
  border: none;
  outline: none;
  font-family: var(--font-body);
  transition: var(--transition-base);
}

button:focus-visible {
  outline: 3px solid var(--yellow);
  outline-offset: 2px;
}

h1,
h2,
h3,
h4,
h5,
h6 {
  font-family: var(--font-heading);
  font-weight: 400;
  line-height: 1.1;
  color: var(--color-text-primary);
  text-transform: uppercase;
  letter-spacing: -0.02em;
}

/* Container */
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 var(--spacing-md);
}

/* Utility Classes */
.text-muted {
  color: var(--color-text-muted);
}

.text-secondary {
  color: var(--color-text-secondary);
}

/* Brutalist Card Styles */
.card {
  background: var(--color-bg-card);
  border: 4px solid var(--black);
  padding: var(--spacing-md);
  box-shadow: var(--shadow-card);
  transition: var(--transition-slow);
  position: relative;
}

.card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 8px;
  background: var(--yellow);
}

.card:hover {
  box-shadow: var(--shadow-card-hover);
  transform: rotate(1deg) translateY(-4px);
}

/* Badge Styles - Brutalist */
.badge {
  display: inline-flex;
  align-items: center;
  padding: 0.5rem 1rem;
  font-size: 0.75rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  font-family: var(--font-body);
  border: 2px solid var(--black);
}

.badge-success {
  background-color: var(--black);
  color: var(--yellow);
}

.badge-warning {
  background-color: var(--yellow);
  color: var(--black);
}

.badge-info {
  background-color: var(--blue);
  color: var(--white);
}

.badge-error,
.badge-live {
  background-color: var(--red);
  color: var(--white);
  animation: pulse-live 1.5s ease-in-out infinite;
}

/* Brutalist Button Styles */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 0.875rem 1.75rem;
  font-weight: 700;
  font-size: 0.9375rem;
  text-align: center;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  transition: var(--transition-base);
  border: 3px solid var(--black);
  font-family: var(--font-body);
}

.btn-primary {
  background: var(--black);
  color: var(--yellow);
}

.btn-primary:hover {
  background: var(--yellow);
  color: var(--black);
  transform: rotate(-2deg);
  box-shadow: var(--shadow-md);
}

.btn-secondary {
  background-color: var(--white);
  color: var(--black);
}

.btn-secondary:hover {
  background-color: var(--yellow);
  transform: rotate(-2deg);
}

.btn-outline {
  background-color: transparent;
  border: 3px solid var(--black);
  color: var(--black);
}

.btn-outline:hover {
  background: var(--black);
  color: var(--yellow);
}

/* Animations */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(8px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(16px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes pulse-live {

  0%,
  100% {
    transform: scale(1);
    box-shadow: 0 0 0 0 rgba(255, 59, 48, 0.4);
  }

  50% {
    transform: scale(1.05);
    box-shadow: 0 0 0 8px rgba(255, 59, 48, 0);
  }
}

@keyframes rotate-shake {

  0%,
  100% {
    transform: rotate(-1deg);
  }

  50% {
    transform: rotate(1deg);
  }
}

.fade-in {
  animation: fadeIn 0.4s ease forwards;
}

.slide-up {
  animation: slideUp 0.5s ease forwards;
}

/* Focus states for accessibility */
*:focus-visible {
  outline: 3px solid var(--yellow);
  outline-offset: 2px;
}

/* Selection styling */
::selection {
  background-color: var(--yellow);
  color: var(--black);
}

/* Scrollbar styling - Brutalist */
::-webkit-scrollbar {
  width: 12px;
  height: 12px;
}

::-webkit-scrollbar-track {
  background: var(--gray);
  border: 2px solid var(--black);
}

::-webkit-scrollbar-thumb {
  background: var(--black);
}

::-webkit-scrollbar-thumb:hover {
  background: var(--color-text-secondary);
}
</file>

<file path="app/gmp/GMPModal.module.css">
.modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    z-index: 2000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    overflow-y: auto;
    animation: fadeIn 0.3s ease-out;
}

.modalContent {
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    padding: 2.5rem;
    max-width: 1200px;
    width: 100%;
    position: relative;
    animation: slideUp 0.4s ease-out;
    box-shadow: var(--shadow-xl);
    max-height: 90vh;
    overflow-y: auto;
}

.modalClose {
    position: absolute;
    top: 1.5rem;
    right: 1.5rem;
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    color: var(--color-text-secondary);
    font-size: 1.25rem;
    cursor: pointer;
    transition: var(--transition-base);
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    line-height: 1;
}

.modalClose:hover {
    background: var(--color-bg-tertiary);
    color: var(--color-primary);
    transform: rotate(90deg);
}

.modalTitle {
    font-size: 1.75rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    color: var(--color-text-primary);
    padding-right: 3rem;
}

.modalSubtitle {
    font-size: 1rem;
    color: var(--color-primary);
    margin-bottom: 2rem;
    font-weight: 500;
}

.dayWiseSection {
    margin-bottom: 2rem;
}

.overallSection {
    margin-bottom: 2rem;
}

.dayWiseTable {
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    overflow-x: auto;
}

.subscriptionTable {
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    overflow: hidden;
}

.table {
    width: 100%;
    border-collapse: collapse;
}

.table thead {
    background: linear-gradient(180deg, var(--color-bg-secondary) 0%, var(--color-bg-tertiary) 100%);
}

.table th {
    padding: 1rem;
    text-align: left;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    font-size: 0.8125rem;
    color: var(--color-text-secondary);
    border-bottom: 1px solid var(--color-border);
    white-space: nowrap;
}

.table td {
    padding: 0.875rem 1rem;
    border-bottom: 1px solid var(--color-border-light);
    color: var(--color-text-secondary);
}

.table tbody tr {
    transition: background 0.2s ease;
}

.table tbody tr:hover {
    background-color: rgba(79, 70, 229, 0.02);
}

.latestDay {
    background: rgba(79, 70, 229, 0.04) !important;
    border-left: 3px solid var(--color-primary);
}

.dateCell {
    font-weight: 500;
}

.dateInfo {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
}

.date {
    font-size: 0.9375rem;
    color: var(--color-text-primary);
}

.dayLabel {
    font-size: 0.75rem;
    color: var(--color-primary);
    font-weight: 600;
    text-transform: uppercase;
}

.highlightRetail {
    color: var(--color-success) !important;
    font-weight: 700 !important;
}

.highlightTotal {
    color: var(--color-primary) !important;
    font-weight: 700 !important;
    font-size: 1rem !important;
}

.subCategory td {
    font-size: 0.875rem;
    color: var(--color-text-secondary);
}

.subscriptionValue {
    font-weight: 600;
    color: var(--color-primary) !important;
    text-align: right;
}

.totalRow {
    background: rgba(79, 70, 229, 0.04);
    border-top: 2px solid rgba(79, 70, 229, 0.2);
}

.totalRow td {
    padding: 1rem;
    font-size: 1rem;
}

.calculationsSection {
    margin-top: 2rem;
}

.sectionTitle {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--color-text-primary);
    margin-bottom: 1.25rem;
}

.calculationGrid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
}

.calculationCard {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border-light);
    border-radius: var(--radius-md);
    padding: 1.5rem;
}

.categoryLabel {
    font-size: 1rem;
    font-weight: 600;
    color: var(--color-primary);
    margin-bottom: 1rem;
}

.calcRow {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 0;
    border-bottom: 1px solid var(--color-border-light);
}

.calcRow:last-child {
    border-bottom: none;
}

.finalRow {
    margin-top: 0.5rem;
    padding-top: 0.875rem;
    border-top: 2px solid var(--color-border);
}

.calcLabel {
    font-size: 0.9375rem;
    color: var(--color-text-secondary);
}

.calcValue {
    font-size: 0.9375rem;
    font-weight: 600;
    color: var(--color-text-primary);
}

.profit {
    color: var(--color-success) !important;
}

.loss {
    color: var(--color-error) !important;
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(24px) scale(0.98);
    }

    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

@media (max-width: 768px) {
    .modal {
        padding: 1rem;
    }

    .modalContent {
        padding: 1.5rem;
        max-height: 95vh;
    }

    .modalTitle {
        font-size: 1.5rem;
    }

    .table th,
    .table td {
        padding: 0.75rem 0.5rem;
        font-size: 0.8125rem;
    }

    .calculationGrid {
        grid-template-columns: 1fr;
    }

    .calculationCard {
        padding: 1.25rem;
    }

    .modalClose {
        top: 1rem;
        right: 1rem;
    }

    .dayWiseTable {
        overflow-x: scroll;
    }
}
</file>

<file path="app/gmp/GMPModal.tsx">
'use client';

import { useEffect } from 'react';
import styles from './GMPModal.module.css';

interface DayWiseData {
    date: string;
    day: number;
    qibExAnchor?: number;
    nii?: number;
    bNII?: number;
    sNII?: number;
    retail?: number;
    total?: number;
}

interface SubscriptionData {
    anchorInvestors?: number;
    qibExAnchor?: number;
    nonInstitutional?: number;
    bNII?: number;
    sNII?: number;
    retail?: number;
    employee?: number;
    shareholder?: number;
    total?: number;
    dayWise?: DayWiseData[];
}

interface IPOData {
    id: number;
    companyName: string;
    category: string;
    gmp: number;
    percentage: number;
    issuePrice: string;
    expectedListing: string;
    lotSize: string;
    listingDate: string;
    subscription?: SubscriptionData;
}

interface GMPModalProps {
    ipo: IPOData;
    onClose: () => void;
}

export default function GMPModal({ ipo, onClose }: GMPModalProps) {
    useEffect(() => {
        document.body.style.overflow = 'hidden';
        return () => {
            document.body.style.overflow = 'unset';
        };
    }, []);

    const handleBackdropClick = (e: React.MouseEvent) => {
        if (e.target === e.currentTarget) {
            onClose();
        }
    };

    // Extract numeric values
    const issuePrice = parseInt(ipo.issuePrice.replace(/[^0-9]/g, ''));
    const lotSizeNum = parseInt(ipo.lotSize.split(' ')[0]);

    // Calculate lot values and profits
    const retailLotValue = issuePrice * lotSizeNum;
    const sNIILotValue = issuePrice * lotSizeNum;
    const bNIILotValue = issuePrice * lotSizeNum;

    const retailProfit = ipo.gmp * lotSizeNum;
    const sNIIProfit = ipo.gmp * lotSizeNum;
    const bNIIProfit = ipo.gmp * lotSizeNum;

    const retailFinal = retailLotValue + retailProfit;
    const sNIIFinal = sNIILotValue + sNIIProfit;
    const bNIIFinal = bNIILotValue + bNIIProfit;

    const subscription = ipo.subscription || {
        retail: 0,
        total: 0
    };

    return (
        <div className={styles.modal} onClick={handleBackdropClick}>
            <div className={styles.modalContent}>
                <button className={styles.modalClose} onClick={onClose}>
                    &times;
                </button>

                <h2 className={styles.modalTitle}>{ipo.companyName}</h2>
                <p className={styles.modalSubtitle}>Live Subscription Status</p>

                {/* Day-wise Subscription Table */}
                {subscription.dayWise && subscription.dayWise.length > 0 && (
                    <div className={styles.dayWiseSection}>
                        <h3 className={styles.sectionTitle}>üìà Day-wise Subscription Details</h3>
                        <div className={styles.dayWiseTable}>
                            <table className={styles.table}>
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>QIB (Ex Anchor)</th>
                                        <th>NII</th>
                                        <th>NII (&gt; ‚Çπ10L)</th>
                                        <th>NII (&lt; ‚Çπ10L)</th>
                                        <th>Retail</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {subscription.dayWise.map((day, index) => (
                                        <tr key={index} className={index === subscription.dayWise!.length - 1 ? styles.latestDay : ''}>
                                            <td className={styles.dateCell}>
                                                <div className={styles.dateInfo}>
                                                    <span className={styles.date}>{day.date}</span>
                                                    <span className={styles.dayLabel}>Day {day.day}</span>
                                                </div>
                                            </td>
                                            <td className={styles.subscriptionValue}>{day.qibExAnchor?.toFixed(2) || '-'}</td>
                                            <td className={styles.subscriptionValue}>{day.nii?.toFixed(2) || '-'}</td>
                                            <td className={styles.subscriptionValue}>{day.bNII?.toFixed(2) || '-'}</td>
                                            <td className={styles.subscriptionValue}>{day.sNII?.toFixed(2) || '-'}</td>
                                            <td className={`${styles.subscriptionValue} ${styles.highlightRetail}`}>{day.retail?.toFixed(2) || '-'}</td>
                                            <td className={`${styles.subscriptionValue} ${styles.highlightTotal}`}><strong>{day.total?.toFixed(2) || '-'}</strong></td>
                                        </tr>
                                    ))}
                                    <tr className={styles.totalRow}>
                                        <td><strong>Overall Total</strong></td>
                                        <td className={styles.subscriptionValue}><strong>{subscription.qibExAnchor?.toFixed(2) || '-'}</strong></td>
                                        <td className={styles.subscriptionValue}><strong>{subscription.nonInstitutional?.toFixed(2) || '-'}</strong></td>
                                        <td className={styles.subscriptionValue}><strong>{subscription.bNII?.toFixed(2) || '-'}</strong></td>
                                        <td className={styles.subscriptionValue}><strong>{subscription.sNII?.toFixed(2) || '-'}</strong></td>
                                        <td className={`${styles.subscriptionValue} ${styles.highlightRetail}`}><strong>{subscription.retail?.toFixed(2) || '-'}</strong></td>
                                        <td className={`${styles.subscriptionValue} ${styles.highlightTotal}`}><strong>{subscription.total?.toFixed(2) || '-'}</strong></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                )}

                {/* Profit/Loss Calculations */}
                <div className={styles.calculationsSection}>
                    <h3 className={styles.sectionTitle}>Lot Size & Profit Analysis</h3>

                    <div className={styles.calculationCard}>
                        <h4 className={styles.categoryLabel}>Retail Investors</h4>
                        <div className={styles.calcRow}>
                            <span className={styles.calcLabel}>Lot Size:</span>
                            <span className={styles.calcValue}>{lotSizeNum} shares</span>
                        </div>
                        <div className={styles.calcRow}>
                            <span className={styles.calcLabel}>Number of Lots:</span>
                            <span className={styles.calcValue}>1 lot</span>
                        </div>
                        <div className={styles.calcRow}>
                            <span className={styles.calcLabel}>Lot Value:</span>
                            <span className={styles.calcValue}>‚Çπ{retailLotValue.toLocaleString()}</span>
                        </div>
                        <div className={styles.calcRow}>
                            <span className={styles.calcLabel}>Profit/Loss:</span>
                            <span className={`${styles.calcValue} ${retailProfit >= 0 ? styles.profit : styles.loss}`}>
                                {retailProfit >= 0 ? '+' : ''}‚Çπ{retailProfit.toLocaleString()}
                            </span>
                        </div>
                        <div className={`${styles.calcRow} ${styles.finalRow}`}>
                            <span className={styles.calcLabel}><strong>Final Value:</strong></span>
                            <span className={styles.calcValue}><strong>‚Çπ{retailFinal.toLocaleString()}</strong></span>
                        </div>
                    </div>

                    <div className={styles.calculationCard}>
                        <h4 className={styles.categoryLabel}>sNII (bids below ‚Çπ10L)</h4>
                        <div className={styles.calcRow}>
                            <span className={styles.calcLabel}>Lot Size:</span>
                            <span className={styles.calcValue}>{lotSizeNum} shares</span>
                        </div>
                        <div className={styles.calcRow}>
                            <span className={styles.calcLabel}>Number of Lots:</span>
                            <span className={styles.calcValue}>2 lots</span>
                        </div>
                        <div className={styles.calcRow}>
                            <span className={styles.calcLabel}>Lot Value:</span>
                            <span className={styles.calcValue}>‚Çπ{sNIILotValue.toLocaleString()}</span>
                        </div>
                        <div className={styles.calcRow}>
                            <span className={styles.calcLabel}>Profit/Loss:</span>
                            <span className={`${styles.calcValue} ${sNIIProfit >= 0 ? styles.profit : styles.loss}`}>
                                {sNIIProfit >= 0 ? '+' : ''}‚Çπ{sNIIProfit.toLocaleString()}
                            </span>
                        </div>
                        <div className={`${styles.calcRow} ${styles.finalRow}`}>
                            <span className={styles.calcLabel}><strong>Final Value:</strong></span>
                            <span className={styles.calcValue}><strong>‚Çπ{sNIIFinal.toLocaleString()}</strong></span>
                        </div>
                    </div>

                    <div className={styles.calculationCard}>
                        <h4 className={styles.categoryLabel}>bNII (bids above ‚Çπ10L)</h4>
                        <div className={styles.calcRow}>
                            <span className={styles.calcLabel}>Lot Size:</span>
                            <span className={styles.calcValue}>{lotSizeNum} shares</span>
                        </div>
                        <div className={styles.calcRow}>
                            <span className={styles.calcLabel}>Number of Lots:</span>
                            <span className={styles.calcValue}>2 lots</span>
                        </div>
                        <div className={styles.calcRow}>
                            <span className={styles.calcLabel}>Lot Value:</span>
                            <span className={styles.calcValue}>‚Çπ{bNIILotValue.toLocaleString()}</span>
                        </div>
                        <div className={styles.calcRow}>
                            <span className={styles.calcLabel}>Profit/Loss:</span>
                            <span className={`${styles.calcValue} ${bNIIProfit >= 0 ? styles.profit : styles.loss}`}>
                                {bNIIProfit >= 0 ? '+' : ''}‚Çπ{bNIIProfit.toLocaleString()}
                            </span>
                        </div>
                        <div className={`${styles.calcRow} ${styles.finalRow}`}>
                            <span className={styles.calcLabel}><strong>Final Value:</strong></span>
                            <span className={styles.calcValue}><strong>‚Çπ{bNIIFinal.toLocaleString()}</strong></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    );
}
</file>

<file path="app/gmp/page.module.css">
.sectionHeader {
  margin-bottom: 3rem;
  animation: slideUp 0.6s ease-out;
}

.sectionTitle {
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 0.75rem;
  color: var(--color-text-primary);
  letter-spacing: -0.02em;
}

.sectionSubtitle {
  font-size: 1.125rem;
  color: var(--color-text-secondary);
  font-weight: 400;
}

.categorySection {
  margin-bottom: 4rem;
}

.categoryTitle {
  font-size: 1.5rem;
  font-weight: 600;
  color: var(--color-text-primary);
  margin-bottom: 1.5rem;
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.categoryIcon {
  font-size: 1.75rem;
}

.categoryCount {
  font-size: 1rem;
  color: var(--color-text-secondary);
  font-weight: 400;
}

.gmpGrid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 1.5rem;
  animation: fadeIn 0.8s ease-out 0.3s both;
}

.gmpCard {
  background: var(--color-bg-card);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  padding: 1.75rem;
  transition: var(--transition-slow);
  position: relative;
  overflow: hidden;
  box-shadow: var(--shadow-card);
}

.gmpCard::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: var(--gradient-primary);
  transform: scaleX(0);
  transition: transform 0.3s ease;
}

.gmpCard:hover {
  transform: translateY(-4px);
  border-color: rgba(79, 70, 229, 0.2);
  box-shadow: var(--shadow-card-hover);
}

.gmpCard:hover::before {
  transform: scaleX(1);
}

.gmpHeader {
  margin-bottom: 1.5rem;
  cursor: pointer;
  user-select: none;
}

.headerTop {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 1rem;
  gap: 0.75rem;
}

.badgeStack {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  align-items: flex-end;
}

.gmpCompany {
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--color-text-primary);
  flex: 1;
}

.categoryBadge {
  padding: 0.375rem 0.875rem;
  border-radius: 9999px;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  white-space: nowrap;
}

.smeBadge {
  background-color: var(--color-info-light);
  color: #1d4ed8;
}

.mainboardBadge {
  background-color: #f3e8ff;
  color: #7c3aed;
}

.statusBadge {
  padding: 0.375rem 0.875rem;
  border-radius: 9999px;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  white-space: nowrap;
}

.statusOpen {
  background-color: var(--color-success-light);
  color: #047857;
}

.statusOpeningSoon {
  background-color: #ffedd5;
  color: #c2410c;
}

.statusClosed {
  background-color: var(--color-bg-tertiary);
  color: var(--color-text-secondary);
}

.gmpValue {
  font-size: 2.5rem;
  font-weight: 700;
  color: var(--color-success);
  margin-bottom: 0.5rem;
  line-height: 1;
}

.gmpValue.negative {
  color: var(--color-error);
}

.gmpPercentage {
  font-size: 1.25rem;
  font-weight: 600;
  margin-bottom: 0.25rem;
}

.profitText {
  color: var(--color-success);
}

.lossText {
  color: var(--color-error);
}

.gmpInfo {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1rem;
  padding-top: 1.5rem;
  border-top: 1px solid var(--color-border-light);
  user-select: text;
}

.infoItem {
  display: flex;
  flex-direction: column;
}

.infoLabel {
  font-size: 0.75rem;
  color: var(--color-text-muted);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  margin-bottom: 0.25rem;
  font-weight: 600;
}

.infoValue {
  font-size: 1rem;
  font-weight: 600;
  color: var(--color-primary);
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }

  to {
    opacity: 1;
  }
}

@media (max-width: 768px) {
  .sectionTitle {
    font-size: 1.875rem;
  }

  .sectionSubtitle {
    font-size: 1rem;
  }

  .categorySection {
    margin-bottom: 3rem;
  }

  .categoryTitle {
    font-size: 1.25rem;
  }

  .gmpGrid {
    grid-template-columns: 1fr;
    gap: 1.25rem;
  }

  .gmpCard {
    padding: 1.5rem;
  }

  .gmpValue {
    font-size: 2rem;
  }

  .gmpPercentage {
    font-size: 1.125rem;
  }

  .gmpInfo {
    gap: 0.75rem;
    padding-top: 1.25rem;
  }

  .infoLabel {
    font-size: 0.6875rem;
  }

  .infoValue {
    font-size: 0.9375rem;
  }
}

@media (max-width: 480px) {
  .sectionHeader {
    margin-bottom: 2rem;
  }

  .sectionTitle {
    font-size: 1.5rem;
    letter-spacing: -0.01em;
  }

  .sectionSubtitle {
    font-size: 0.875rem;
  }

  .categorySection {
    margin-bottom: 2.5rem;
  }

  .categoryTitle {
    font-size: 1.125rem;
    gap: 0.5rem;
  }

  .categoryIcon {
    font-size: 1.5rem;
  }

  .categoryCount {
    font-size: 0.875rem;
  }

  .gmpCard {
    padding: 1.25rem;
  }

  .gmpHeader {
    margin-bottom: 1.25rem;
  }

  .headerTop {
    margin-bottom: 0.75rem;
    gap: 0.5rem;
  }

  .gmpCompany {
    font-size: 1.125rem;
  }

  .categoryBadge,
  .statusBadge {
    padding: 0.25rem 0.625rem;
    font-size: 0.6875rem;
  }

  .gmpValue {
    font-size: 1.75rem;
  }

  .gmpPercentage {
    font-size: 1rem;
  }

  .gmpInfo {
    gap: 0.5rem;
    padding-top: 1rem;
  }

  .infoItem {
    gap: 0.125rem;
  }

  .infoLabel {
    font-size: 0.625rem;
    letter-spacing: 0.06em;
  }

  .infoValue {
    font-size: 0.875rem;
  }
}
</file>

<file path="app/gmp/page.tsx">
'use client';

import { useState, useEffect } from 'react';
import styles from './page.module.css';
import GMPModal from './GMPModal';
import { fetchGMPData } from '@/lib/api';

interface DayWiseData {
    date: string;
    day: number;
    qibExAnchor?: number;
    nii?: number;
    bNII?: number;
    sNII?: number;
    retail: number;
    total: number;
}

interface SubscriptionData {
    anchorInvestors?: number;
    qibExAnchor?: number;
    nonInstitutional?: number;
    bNII?: number;
    sNII?: number;
    retail?: number;
    employee?: number;
    shareholder?: number;
    total?: number;
    dayWise?: DayWiseData[];
}

interface GMPData {
    id: number;
    ipo_name: string;
    company_name: string;
    category: string;
    gmp: number;
    percentage: number;
    issue_price: string;
    price: number;
    expected_listing: string;
    lot_size: string;
    listing_date: string;
    status: string;
    anchor_investors?: number;
    qib_ex_anchor?: number;
    non_institutional?: number;
    b_nii?: number;
    s_nii?: number;
    retail?: number;
    employee?: number;
    shareholder?: number;
    total_subscription?: number;
    day_wise_subscription?: DayWiseData[];
}

// Helper function to get status badge class
const getStatusClass = (status: string) => {
    switch (status) {
        case 'Issue Open': return styles.statusOpen;
        case 'Opening Soon': return styles.statusOpeningSoon;
        case 'Closed': return styles.statusClosed;
        default: return '';
    }
};

// Helper function to format date for display
const formatDisplayDate = (dateStr: string) => {
    if (!dateStr) return '';
    const date = new Date(dateStr);
    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
};

export default function GMP() {
    const [gmpData, setGmpData] = useState<GMPData[]>([]);
    const [loading, setLoading] = useState(true);
    const [selectedIPO, setSelectedIPO] = useState<GMPData | null>(null);

    useEffect(() => {
        const loadData = async () => {
            try {
                const data = await fetchGMPData();
                // Transform database fields to UI-expected fields
                const transformedData = data.map((ipo: any) => ({
                    id: ipo.id,
                    ipo_name: ipo.ipo_name,
                    company_name: ipo.company_name || ipo.ipo_name,
                    category: ipo.category || 'Mainboard',
                    gmp: ipo.gmp_amount || 0,
                    percentage: ipo.gmp_percentage || 0,
                    issue_price: ipo.max_price ? `‚Çπ${ipo.max_price}` : (ipo.price_range || '-'),
                    price: ipo.max_price || 0,
                    expected_listing: ipo.max_price && ipo.gmp_amount ? `‚Çπ${ipo.max_price + ipo.gmp_amount}` : '-',
                    lot_size: ipo.lot_size ? `${ipo.lot_size} shares` : '-',
                    listing_date: ipo.listing_date || '',
                    status: ipo.status === 'open' ? 'Issue Open' :
                        ipo.status === 'upcoming' ? 'Opening Soon' : 'Closed',
                    anchor_investors: ipo.anchor_investors,
                    qib_ex_anchor: ipo.subscription_qib,
                    non_institutional: ipo.subscription_nii,
                    b_nii: ipo.subscription_bnii,
                    s_nii: ipo.subscription_snii,
                    retail: ipo.subscription_retail,
                    employee: ipo.subscription_employee,
                    shareholder: ipo.subscription_shareholder,
                    total_subscription: ipo.subscription_total,
                    day_wise_subscription: ipo.day_wise_subscription
                }));
                setGmpData(transformedData);
            } catch (error) {
                console.error('Failed to load GMP data:', error);
            } finally {
                setLoading(false);
            }
        };

        loadData();
    }, []);

    // Sort IPOs by listing date (ascending - nearest first)
    const sortedData = [...gmpData].sort((a, b) =>
        new Date(a.listing_date).getTime() - new Date(b.listing_date).getTime()
    );

    // Group IPOs by category
    const mainboardIPOs = sortedData.filter(ipo => ipo.category === "Mainboard");
    const smeIPOs = sortedData.filter(ipo => ipo.category === "SME");

    const renderIPOCards = (ipos: GMPData[]) => (
        ipos.map((ipo) => (
            <div
                key={ipo.id}
                className={styles.gmpCard}
            >
                <div
                    className={styles.gmpHeader}
                    onClick={() => setSelectedIPO(ipo)}
                >
                    <div className={styles.headerTop}>
                        <h3 className={styles.gmpCompany}>{ipo.company_name || ipo.ipo_name}</h3>
                        <div className={styles.badgeStack}>
                            <span className={`${styles.categoryBadge} ${ipo.category === 'SME' ? styles.smeBadge : styles.mainboardBadge}`}>
                                {ipo.category}
                            </span>
                            <span className={`${styles.statusBadge} ${getStatusClass(ipo.status)}`}>
                                {ipo.status}
                            </span>
                        </div>
                    </div>
                    <div className={`${styles.gmpValue} ${ipo.gmp < 0 ? styles.negative : ''}`}>
                        ‚Çπ{ipo.gmp}
                    </div>
                    <p className={`${styles.gmpPercentage} ${ipo.percentage < 0 ? styles.lossText : styles.profitText}`}>
                        {ipo.percentage >= 0 ? '+' : ''}{ipo.percentage}% {ipo.percentage >= 0 ? 'Profit' : 'Loss'}
                    </p>
                </div>

                <div className={styles.gmpInfo}>
                    <div className={styles.infoItem}>
                        <span className={styles.infoLabel}>Issue Price</span>
                        <span className={styles.infoValue}>{ipo.issue_price}</span>
                    </div>
                    <div className={styles.infoItem}>
                        <span className={styles.infoLabel}>Expected</span>
                        <span className={styles.infoValue}>{ipo.expected_listing}</span>
                    </div>
                    <div className={styles.infoItem}>
                        <span className={styles.infoLabel}>Lot Size</span>
                        <span className={styles.infoValue}>{ipo.lot_size}</span>
                    </div>
                    <div className={styles.infoItem}>
                        <span className={styles.infoLabel}>Listing</span>
                        <span className={styles.infoValue}>{formatDisplayDate(ipo.listing_date)}</span>
                    </div>
                </div>
            </div>
        ))
    );

    if (loading) {
        return (
            <div className={styles.sectionHeader}>
                <h1 className={styles.sectionTitle}>Grey Market Premium</h1>
                <p className={styles.sectionSubtitle}>Loading GMP data...</p>
            </div>
        );
    }

    return (
        <>
            <div className={styles.sectionHeader}>
                <h1 className={styles.sectionTitle}>Grey Market Premium</h1>
                <p className={styles.sectionSubtitle}>
                    Real-time GMP tracking and listing price predictions
                </p>
            </div>

            {/* Mainboard IPOs Section */}
            {mainboardIPOs.length > 0 && (
                <div className={styles.categorySection}>
                    <h2 className={styles.categoryTitle}>
                        <span className={styles.categoryIcon}>üìä</span>
                        Mainboard IPOs
                        <span className={styles.categoryCount}>({mainboardIPOs.length})</span>
                    </h2>
                    <div className={styles.gmpGrid}>
                        {renderIPOCards(mainboardIPOs)}
                    </div>
                </div>
            )}

            {/* SME IPOs Section */}
            {smeIPOs.length > 0 && (
                <div className={styles.categorySection}>
                    <h2 className={styles.categoryTitle}>
                        <span className={styles.categoryIcon}>üöÄ</span>
                        SME IPOs
                        <span className={styles.categoryCount}>({smeIPOs.length})</span>
                    </h2>
                    <div className={styles.gmpGrid}>
                        {renderIPOCards(smeIPOs)}
                    </div>
                </div>
            )}

            {gmpData.length === 0 && (
                <div className={styles.emptyState}>
                    <p>No GMP data available at the moment.</p>
                </div>
            )}

            {/* Modal */}
            {selectedIPO && (
                <GMPModal
                    ipo={{
                        ...selectedIPO,
                        companyName: selectedIPO.company_name || selectedIPO.ipo_name,
                        issuePrice: selectedIPO.issue_price,
                        expectedListing: selectedIPO.expected_listing,
                        lotSize: selectedIPO.lot_size,
                        listingDate: selectedIPO.listing_date,
                        subscription: {
                            anchorInvestors: selectedIPO.anchor_investors,
                            qibExAnchor: selectedIPO.qib_ex_anchor,
                            nonInstitutional: selectedIPO.non_institutional,
                            bNII: selectedIPO.b_nii,
                            sNII: selectedIPO.s_nii,
                            retail: selectedIPO.retail,
                            employee: selectedIPO.employee,
                            shareholder: selectedIPO.shareholder,
                            total: selectedIPO.total_subscription,
                            dayWise: selectedIPO.day_wise_subscription
                        }
                    }}
                    onClose={() => setSelectedIPO(null)}
                />
            )}
        </>
    );
}
</file>

<file path="app/ipo/[slug]/IPOSchema.tsx">
// JSON-LD Schema Markup Component for IPO Detail Pages

interface IPOSchemaProps {
    companyName: string;
    gmp: number;
    gmpPercentage: number;
    subscription: number;
    priceMin: number;
    priceMax: number;
    openDate: string;
    closeDate: string;
    allotmentDate: string;
    listingDate: string;
    registrar: string;
    registrarLink: string;
    faqs: { q: string; a: string }[];
    slug: string;
}

export default function IPOSchema({
    companyName,
    gmp,
    gmpPercentage,
    subscription,
    priceMin,
    priceMax,
    openDate,
    closeDate,
    allotmentDate,
    listingDate,
    registrar,
    registrarLink,
    faqs,
    slug,
}: IPOSchemaProps) {
    const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || 'https://ipotracker.in';
    const pageUrl = `${baseUrl}/ipo/${slug}`;
    const logoUrl = `${baseUrl}/images/logo.png`;
    const now = new Date().toISOString();

    // FinancialProduct Schema
    const financialProductSchema = {
        '@context': 'https://schema.org',
        '@type': 'FinancialProduct',
        name: `${companyName} IPO`,
        description: `${companyName} Initial Public Offering with live GMP updates, subscription status, and allotment details`,
        url: pageUrl,
        provider: {
            '@type': 'Organization',
            name: companyName,
        },
        offers: {
            '@type': 'Offer',
            price: priceMax,
            priceCurrency: 'INR',
            availability: 'https://schema.org/InStock',
            priceValidUntil: closeDate,
            seller: {
                '@type': 'Organization',
                name: companyName,
            },
        },
        audience: {
            '@type': 'PeopleAudience',
            audienceType: 'Retail Investors, Institutional Investors',
        },
    };

    // FAQ Schema
    const faqSchema = {
        '@context': 'https://schema.org',
        '@type': 'FAQPage',
        mainEntity: [
            {
                '@type': 'Question',
                name: `What is the ${companyName} IPO GMP today?`,
                acceptedAnswer: {
                    '@type': 'Answer',
                    text: `The current Grey Market Premium (GMP) for ${companyName} IPO is ‚Çπ${gmp}, indicating a premium of ${gmpPercentage}% over the issue price.`,
                },
            },
            {
                '@type': 'Question',
                name: `When is ${companyName} IPO opening and closing?`,
                acceptedAnswer: {
                    '@type': 'Answer',
                    text: `${companyName} IPO opens on ${openDate} and closes on ${closeDate}.`,
                },
            },
            {
                '@type': 'Question',
                name: `How to check ${companyName} IPO allotment status?`,
                acceptedAnswer: {
                    '@type': 'Answer',
                    text: `Check ${companyName} IPO allotment status on ${registrar} website at ${registrarLink} using your PAN number or application number.`,
                },
            },
            ...faqs.map(faq => ({
                '@type': 'Question',
                name: faq.q,
                acceptedAnswer: {
                    '@type': 'Answer',
                    text: faq.a,
                },
            })),
        ],
    };

    // Article Schema
    const articleSchema = {
        '@context': 'https://schema.org',
        '@type': 'Article',
        headline: `${companyName} IPO Review: GMP, Subscription & Allotment Details`,
        description: `Comprehensive analysis of ${companyName} IPO including grey market premium, subscription status, financials, and investment recommendation`,
        image: logoUrl,
        datePublished: now,
        dateModified: now,
        author: {
            '@type': 'Organization',
            name: 'IPO Tracker',
        },
        publisher: {
            '@type': 'Organization',
            name: 'IPO Tracker',
            logo: {
                '@type': 'ImageObject',
                url: logoUrl,
            },
        },
    };

    // Breadcrumb Schema
    const breadcrumbSchema = {
        '@context': 'https://schema.org',
        '@type': 'BreadcrumbList',
        itemListElement: [
            {
                '@type': 'ListItem',
                position: 1,
                name: 'Home',
                item: baseUrl,
            },
            {
                '@type': 'ListItem',
                position: 2,
                name: 'IPO',
                item: `${baseUrl}/upcoming-ipos`,
            },
            {
                '@type': 'ListItem',
                position: 3,
                name: `${companyName} IPO`,
                item: pageUrl,
            },
        ],
    };

    return (
        <>
            <script
                type="application/ld+json"
                dangerouslySetInnerHTML={{ __html: JSON.stringify(financialProductSchema) }}
            />
            <script
                type="application/ld+json"
                dangerouslySetInnerHTML={{ __html: JSON.stringify(faqSchema) }}
            />
            <script
                type="application/ld+json"
                dangerouslySetInnerHTML={{ __html: JSON.stringify(articleSchema) }}
            />
            <script
                type="application/ld+json"
                dangerouslySetInnerHTML={{ __html: JSON.stringify(breadcrumbSchema) }}
            />
        </>
    );
}
</file>

<file path="app/ipo/[slug]/layout.tsx">
import { Metadata } from 'next';

// Mock IPO data for metadata generation - in production, fetch from API
const getIPOData = async (slug: string) => {
    const companyName = slug
        .replace(/-ipo-gmp-allotment-subscription$/, '')
        .split('-')
        .map(word => word.charAt(0).toUpperCase() + word.slice(1))
        .join(' ');

    return {
        companyName,
        gmp: 485,
        gmpPercentage: 96.5,
        subscription: 69.43,
        priceMin: 475,
        priceMax: 500,
        openDate: '2024-11-22',
        closeDate: '2024-11-24',
        allotmentDate: '2024-11-29',
        listingDate: '2024-11-30',
        registrar: 'Link Intime India Pvt Ltd',
        registrarLink: 'https://linkintime.co.in',
    };
};

interface Props {
    params: Promise<{ slug: string }>;
}

export async function generateMetadata({ params }: Props): Promise<Metadata> {
    const { slug } = await params;
    const ipo = await getIPOData(slug);
    const currentYear = new Date().getFullYear();
    const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || 'https://ipotracker.in';
    const pageUrl = `${baseUrl}/ipo/${slug}`;
    const logoUrl = `${baseUrl}/images/ipo/${slug}-logo.png`;

    return {
        title: `${ipo.companyName} IPO GMP, Allotment Status, Subscription, Review ${currentYear}`,
        description: `${ipo.companyName} IPO: Live GMP ‚Çπ${ipo.gmp} (+${ipo.gmpPercentage}%), subscription ${ipo.subscription}x. Check allotment status, issue date, price band ‚Çπ${ipo.priceMin}-${ipo.priceMax}, grey market premium & expert review.`,
        keywords: [
            `${ipo.companyName.toLowerCase()} ipo`,
            `${ipo.companyName.toLowerCase()} ipo gmp`,
            `${ipo.companyName.toLowerCase()} ipo allotment status`,
            `${ipo.companyName.toLowerCase()} ipo subscription`,
            `${ipo.companyName.toLowerCase()} grey market premium`,
            `${ipo.companyName.toLowerCase()} ipo listing date`,
            `${ipo.companyName.toLowerCase()} ipo review`,
            'ipo gmp today',
            'upcoming ipo',
            'ipo allotment',
        ],
        authors: [{ name: 'IPO Tracker' }],
        creator: 'IPO Tracker',
        publisher: 'IPO Tracker',
        robots: {
            index: true,
            follow: true,
            googleBot: {
                index: true,
                follow: true,
                'max-video-preview': -1,
                'max-image-preview': 'large',
                'max-snippet': -1,
            },
        },
        alternates: {
            canonical: pageUrl,
        },
        openGraph: {
            title: `${ipo.companyName} IPO - GMP ‚Çπ${ipo.gmp}, Subscription ${ipo.subscription}x`,
            description: `Get live updates on ${ipo.companyName} IPO. Current GMP, subscription status, allotment date & detailed review.`,
            url: pageUrl,
            siteName: 'IPO Tracker',
            images: [
                {
                    url: logoUrl,
                    width: 1200,
                    height: 630,
                    alt: `${ipo.companyName} IPO`,
                },
            ],
            locale: 'en_IN',
            type: 'article',
        },
        twitter: {
            card: 'summary_large_image',
            title: `${ipo.companyName} IPO - Live GMP & Subscription Status`,
            description: `Track ${ipo.companyName} IPO: GMP ‚Çπ${ipo.gmp}, Subscription ${ipo.subscription}x`,
            images: [logoUrl],
            creator: '@ipotracker',
        },
        other: {
            'article:published_time': new Date().toISOString(),
            'article:modified_time': new Date().toISOString(),
            'article:section': 'Finance',
            'article:tag': 'IPO, Stock Market, Investment',
        },
    };
}

export default function IPOLayout({
    children,
}: {
    children: React.ReactNode;
}) {
    return children;
}
</file>

<file path="app/ipo/[slug]/page.module.css">
/* IPO Detail Page Styles - Premium Light Theme */

/* ===== LAYOUT ===== */
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 1rem;
}

.pageWrapper {
  padding-bottom: 100px;
}

/* ===== HERO SECTION ===== */
.hero {
  background: linear-gradient(135deg, rgba(79, 70, 229, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%);
  border-radius: var(--radius-xl);
  padding: 2.5rem;
  margin-bottom: 2rem;
  border: 1px solid var(--color-border);
  box-shadow: var(--shadow-card);
}

.heroHeader {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.heroLeft {
  display: flex;
  align-items: center;
  gap: 1.5rem;
}

.companyLogo {
  width: 80px;
  height: 80px;
  border-radius: var(--radius-lg);
  background: var(--gradient-primary);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  font-weight: 700;
  color: white;
  box-shadow: 0 4px 12px rgba(79, 70, 229, 0.25);
}

.heroTitle {
  font-size: 2rem;
  font-weight: 700;
  color: var(--color-text-primary);
  margin-bottom: 0.5rem;
}

.statusBadge {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  border-radius: 9999px;
  font-size: 0.875rem;
  font-weight: 600;
}

.statusOpen {
  background: var(--color-success-light);
  color: #047857;
}

.statusClosed {
  background: var(--color-bg-tertiary);
  color: var(--color-text-secondary);
}

.statusAllotment {
  background: var(--color-info-light);
  color: #1d4ed8;
}

.statusListed {
  background: #f3e8ff;
  color: #7c3aed;
}

.alertButton {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem 1.5rem;
  background: var(--gradient-primary);
  border: none;
  border-radius: var(--radius-md);
  color: white;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition-base);
  box-shadow: 0 4px 12px rgba(79, 70, 229, 0.25);
}

.alertButton:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(79, 70, 229, 0.35);
}

.lastUpdated {
  font-size: 0.75rem;
  color: var(--color-text-muted);
  margin-top: 0.5rem;
}

/* Metric Cards */
.metricsGrid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 1rem;
}

.metricCard {
  background: var(--color-bg-card);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  padding: 1.25rem;
  text-align: center;
  transition: var(--transition-base);
  box-shadow: var(--shadow-xs);
}

.metricCard:hover {
  transform: translateY(-4px);
  box-shadow: var(--shadow-md);
  border-color: rgba(79, 70, 229, 0.2);
}

.metricLabel {
  font-size: 0.75rem;
  color: var(--color-text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 0.5rem;
  font-weight: 600;
}

.metricValue {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--color-text-primary);
}

.metricChange {
  font-size: 0.875rem;
  margin-top: 0.25rem;
  font-weight: 600;
}

.positive {
  color: var(--color-success);
}

.negative {
  color: var(--color-error);
}

/* ===== SECTION STYLES ===== */
.section {
  background: var(--color-bg-card);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-xl);
  padding: 2rem;
  margin-bottom: 2rem;
  box-shadow: var(--shadow-card);
}

.sectionTitle {
  font-size: 1.375rem;
  font-weight: 700;
  color: var(--color-text-primary);
  margin-bottom: 1.5rem;
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.sectionIcon {
  font-size: 1.25rem;
}

/* ===== QUICK FACTS TABLE ===== */
.factsGrid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 0;
}

.factItem {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 1.25rem;
  border-bottom: 1px solid var(--color-border-light);
}

.factItem:nth-child(odd) {
  background: var(--color-bg-secondary);
}

.factLabel {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 0.875rem;
  color: var(--color-text-secondary);
}

.factValue {
  font-weight: 600;
  color: var(--color-text-primary);
  text-align: right;
}

/* ===== SUBSCRIPTION STATUS ===== */
.subscriptionOverall {
  text-align: center;
  padding: 2rem;
  background: linear-gradient(135deg, rgba(79, 70, 229, 0.05) 0%, rgba(139, 92, 246, 0.03) 100%);
  border-radius: var(--radius-lg);
  margin-bottom: 1.5rem;
}

.overallLabel {
  font-size: 0.875rem;
  color: var(--color-text-secondary);
  margin-bottom: 0.5rem;
}

.overallValue {
  font-size: 3rem;
  font-weight: 700;
  color: var(--color-primary);
}

.overallTrend {
  font-size: 1rem;
  margin-top: 0.25rem;
}

.categoryCards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
}

.categoryCard {
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border-light);
  border-radius: var(--radius-md);
  padding: 1.25rem;
}

.categoryName {
  font-size: 0.75rem;
  color: var(--color-text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 0.75rem;
  font-weight: 600;
}

.categoryValue {
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--color-text-primary);
  margin-bottom: 0.75rem;
}

.progressBar {
  height: 8px;
  background: var(--color-bg-tertiary);
  border-radius: 4px;
  overflow: hidden;
}

.progressFill {
  height: 100%;
  border-radius: 4px;
  transition: width 0.5s ease;
}

.progressRed {
  background: linear-gradient(90deg, #ef4444, #f87171);
}

.progressOrange {
  background: linear-gradient(90deg, #f59e0b, #fbbf24);
}

.progressYellow {
  background: linear-gradient(90deg, #eab308, #facc15);
}

.progressGreen {
  background: linear-gradient(90deg, #10b981, #34d399);
}

.refreshRow {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 1.5rem;
  padding-top: 1rem;
  border-top: 1px solid var(--color-border-light);
}

.timestamp {
  font-size: 0.75rem;
  color: var(--color-text-muted);
}

.refreshButton {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  background: rgba(79, 70, 229, 0.1);
  border: 1px solid rgba(79, 70, 229, 0.2);
  border-radius: var(--radius-sm);
  color: var(--color-primary);
  font-size: 0.875rem;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition-base);
}

.refreshButton:hover {
  background: rgba(79, 70, 229, 0.15);
}

/* ===== GMP TRACKER ===== */
.gmpGrid {
  display: grid;
  grid-template-columns: 1fr 2fr;
  gap: 1.5rem;
}

.gmpMainCard {
  background: linear-gradient(135deg, rgba(16, 185, 129, 0.08) 0%, rgba(16, 185, 129, 0.03) 100%);
  border: 1px solid rgba(16, 185, 129, 0.2);
  border-radius: var(--radius-lg);
  padding: 1.5rem;
}

.gmpAmount {
  font-size: 2.5rem;
  font-weight: 700;
  color: var(--color-success);
  margin-bottom: 0.5rem;
}

.gmpRow {
  display: flex;
  justify-content: space-between;
  padding: 0.5rem 0;
  border-bottom: 1px solid var(--color-border-light);
}

.gmpRow:last-child {
  border-bottom: none;
}

.gmpLabel {
  font-size: 0.875rem;
  color: var(--color-text-secondary);
}

.gmpValue {
  font-weight: 600;
  color: var(--color-text-primary);
}

.gmpChart {
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border-light);
  border-radius: var(--radius-lg);
  padding: 1.5rem;
  min-height: 200px;
  display: flex;
  flex-direction: column;
}

.chartTitle {
  font-size: 0.875rem;
  color: var(--color-text-secondary);
  margin-bottom: 1rem;
  font-weight: 600;
}

.chartArea {
  flex: 1;
  display: flex;
  align-items: flex-end;
  gap: 4px;
  padding: 1rem 0;
}

.chartBar {
  flex: 1;
  background: var(--gradient-primary);
  border-radius: 4px 4px 0 0;
  min-height: 10px;
  transition: height 0.3s;
}

.gmpHistoryTable {
  margin-top: 1.5rem;
}

.historyTable {
  width: 100%;
  border-collapse: collapse;
}

.historyTable th,
.historyTable td {
  padding: 0.75rem 1rem;
  text-align: left;
  border-bottom: 1px solid var(--color-border-light);
}

.historyTable th {
  font-size: 0.75rem;
  color: var(--color-text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-weight: 600;
}

.historyTable td {
  font-size: 0.875rem;
  color: var(--color-text-primary);
}

.disclaimer {
  margin-top: 1rem;
  padding: 1rem;
  background: var(--color-warning-light);
  border: 1px solid rgba(245, 158, 11, 0.3);
  border-radius: var(--radius-sm);
  font-size: 0.75rem;
  color: #b45309;
}

/* ===== ALLOTMENT SECTION ===== */
.allotmentGrid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1.5rem;
}

.allotmentCard {
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border-light);
  border-radius: var(--radius-lg);
  padding: 1.5rem;
}

.allotmentCard h3 {
  font-size: 1rem;
  color: var(--color-text-primary);
  margin-bottom: 1rem;
}

.registrarLink {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem 1.25rem;
  background: var(--gradient-primary);
  border-radius: var(--radius-md);
  color: white;
  text-decoration: none;
  font-weight: 600;
  font-size: 0.875rem;
  transition: var(--transition-base);
  box-shadow: 0 2px 8px rgba(79, 70, 229, 0.25);
}

.registrarLink:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 16px rgba(79, 70, 229, 0.35);
}

/* ===== FINANCIALS ===== */
.financialCards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 1rem;
  margin-bottom: 2rem;
}

.financialCard {
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border-light);
  border-radius: var(--radius-md);
  padding: 1rem;
  text-align: center;
}

.financialLabel {
  font-size: 0.75rem;
  color: var(--color-text-muted);
  margin-bottom: 0.5rem;
  font-weight: 600;
}

.financialValue {
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--color-text-primary);
}

.financialTable {
  width: 100%;
  border-collapse: collapse;
  margin-top: 1.5rem;
}

.financialTable th,
.financialTable td {
  padding: 1rem;
  text-align: center;
  border-bottom: 1px solid var(--color-border-light);
}

.financialTable th {
  font-size: 0.75rem;
  color: var(--color-text-muted);
  text-transform: uppercase;
  background: var(--color-bg-secondary);
  font-weight: 600;
}

.financialTable td:first-child {
  text-align: left;
  color: var(--color-text-secondary);
}

/* ===== ISSUE DETAILS ===== */
.issueGrid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 2rem;
}

.issueBreakup h3,
.useFunds h3 {
  font-size: 1rem;
  color: var(--color-text-primary);
  margin-bottom: 1.25rem;
}

.breakupItem {
  display: flex;
  justify-content: space-between;
  padding: 0.75rem 0;
  border-bottom: 1px solid var(--color-border-light);
}

.breakupLabel {
  color: var(--color-text-secondary);
  font-size: 0.875rem;
}

.breakupValue {
  font-weight: 600;
  color: var(--color-text-primary);
}

.pieChart {
  width: 200px;
  height: 200px;
  border-radius: 50%;
  margin: 0 auto 1.5rem;
  position: relative;
}

.pieLegend {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.legendItem {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 0.875rem;
}

.legendColor {
  width: 12px;
  height: 12px;
  border-radius: 3px;
}

/* ===== SHAREHOLDING ===== */
.shareholdingGrid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 2rem;
}

.shareholdingCard {
  text-align: center;
}

.shareholdingCard h3 {
  font-size: 1rem;
  color: var(--color-text-primary);
  margin-bottom: 1.5rem;
}

.promoterTable {
  width: 100%;
  border-collapse: collapse;
  margin-top: 2rem;
}

.promoterTable th,
.promoterTable td {
  padding: 1rem;
  text-align: left;
  border-bottom: 1px solid var(--color-border-light);
}

.promoterTable th {
  font-size: 0.75rem;
  color: var(--color-text-muted);
  text-transform: uppercase;
  font-weight: 600;
}

/* ===== ABOUT COMPANY ===== */
.companyOverview {
  font-size: 1rem;
  line-height: 1.8;
  color: var(--color-text-secondary);
  margin-bottom: 2rem;
}

.companyOverview p {
  margin-bottom: 1rem;
}

.highlights {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1rem;
}

.highlightItem {
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
  padding: 1rem;
  background: var(--color-bg-secondary);
  border-radius: var(--radius-md);
}

.highlightIcon {
  color: var(--color-success);
  font-size: 1.25rem;
}

.highlightText {
  font-size: 0.875rem;
  color: var(--color-text-primary);
}

/* ===== EXPERT REVIEW ===== */
.reviewHeader {
  display: flex;
  align-items: center;
  gap: 2rem;
  margin-bottom: 2rem;
  padding-bottom: 1.5rem;
  border-bottom: 1px solid var(--color-border-light);
}

.overallRating {
  text-align: center;
}

.ratingStars {
  font-size: 2rem;
  margin-bottom: 0.5rem;
}

.ratingLabel {
  font-size: 0.875rem;
  color: var(--color-text-secondary);
}

.ratingBars {
  flex: 1;
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 0.75rem;
}

.ratingItem {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.ratingName {
  font-size: 0.75rem;
  color: var(--color-text-secondary);
  min-width: 100px;
}

.ratingBar {
  flex: 1;
  height: 8px;
  background: var(--color-bg-tertiary);
  border-radius: 4px;
  overflow: hidden;
}

.ratingFill {
  height: 100%;
  background: var(--gradient-primary);
  border-radius: 4px;
}

.ratingValue {
  font-size: 0.75rem;
  color: var(--color-text-primary);
  min-width: 30px;
  font-weight: 600;
}

.prosConsGrid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 2rem;
  margin-bottom: 2rem;
}

.prosSection h3,
.consSection h3 {
  font-size: 1rem;
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.prosSection h3 {
  color: var(--color-success);
}

.consSection h3 {
  color: var(--color-warning);
}

.prosList,
.consList {
  list-style: none;
  padding: 0;
}

.prosList li,
.consList li {
  padding: 0.75rem 0;
  border-bottom: 1px solid var(--color-border-light);
  font-size: 0.875rem;
  color: var(--color-text-primary);
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
}

.recommendationBox {
  background: linear-gradient(135deg, rgba(79, 70, 229, 0.05) 0%, rgba(139, 92, 246, 0.03) 100%);
  border: 1px solid rgba(79, 70, 229, 0.15);
  border-radius: var(--radius-lg);
  padding: 1.5rem;
  text-align: center;
}

.recommendationLabel {
  font-size: 0.875rem;
  color: var(--color-text-secondary);
  margin-bottom: 0.5rem;
}

.recommendationValue {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--color-success);
  margin-bottom: 1rem;
}

.poll {
  display: flex;
  justify-content: center;
  gap: 2rem;
  margin-top: 1.5rem;
  padding-top: 1.5rem;
  border-top: 1px solid var(--color-border-light);
}

.pollOption {
  text-align: center;
}

.pollBar {
  width: 100px;
  height: 8px;
  background: var(--color-bg-tertiary);
  border-radius: 4px;
  overflow: hidden;
  margin-top: 0.5rem;
}

.pollFill {
  height: 100%;
  border-radius: 4px;
}

.pollApply {
  background: var(--color-success);
}

.pollAvoid {
  background: var(--color-error);
}

.pollLabel {
  font-size: 0.75rem;
  color: var(--color-text-muted);
  margin-bottom: 0.25rem;
}

.pollValue {
  font-size: 1rem;
  font-weight: 700;
  color: var(--color-text-primary);
}

/* ===== TIMELINE ===== */
.timeline {
  position: relative;
  padding-left: 2rem;
}

.timeline::before {
  content: '';
  position: absolute;
  left: 8px;
  top: 0;
  bottom: 0;
  width: 2px;
  background: var(--color-border);
}

.timelineItem {
  position: relative;
  padding-bottom: 1.5rem;
}

.timelineItem::before {
  content: '';
  position: absolute;
  left: -2rem;
  top: 0.25rem;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: var(--gradient-primary);
  border: 3px solid var(--color-bg-card);
  box-shadow: var(--shadow-sm);
}

.timelineDate {
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--color-text-primary);
  margin-bottom: 0.25rem;
}

.timelineEvent {
  font-size: 0.875rem;
  color: var(--color-text-secondary);
}

/* ===== FAQ SECTION ===== */
.faqList {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.faqItem {
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border-light);
  border-radius: var(--radius-md);
  overflow: hidden;
}

.faqQuestion {
  padding: 1.25rem;
  font-size: 1rem;
  font-weight: 600;
  color: var(--color-text-primary);
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: var(--transition-base);
}

.faqQuestion:hover {
  background: var(--color-bg-tertiary);
}

.faqAnswer {
  padding: 0 1.25rem 1.25rem;
  font-size: 0.9375rem;
  color: var(--color-text-secondary);
  line-height: 1.7;
}

/* ===== FLOATING CTA ===== */
.floatingCta {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: var(--color-bg-card);
  border-top: 1px solid var(--color-border);
  padding: 1rem 2rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.08);
  z-index: 100;
}

.ctaInfo {
  display: flex;
  align-items: center;
  gap: 2rem;
}

.ctaLabel {
  font-size: 0.75rem;
  color: var(--color-text-muted);
  text-transform: uppercase;
  font-weight: 600;
}

.ctaValue {
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--color-text-primary);
}

.ctaButtons {
  display: flex;
  gap: 1rem;
}

.ctaButton {
  padding: 0.875rem 2rem;
  border-radius: var(--radius-md);
  font-weight: 600;
  font-size: 0.9375rem;
  cursor: pointer;
  transition: var(--transition-base);
}

.ctaPrimary {
  background: var(--gradient-primary);
  color: white;
  border: none;
  box-shadow: 0 4px 12px rgba(79, 70, 229, 0.25);
}

.ctaPrimary:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(79, 70, 229, 0.35);
}

.ctaSecondary {
  background: transparent;
  color: var(--color-text-secondary);
  border: 1px solid var(--color-border);
}

.ctaSecondary:hover {
  background: var(--color-bg-secondary);
  border-color: var(--color-primary);
  color: var(--color-primary);
}

/* ===== RESPONSIVE ===== */

/* Large tablets */
@media (max-width: 1024px) {
  .metricsGrid {
    grid-template-columns: repeat(2, 1fr);
  }

  .gmpGrid {
    grid-template-columns: 1fr;
  }

  .issueGrid,
  .shareholdingGrid,
  .allotmentGrid,
  .prosConsGrid {
    grid-template-columns: 1fr;
  }

  .section {
    padding: 1.5rem;
  }

  .hero {
    padding: 2rem;
  }
}

/* Tablets */
@media (max-width: 768px) {
  .container {
    padding: 0 0.75rem;
  }

  .hero {
    padding: 1.5rem;
    margin-bottom: 1.5rem;
  }

  .heroHeader {
    flex-direction: column;
    gap: 1rem;
  }

  .heroLeft {
    flex-direction: column;
    align-items: flex-start;
    gap: 1rem;
  }

  .companyLogo {
    width: 64px;
    height: 64px;
    font-size: 1.5rem;
  }

  .heroTitle {
    font-size: 1.5rem;
  }

  .metricsGrid {
    grid-template-columns: 1fr;
    gap: 0.75rem;
  }

  .metricCard {
    padding: 1rem;
  }

  .metricValue {
    font-size: 1.25rem;
  }

  .section {
    padding: 1.25rem;
    margin-bottom: 1.5rem;
  }

  .sectionTitle {
    font-size: 1.125rem;
    margin-bottom: 1rem;
  }

  .factsGrid {
    grid-template-columns: 1fr;
  }

  .factItem {
    padding: 0.75rem 1rem;
  }

  .highlights {
    grid-template-columns: 1fr;
  }

  .ratingBars {
    grid-template-columns: 1fr;
  }

  .reviewHeader {
    flex-direction: column;
    text-align: center;
  }

  .financialCards {
    grid-template-columns: repeat(2, 1fr);
  }

  .categoryCards {
    grid-template-columns: 1fr;
  }

  .floatingCta {
    flex-direction: column;
    gap: 1rem;
    padding: 1rem;
  }

  .ctaInfo {
    gap: 1rem;
  }

  .ctaButtons {
    width: 100%;
  }

  .ctaButton {
    flex: 1;
    text-align: center;
  }
}

/* Mobile phones */
@media (max-width: 480px) {
  .container {
    padding: 0 0.5rem;
  }

  .hero {
    padding: 1rem;
    border-radius: var(--radius-md);
  }

  .heroHeader {
    gap: 0.75rem;
  }

  .companyLogo {
    width: 56px;
    height: 56px;
    font-size: 1.25rem;
  }

  .heroTitle {
    font-size: 1.25rem;
    margin-bottom: 0.375rem;
  }

  .statusBadge {
    padding: 0.375rem 0.75rem;
    font-size: 0.75rem;
  }

  .alertButton {
    padding: 0.625rem 1rem;
    font-size: 0.8125rem;
  }

  .metricsGrid {
    gap: 0.5rem;
  }

  .metricCard {
    padding: 0.875rem;
  }

  .metricLabel {
    font-size: 0.6875rem;
    margin-bottom: 0.25rem;
  }

  .metricValue {
    font-size: 1.125rem;
  }

  .section {
    padding: 1rem;
    margin-bottom: 1rem;
    border-radius: var(--radius-md);
  }

  .sectionTitle {
    font-size: 1rem;
    margin-bottom: 0.875rem;
    gap: 0.5rem;
  }

  .sectionIcon {
    font-size: 1rem;
  }

  .factLabel {
    font-size: 0.8125rem;
  }

  .factValue {
    font-size: 0.875rem;
  }

  .subscriptionOverall {
    padding: 1.25rem;
  }

  .overallValue {
    font-size: 2.25rem;
  }

  .categoryCard {
    padding: 1rem;
  }

  .categoryName {
    font-size: 0.6875rem;
  }

  .categoryValue {
    font-size: 1rem;
  }

  .gmpMainCard {
    padding: 1rem;
  }

  .gmpAmount {
    font-size: 2rem;
  }

  .financialCards {
    grid-template-columns: 1fr;
    gap: 0.5rem;
  }

  .financialCard {
    padding: 0.75rem;
  }

  .financialLabel {
    font-size: 0.6875rem;
  }

  .financialValue {
    font-size: 1rem;
  }

  .highlightItem {
    padding: 0.75rem;
    gap: 0.5rem;
  }

  .highlightIcon {
    font-size: 1rem;
  }

  .highlightText {
    font-size: 0.8125rem;
  }

  .ratingStars {
    font-size: 1.5rem;
  }

  .ratingName {
    min-width: 80px;
    font-size: 0.6875rem;
  }

  .prosList li,
  .consList li {
    padding: 0.625rem 0;
    font-size: 0.8125rem;
  }

  .recommendationBox {
    padding: 1rem;
  }

  .floatingCta {
    padding: 0.75rem;
    gap: 0.75rem;
  }

  .ctaInfo {
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .ctaButton,
  .ctaSecondary {
    padding: 0.625rem 1rem;
    font-size: 0.8125rem;
  }
}
</file>

<file path="app/ipo/[slug]/page.tsx">
'use client';

import { useState, useEffect } from 'react';
import { useParams } from 'next/navigation';
import Link from 'next/link';
import styles from './page.module.css';
import IPOSchema from './IPOSchema';

// Breadcrumb component for internal linking and SEO
const Breadcrumb = ({ companyName }: { companyName: string }) => (
    <nav aria-label="Breadcrumb" className={styles.breadcrumb}>
        <ol itemScope itemType="https://schema.org/BreadcrumbList" style={{ display: 'flex', gap: '0.5rem', listStyle: 'none', margin: 0, padding: '0.5rem 0', fontSize: '0.875rem', color: 'var(--neutral-200)' }}>
            <li itemProp="itemListElement" itemScope itemType="https://schema.org/ListItem">
                <Link href="/" itemProp="item" style={{ color: 'var(--accent-cyan)' }}><span itemProp="name">Home</span></Link>
                <meta itemProp="position" content="1" />
            </li>
            <li style={{ color: 'var(--neutral-200)' }}>/</li>
            <li itemProp="itemListElement" itemScope itemType="https://schema.org/ListItem">
                <Link href="/upcoming-ipos" itemProp="item" style={{ color: 'var(--accent-cyan)' }}><span itemProp="name">IPOs</span></Link>
                <meta itemProp="position" content="2" />
            </li>
            <li style={{ color: 'var(--neutral-200)' }}>/</li>
            <li itemProp="itemListElement" itemScope itemType="https://schema.org/ListItem">
                <span itemProp="name">{companyName} IPO</span>
                <meta itemProp="position" content="3" />
            </li>
        </ol>
    </nav>
);

// Mock IPO data - will be replaced with API call
const mockIPOData = {
    id: 1,
    slug: 'tata-technologies-ipo-gmp-allotment-subscription',
    companyName: 'Tata Technologies',
    logo: 'TT',
    status: 'Open for Subscription' as const,
    category: 'Mainboard',

    // Hero Metrics
    gmp: 485,
    gmpPercentage: 96.5,
    subscription: 69.43,
    priceMin: 475,
    priceMax: 500,
    lotSize: 30,

    // Quick Facts
    issueType: 'Mainboard',
    issueSize: 3042.51,
    freshIssue: 0,
    ofs: 3042.51,
    minInvestment: 15000,
    openDate: '2024-11-22',
    closeDate: '2024-11-24',
    allotmentDate: '2024-11-29',
    listingDate: '2024-11-30',
    registrar: 'Link Intime India Pvt Ltd',
    registrarLink: 'https://linkintime.co.in',
    leadManagers: ['JM Financial', 'Citigroup', 'BofA Securities'],
    exchanges: ['NSE', 'BSE'],

    // Subscription Details
    subscriptionData: {
        overall: 69.43,
        qib: 200.56,
        nii: 45.23,
        bNII: 38.45,
        sNII: 52.18,
        retail: 12.87,
        employee: 8.45,
        shareholder: 15.23,
    },
    lastUpdated: '2024-11-24T16:30:00',

    // GMP History
    gmpHistory: [
        { date: '2024-11-24', gmp: 485, change: '+25', premium: 96.5 },
        { date: '2024-11-23', gmp: 460, change: '+40', premium: 92.0 },
        { date: '2024-11-22', gmp: 420, change: '+35', premium: 84.0 },
        { date: '2024-11-21', gmp: 385, change: '+20', premium: 77.0 },
        { date: '2024-11-20', gmp: 365, change: '+15', premium: 73.0 },
    ],
    kostakRate: 25000,
    subjectToSauda: 22000,

    // Financials
    financials: {
        revenueFY23: 4414.87,
        revenueFY22: 3530.42,
        revenueFY21: 2485.24,
        patFY23: 624.31,
        patFY22: 438.26,
        patFY21: 169.52,
        netWorth: 2586.43,
        eps: 15.42,
        peRatio: 32.4,
        ronw: 24.1,
        debtToEquity: 0.02,
    },

    // Issue Details
    issueBreakup: {
        freshIssue: 0,
        freshIssuePercent: 0,
        ofs: 3042.51,
        ofsPercent: 100,
        preIpoPlacement: 0,
        totalIssue: 3042.51,
        postIssuePaidUp: 405.18,
        marketCap: 20259,
    },
    useOfFunds: [
        { label: 'General Corporate Purposes', percentage: 100, color: '#2563eb' },
    ],

    // Shareholding
    preIpoShareholding: [
        { label: 'Promoters', percentage: 74.39, color: '#2563eb' },
        { label: 'Public', percentage: 25.61, color: '#06b6d4' },
    ],
    postIpoShareholding: [
        { label: 'Promoters', percentage: 59.15, color: '#2563eb' },
        { label: 'QIB', percentage: 18.42, color: '#10b981' },
        { label: 'NII', percentage: 7.37, color: '#f59e0b' },
        { label: 'Retail', percentage: 9.82, color: '#ef4444' },
        { label: 'Others', percentage: 5.24, color: '#8b5cf6' },
    ],
    promoters: [
        { name: 'Tata Motors Ltd', relationship: 'Holding Company', preIpo: 74.39, postIpo: 59.15 },
    ],
    lockInPeriod: { promoter: 18, preIpo: 6 },

    // Company Info
    about: {
        overview: `Tata Technologies is a global engineering and product development digital services company. The company provides services to automotive and aerospace manufacturers worldwide. With over 11,000 employees across 21 countries, they help clients design, develop, and realize better products.`,
        highlights: [
            'Global leader in engineering and design services',
            'Serving top automotive and aerospace OEMs',
            'Strong presence in EV and sustainable mobility',
            'Robust R&D capabilities with 8 global delivery centers',
            'Part of the Tata Group with strong parentage',
            'High client retention rate of 95%+',
        ],
        industry: 'Engineering Research & Development Services',
        marketSize: 'USD 215 billion globally',
    },

    // Expert Review
    review: {
        overall: 4.2,
        ratings: {
            financial: 4.5,
            valuation: 3.8,
            growth: 4.5,
            management: 4.2,
            industry: 4.0,
        },
        strengths: [
            'Strong parentage with Tata Group brand value',
            'Diversified global client base across geographies',
            'Leadership position in ER&D services segment',
        ],
        concerns: [
            'Premium valuation compared to listed peers',
            'High dependence on automotive sector',
            'Forex exposure due to global operations',
        ],
        recommendation: 'Subscribe for Long-term',
        riskLevel: 'Medium',
        investmentHorizon: 'Long-term (2-3 years)',
    },
    poll: { yes: 78, no: 22, totalVotes: 12543 },

    // Timeline
    timeline: [
        { label: 'IPO Announcement', date: '2024-11-15', status: 'completed' },
        { label: 'Price Band', date: '2024-11-18', status: 'completed' },
        { label: 'IPO Opens', date: '2024-11-22', status: 'active' },
        { label: 'IPO Closes', date: '2024-11-24', status: 'upcoming' },
        { label: 'Allotment', date: '2024-11-29', status: 'upcoming' },
        { label: 'Refunds', date: '2024-11-30', status: 'upcoming' },
        { label: 'Credit to Demat', date: '2024-11-30', status: 'upcoming' },
        { label: 'Listing', date: '2024-12-01', status: 'upcoming' },
    ],

    // FAQs
    faqs: [
        { q: 'What is the Tata Technologies IPO price band?', a: 'The price band for Tata Technologies IPO is ‚Çπ475 to ‚Çπ500 per share. At the upper price band, the minimum investment required is ‚Çπ15,000 for 1 lot (30 shares).' },
        { q: 'When does Tata Technologies IPO open and close?', a: 'Tata Technologies IPO opens on November 22, 2024 and closes on November 24, 2024. The IPO is open for subscription for 3 days.' },
        { q: 'What is the current GMP for Tata Technologies IPO?', a: 'The current Grey Market Premium (GMP) for Tata Technologies IPO is ‚Çπ485, indicating an expected listing gain of approximately 97% over the issue price.' },
        { q: 'How to check Tata Technologies IPO allotment status?', a: 'You can check the allotment status on the registrar website (Link Intime) or on BSE/NSE websites using your PAN number or application number after the allotment date.' },
        { q: 'What is the lot size for Tata Technologies IPO?', a: 'The lot size is 30 shares. Retail investors can apply for minimum 1 lot (‚Çπ15,000) and maximum 13 lots (‚Çπ1,95,000).' },
    ],

    // Related IPOs
    relatedIPOs: [
        { id: 2, name: 'Fedbank Financial', priceRange: '‚Çπ133-140', gmp: 25, subscription: 2.43, logo: 'FF' },
        { id: 3, name: 'Gandhar Oil', priceRange: '‚Çπ160-169', gmp: 45, subscription: 8.76, logo: 'GO' },
        { id: 4, name: 'Flair Writing', priceRange: '‚Çπ288-304', gmp: 65, subscription: 15.23, logo: 'FW' },
    ],

    // Comments
    comments: [
        { id: 1, author: 'Rahul Sharma', date: '2024-11-24', body: 'Great IPO, definitely applying for long term. Tata brand gives confidence.' },
        { id: 2, author: 'Priya Patel', date: '2024-11-23', body: 'GMP is very high, might see some correction post listing. Careful with expectations.' },
        { id: 3, author: 'Amit Kumar', date: '2024-11-22', body: 'Applied from 3 accounts. High hopes for allotment!' },
    ],
};

type IPOStatus = 'Open for Subscription' | 'Closed' | 'Allotment Done' | 'Listed';

const getStatusClass = (status: IPOStatus) => {
    switch (status) {
        case 'Open for Subscription': return styles.statusOpen;
        case 'Closed': return styles.statusClosed;
        case 'Allotment Done': return styles.statusAllotment;
        case 'Listed': return styles.statusListed;
        default: return '';
    }
};

const getProgressColor = (value: number) => {
    if (value < 1) return styles.progressRed;
    if (value < 5) return styles.progressOrange;
    if (value < 10) return styles.progressYellow;
    return styles.progressGreen;
};

const formatDate = (dateStr: string) => {
    const date = new Date(dateStr);
    return date.toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' });
};

const formatCurrency = (amount: number) => `‚Çπ${amount.toLocaleString('en-IN')}`;

export default function IPODetailPage() {
    const params = useParams();
    const [ipo, setIpo] = useState(mockIPOData);
    const [openFaqs, setOpenFaqs] = useState<number[]>([]);
    const [showStickyFooter, setShowStickyFooter] = useState(false);

    useEffect(() => {
        const handleScroll = () => {
            setShowStickyFooter(window.scrollY > 500);
        };
        window.addEventListener('scroll', handleScroll);
        return () => window.removeEventListener('scroll', handleScroll);
    }, []);

    const toggleFaq = (index: number) => {
        setOpenFaqs(prev => prev.includes(index) ? prev.filter(i => i !== index) : [...prev, index]);
    };

    return (
        <div className={styles.pageWrapper}>
            {/* JSON-LD Schema Markup for SEO */}
            <IPOSchema
                companyName={ipo.companyName}
                gmp={ipo.gmp}
                gmpPercentage={ipo.gmpPercentage}
                subscription={ipo.subscription}
                priceMin={ipo.priceMin}
                priceMax={ipo.priceMax}
                openDate={ipo.openDate}
                closeDate={ipo.closeDate}
                allotmentDate={ipo.allotmentDate}
                listingDate={ipo.listingDate}
                registrar={ipo.registrar}
                registrarLink={ipo.registrarLink}
                faqs={ipo.faqs}
                slug={ipo.slug}
            />

            <div className={styles.container}>
                {/* Breadcrumb Navigation */}
                <Breadcrumb companyName={ipo.companyName} />

                {/* SECTION A: Hero */}
                <section className={styles.hero} aria-labelledby="hero-title">
                    <div className={styles.heroHeader}>
                        <div className={styles.heroLeft}>
                            <div className={styles.companyLogo} role="img" aria-label={`${ipo.companyName} logo`}>{ipo.logo}</div>
                            <div>
                                <h1 id="hero-title" className={styles.heroTitle}>{ipo.companyName} IPO - GMP, Subscription, Allotment Status, Review</h1>
                                <span className={`${styles.statusBadge} ${getStatusClass(ipo.status)}`} role="status" aria-live="polite">
                                    ‚óè {ipo.status}
                                </span>
                                <p className={styles.lastUpdated}>Last updated: <time dateTime={ipo.lastUpdated}>{formatDate(ipo.lastUpdated)}</time></p>
                            </div>
                        </div>
                        <button className={styles.alertButton} aria-label={`Set price alert for ${ipo.companyName} IPO`}>üîî Set Alert</button>
                    </div>

                    <div className={styles.metricsGrid}>
                        <div className={styles.metricCard}>
                            <div className={styles.metricLabel}>Grey Market Premium</div>
                            <div className={styles.metricValue}>{formatCurrency(ipo.gmp)}</div>
                            <div className={`${styles.metricChange} ${styles.positive}`}>+{ipo.gmpPercentage}%</div>
                        </div>
                        <div className={styles.metricCard}>
                            <div className={styles.metricLabel}>Subscription</div>
                            <div className={styles.metricValue}>{ipo.subscription}x</div>
                            <div className={`${styles.metricChange} ${styles.positive}`}>times</div>
                        </div>
                        <div className={styles.metricCard}>
                            <div className={styles.metricLabel}>Price Band</div>
                            <div className={styles.metricValue}>{formatCurrency(ipo.priceMin)} - {formatCurrency(ipo.priceMax)}</div>
                        </div>
                        <div className={styles.metricCard}>
                            <div className={styles.metricLabel}>Lot Size</div>
                            <div className={styles.metricValue}>{ipo.lotSize} shares</div>
                            <div className={styles.metricChange}>{formatCurrency(ipo.lotSize * ipo.priceMax)}</div>
                        </div>
                    </div>
                </section>

                {/* SECTION B: Quick Facts */}
                <section className={styles.section}>
                    <h2 className={styles.sectionTitle}><span className={styles.sectionIcon}>üìã</span> Quick Facts</h2>
                    <div className={styles.factsGrid}>
                        <div className={styles.factItem}><span className={styles.factLabel}>üìä Issue Type</span><span className={styles.factValue}>{ipo.issueType}</span></div>
                        <div className={styles.factItem}><span className={styles.factLabel}>üìÖ IPO Open Date</span><span className={styles.factValue}>{formatDate(ipo.openDate)}</span></div>
                        <div className={styles.factItem}><span className={styles.factLabel}>üí∞ Issue Size</span><span className={styles.factValue}>{formatCurrency(ipo.issueSize)} Cr</span></div>
                        <div className={styles.factItem}><span className={styles.factLabel}>üìÖ IPO Close Date</span><span className={styles.factValue}>{formatDate(ipo.closeDate)}</span></div>
                        <div className={styles.factItem}><span className={styles.factLabel}>üÜï Fresh Issue</span><span className={styles.factValue}>{formatCurrency(ipo.freshIssue)} Cr</span></div>
                        <div className={styles.factItem}><span className={styles.factLabel}>üìÖ Allotment Date</span><span className={styles.factValue}>{formatDate(ipo.allotmentDate)}</span></div>
                        <div className={styles.factItem}><span className={styles.factLabel}>üîÑ OFS</span><span className={styles.factValue}>{formatCurrency(ipo.ofs)} Cr</span></div>
                        <div className={styles.factItem}><span className={styles.factLabel}>üìÖ Listing Date</span><span className={styles.factValue}>{formatDate(ipo.listingDate)}</span></div>
                        <div className={styles.factItem}><span className={styles.factLabel}>üíµ Price Band</span><span className={styles.factValue}>{formatCurrency(ipo.priceMin)} - {formatCurrency(ipo.priceMax)}</span></div>
                        <div className={styles.factItem}><span className={styles.factLabel}>üìù Registrar</span><span className={styles.factValue}>{ipo.registrar}</span></div>
                        <div className={styles.factItem}><span className={styles.factLabel}>üì¶ Lot Size</span><span className={styles.factValue}>{ipo.lotSize} shares</span></div>
                        <div className={styles.factItem}><span className={styles.factLabel}>üè¢ Lead Managers</span><span className={styles.factValue}>{ipo.leadManagers.length} managers</span></div>
                        <div className={styles.factItem}><span className={styles.factLabel}>üí∏ Min Investment</span><span className={styles.factValue}>{formatCurrency(ipo.minInvestment)}</span></div>
                        <div className={styles.factItem}><span className={styles.factLabel}>üìà Exchange</span><span className={styles.factValue}>{ipo.exchanges.join(', ')}</span></div>
                    </div>
                </section>

                {/* SECTION C: Subscription Status */}
                <section className={styles.section}>
                    <h2 className={styles.sectionTitle}><span className={styles.sectionIcon}>üìä</span> Live Subscription Status</h2>
                    <div className={styles.subscriptionOverall}>
                        <div className={styles.overallLabel}>Overall Subscription</div>
                        <div className={styles.overallValue}>{ipo.subscriptionData.overall}x</div>
                        <div className={`${styles.overallTrend} ${styles.positive}`}>‚ñ≤ times subscribed</div>
                    </div>

                    <div className={styles.categoryCards}>
                        {[
                            { name: 'QIB', value: ipo.subscriptionData.qib },
                            { name: 'NII (bNII)', value: ipo.subscriptionData.bNII },
                            { name: 'NII (sNII)', value: ipo.subscriptionData.sNII },
                            { name: 'Retail (RII)', value: ipo.subscriptionData.retail },
                            { name: 'Employee', value: ipo.subscriptionData.employee },
                        ].map((cat) => (
                            <div key={cat.name} className={styles.categoryCard}>
                                <div className={styles.categoryName}>{cat.name}</div>
                                <div className={styles.categoryValue}>{cat.value}x</div>
                                <div className={styles.progressBar}>
                                    <div
                                        className={`${styles.progressFill} ${getProgressColor(cat.value)}`}
                                        style={{ width: `${Math.min(cat.value * 10, 100)}%` }}
                                    />
                                </div>
                            </div>
                        ))}
                    </div>

                    <div className={styles.refreshRow}>
                        <span className={styles.timestamp}>Updated: {formatDate(ipo.lastUpdated)}</span>
                        <button className={styles.refreshButton}>üîÑ Refresh Now</button>
                    </div>
                </section>

                {/* SECTION D: GMP Tracker */}
                <section className={styles.section}>
                    <h2 className={styles.sectionTitle}><span className={styles.sectionIcon}>üíπ</span> Grey Market Premium (GMP) Analysis</h2>
                    <div className={styles.gmpGrid}>
                        <div className={styles.gmpMainCard}>
                            <div className={styles.gmpAmount}>{formatCurrency(ipo.gmp)}</div>
                            <div className={styles.gmpRow}><span className={styles.gmpLabel}>GMP Premium</span><span className={`${styles.gmpValue} ${styles.positive}`}>+{ipo.gmpPercentage}%</span></div>
                            <div className={styles.gmpRow}><span className={styles.gmpLabel}>Expected Listing</span><span className={styles.gmpValue}>{formatCurrency(ipo.priceMax + ipo.gmp)}</span></div>
                            <div className={styles.gmpRow}><span className={styles.gmpLabel}>Est. Listing Gain</span><span className={`${styles.gmpValue} ${styles.positive}`}>{formatCurrency(ipo.gmp * ipo.lotSize)}</span></div>
                            <div className={styles.gmpRow}><span className={styles.gmpLabel}>Kostak Rate</span><span className={styles.gmpValue}>{formatCurrency(ipo.kostakRate)}</span></div>
                            <div className={styles.gmpRow}><span className={styles.gmpLabel}>Subject to Sauda</span><span className={styles.gmpValue}>{formatCurrency(ipo.subjectToSauda)}</span></div>
                        </div>

                        <div className={styles.gmpChart}>
                            <div className={styles.chartTitle}>GMP Trend (Last 5 Days)</div>
                            <div className={styles.chartArea}>
                                {ipo.gmpHistory.slice().reverse().map((day, i) => (
                                    <div key={i} className={styles.chartBar} style={{ height: `${(day.gmp / 500) * 100}%` }} title={`${day.date}: ‚Çπ${day.gmp}`} />
                                ))}
                            </div>
                        </div>
                    </div>

                    <div className={styles.gmpHistoryTable}>
                        <table className={styles.historyTable}>
                            <thead>
                                <tr><th>Date</th><th>GMP (‚Çπ)</th><th>Change</th><th>Premium (%)</th></tr>
                            </thead>
                            <tbody>
                                {ipo.gmpHistory.map((day, i) => (
                                    <tr key={i}>
                                        <td>{formatDate(day.date)}</td>
                                        <td>{formatCurrency(day.gmp)}</td>
                                        <td className={styles.positive}>{day.change}</td>
                                        <td>{day.premium}%</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>

                    <div className={styles.disclaimer}>‚ö†Ô∏è GMP Disclaimer: Grey market premiums are unofficial and may not reflect actual listing performance. Invest based on fundamentals.</div>
                </section>

                {/* SECTION E: Allotment Details */}
                <section className={styles.section}>
                    <h2 className={styles.sectionTitle}><span className={styles.sectionIcon}>üéØ</span> IPO Allotment Status & Details</h2>
                    <div className={styles.allotmentGrid}>
                        <div className={styles.allotmentCard}>
                            <h3>Allotment Status</h3>
                            <p style={{ marginBottom: '1rem', color: 'var(--neutral-200)' }}>Expected on: {formatDate(ipo.allotmentDate)}</p>
                            <a href={ipo.registrarLink} target="_blank" rel="noopener noreferrer" className={styles.registrarLink}>
                                üîó Check on {ipo.registrar}
                            </a>
                        </div>
                        <div className={styles.allotmentCard}>
                            <h3>Refund Information</h3>
                            <p style={{ color: 'var(--neutral-200)', marginBottom: '0.5rem' }}>Refund Date: {formatDate(ipo.timeline.find(t => t.label === 'Refunds')?.date || '')}</p>
                            <p style={{ color: 'var(--neutral-200)' }}>Credit to Demat: {formatDate(ipo.listingDate)}</p>
                        </div>
                    </div>
                </section>

                {/* SECTION F: Financials */}
                <section className={styles.section}>
                    <h2 className={styles.sectionTitle}><span className={styles.sectionIcon}>üí∞</span> Company Financial Performance</h2>
                    <div className={styles.financialCards}>
                        {[
                            { label: 'Revenue (FY23)', value: `‚Çπ${ipo.financials.revenueFY23} Cr` },
                            { label: 'PAT (FY23)', value: `‚Çπ${ipo.financials.patFY23} Cr` },
                            { label: 'Net Worth', value: `‚Çπ${ipo.financials.netWorth} Cr` },
                            { label: 'EPS', value: `‚Çπ${ipo.financials.eps}` },
                            { label: 'P/E Ratio', value: `${ipo.financials.peRatio}x` },
                            { label: 'RoNW', value: `${ipo.financials.ronw}%` },
                            { label: 'Debt/Equity', value: `${ipo.financials.debtToEquity}` },
                        ].map((metric) => (
                            <div key={metric.label} className={styles.financialCard}>
                                <div className={styles.financialLabel}>{metric.label}</div>
                                <div className={styles.financialValue}>{metric.value}</div>
                            </div>
                        ))}
                    </div>

                    <table className={styles.financialTable}>
                        <thead><tr><th>Particulars</th><th>FY23</th><th>FY22</th><th>FY21</th><th>Growth</th></tr></thead>
                        <tbody>
                            <tr><td>Revenue (‚Çπ Cr)</td><td>{ipo.financials.revenueFY23}</td><td>{ipo.financials.revenueFY22}</td><td>{ipo.financials.revenueFY21}</td><td className={styles.positive}>+25%</td></tr>
                            <tr><td>PAT (‚Çπ Cr)</td><td>{ipo.financials.patFY23}</td><td>{ipo.financials.patFY22}</td><td>{ipo.financials.patFY21}</td><td className={styles.positive}>+42%</td></tr>
                        </tbody>
                    </table>
                </section>

                {/* SECTION G: Issue Details */}
                <section className={styles.section}>
                    <h2 className={styles.sectionTitle}><span className={styles.sectionIcon}>üìÑ</span> IPO Details</h2>
                    <div className={styles.issueGrid}>
                        <div className={styles.issueBreakup}>
                            <h3>Issue Breakup</h3>
                            {[
                                { label: 'Fresh Issue', value: `‚Çπ${ipo.issueBreakup.freshIssue} Cr (${ipo.issueBreakup.freshIssuePercent}%)` },
                                { label: 'Offer for Sale', value: `‚Çπ${ipo.issueBreakup.ofs} Cr (${ipo.issueBreakup.ofsPercent}%)` },
                                { label: 'Total Issue Size', value: `‚Çπ${ipo.issueBreakup.totalIssue} Cr` },
                                { label: 'Market Cap (Upper)', value: `‚Çπ${ipo.issueBreakup.marketCap} Cr` },
                            ].map((item) => (
                                <div key={item.label} className={styles.breakupItem}>
                                    <span className={styles.breakupLabel}>{item.label}</span>
                                    <span className={styles.breakupValue}>{item.value}</span>
                                </div>
                            ))}
                        </div>
                        <div className={styles.useFunds}>
                            <h3>Use of Funds</h3>
                            <div className={styles.pieChart} style={{ background: `conic-gradient(${ipo.useOfFunds.map((f, i) => `${f.color} ${i === 0 ? 0 : ipo.useOfFunds.slice(0, i).reduce((a, b) => a + b.percentage, 0)}% ${ipo.useOfFunds.slice(0, i + 1).reduce((a, b) => a + b.percentage, 0)}%`).join(', ')})` }} />
                            <div className={styles.pieLegend}>
                                {ipo.useOfFunds.map((fund) => (
                                    <div key={fund.label} className={styles.legendItem}>
                                        <span className={styles.legendColor} style={{ background: fund.color }} />
                                        <span>{fund.label}: {fund.percentage}%</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </section>

                {/* SECTION H: Shareholding */}
                <section className={styles.section}>
                    <h2 className={styles.sectionTitle}><span className={styles.sectionIcon}>üèõÔ∏è</span> Shareholding Pattern</h2>
                    <div className={styles.shareholdingGrid}>
                        <div className={styles.shareholdingCard}>
                            <h3>Pre-IPO Shareholding</h3>
                            <div className={styles.pieChart} style={{ background: `conic-gradient(${ipo.preIpoShareholding.map((s, i) => `${s.color} ${i === 0 ? 0 : ipo.preIpoShareholding.slice(0, i).reduce((a, b) => a + b.percentage, 0)}% ${ipo.preIpoShareholding.slice(0, i + 1).reduce((a, b) => a + b.percentage, 0)}%`).join(', ')})` }} />
                            <div className={styles.pieLegend}>
                                {ipo.preIpoShareholding.map((s) => (
                                    <div key={s.label} className={styles.legendItem}><span className={styles.legendColor} style={{ background: s.color }} /><span>{s.label}: {s.percentage}%</span></div>
                                ))}
                            </div>
                        </div>
                        <div className={styles.shareholdingCard}>
                            <h3>Post-IPO Shareholding</h3>
                            <div className={styles.pieChart} style={{ background: `conic-gradient(${ipo.postIpoShareholding.map((s, i) => `${s.color} ${i === 0 ? 0 : ipo.postIpoShareholding.slice(0, i).reduce((a, b) => a + b.percentage, 0)}% ${ipo.postIpoShareholding.slice(0, i + 1).reduce((a, b) => a + b.percentage, 0)}%`).join(', ')})` }} />
                            <div className={styles.pieLegend}>
                                {ipo.postIpoShareholding.map((s) => (
                                    <div key={s.label} className={styles.legendItem}><span className={styles.legendColor} style={{ background: s.color }} /><span>{s.label}: {s.percentage}%</span></div>
                                ))}
                            </div>
                        </div>
                    </div>
                    <table className={styles.promoterTable}>
                        <thead><tr><th>Promoter Name</th><th>Relationship</th><th>Pre-IPO (%)</th><th>Post-IPO (%)</th></tr></thead>
                        <tbody>
                            {ipo.promoters.map((p, i) => (
                                <tr key={i}><td>{p.name}</td><td>{p.relationship}</td><td>{p.preIpo}%</td><td>{p.postIpo}%</td></tr>
                            ))}
                        </tbody>
                    </table>
                </section>

                {/* SECTION I: About Company */}
                <section className={styles.section}>
                    <h2 className={styles.sectionTitle}><span className={styles.sectionIcon}>üè¢</span> About {ipo.companyName}</h2>
                    <div className={styles.companyOverview}><p>{ipo.about.overview}</p></div>
                    <h3 style={{ marginBottom: '1rem', color: 'var(--neutral-100)' }}>Key Highlights</h3>
                    <div className={styles.highlights}>
                        {ipo.about.highlights.map((h, i) => (
                            <div key={i} className={styles.highlightItem}><span className={styles.highlightIcon}>‚úì</span><span className={styles.highlightText}>{h}</span></div>
                        ))}
                    </div>
                </section>

                {/* SECTION J: Expert Review */}
                <section className={styles.section}>
                    <h2 className={styles.sectionTitle}><span className={styles.sectionIcon}>‚≠ê</span> IPO Review & Recommendation</h2>
                    <div className={styles.reviewHeader}>
                        <div className={styles.overallRating}>
                            <div className={styles.ratingStars}>{'‚òÖ'.repeat(Math.floor(ipo.review.overall))}{'‚òÜ'.repeat(5 - Math.floor(ipo.review.overall))}</div>
                            <div className={styles.ratingLabel}>{ipo.review.overall} out of 5</div>
                        </div>
                        <div className={styles.ratingBars}>
                            {Object.entries(ipo.review.ratings).map(([key, value]) => (
                                <div key={key} className={styles.ratingItem}>
                                    <span className={styles.ratingName}>{key.charAt(0).toUpperCase() + key.slice(1)}</span>
                                    <div className={styles.ratingBar}><div className={styles.ratingFill} style={{ width: `${value * 20}%` }} /></div>
                                    <span className={styles.ratingValue}>{value}/5</span>
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className={styles.prosConsGrid}>
                        <div className={styles.prosSection}>
                            <h3>‚úì Strengths</h3>
                            <ul className={styles.prosList}>{ipo.review.strengths.map((s, i) => <li key={i}><span>‚úì</span> {s}</li>)}</ul>
                        </div>
                        <div className={styles.consSection}>
                            <h3>‚ö† Concerns</h3>
                            <ul className={styles.consList}>{ipo.review.concerns.map((c, i) => <li key={i}><span>‚ö†</span> {c}</li>)}</ul>
                        </div>
                    </div>

                    <div className={styles.recommendationBox}>
                        <div className={styles.recommendationLabel}>Expert Recommendation</div>
                        <div className={styles.recommendationValue}>{ipo.review.recommendation}</div>
                        <p style={{ color: 'var(--neutral-200)', fontSize: '0.875rem' }}>Risk Level: {ipo.review.riskLevel} | Horizon: {ipo.review.investmentHorizon}</p>
                        <div className={styles.poll}>
                            <div className={styles.pollOption}>
                                <div className={styles.pollPercent}>{ipo.poll.yes}%</div>
                                <div className={styles.pollBar}><div className={`${styles.pollFill} ${styles.pollYes}`} style={{ width: `${ipo.poll.yes}%` }} /></div>
                                <div className={styles.pollLabel}>Should Apply</div>
                            </div>
                            <div className={styles.pollOption}>
                                <div className={styles.pollPercent}>{ipo.poll.no}%</div>
                                <div className={styles.pollBar}><div className={`${styles.pollFill} ${styles.pollNo}`} style={{ width: `${ipo.poll.no}%` }} /></div>
                                <div className={styles.pollLabel}>Should Skip</div>
                            </div>
                        </div>
                        <p style={{ marginTop: '1rem', color: 'var(--neutral-200)', fontSize: '0.75rem' }}>{ipo.poll.totalVotes.toLocaleString()} investors voted</p>
                    </div>
                </section>

                {/* SECTION K: Timeline */}
                <section className={styles.section}>
                    <h2 className={styles.sectionTitle}><span className={styles.sectionIcon}>üìÖ</span> IPO Timeline & Important Dates</h2>
                    <div className={styles.timeline}>
                        <div className={styles.timelineTrack}><div className={styles.timelineProgress} style={{ width: '37.5%' }} /></div>
                        <div className={styles.timelineItems}>
                            {ipo.timeline.map((item, i) => (
                                <div key={i} className={styles.timelineItem}>
                                    <div className={`${styles.timelineDot} ${item.status === 'completed' ? styles.completed : item.status === 'active' ? styles.active : ''}`} />
                                    <div><div className={styles.timelineLabel}>{item.label}</div><div className={styles.timelineDate}>{formatDate(item.date)}</div></div>
                                </div>
                            ))}
                        </div>
                    </div>
                    <div className={styles.countdown}>
                        <div className={styles.countdownLabel}>Time to IPO Close</div>
                        <div className={styles.countdownValue}>2 Days 8 Hours 30 Minutes</div>
                    </div>
                </section>

                {/* SECTION L: Registrar */}
                <section className={styles.section}>
                    <h2 className={styles.sectionTitle}><span className={styles.sectionIcon}>üèõÔ∏è</span> Registrar & Lead Managers</h2>
                    <div className={styles.registrarGrid}>
                        <div className={styles.registrarCard}>
                            <h3>Registrar</h3>
                            <div className={styles.registrarInfo}>
                                <p><strong>{ipo.registrar}</strong></p>
                                <p>Website: <a href={ipo.registrarLink} target="_blank" rel="noopener noreferrer" style={{ color: 'var(--accent-cyan)' }}>{ipo.registrarLink}</a></p>
                            </div>
                            <a href={ipo.registrarLink} target="_blank" rel="noopener noreferrer" className={styles.registrarLink} style={{ marginTop: '1rem', display: 'inline-flex' }}>Check Allotment Status</a>
                        </div>
                        <div className={styles.registrarCard}>
                            <h3>Book Running Lead Managers</h3>
                            <div className={styles.leadManagers}>
                                {ipo.leadManagers.map((m, i) => <span key={i} className={styles.managerBadge}>{m}</span>)}
                            </div>
                        </div>
                    </div>
                </section>

                {/* SECTION M: How to Apply */}
                <section className={styles.section}>
                    <h2 className={styles.sectionTitle}><span className={styles.sectionIcon}>üìù</span> How to Apply for {ipo.companyName} IPO</h2>
                    <div className={styles.stepsGrid}>
                        {[
                            { num: 1, title: 'Log in to your Demat Account', desc: 'Access your trading/demat account through your broker app or website.' },
                            { num: 2, title: 'Navigate to IPO Section', desc: 'Find the IPO or New Issues section in your trading platform.' },
                            { num: 3, title: `Select ${ipo.companyName} IPO`, desc: 'Click on the IPO to view details and apply.' },
                            { num: 4, title: 'Choose Number of Lots', desc: `Min: 1 lot (${ipo.lotSize} shares = ${formatCurrency(ipo.minInvestment)})` },
                            { num: 5, title: 'Select UPI ID or ASBA', desc: 'Enter your UPI ID for payment or select ASBA through your bank.' },
                            { num: 6, title: 'Submit Application', desc: 'Review details and submit your application.' },
                            { num: 7, title: 'Approve UPI Request', desc: 'Accept the mandate request in your UPI app within 24 hours.' },
                        ].map((step) => (
                            <div key={step.num} className={styles.step}>
                                <div className={styles.stepNumber}>{step.num}</div>
                                <div className={styles.stepContent}><h4>{step.title}</h4><p>{step.desc}</p>
                                    {step.num === 1 && (
                                        <div className={styles.brokerLinks}>
                                            {['Zerodha', 'Upstox', 'Groww', 'Angel One', 'ICICI Direct'].map((b) => <span key={b} className={styles.brokerLink}>{b}</span>)}
                                        </div>
                                    )}
                                </div>
                            </div>
                        ))}
                    </div>
                </section>

                {/* SECTION N: FAQs */}
                <section className={styles.section} aria-labelledby="faq-heading">
                    <h2 id="faq-heading" className={styles.sectionTitle}><span className={styles.sectionIcon}>‚ùì</span> Frequently Asked Questions</h2>
                    <div className={styles.faqList} role="region" aria-label="FAQ accordion">
                        {ipo.faqs.map((faq, i) => (
                            <div key={i} className={`${styles.faqItem} ${openFaqs.includes(i) ? styles.open : ''}`}>
                                <button
                                    className={styles.faqQuestion}
                                    onClick={() => toggleFaq(i)}
                                    aria-expanded={openFaqs.includes(i)}
                                    aria-controls={`faq-answer-${i}`}
                                    id={`faq-question-${i}`}
                                >
                                    {faq.q}
                                    <span className={styles.faqIcon} aria-hidden="true">+</span>
                                </button>
                                <div
                                    className={styles.faqAnswer}
                                    id={`faq-answer-${i}`}
                                    role="region"
                                    aria-labelledby={`faq-question-${i}`}
                                    hidden={!openFaqs.includes(i)}
                                >
                                    <div className={styles.faqAnswerContent}>{faq.a}</div>
                                </div>
                            </div>
                        ))}
                    </div>
                </section>

                {/* SECTION O: Related IPOs */}
                <section className={styles.section}>
                    <h2 className={styles.sectionTitle}><span className={styles.sectionIcon}>üìà</span> Similar IPOs You Might Be Interested In</h2>
                    <div className={styles.relatedScroll}>
                        {ipo.relatedIPOs.map((related) => (
                            <div key={related.id} className={styles.relatedCard}>
                                <div className={styles.relatedHeader}>
                                    <div className={styles.relatedLogo}>{related.logo}</div>
                                    <div className={styles.relatedName}>{related.name}</div>
                                </div>
                                <div className={styles.relatedMeta}>
                                    <div className={styles.relatedRow}><span className={styles.relatedLabel}>Price</span><span className={styles.relatedValue}>{related.priceRange}</span></div>
                                    <div className={styles.relatedRow}><span className={styles.relatedLabel}>GMP</span><span className={`${styles.relatedValue} ${styles.positive}`}>‚Çπ{related.gmp}</span></div>
                                    <div className={styles.relatedRow}><span className={styles.relatedLabel}>Subscription</span><span className={styles.relatedValue}>{related.subscription}x</span></div>
                                </div>
                                <Link href={`/ipo/${related.name.toLowerCase().replace(/\s+/g, '-')}-ipo-gmp-allotment-subscription`}><button className={styles.viewButton}>View Details</button></Link>
                            </div>
                        ))}
                    </div>
                </section>

                {/* SECTION P: Comments */}
                <section className={styles.section}>
                    <h2 className={styles.sectionTitle}><span className={styles.sectionIcon}>üí¨</span> Investor Discussion & Comments</h2>
                    <p style={{ marginBottom: '1.5rem', color: 'var(--neutral-200)' }}>{ipo.comments.length} investors have shared their views</p>

                    <div className={styles.commentForm}>
                        <div className={styles.formRow}>
                            <div className={styles.formGroup}><label>Name</label><input type="text" placeholder="Your name" /></div>
                            <div className={styles.formGroup}><label>Email</label><input type="email" placeholder="your@email.com" /></div>
                        </div>
                        <div className={styles.formGroup} style={{ marginBottom: '1rem' }}><label>Comment</label><textarea placeholder="Share your views on this IPO..." /></div>
                        <button className={styles.submitButton}>Submit Comment</button>
                    </div>

                    <div className={styles.commentsList}>
                        {ipo.comments.map((comment) => (
                            <div key={comment.id} className={styles.comment}>
                                <div className={styles.commentHeader}><span className={styles.commentAuthor}>{comment.author}</span><span className={styles.commentDate}>{formatDate(comment.date)}</span></div>
                                <div className={styles.commentBody}>{comment.body}</div>
                            </div>
                        ))}
                    </div>
                    <button className={styles.loadMore}>Load More Comments</button>
                </section>
            </div>

            {/* SECTION Q: Sticky Footer */}
            <div className={`${styles.stickyFooter} ${showStickyFooter ? styles.visible : ''}`}>
                <div className={styles.footerContent}>
                    <span className={styles.footerTitle}>Track {ipo.companyName} IPO</span>
                    <div className={styles.footerActions}>
                        <button className={`${styles.footerButton} ${styles.alertBtn}`}>üîî Set Alert</button>
                        <button className={`${styles.footerButton} ${styles.watchlistBtn}`}>‚≠ê Watchlist</button>
                        <button className={`${styles.footerButton} ${styles.shareBtn}`}>üì§ Share</button>
                    </div>
                </div>
            </div>
        </div>
    );
}
</file>

<file path="app/layout.tsx">
import { Playfair_Display, IBM_Plex_Sans, JetBrains_Mono } from 'next/font/google';
import './globals.css';
import Navigation from '@/components/Navigation';

const playfair = Playfair_Display({
  subsets: ['latin'],
  weight: ['700', '900'],
  variable: '--font-playfair',
});

const ibmPlex = IBM_Plex_Sans({
  subsets: ['latin'],
  weight: ['300', '400', '500', '600'],
  variable: '--font-ibm-plex',
});

const jetbrains = JetBrains_Mono({
  subsets: ['latin'],
  weight: ['400', '500'],
  variable: '--font-jetbrains',
});

export const metadata = {
  title: 'IPO Tracker - Market Intelligence',
  description: 'Comprehensive IPO data, Grey Market Premium tracking, and shareholder analysis',
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      <body className={`${playfair.variable} ${ibmPlex.variable} ${jetbrains.variable}`} suppressHydrationWarning>
        <Navigation />
        <main className="main-content">
          {children}
        </main>
      </body>
    </html>
  );
}
</file>

<file path="app/page.module.css">
/* ============================================
   Homepage Layout - Elegant Theme
   ============================================ */

.homepage {
  min-height: 100vh;
  background: linear-gradient(135deg, #1a3a3a 0%, #2c5f5f 50%, #1a3a3a 100%);
}

.loadingContainer {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: var(--beige, #e8e5d6);
  gap: 1.5rem;
}

.loader {
  width: 48px;
  height: 48px;
  border: 4px solid var(--teal-dark, #1a3a3a);
  border-top-color: var(--accent-green, #22c55e);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

.loadingText {
  font-size: 1rem;
  font-family: var(--font-body);
  color: var(--teal-dark, #1a3a3a);
  text-transform: uppercase;
  letter-spacing: 0.1em;
}

/* Hero Section - Teal Gradient */
.heroSection {
  background: linear-gradient(135deg, #1a3a3a 0%, #2d5555 50%, #1a3a3a 100%);
  padding: 5rem 3rem 6rem;
  position: relative;
  overflow: hidden;
}

.heroSection::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background:
    radial-gradient(circle at 20% 50%, rgba(34, 197, 94, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 80% 80%, rgba(59, 130, 246, 0.1) 0%, transparent 50%);
  pointer-events: none;
}

.heroContent {
  width: 100%;
  max-width: none;
  margin: 0 auto;
  padding: 0 5%;
  position: relative;
  z-index: 1;
  display: grid;
  grid-template-columns: 1.2fr 1fr;
  gap: 8rem;
  align-items: center;
}

/* Slightly reduce gap on medium-large screens */
@media (min-width: 1600px) {
  .heroContent {
    gap: 12rem;
  }
}

@media (min-width: 2000px) {
  .heroContent {
    gap: 16rem;
  }
}

.heroText {
  /* Text section on the left */
}

/* Hero Badge */
.heroBadge {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  padding: 0.5rem 1.25rem;
  border-radius: 50px;
  margin-bottom: 2rem;
  animation: fadeInDown 0.8s ease-out;
}

.pulseDot {
  width: 8px;
  height: 8px;
  background: var(--accent-green, #22c55e);
  border-radius: 50%;
  animation: pulse 2s infinite;
}

@keyframes pulse {

  0%,
  100% {
    opacity: 1;
    transform: scale(1);
  }

  50% {
    opacity: 0.5;
    transform: scale(1.2);
  }
}

.badgeText {
  color: #fff;
  font-size: 0.9rem;
  font-weight: 500;
}

.heroTitle {
  font-size: 4.5rem;
  font-weight: 900;
  font-family: var(--font-heading, 'Inter', sans-serif);
  color: #fff;
  line-height: 1.1;
  margin-bottom: 1.5rem;
  letter-spacing: -2px;
  animation: fadeInUp 0.8s ease-out 0.2s both;
}

.gradientText {
  background: linear-gradient(135deg, #22c55e 0%, #3b82f6 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  display: inline-block;
}

.heroSubtitle {
  font-size: 1.35rem;
  font-family: var(--font-body, 'Inter', sans-serif);
  color: rgba(255, 255, 255, 0.85);
  max-width: 700px;
  line-height: 1.6;
  margin-bottom: 2.5rem;
  animation: fadeInUp 0.8s ease-out 0.4s both;
}

/* Hero Stats */
.heroStats {
  display: flex;
  gap: 3rem;
  animation: fadeInUp 0.8s ease-out 0.6s both;
}

.statItem {
  display: flex;
  flex-direction: column;
}

.statNumber {
  font-size: 2.5rem;
  font-weight: 800;
  color: var(--accent-green, #22c55e);
  line-height: 1;
  margin-bottom: 0.5rem;
}

.statLabel {
  font-size: 0.95rem;
  color: rgba(255, 255, 255, 0.7);
  font-weight: 500;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fadeInDown {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Hero Card - Floating on Right */
@keyframes float {

  0%,
  100% {
    transform: translateY(0px);
  }

  50% {
    transform: translateY(-20px);
  }
}

@keyframes blink {

  0%,
  100% {
    opacity: 1;
  }

  50% {
    opacity: 0.3;
  }
}

/* Container for stacked cards */
.heroCardsContainer {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.heroCard {
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 24px;
  padding: 2rem;
  transition: all 0.4s ease;
  animation: float 6s ease-in-out infinite;
}

.heroCardSecond {
  animation-delay: -3s;
  /* Offset animation for visual interest */
}

.heroCard:hover {
  transform: translateY(-10px) scale(1.02);
  box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
}

/* Upcoming badge (yellow) */
.upcomingBadge {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  background: #ffd93d;
  padding: 0.5rem 1rem;
  border-radius: 20px;
  font-size: 0.85rem;
  font-weight: 600;
  color: #1a2e2e;
}

.upcomingDot {
  width: 8px;
  height: 8px;
  background: #1a2e2e;
  border-radius: 50%;
}

.cardHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
}

.cardTitle {
  font-size: 1.5rem;
  font-weight: 700;
  color: #fff;
  margin: 0;
}

.liveBadge {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  background: #ff3b3b;
  padding: 0.5rem 1rem;
  border-radius: 20px;
  font-size: 0.85rem;
  font-weight: 600;
  color: white;
}

.liveDot {
  width: 8px;
  height: 8px;
  background: white;
  border-radius: 50%;
  animation: blink 1.5s infinite;
}

.cardMetrics {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.metric {
  text-align: center;
}

.metricLabel {
  font-size: 0.8rem;
  color: rgba(255, 255, 255, 0.6);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: 0.5rem;
}

.metricValue {
  font-size: 2rem;
  font-weight: 700;
  color: #3fffc3;
}

.positive {
  color: #00d9a3 !important;
}

.cardFooter {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-top: 1.5rem;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.cardFooterItem {
  display: flex;
  flex-direction: column;
}

.footerLabel {
  font-size: 0.85rem;
  color: rgba(255, 255, 255, 0.6);
  margin-bottom: 0.3rem;
}

.footerValue {
  font-size: 1.1rem;
  font-weight: 600;
  color: #3fffc3;
}

/* Container - Matches page gradient */
.container {
  width: 100%;
  max-width: none;
  margin: 0 auto;
  padding: 4rem 5%;
  background: transparent;
}

/* Cards Grid */
.cardsGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
  gap: 2rem;
  margin-bottom: 4rem;
}

.noFeatured {
  grid-column: 1 / -1;
  text-align: center;
  padding: 3rem;
  background: rgba(26, 58, 58, 0.05);
  border: 2px solid rgba(26, 58, 58, 0.1);
  border-radius: 8px;
  color: var(--teal-mid, #2d4a4a);
  font-family: var(--font-body);
}

.noFeaturedSub {
  margin-top: 0.5rem;
  color: var(--teal-mid, #2d4a4a);
  opacity: 0.7;
  font-size: 0.875rem;
}

/* Legacy styles - keep for compatibility */
.featuredGrid {
  composes: cardsGrid;
}

.heroBottom {
  display: none;
}

.noAnalysisTiles {
  display: none;
}

/* Section Styling - Elegant Theme */
.dashboardSection,
.filtersSection,
.heatmapSection,
.calendarSection,
.comparisonSection {
  width: 100%;
  max-width: none;
  margin: 0 auto;
  padding: 3rem 5%;
  position: relative;
}

/* Hide the calculator section */
.calculatorSection {
  display: none;
}

.dashboardSection::after,
.heatmapSection::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 2rem;
  right: 2rem;
  height: 2px;
  background: var(--beige-dark, #d0cbb8);
}

.filtersSection::after,
.comparisonSection::after,
.calendarSection::after {
  display: none;
}

.filtersSection {
  padding-top: 1.5rem;
  padding-bottom: 1.5rem;
}

/* Heatmap and Calendar side by side layout */
.heatmapSection {
  float: left;
  width: calc(65% - 1rem);
  margin-right: 1rem;
  padding-bottom: 2rem;
  display: flex;
  flex-direction: column;
}

.heatmapSection::after {
  display: none;
}

.heatmapSection>* {
  flex: 1;
}

.calendarSection {
  float: left;
  width: 35%;
  padding-top: 3rem;
  padding-bottom: 2rem;
  display: flex;
  flex-direction: column;
}

.calendarSection>* {
  flex: 1;
}

/* Clear float after calendar */
.comparisonSection {
  clear: both;
}

.sectionTitle {
  font-size: 1.75rem;
  font-family: var(--font-heading);
  color: var(--teal-dark, #1a3a3a);
  margin-bottom: 1.5rem;
  display: inline-block;
  background: var(--beige-dark, #d0cbb8);
  padding: 0.5rem 1.5rem;
  border-radius: 4px;
  text-transform: uppercase;
}

.sectionTitle::before {
  display: none;
}

/* Responsive Design */

/* Large tablets and small desktops */
@media (max-width: 1200px) {
  .heroContent {
    gap: 8rem;
  }

  .cardsGrid {
    grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
  }
}

@media (max-width: 1024px) {
  .heroBottom {
    grid-template-columns: repeat(2, 1fr);
  }

  .heroContent {
    grid-template-columns: 1fr;
    gap: 2.5rem;
  }

  .heroCardsContainer {
    display: flex;
    flex-direction: row;
    gap: 1rem;
    overflow-x: auto;
    padding-bottom: 1rem;
    -webkit-overflow-scrolling: touch;
  }

  .heroCard {
    min-width: 300px;
    flex-shrink: 0;
  }

  .heroTitle {
    font-size: 3.5rem;
  }

  .cardsGrid {
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
  }

  /* Side-by-side sections become stacked */
  .heatmapSection,
  .calendarSection {
    float: none;
    width: 100%;
    margin-right: 0;
  }
}

/* Tablets */
@media (max-width: 768px) {
  .heroSection {
    padding: 2.5rem 1.25rem 3rem;
  }

  .heroContent {
    grid-template-columns: 1fr;
    gap: 2rem;
  }

  .heroCardsContainer,
  .heroCard {
    display: none;
  }

  .heroTitle {
    font-size: 2.25rem;
    letter-spacing: -1px;
  }

  .heroSubtitle {
    font-size: 0.9375rem;
    margin-bottom: 1.5rem;
  }

  .heroBadge {
    padding: 0.4rem 1rem;
    margin-bottom: 1.5rem;
  }

  .badgeText {
    font-size: 0.8rem;
  }

  .heroStats {
    flex-direction: row;
    flex-wrap: wrap;
    gap: 1.5rem;
    justify-content: flex-start;
  }

  .statItem {
    min-width: 45%;
  }

  .statNumber {
    font-size: 2rem;
  }

  .statLabel {
    font-size: 0.875rem;
  }

  .cardsGrid,
  .featuredGrid {
    grid-template-columns: 1fr;
    padding: 0;
    gap: 1.25rem;
  }

  .heroBottom {
    padding: 0 1rem;
    gap: 1.25rem;
  }

  .sectionTitle {
    font-size: 1.375rem;
    padding: 0.375rem 1rem;
  }

  .container {
    padding: 2.5rem 1rem;
  }

  .dashboardSection,
  .filtersSection,
  .calculatorSection,
  .heatmapSection,
  .calendarSection,
  .comparisonSection {
    padding: 2rem 1rem;
    float: none;
    width: 100%;
    margin-right: 0;
  }

  .dashboardSection::after,
  .calculatorSection::after,
  .heatmapSection::after,
  .calendarSection::after {
    left: 1rem;
    right: 1rem;
  }
}

/* Mobile phones */
@media (max-width: 480px) {
  .heroSection {
    padding: 2rem 1rem 2.5rem;
  }

  .heroTitle {
    font-size: 1.875rem;
    letter-spacing: -0.5px;
  }

  .heroSubtitle {
    font-size: 0.875rem;
    line-height: 1.5;
  }

  .heroStats {
    flex-direction: column;
    gap: 1rem;
  }

  .statItem {
    min-width: 100%;
    flex-direction: row;
    align-items: center;
    justify-content: space-between;
  }

  .statNumber {
    font-size: 1.75rem;
  }

  .container {
    padding: 2rem 0.75rem;
  }

  .cardsGrid,
  .featuredGrid {
    gap: 1rem;
  }

  .sectionTitle {
    font-size: 1.125rem;
    padding: 0.25rem 0.75rem;
  }

  .dashboardSection,
  .filtersSection,
  .calculatorSection,
  .heatmapSection,
  .calendarSection,
  .comparisonSection {
    padding: 1.5rem 0.75rem;
  }
}
</file>

<file path="app/page.tsx">
'use client';

import { useEffect, useState } from 'react';
import styles from './page.module.css';
import FeaturedIPOCard from '@/components/homepage/FeaturedIPOCard';
import IPOCategoryChart from '@/components/homepage/IPOCategoryChart';
import DashboardTabs from '@/components/homepage/DashboardTabs';
import IPOFilters from '@/components/homepage/IPOFilters';
import ShouldIApplyCalculator from '@/components/homepage/ShouldIApplyCalculator';
import SubscriptionHeatmap from '@/components/homepage/SubscriptionHeatmap';
import IPOCalendarWidget from '@/components/homepage/IPOCalendarWidget';
import ComparisonTable from '@/components/homepage/ComparisonTable';
import {
  fetchFeaturedIPOs,
  fetchOpenIPOs,
} from '@/lib/api';

export default function Home() {
  const [featuredIPOs, setFeaturedIPOs] = useState<any[]>([]);
  const [openIPOs, setOpenIPOs] = useState<any[]>([]);
  const [filteredCategory, setFilteredCategory] = useState('all');
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadData();
    const interval = setInterval(loadData, 120000); // Refresh every 2 minutes
    return () => clearInterval(interval);
  }, []);

  async function loadData() {
    try {
      const [featured, open] = await Promise.all([
        fetchFeaturedIPOs(),
        fetchOpenIPOs(),
      ]);
      setFeaturedIPOs(featured);
      setOpenIPOs(open);
    } catch (error) {
      console.error('Error loading homepage data:', error);
    } finally {
      setLoading(false);
    }
  }

  if (loading) {
    return (
      <div className={styles.loadingContainer}>
        <div className={styles.loader}></div>
        <p className={styles.loadingText}>Loading IPO Tracker...</p>
      </div>
    );
  }

  return (
    <main className={styles.homepage}>
      {/* Hero Section */}
      <section className={styles.heroSection}>
        <div className={styles.heroContent}>
          {/* Left side - Text */}
          <div className={styles.heroText}>
            <div className={styles.heroBadge}>
              <div className={styles.pulseDot}></div>
              <span className={styles.badgeText}>Real-Time Market Intelligence</span>
            </div>

            <h1 className={styles.heroTitle}>
              TRACK MARKET<br />
              <span className={styles.gradientText}>INTELLIGENCE</span><br />
              IN REAL-TIME
            </h1>

            <p className={styles.heroSubtitle}>
              Live GMP tracking, subscription data, and comprehensive IPO analysis for informed investment decisions
            </p>

            <div className={styles.heroStats}>
              <div className={styles.statItem}>
                <div className={styles.statNumber}>50+</div>
                <div className={styles.statLabel}>Active IPOs Tracked</div>
              </div>
              <div className={styles.statItem}>
                <div className={styles.statNumber}>Real-Time</div>
                <div className={styles.statLabel}>GMP Updates</div>
              </div>
              <div className={styles.statItem}>
                <div className={styles.statNumber}>100%</div>
                <div className={styles.statLabel}>Accurate Data</div>
              </div>
            </div>
          </div>

          {/* Right side - Floating Card */}
          {featuredIPOs.length > 0 && (
            <div className={styles.heroCard}>
              <div className={styles.cardHeader}>
                <h3 className={styles.cardTitle}>{featuredIPOs[0].company_name || 'TATA TECHNOLOGIES'}</h3>
                <div className={styles.liveBadge}>
                  <span className={styles.liveDot}></span>
                  LIVE
                </div>
              </div>
              <div className={styles.cardMetrics}>
                <div className={styles.metric}>
                  <div className={styles.metricLabel}>GMP</div>
                  <div className={styles.metricValue}>‚Çπ{featuredIPOs[0].current_gmp || 485}</div>
                </div>
                <div className={styles.metric}>
                  <div className={styles.metricLabel}>GAIN</div>
                  <div className={`${styles.metricValue} ${styles.positive}`}>+{featuredIPOs[0].expected_gain_percent || 97}%</div>
                </div>
                <div className={styles.metric}>
                  <div className={styles.metricLabel}>SUB</div>
                  <div className={styles.metricValue}>{featuredIPOs[0].subscription_total || 69.43}x</div>
                </div>
              </div>
              <div className={styles.cardFooter}>
                <div className={styles.cardFooterItem}>
                  <span className={styles.footerLabel}>Retail Subscription</span>
                  <span className={styles.footerValue}>{featuredIPOs[0].subscription_retail || 12.87}x</span>
                </div>
                <div className={styles.cardFooterItem}>
                  <span className={styles.footerLabel}>Issue Price</span>
                  <span className={styles.footerValue}>‚Çπ{featuredIPOs[0].price_band_low || 50}</span>
                </div>
                <div className={styles.cardFooterItem}>
                  <span className={styles.footerLabel}>Time Remaining</span>
                  <span className={styles.footerValue}>3 Days</span>
                </div>
              </div>
            </div>
          )}
        </div>
      </section>

      {/* Cards Section */}
      <div className={styles.container}>
        {/* Featured IPO Cards */}
        <div className={styles.cardsGrid}>
          {featuredIPOs.length > 0 ? (
            featuredIPOs.map((ipo: any) => (
              <FeaturedIPOCard key={ipo.id} ipo={ipo} />
            ))
          ) : (
            <div className={styles.noFeatured}>
              <p>üîç No featured IPOs available at the moment</p>
              <p className={styles.noFeaturedSub}>Check back soon for hot IPO opportunities!</p>
            </div>
          )}
        </div>

        {/* IPO Category Chart Section */}
        <IPOCategoryChart />
      </div>

      {/* Dashboard Section */}
      <section className={styles.dashboardSection}>
        <h2 className={styles.sectionTitle}>üìä Live Dashboard</h2>
        <DashboardTabs />
      </section>



      {/* Calculator */}
      <section className={styles.calculatorSection}>
        <h2 className={styles.sectionTitle}>üßÆ Should I Apply Calculator</h2>
        <ShouldIApplyCalculator ipos={openIPOs} />
      </section>

      {/* Heatmap */}
      <section className={styles.heatmapSection}>
        <h2 className={styles.sectionTitle}>üî• Subscription Heatmap</h2>
        <SubscriptionHeatmap ipos={openIPOs} />
      </section>

      {/* Calendar */}
      <section className={styles.calendarSection}>
        <h2 className={styles.sectionTitle}>üìÖ IPO Calendar</h2>
        <IPOCalendarWidget />
      </section>

      {/* Comparison Table */}
      <section className={styles.comparisonSection}>
        <h2 className={styles.sectionTitle}>üìã IPO Comparison Table</h2>
        <ComparisonTable category={filteredCategory} />
      </section>
    </main>
  );
}
</file>

<file path="app/shareholders/page.module.css">
.sectionHeader {
    margin-bottom: 3rem;
    animation: slideUp 0.6s ease-out;
}

.sectionTitle {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.75rem;
    color: var(--color-text-primary);
    letter-spacing: -0.02em;
}

.sectionSubtitle {
    font-size: 1.125rem;
    color: var(--color-text-secondary);
    font-weight: 400;
}

.tableContainer {
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    overflow: hidden;
    animation: slideUp 0.6s ease-out 0.3s both;
    box-shadow: var(--shadow-card);
}

.table {
    width: 100%;
    border-collapse: collapse;
}

.table thead {
    background: linear-gradient(180deg, var(--color-bg-secondary) 0%, var(--color-bg-tertiary) 100%);
}

.table th {
    padding: 1.125rem 1.5rem;
    text-align: left;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    font-size: 0.8125rem;
    color: var(--color-text-secondary);
    border-bottom: 1px solid var(--color-border);
}

.table td {
    padding: 1.125rem 1.5rem;
    border-bottom: 1px solid var(--color-border-light);
    color: var(--color-text-secondary);
}

.table tbody tr {
    transition: background 0.2s ease;
}

.table tbody tr:hover {
    background-color: rgba(79, 70, 229, 0.02);
}

.companyName {
    font-weight: 600;
    color: var(--color-text-primary) !important;
    font-size: 1rem;
}

.categoryBadge {
    display: inline-block;
    padding: 0.3125rem 0.75rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 600;
    background: var(--color-info-light);
    color: #1d4ed8;
}

.badge {
    display: inline-block;
    padding: 0.3125rem 0.75rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.badgeFiled {
    background: var(--color-success-light);
    color: #047857;
}

.badgePending {
    background: var(--color-warning-light);
    color: #b45309;
}

.issueSize {
    font-weight: 600;
    color: var(--color-primary) !important;
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@media (max-width: 1024px) {
    .tableContainer {
        overflow-x: auto;
    }

    .table {
        min-width: 800px;
    }
}

@media (max-width: 768px) {
    .sectionTitle {
        font-size: 1.875rem;
    }

    .table th,
    .table td {
        padding: 1rem;
        font-size: 0.875rem;
    }
}
</file>

<file path="app/shareholders/page.tsx">
'use client';

import { useEffect, useState } from 'react';
import styles from './page.module.css';
import { fetchShareholderData } from '@/lib/api';

interface ShareholderData {
  id: number;
  ipo_name: string;
  parent_company: string | null;
  category: string | null;
  drhp_status: string | null;
  rhp_status: string | null;
  issue_size_cr: string | null;
}

export default function Shareholders() {
  const [shareholderData, setShareholderData] = useState<ShareholderData[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const loadData = async () => {
      try {
        const data = await fetchShareholderData();
        setShareholderData(data);
      } catch (error) {
        console.error('Failed to load shareholder data:', error);
      } finally {
        setLoading(false);
      }
    };

    loadData();
  }, []);

  if (loading) {
    return (
      <div className={styles.sectionHeader}>
        <h1 className={styles.sectionTitle}>IPO Shareholder Analysis</h1>
        <p className={styles.sectionSubtitle}>Loading...</p>
      </div>
    );
  }

  return (
    <>
      <div className={styles.sectionHeader}>
        <h1 className={styles.sectionTitle}>IPO Shareholder Analysis</h1>
        <p className={styles.sectionSubtitle}>
          Track parent companies, shareholder categories, and regulatory filings
        </p>
      </div>

      <div className={styles.tableContainer}>
        <table className={styles.table}>
          <thead>
            <tr>
              <th>Company Name</th>
              <th>Parent Company</th>
              <th>Category</th>
              <th>DRHP Status</th>
              <th>RHP Status</th>
              <th>Issue Size</th>
            </tr>
          </thead>
          <tbody>
            {shareholderData.map((row) => (
              <tr key={row.id}>
                <td className={styles.companyName}>{row.ipo_name}</td>
                <td>{row.parent_company || '-'}</td>
                <td>
                  {row.category ? (
                    <span className={styles.categoryBadge}>{row.category}</span>
                  ) : '-'}
                </td>
                <td>
                  {row.drhp_status ? (
                    <span className={`${styles.badge} ${row.drhp_status === 'filed' ? styles.badgeFiled : styles.badgePending}`}>
                      {row.drhp_status}
                    </span>
                  ) : '-'}
                </td>
                <td>
                  {row.rhp_status ? (
                    <span className={`${styles.badge} ${row.rhp_status === 'filed' ? styles.badgeFiled : styles.badgePending}`}>
                      {row.rhp_status}
                    </span>
                  ) : '-'}
                </td>
                <td className={styles.issueSize}>{row.issue_size_cr ? `‚Çπ${row.issue_size_cr} Cr` : '-'}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      {shareholderData.length === 0 && (
        <div className={styles.emptyState}>
          <p>No shareholder data available at the moment.</p>
        </div>
      )}
    </>
  );
}
</file>

<file path="app/upcoming-ipos/page.module.css">
.sectionHeader {
    margin-bottom: 3rem;
    animation: slideUp 0.6s ease-out;
}

.sectionTitle {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.75rem;
    color: var(--color-text-primary);
    letter-spacing: -0.02em;
}

.sectionSubtitle {
    font-size: 1.125rem;
    color: var(--color-text-secondary);
    font-weight: 400;
}

.ipoGrid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 1.75rem;
    animation: fadeIn 0.8s ease-out 0.3s both;
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

@media (max-width: 768px) {
    .sectionTitle {
        font-size: 1.875rem;
    }

    .ipoGrid {
        grid-template-columns: 1fr;
    }
}
</file>

<file path="app/upcoming-ipos/page.tsx">
'use client';

import { useEffect, useState } from 'react';
import IPOCard from '@/components/IPOCard';
import styles from './page.module.css';
import { fetchCombinedIPOData } from '@/lib/api';

export default function UpcomingIPOs() {
    const [upcomingIPOs, setUpcomingIPOs] = useState<any[]>([]);
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        const loadData = async () => {
            try {
                const data = await fetchCombinedIPOData();
                setUpcomingIPOs(data);
            } catch (error) {
                console.error('Failed to load upcoming IPOs:', error);
            } finally {
                setLoading(false);
            }
        };

        loadData();
    }, []);

    if (loading) {
        return (
            <div className={styles.sectionHeader}>
                <h1 className={styles.sectionTitle}>Upcoming IPOs</h1>
                <p className={styles.sectionSubtitle}>Loading IPO data...</p>
            </div>
        );
    }

    return (
        <>
            <div className={styles.sectionHeader}>
                <h1 className={styles.sectionTitle}>Upcoming IPOs</h1>
                <p className={styles.sectionSubtitle}>
                    Live tracking of all scheduled IPO launches with detailed information
                </p>
            </div>

            <div className={styles.ipoGrid}>
                {upcomingIPOs.map((ipo) => (
                    <IPOCard key={ipo.id} ipo={ipo} />
                ))}
            </div>

            {upcomingIPOs.length === 0 && (
                <div className={styles.emptyState}>
                    <p>No upcoming IPOs at the moment. Check back soon!</p>
                </div>
            )}
        </>
    );
}
</file>

<file path="components/GoldCard.tsx">
import React from "react";
import { cn } from "@/lib/utils";
import { AlertTriangle } from "lucide-react";

interface GoldCardProps {
    data: {
        ipo_name: string;
        parent_company: string;
        action_text?: string;
    };
    className?: string;
}

export function GoldCard({ data, className }: GoldCardProps) {
    return (
        <div
            className={cn(
                "relative overflow-hidden rounded-xl border border-yellow-600/30 bg-gradient-to-b from-yellow-900/40 to-black p-6",
                className
            )}
        >
            {/* Glow Effect */}
            <div className="absolute top-0 right-0 h-32 w-32 -translate-y-1/2 translate-x-1/2 rounded-full bg-yellow-500/20 blur-3xl" />

            <div className="relative z-10 flex flex-col gap-4">
                {/* Badge */}
                <div className="w-fit">
                    <span className="relative inline-flex items-center rounded-full border border-yellow-500/50 bg-yellow-500/10 px-3 py-1 text-xs font-medium text-yellow-500">
                        <span className="absolute -left-1 -top-1 h-2 w-2 animate-ping rounded-full bg-yellow-500" />
                        <span className="mr-2 h-1.5 w-1.5 rounded-full bg-yellow-500" />
                        Upcoming
                    </span>
                </div>

                {/* Content */}
                <div>
                    <h3 className="text-xl font-bold text-white">{data.ipo_name}</h3>
                    <p className="mt-1 text-sm text-zinc-400">
                        Parent Company: <span className="text-zinc-300">{data.parent_company}</span>
                    </p>
                </div>

                {/* Footer */}
                <div className="mt-2 flex items-center gap-2 rounded-lg bg-yellow-500/10 p-3 text-sm text-yellow-200/80">
                    <AlertTriangle className="h-4 w-4 text-yellow-500" />
                    <span>{data.action_text || "Buy before RHP filing."}</span>
                </div>
            </div>
        </div>
    );
}
</file>

<file path="components/homepage/ComparisonTable.module.css">
/* ============================================
   IPO Comparison Table - Brutalist Editorial Style
   ============================================ */

.container {
    background: var(--color-bg-card);
    border: 4px solid var(--black);
    overflow: hidden;
    box-shadow: var(--shadow-card);
}

.loading {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 3rem;
    color: var(--color-text-primary);
    font-size: 1rem;
    font-family: var(--font-body);
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

/* Controls Section */
.controls {
    padding: 1.25rem 1.5rem;
    background: var(--yellow);
    border-bottom: 4px solid var(--black);
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
}

.sortButtons {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.sortButton {
    padding: 0.625rem 1.25rem;
    background-color: var(--white);
    color: var(--black);
    border: 3px solid var(--black);
    font-size: 0.8125rem;
    font-family: var(--font-body);
    font-weight: 700;
    cursor: pointer;
    transition: all 0.15s ease;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.sortButton:hover {
    background-color: var(--black);
    color: var(--yellow);
    transform: rotate(-1deg);
}

.sortButton.active {
    background: var(--black);
    color: var(--yellow);
    box-shadow: var(--shadow-sm);
}

.exportButton {
    padding: 0.625rem 1.25rem;
    background-color: var(--black);
    color: var(--yellow);
    border: 3px solid var(--black);
    font-size: 0.8125rem;
    font-family: var(--font-body);
    font-weight: 700;
    cursor: pointer;
    transition: all 0.15s ease;
    display: flex;
    align-items: center;
    gap: 0.375rem;
    text-transform: uppercase;
}

.exportButton:hover {
    background-color: var(--yellow);
    color: var(--black);
    transform: rotate(-2deg);
}

/* Table Wrapper */
.tableWrapper {
    overflow-x: auto;
}

/* Table Styles */
.table {
    width: 100%;
    border-collapse: collapse;
}

.table thead {
    background: var(--gray);
    border-bottom: 4px solid var(--black);
}

.table thead th {
    padding: 1rem 1.25rem;
    text-align: left;
    font-size: 0.6875rem;
    font-family: var(--font-body);
    font-weight: 700;
    color: var(--black);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    white-space: nowrap;
    border-right: 2px solid var(--color-border-light);
}

.table thead th:last-child {
    border-right: none;
}

.table tbody tr {
    border-bottom: 2px solid var(--color-border-light);
    transition: all 0.15s ease;
}

.table tbody tr:hover {
    background-color: var(--yellow);
}

.table tbody tr:last-child {
    border-bottom: none;
}

.table tbody td {
    padding: 1rem 1.25rem;
    font-size: 0.9375rem;
    font-family: var(--font-body);
    color: var(--color-text-primary);
    vertical-align: middle;
    border-right: 1px solid var(--color-border-light);
}

.table tbody td:last-child {
    border-right: none;
}

/* Company Cell */
.companyCell {
    font-weight: 700;
    color: var(--color-text-primary);
    min-width: 200px;
}

.companyCell strong {
    display: block;
    color: var(--color-text-primary);
    font-family: var(--font-heading);
    text-transform: uppercase;
    font-weight: 400;
}

/* Category Badge */
.badge {
    display: inline-flex;
    align-items: center;
    padding: 0.375rem 0.875rem;
    font-size: 0.5625rem;
    font-family: var(--font-body);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    white-space: nowrap;
    border: 2px solid var(--black);
}

.sme {
    background-color: var(--gray);
    color: var(--black);
}

.mainboard {
    background: var(--black);
    color: var(--yellow);
}

/* Value Styling */
.positive {
    color: var(--blue);
    font-weight: 700;
}

.negative {
    color: var(--red);
    font-weight: 700;
}

.subscribed {
    color: var(--blue);
}

/* View Button */
.viewButton {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.625rem 1.25rem;
    background: var(--black);
    color: var(--yellow);
    border: 3px solid var(--black);
    font-size: 0.8125rem;
    font-family: var(--font-body);
    font-weight: 700;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.15s ease;
    text-transform: uppercase;
}

.viewButton:hover {
    background: var(--yellow);
    color: var(--black);
    transform: rotate(-2deg);
    box-shadow: var(--shadow-sm);
}

/* Responsive Design */
@media (max-width: 1024px) {
    .controls {
        flex-direction: column;
        align-items: flex-start;
    }

    .sortButtons {
        width: 100%;
    }

    .sortButton {
        flex: 1;
        text-align: center;
    }
}

@media (max-width: 768px) {

    .table thead th,
    .table tbody td {
        padding: 0.875rem 1rem;
        font-size: 0.8125rem;
    }

    .companyCell {
        min-width: 150px;
    }

    .badge {
        font-size: 0.5rem;
        padding: 0.25rem 0.5rem;
    }

    .viewButton {
        padding: 0.5rem 0.875rem;
        font-size: 0.75rem;
    }
}
</file>

<file path="components/homepage/ComparisonTable.tsx">
'use client';

import { useState, useEffect } from 'react';
import Link from 'next/link';
import styles from './ComparisonTable.module.css';
import { fetchAllIPOsForComparison } from '@/lib/api';

export default function ComparisonTable({ category }: { category: string }) {
    const [ipos, setIpos] = useState<any[]>([]);
    const [loading, setLoading] = useState(true);
    const [sortBy, setSortBy] = useState<'gmp' | 'subscription' | 'date'>('date');

    useEffect(() => {
        loadData();
    }, [category]);

    async function loadData() {
        const data = await fetchAllIPOsForComparison(category);
        setIpos(data);
        setLoading(false);
    }

    const sortedIPOs = [...ipos].sort((a, b) => {
        if (sortBy === 'gmp') return b.gmp_percentage - a.gmp_percentage;
        if (sortBy === 'subscription') return b.subscription_total - a.subscription_total;
        return new Date(b.open_date).getTime() - new Date(a.open_date).getTime();
    });

    if (loading) {
        return <div className={styles.loading}>Loading comparison data...</div>;
    }

    return (
        <div className={styles.container}>
            <div className={styles.controls}>
                <div className={styles.sortButtons}>
                    <button
                        className={`${styles.sortButton} ${sortBy === 'date' ? styles.active : ''}`}
                        onClick={() => setSortBy('date')}
                    >
                        Sort by Date
                    </button>
                    <button
                        className={`${styles.sortButton} ${sortBy === 'gmp' ? styles.active : ''}`}
                        onClick={() => setSortBy('gmp')}
                    >
                        Sort by GMP
                    </button>
                    <button
                        className={`${styles.sortButton} ${sortBy === 'subscription' ? styles.active : ''}`}
                        onClick={() => setSortBy('subscription')}
                    >
                        Sort by Subscription
                    </button>
                </div>
                <button className={styles.exportButton}>
                    üì• Export to CSV
                </button>
            </div>

            <div className={styles.tableWrapper}>
                <table className={styles.table}>
                    <thead>
                        <tr>
                            <th>Company</th>
                            <th>Category</th>
                            <th>Price Band</th>
                            <th>GMP</th>
                            <th>% Gain</th>
                            <th>Lot Size</th>
                            <th>Subscription</th>
                            <th>Open Date</th>
                            <th>Close Date</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {sortedIPOs.map(ipo => (
                            <tr key={ipo.id}>
                                <td className={styles.companyCell}>
                                    <strong>{ipo.company_name || ipo.ipo_name}</strong>
                                </td>
                                <td>
                                    <span className={`${styles.badge} ${ipo.category === 'SME' ? styles.sme : styles.mainboard}`}>
                                        {ipo.category}
                                    </span>
                                </td>
                                <td>‚Çπ{ipo.min_price}-{ipo.max_price}</td>
                                <td className={ipo.gmp_amount >= 0 ? styles.positive : styles.negative}>
                                    ‚Çπ{ipo.gmp_amount}
                                </td>
                                <td className={ipo.gmp_percentage >= 0 ? styles.positive : styles.negative}>
                                    {ipo.gmp_percentage >= 0 ? '+' : ''}{ipo.gmp_percentage.toFixed(1)}%
                                </td>
                                <td>{ipo.lot_size}</td>
                                <td>
                                    <strong className={ipo.subscription_total >= 1 ? styles.subscribed : ''}>
                                        {ipo.subscription_total.toFixed(2)}x
                                    </strong>
                                </td>
                                <td>{new Date(ipo.open_date).toLocaleDateString('en-IN', { month: 'short', day: 'numeric' })}</td>
                                <td>{new Date(ipo.close_date).toLocaleDateString('en-IN', { month: 'short', day: 'numeric' })}</td>
                                <td>
                                    <Link href={`/ipo/${ipo.slug}`} className={styles.viewButton}>
                                        View
                                    </Link>
                                </td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>
        </div>
    );
}
</file>

<file path="components/homepage/DashboardTabs.module.css">
/* ============================================
   Dashboard Tabs - Brutalist Editorial Style
   ============================================ */

.container {
    background: var(--color-bg-card);
    border: 4px solid var(--black);
    overflow: hidden;
    box-shadow: var(--shadow-card);
}

.loading {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 4rem 2rem;
    color: var(--color-text-primary);
    font-size: 1rem;
    font-family: var(--font-body);
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

/* Tabs */
.tabs {
    display: flex;
    border-bottom: 4px solid var(--black);
    background: var(--gray);
    overflow-x: auto;
    scrollbar-width: none;
    -ms-overflow-style: none;
}

.tabs::-webkit-scrollbar {
    display: none;
}

.tab {
    flex: 1;
    min-width: 140px;
    padding: 1rem 1.25rem;
    background: var(--gray);
    border: none;
    border-right: 2px solid var(--black);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    font-family: var(--font-body);
    font-weight: 700;
    color: var(--color-text-secondary);
    cursor: pointer;
    transition: all 0.15s ease;
    white-space: nowrap;
    position: relative;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.tab:last-child {
    border-right: none;
}

.tab:hover {
    color: var(--black);
    background-color: var(--yellow);
}

.activeTab {
    color: var(--yellow);
    background-color: var(--black);
}

.tabIcon {
    font-size: 1rem;
}

.tabLabel {
    font-size: 0.8125rem;
}

.tabCount {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 22px;
    height: 22px;
    padding: 0 0.5rem;
    font-size: 0.6875rem;
    font-weight: 700;
    background: var(--white);
    color: var(--black);
    border: 2px solid var(--black);
    transition: all 0.15s ease;
}

.activeTab .tabCount {
    background: var(--yellow);
    color: var(--black);
}

/* Content */
.content {
    padding: 1.5rem;
    background: var(--white);
}

.grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 1.5rem;
}

.empty {
    text-align: center;
    padding: 3rem;
    color: var(--color-text-primary);
    font-family: var(--font-body);
    text-transform: uppercase;
}

.empty p {
    font-size: 1rem;
    margin: 0;
    color: var(--color-text-muted);
}

/* IPO Cards */
.ipoCard {
    display: flex;
    flex-direction: column;
    padding: 1.25rem;
    background: var(--color-bg-card);
    border: 3px solid var(--black);
    text-decoration: none;
    transition: all 0.2s ease;
    position: relative;
}

/* Yellow top bar */
.ipoCard::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 6px;
    background: var(--yellow);
}

.ipoCard:hover {
    background: var(--yellow);
    box-shadow: var(--shadow-md);
    transform: rotate(1deg) translateY(-4px);
}

.cardTop {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
    padding-top: 0.5rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid var(--black);
}

.cardInfo {
    flex: 1;
    min-width: 0;
}

.ipoName {
    font-size: 1rem;
    font-family: var(--font-heading);
    color: var(--color-text-primary);
    margin: 0 0 0.5rem 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    text-transform: uppercase;
}

.category {
    display: inline-block;
    padding: 0.375rem 0.75rem;
    font-size: 0.5625rem;
    font-family: var(--font-body);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border: 2px solid var(--black);
}

.mainboard {
    background: var(--black);
    color: var(--yellow);
}

.sme {
    background-color: var(--gray);
    color: var(--black);
}

/* Metrics */
.cardMetrics {
    text-align: right;
}

.metric {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
}

.metricLabel {
    font-size: 0.625rem;
    font-family: var(--font-body);
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    font-weight: 700;
}

.metricValue {
    font-size: 1.375rem;
    font-family: var(--font-body);
    font-weight: 700;
    color: var(--color-text-primary);
}

.metricValue.subscribed {
    color: var(--blue);
}

.daysLeft {
    margin-top: 0.375rem;
    font-size: 0.6875rem;
    font-family: var(--font-body);
    font-weight: 700;
    color: var(--black);
    background: var(--yellow);
    padding: 0.375rem 0.625rem;
    display: inline-block;
    text-transform: uppercase;
    border: 2px solid var(--black);
}

/* Listing Gain */
.listingGain {
    text-align: right;
}

.gainLabel {
    display: block;
    font-size: 0.625rem;
    font-family: var(--font-body);
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    font-weight: 700;
    margin-bottom: 0.125rem;
}

.gainValue {
    font-size: 1.375rem;
    font-family: var(--font-body);
    font-weight: 700;
}

.gainValue.positive {
    color: var(--blue);
}

.gainValue.negative {
    color: var(--red);
}

/* Upcoming Date */
.upcomingDate {
    font-size: 0.875rem;
    font-family: var(--font-body);
    font-weight: 700;
    color: var(--black);
    background: var(--gray);
    padding: 0.5rem 0.875rem;
    border: 2px solid var(--black);
    text-transform: uppercase;
}

/* Card Bottom */
.cardBottom {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.gmpInfo {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.gmpLabel {
    font-size: 0.6875rem;
    font-family: var(--font-body);
    font-weight: 700;
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
}

.gmpValue {
    font-size: 1rem;
    font-family: var(--font-body);
    font-weight: 700;
}

.gmpValue.positive {
    color: var(--blue);
}

.gmpValue.negative {
    color: var(--red);
}

.cardArrow {
    font-size: 1.25rem;
    color: var(--black);
    transition: all 0.15s ease;
}

.ipoCard:hover .cardArrow {
    transform: translateX(4px) rotate(-5deg);
}

/* Responsive Design */
@media (max-width: 768px) {
    .tabs {
        overflow-x: scroll;
        -webkit-overflow-scrolling: touch;
    }

    .tab {
        padding: 0.875rem 1rem;
        min-width: 120px;
    }

    .tabLabel {
        font-size: 0.75rem;
    }

    .content {
        padding: 1.25rem;
    }

    .grid {
        grid-template-columns: 1fr;
    }

    .ipoCard {
        padding: 1rem;
    }
}
</file>

<file path="components/homepage/DashboardTabs.tsx">
'use client';

import { useState, useEffect } from 'react';
import Link from 'next/link';
import styles from './DashboardTabs.module.css';
import {
    fetchOpenIPOs,
    fetchClosingSoonIPOs,
    fetchRecentlyListedIPOs,
    fetchUpcomingThisWeek
} from '@/lib/api';

type TabType = 'open' | 'closing' | 'listed' | 'upcoming';

export default function DashboardTabs() {
    const [activeTab, setActiveTab] = useState<TabType>('open');
    const [data, setData] = useState<any>({
        open: [],
        closing: [],
        listed: [],
        upcoming: []
    });
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        loadAllData();
        const interval = setInterval(loadAllData, 60000); // Refresh every minute
        return () => clearInterval(interval);
    }, []);

    async function loadAllData() {
        const [open, closing, listed, upcoming] = await Promise.all([
            fetchOpenIPOs(),
            fetchClosingSoonIPOs(),
            fetchRecentlyListedIPOs(),
            fetchUpcomingThisWeek()
        ]);

        setData({ open, closing, listed, upcoming });
        setLoading(false);
    }

    const tabs = [
        { id: 'open' as TabType, label: 'Currently Open', count: data.open.length, icon: 'üü¢' },
        { id: 'listed' as TabType, label: 'Recently Listed', count: data.listed.length, icon: 'üìà' },
        { id: 'upcoming' as TabType, label: 'Upcoming This Week', count: data.upcoming.length, icon: 'üìÖ' },
        { id: 'closing' as TabType, label: 'Closed', count: data.closing.length, icon: 'üî¥' }
    ];

    const renderIPOCard = (ipo: any, type: TabType) => {
        const daysLeft = type === 'open' || type === 'closing'
            ? Math.ceil((new Date(ipo.close_date).getTime() - Date.now()) / (1000 * 60 * 60 * 24))
            : null;

        const listingGain = type === 'listed' && ipo.listing_gain_percent
            ? ipo.listing_gain_percent
            : null;

        return (
            <Link href={`/ipo/${ipo.slug}`} key={ipo.id} className={styles.ipoCard}>
                <div className={styles.cardTop}>
                    <div className={styles.cardInfo}>
                        <h4 className={styles.ipoName}>{ipo.company_name || ipo.ipo_name}</h4>
                        <span className={`${styles.category} ${ipo.category === 'SME' ? styles.sme : styles.mainboard}`}>
                            {ipo.category}
                        </span>
                    </div>

                    {type === 'open' || type === 'closing' ? (
                        <div className={styles.cardMetrics}>
                            <div className={styles.metric}>
                                <span className={styles.metricLabel}>Subscription</span>
                                <span className={`${styles.metricValue} ${ipo.subscription_total >= 1 ? styles.subscribed : ''}`}>
                                    {ipo.subscription_total.toFixed(2)}x
                                </span>
                            </div>
                            {daysLeft !== null && (
                                <div className={styles.daysLeft}>
                                    {daysLeft > 0 ? `${daysLeft}d left` : 'Closes Today'}
                                </div>
                            )}
                        </div>
                    ) : type === 'listed' ? (
                        <div className={styles.listingGain}>
                            <span className={styles.gainLabel}>Listing Gain</span>
                            <span className={`${styles.gainValue} ${listingGain && listingGain > 0 ? styles.positive : styles.negative}`}>
                                {listingGain !== null ? `${listingGain > 0 ? '+' : ''}${listingGain.toFixed(1)}%` : 'N/A'}
                            </span>
                        </div>
                    ) : (
                        <div className={styles.upcomingDate}>
                            Opens: {new Date(ipo.open_date).toLocaleDateString('en-IN', { month: 'short', day: 'numeric' })}
                        </div>
                    )}
                </div>

                <div className={styles.cardBottom}>
                    <div className={styles.gmpInfo}>
                        <span className={styles.gmpLabel}>GMP</span>
                        <span className={`${styles.gmpValue} ${ipo.gmp_amount >= 0 ? styles.positive : styles.negative}`}>
                            ‚Çπ{ipo.gmp_amount} ({ipo.gmp_percentage >= 0 ? '+' : ''}{ipo.gmp_percentage.toFixed(1)}%)
                        </span>
                    </div>
                    <div className={styles.cardArrow}>‚Üí</div>
                </div>
            </Link>
        );
    };

    if (loading) {
        return (
            <div className={styles.container}>
                <div className={styles.loading}>Loading dashboard...</div>
            </div>
        );
    }

    const activeData = data[activeTab];

    return (
        <div className={styles.container}>
            <div className={styles.tabs}>
                {tabs.map(tab => (
                    <button
                        key={tab.id}
                        className={`${styles.tab} ${activeTab === tab.id ? styles.activeTab : ''}`}
                        onClick={() => setActiveTab(tab.id)}
                    >
                        <span className={styles.tabIcon}>{tab.icon}</span>
                        <span className={styles.tabLabel}>{tab.label}</span>
                        <span className={styles.tabCount}>{tab.count}</span>
                    </button>
                ))}
            </div>

            <div className={styles.content}>
                {activeData.length > 0 ? (
                    <div className={styles.grid}>
                        {activeData.map((ipo: any) => renderIPOCard(ipo, activeTab))}
                    </div>
                ) : (
                    <div className={styles.empty}>
                        <p>No IPOs in this category at the moment</p>
                    </div>
                )}
            </div>
        </div>
    );
}
</file>

<file path="components/homepage/FeaturedIPOCard.module.css">
/* ============================================
   Featured IPO Card - Cream/Teal Theme
   ============================================ */

.card {
    background: #f5f5eb;
    border: 4px solid #1a1a1a;
    overflow: visible;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    flex-direction: column;
    box-shadow: 8px 8px 0 rgba(0, 0, 0, 0.3);
    text-decoration: none;
    position: relative;
    transform: rotate(-1.5deg) translateZ(0);

    /* Advanced Rendering Optimization for Sharp Text */
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
    transform-style: preserve-3d;
    -webkit-font-smoothing: subpixel-antialiased;
    -moz-osx-font-smoothing: auto;
    will-change: transform;
    outline: 1px solid transparent;
    /* Anti-aliasing hack */
    perspective: 1000px;
}

.card:nth-child(4n+1) {
    transform: rotate(-1.5deg) translateZ(0);
}

.card:nth-child(4n+2) {
    transform: rotate(-1.5deg) translateZ(0);
}

.card:nth-child(4n+3) {
    transform: rotate(-1.5deg) translateZ(0);
}

.card:nth-child(4n) {
    transform: rotate(-1.5deg) translateZ(0);
}

/* Tilt animation on hover */
.card:hover {
    box-shadow: 10px 10px 0 rgba(0, 0, 0, 0.3);
    transform: rotate(0deg) translateY(-8px) scale(1.02);
    border-color: #1a1a1a;
}

.cardHeader {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: 24px;
    gap: 1rem;
    border-bottom: 3px solid #1a1a1a;
    background: #f5f5eb;
}

.titleSection {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.companyName {
    font-size: 20px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    font-weight: 700;
    color: #1a1a1a;
    line-height: 1.15;
    margin: 0;
    letter-spacing: -0.3px;
}

.badge {
    display: inline-flex;
    align-items: center;
    padding: 4px 12px;
    font-size: 11px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    width: fit-content;
    border: 2px solid #1a1a1a;
    background: transparent;
    color: #1a1a1a;
}

.smeBadge {
    background-color: transparent;
    color: #1a1a1a;
}

.mainboardBadge {
    background-color: transparent;
    color: #1a1a1a;
}

.statusSection {
    flex-shrink: 0;
}

.statusBadge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    font-size: 11px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    font-weight: 700;
    white-space: nowrap;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border: 2px solid #1a1a1a;
}

.openStatus {
    background-color: #ff4444;
    color: white;
    border-color: #1a1a1a;
}

.openStatus::before {
    content: '';
    width: 8px;
    height: 8px;
    background: currentColor;
    border-radius: 50%;
    animation: pulse-dot 1.5s ease-in-out infinite;
}

@keyframes pulse-dot {

    0%,
    100% {
        opacity: 1;
        transform: scale(1);
    }

    50% {
        opacity: 0.6;
        transform: scale(1.3);
    }
}

.upcomingStatus {
    background-color: #ffc107;
    color: #1a1a1a;
    border-color: #1a1a1a;
}

.upcomingStatus::before {
    content: '';
    width: 8px;
    height: 8px;
    background: #1a1a1a;
    border-radius: 50%;
}

.metricsRow {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0;
    background: #f5f5eb;
    border-bottom: 3px solid #1a1a1a;
    padding: 24px;
}

.metric {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 8px;
    padding: 0 12px;
    border-right: 2px solid #1a1a1a;
}

.metric:last-child {
    border-right: none;
}

.metricLabel {
    font-size: 11px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 600;
}

.metricValue {
    font-size: 28px;
    font-family: 'Courier New', Courier, monospace;
    font-weight: 700;
    color: #1a1a1a;
    line-height: 1.2;
}

.positive {
    color: #22c55e;
}

.negative {
    color: #ff4444;
}

.progressSection {
    padding: 20px 24px;
    background: #f5f5eb;
    border-bottom: 3px solid #1a1a1a;
}

.progressLabel {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    font-size: 13px;
    font-family: 'Courier New', Courier, monospace;
    font-weight: 600;
    color: #1a1a1a;
}

.timer {
    font-weight: 700;
    color: #1a1a1a;
    font-size: 12px;
}

.progressBar {
    width: 100%;
    height: 12px;
    background-color: #c4b9a4;
    border: 2px solid #1a1a1a;
    overflow: hidden;
}

.progressFill {
    height: 100%;
    transition: width 0.6s ease;
    background: #22c55e;
}

/* Footer with darker cream background */
.footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 24px;
    margin-top: auto;
    background: #c4b9a4;
}

.price {
    font-size: 15px;
    font-family: 'Courier New', Courier, monospace;
    font-weight: 600;
    color: #1a1a1a;
}

.viewDetails {
    padding: 10px 20px;
    background: #1a1a1a;
    color: #dfd8c8;
    text-decoration: none;
    font-size: 13px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    font-weight: 600;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    border: 2px solid #1a1a1a;
}

.card:hover .viewDetails {
    background: #2c5f5f;
    border-color: #1a1a1a;
}

/* Compatibility class names */
.featuredCard {
    composes: card;
}

.cardContent {
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    flex: 1;
    background: #dfd8c8;
}

.priceTag {
    text-align: right;
}

.currentPrice {
    font-size: 1.75rem;
    font-family: 'Courier New', Courier, monospace;
    font-weight: 700;
    color: #1a1a1a;
    line-height: 1;
}

.originalPrice {
    font-size: 0.875rem;
    color: #666;
    text-decoration: line-through;
    margin-top: 0.25rem;
}

.cardMetrics {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0;
    border: 2px solid #1a1a1a;
    overflow: hidden;
}

.cardMetrics .metric {
    border: none;
    border-right: 2px solid #1a1a1a;
    background: #dfd8c8;
}

.cardMetrics .metric:nth-child(2n) {
    border-right: none;
}

.gmpPositive {
    color: #22c55e;
}

.gmpNegative {
    color: #ff4444;
}

.subscriptionHigh {
    color: #22c55e;
}

.subscriptionMedium {
    color: #1a1a1a;
}

.subscriptionLow {
    color: #666;
}

.cardFooter {
    margin-top: auto;
}

.viewButton {
    width: 100%;
    padding: 1rem;
    background: #1a1a1a;
    color: #dfd8c8;
    border: none;
    font-size: 0.9375rem;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.viewButton:hover {
    background: #2c5f5f;
    color: #dfd8c8;
}

.statusOpen {
    background-color: #ff4444;
    color: white;
}

.statusClosing {
    background-color: #ffc107;
    color: #1a1a1a;
}

.statusUpcoming {
    background-color: #ffc107;
    color: #1a1a1a;
}

/* Tablets */
@media (max-width: 768px) {
    .card {
        transform: rotate(0deg);
        box-shadow: 6px 6px 0 rgba(0, 0, 0, 0.3);
    }

    .card:nth-child(2),
    .card:nth-child(3),
    .card:nth-child(4n+1),
    .card:nth-child(4n+2),
    .card:nth-child(4n+3),
    .card:nth-child(4n) {
        transform: rotate(0deg);
    }

    .card:hover {
        transform: translateY(-4px) scale(1.01);
    }

    .cardHeader {
        flex-direction: column;
        gap: 0.75rem;
        padding: 1.25rem;
    }

    .metricsRow {
        grid-template-columns: repeat(3, 1fr);
        gap: 0;
        padding: 1.25rem;
    }

    .metric {
        padding: 0 8px;
    }

    .metricValue {
        font-size: 24px;
    }

    .companyName {
        font-size: 1.125rem;
    }

    .footer {
        flex-direction: column;
        gap: 1rem;
        align-items: stretch;
    }

    .viewDetails {
        width: 100%;
        justify-content: center;
    }
}

/* Mobile phones */
@media (max-width: 480px) {
    .card {
        box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.25);
        border-width: 3px;
    }

    .cardHeader {
        padding: 1rem;
        border-bottom-width: 2px;
    }

    .titleSection {
        gap: 6px;
    }

    .companyName {
        font-size: 1rem;
        letter-spacing: -0.2px;
    }

    .badge {
        font-size: 10px;
        padding: 3px 10px;
    }

    .statusBadge {
        font-size: 10px;
        padding: 6px 12px;
    }

    .metricsRow {
        padding: 1rem;
        border-bottom-width: 2px;
    }

    .metric {
        padding: 0 6px;
        gap: 6px;
    }

    .metricLabel {
        font-size: 10px;
    }

    .metricValue {
        font-size: 20px;
    }

    .progressSection {
        padding: 1rem;
        border-bottom-width: 2px;
    }

    .progressLabel {
        font-size: 12px;
        margin-bottom: 10px;
    }

    .timer {
        font-size: 11px;
    }

    .progressBar {
        height: 10px;
    }

    .footer {
        padding: 1rem;
    }

    .price {
        font-size: 14px;
    }

    .viewDetails {
        padding: 10px 16px;
        font-size: 12px;
    }
}
</file>

<file path="components/homepage/FeaturedIPOCard.tsx">
'use client';

import { useState, useEffect } from 'react';
import Link from 'next/link';
import styles from './FeaturedIPOCard.module.css';

interface FeaturedIPOProps {
    id: number;
    ipo_name: string;
    company_name: string;
    slug: string;
    category: 'SME' | 'Mainboard';
    status: string;
    gmp_amount: number;
    gmp_percentage: number;
    subscription_retail: number;
    subscription_total: number;
    close_date: string;
    open_date: string;
    issue_price: number;
    max_price: number;
}

export default function FeaturedIPOCard({ ipo }: { ipo: FeaturedIPOProps }) {
    const [timeLeft, setTimeLeft] = useState('');

    useEffect(() => {
        const calculateTimeLeft = () => {
            const targetDate = ipo.status === 'open' 
                ? new Date(ipo.close_date) 
                : new Date(ipo.open_date);
            const now = new Date();
            const diff = targetDate.getTime() - now.getTime();

            if (diff <= 0) {
                return ipo.status === 'open' ? 'Closed' : 'Opening Soon';
            }

            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));

            if (days > 0) return `${days}d ${hours}h left`;
            if (hours > 0) return `${hours}h ${minutes}m left`;
            return `${minutes}m left`;
        };

        setTimeLeft(calculateTimeLeft());
        const interval = setInterval(() => setTimeLeft(calculateTimeLeft()), 60000);

        return () => clearInterval(interval);
    }, [ipo.close_date, ipo.open_date, ipo.status]);

    const price = ipo.issue_price || ipo.max_price;

    return (
        <Link href={`/ipo/${ipo.slug}`} className={styles.card}>
            <div className={styles.cardHeader}>
                <div className={styles.titleSection}>
                    <h3 className={styles.companyName}>{ipo.company_name || ipo.ipo_name}</h3>
                    <span className={`${styles.badge} ${ipo.category === 'SME' ? styles.smeBadge : styles.mainboardBadge}`}>
                        {ipo.category}
                    </span>
                </div>
                <div className={styles.statusSection}>
                    <span className={`${styles.statusBadge} ${ipo.status === 'open' ? styles.openStatus : styles.upcomingStatus}`}>
                        {ipo.status === 'open' ? 'üî¥ LIVE' : 'üü° Upcoming'}
                    </span>
                </div>
            </div>

            <div className={styles.metricsRow}>
                <div className={styles.metric}>
                    <span className={styles.metricLabel}>GMP</span>
                    <span className={`${styles.metricValue} ${ipo.gmp_amount >= 0 ? styles.positive : styles.negative}`}>
                        ‚Çπ{ipo.gmp_amount}
                    </span>
                </div>
                <div className={styles.metric}>
                    <span className={styles.metricLabel}>Expected Gain</span>
                    <span className={`${styles.metricValue} ${ipo.gmp_percentage >= 0 ? styles.positive : styles.negative}`}>
                        {ipo.gmp_percentage >= 0 ? '+' : ''}{ipo.gmp_percentage.toFixed(1)}%
                    </span>
                </div>
                <div className={styles.metric}>
                    <span className={styles.metricLabel}>Subscription</span>
                    <span className={styles.metricValue}>
                        {ipo.subscription_total.toFixed(2)}x
                    </span>
                </div>
            </div>

            <div className={styles.progressSection}>
                <div className={styles.progressLabel}>
                    <span>Retail: {ipo.subscription_retail.toFixed(2)}x</span>
                    <span className={styles.timer}>{timeLeft}</span>
                </div>
                <div className={styles.progressBar}>
                    <div 
                        className={styles.progressFill}
                        style={{ 
                            width: `${Math.min(100, (ipo.subscription_retail / 5) * 100)}%`,
                            backgroundColor: ipo.subscription_retail >= 1 ? '#22c55e' : '#06b6d4'
                        }}
                    />
                </div>
            </div>

            <div className={styles.footer}>
                <span className={styles.price}>Issue Price: ‚Çπ{price}</span>
                <span className={styles.viewDetails}>View Details ‚Üí</span>
            </div>
        </Link>
    );
}
</file>

<file path="components/homepage/IPOAnalysisTile.module.css">
/* IPO Analysis Tile - Black and Yellow Theme */

.tile {
    background: linear-gradient(145deg, #0a0a0a 0%, #1a1a1a 100%);
    border: 3px solid #ffed4e;
    border-radius: 0;
    padding: 1.25rem;
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
}

.tile::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #ffed4e, #ffd700, #d4af37);
}

.tile:hover {
    border-color: #ffd700;
    transform: translateY(-4px);
    box-shadow: 0 12px 40px rgba(255, 237, 78, 0.25);
}

/* Header */
.header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
    gap: 0.5rem;
}

.ipoName {
    font-size: 1rem;
    font-family: var(--font-heading, 'Space Grotesk', sans-serif);
    color: #ffed4e;
    margin: 0;
    text-transform: uppercase;
    letter-spacing: 0.02em;
    line-height: 1.2;
    flex: 1;
}

.category {
    font-size: 0.625rem;
    font-family: var(--font-body, 'Inter', sans-serif);
    color: #0a0a0a;
    background: #ffed4e;
    padding: 0.2rem 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    white-space: nowrap;
    font-weight: 600;
}

/* Filter Dropdown */
.filterContainer {
    margin-bottom: 1rem;
}

.filterDropdown {
    width: 100%;
    padding: 0.5rem 0.75rem;
    background: #0a0a0a;
    border: 2px solid #ffed4e;
    border-radius: 0;
    color: #ffed4e;
    font-size: 0.8rem;
    font-family: var(--font-body, 'Inter', sans-serif);
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23ffed4e' d='M6 8L2 4h8z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 0.75rem center;
    padding-right: 2rem;
    text-transform: uppercase;
}

.filterDropdown:hover {
    background: #1a1a1a;
    box-shadow: 0 0 10px rgba(255, 237, 78, 0.3);
}

.filterDropdown:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(255, 237, 78, 0.4);
}

.filterDropdown option {
    background: #0a0a0a;
    color: #ffed4e;
    padding: 0.5rem;
}

/* Chart Container */
.chartContainer {
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 0.75rem;
}

.pieChart {
    width: 160px;
    height: 160px;
    filter: drop-shadow(0 4px 12px rgba(255, 237, 78, 0.2));
}

.pieSlice {
    transform-origin: center;
    animation: sliceAppear 0.5s ease-out forwards;
    opacity: 0;
    transition: transform 0.2s ease;
}

.pieSlice:hover {
    transform: scale(1.02);
    filter: brightness(1.1);
}

@keyframes sliceAppear {
    from {
        opacity: 0;
        transform: scale(0.9);
    }

    to {
        opacity: 1;
        transform: scale(1);
    }
}

/* Slice Labels */
.sliceLabel {
    font-family: var(--font-body, 'Inter', sans-serif);
    pointer-events: none;
}

.sliceLabelValue {
    font-size: 8px;
    font-weight: 700;
}

.sliceLabelPercent {
    font-size: 6px;
    font-weight: 500;
}

/* Total Label */
.totalLabel {
    text-align: center;
    font-size: 0.8rem;
    font-family: var(--font-body, 'Inter', sans-serif);
    color: #ffed4e;
    font-weight: 600;
    padding: 0.5rem;
    background: rgba(255, 237, 78, 0.1);
    border: 1px solid rgba(255, 237, 78, 0.3);
    margin-bottom: 0.75rem;
}

/* Legend */
.legend {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.5rem;
    padding-top: 0.5rem;
    border-top: 1px solid rgba(255, 237, 78, 0.2);
}

.legendItem {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    font-size: 0.7rem;
    font-family: var(--font-body, 'Inter', sans-serif);
}

.legendColor {
    width: 12px;
    height: 12px;
    border-radius: 0;
    flex-shrink: 0;
    border: 1px solid #0a0a0a;
}

.legendLabel {
    color: rgba(255, 255, 255, 0.7);
    flex: 1;
}

.legendValue {
    color: #ffed4e;
    font-weight: 700;
    text-align: right;
}

/* Responsive */
@media (max-width: 768px) {
    .tile {
        padding: 1rem;
    }

    .ipoName {
        font-size: 0.9rem;
    }

    .pieChart {
        width: 140px;
        height: 140px;
    }

    .legend {
        grid-template-columns: 1fr;
    }

    .legendItem {
        font-size: 0.65rem;
    }

    .sliceLabelValue {
        font-size: 7px;
    }

    .sliceLabelPercent {
        font-size: 5px;
    }
}
</file>

<file path="components/homepage/IPOAnalysisTile.tsx">
'use client';

import { useState } from 'react';
import styles from './IPOAnalysisTile.module.css';

interface IPOData {
    id: number;
    ipo_name: string;
    company_name?: string;
    category?: string;
    issue_size_cr?: number;
    lot_size?: number;
    subscription_retail?: number;
    subscription_nii?: number;
    subscription_qib?: number;
    subscription_total?: number;
}

type FilterType = 'allocation' | 'issueSize' | 'subscription' | 'lots' | 'investors';

interface FilterOption {
    value: FilterType;
    label: string;
}

const filterOptions: FilterOption[] = [
    { value: 'allocation', label: 'Allocation %' },
    { value: 'issueSize', label: 'Issue Size (‚Çπ Cr)' },
    { value: 'subscription', label: 'Subscription Data' },
    { value: 'lots', label: 'Lot Distribution' },
    { value: 'investors', label: 'Investor Count' },
];

// SEBI-defined allocation percentages
const ALLOCATION_PERCENTAGES = {
    retail: 35,
    sNII: 15,
    bNII: 15,
    qib: 35,
};

// Black and Yellow/Gold theme colors
const THEME_COLORS = {
    retail: '#ffed4e',    // Bright Yellow
    sNII: '#d4af37',      // Gold
    bNII: '#b8860b',      // Dark Goldenrod
    qib: '#ffd700',       // Gold
};

interface PieSegment {
    label: string;
    value: number;
    color: string;
    displayValue: string;
    percentage: number;
}

export default function IPOAnalysisTile({ ipo }: { ipo: IPOData }) {
    const [selectedFilter, setSelectedFilter] = useState<FilterType>('allocation');

    const getChartData = (): PieSegment[] => {
        const issueSize = ipo.issue_size_cr || 100;
        const lotSize = ipo.lot_size || 1;
        const retailSub = ipo.subscription_retail || 1;
        const niiSub = ipo.subscription_nii || 1;
        const qibSub = ipo.subscription_qib || 1;

        switch (selectedFilter) {
            case 'allocation':
                return [
                    { label: 'Retail', value: ALLOCATION_PERCENTAGES.retail, color: THEME_COLORS.retail, displayValue: `${ALLOCATION_PERCENTAGES.retail}%`, percentage: ALLOCATION_PERCENTAGES.retail },
                    { label: 'sNII', value: ALLOCATION_PERCENTAGES.sNII, color: THEME_COLORS.sNII, displayValue: `${ALLOCATION_PERCENTAGES.sNII}%`, percentage: ALLOCATION_PERCENTAGES.sNII },
                    { label: 'bNII', value: ALLOCATION_PERCENTAGES.bNII, color: THEME_COLORS.bNII, displayValue: `${ALLOCATION_PERCENTAGES.bNII}%`, percentage: ALLOCATION_PERCENTAGES.bNII },
                    { label: 'QIB', value: ALLOCATION_PERCENTAGES.qib, color: THEME_COLORS.qib, displayValue: `${ALLOCATION_PERCENTAGES.qib}%`, percentage: ALLOCATION_PERCENTAGES.qib },
                ];

            case 'issueSize': {
                const retailCr = (issueSize * ALLOCATION_PERCENTAGES.retail) / 100;
                const sNIICr = (issueSize * ALLOCATION_PERCENTAGES.sNII) / 100;
                const bNIICr = (issueSize * ALLOCATION_PERCENTAGES.bNII) / 100;
                const qibCr = (issueSize * ALLOCATION_PERCENTAGES.qib) / 100;
                return [
                    { label: 'Retail', value: retailCr, color: THEME_COLORS.retail, displayValue: `‚Çπ${retailCr.toFixed(1)}Cr`, percentage: ALLOCATION_PERCENTAGES.retail },
                    { label: 'sNII', value: sNIICr, color: THEME_COLORS.sNII, displayValue: `‚Çπ${sNIICr.toFixed(1)}Cr`, percentage: ALLOCATION_PERCENTAGES.sNII },
                    { label: 'bNII', value: bNIICr, color: THEME_COLORS.bNII, displayValue: `‚Çπ${bNIICr.toFixed(1)}Cr`, percentage: ALLOCATION_PERCENTAGES.bNII },
                    { label: 'QIB', value: qibCr, color: THEME_COLORS.qib, displayValue: `‚Çπ${qibCr.toFixed(1)}Cr`, percentage: ALLOCATION_PERCENTAGES.qib },
                ];
            }

            case 'subscription': {
                const totalSub = retailSub + niiSub + qibSub;
                const retailPct = (retailSub / totalSub) * 100;
                const niiPct = (niiSub / totalSub) * 100;
                const qibPct = (qibSub / totalSub) * 100;
                return [
                    { label: 'Retail', value: retailSub, color: THEME_COLORS.retail, displayValue: `${retailSub.toFixed(2)}x`, percentage: retailPct },
                    { label: 'NII', value: niiSub, color: THEME_COLORS.sNII, displayValue: `${niiSub.toFixed(2)}x`, percentage: niiPct },
                    { label: 'QIB', value: qibSub, color: THEME_COLORS.qib, displayValue: `${qibSub.toFixed(2)}x`, percentage: qibPct },
                ];
            }

            case 'lots': {
                const totalLots = Math.round((issueSize * 10000000) / (lotSize * 100));
                const retailLots = Math.round((totalLots * ALLOCATION_PERCENTAGES.retail) / 100);
                const sNIILots = Math.round((totalLots * ALLOCATION_PERCENTAGES.sNII) / 100);
                const bNIILots = Math.round((totalLots * ALLOCATION_PERCENTAGES.bNII) / 100);
                const qibLots = Math.round((totalLots * ALLOCATION_PERCENTAGES.qib) / 100);
                return [
                    { label: 'Retail', value: retailLots, color: THEME_COLORS.retail, displayValue: `${(retailLots / 1000).toFixed(1)}K`, percentage: ALLOCATION_PERCENTAGES.retail },
                    { label: 'sNII', value: sNIILots, color: THEME_COLORS.sNII, displayValue: `${(sNIILots / 1000).toFixed(1)}K`, percentage: ALLOCATION_PERCENTAGES.sNII },
                    { label: 'bNII', value: bNIILots, color: THEME_COLORS.bNII, displayValue: `${(bNIILots / 1000).toFixed(1)}K`, percentage: ALLOCATION_PERCENTAGES.bNII },
                    { label: 'QIB', value: qibLots, color: THEME_COLORS.qib, displayValue: `${(qibLots / 1000).toFixed(1)}K`, percentage: ALLOCATION_PERCENTAGES.qib },
                ];
            }

            case 'investors': {
                const baseInvestors = 10000;
                const retailInvestors = Math.round(baseInvestors * retailSub);
                const niiInvestors = Math.round((baseInvestors * niiSub) / 10);
                const qibInvestors = Math.round((baseInvestors * qibSub) / 100);
                const totalInvestors = retailInvestors + niiInvestors + qibInvestors;
                return [
                    { label: 'Retail', value: retailInvestors, color: THEME_COLORS.retail, displayValue: `${(retailInvestors / 1000).toFixed(1)}K`, percentage: (retailInvestors / totalInvestors) * 100 },
                    { label: 'NII', value: niiInvestors, color: THEME_COLORS.sNII, displayValue: `${(niiInvestors / 1000).toFixed(1)}K`, percentage: (niiInvestors / totalInvestors) * 100 },
                    { label: 'QIB', value: qibInvestors, color: THEME_COLORS.qib, displayValue: `${qibInvestors}`, percentage: (qibInvestors / totalInvestors) * 100 },
                ];
            }

            default:
                return [];
        }
    };

    const chartData = getChartData();
    const total = chartData.reduce((sum, segment) => sum + segment.value, 0);

    // Generate SVG pie chart paths with labels
    const generatePieSlices = () => {
        let currentAngle = -90;
        const centerX = 100;
        const centerY = 100;
        const radius = 85;
        const labelRadius = 55; // Radius for labels inside the pie

        return chartData.map((segment, index) => {
            const sliceAngle = (segment.value / total) * 360;
            const startAngle = currentAngle;
            const endAngle = currentAngle + sliceAngle;
            const midAngle = (startAngle + endAngle) / 2;

            currentAngle = endAngle;

            // Convert angles to radians
            const startRad = (startAngle * Math.PI) / 180;
            const endRad = (endAngle * Math.PI) / 180;
            const midRad = (midAngle * Math.PI) / 180;

            // Calculate arc points
            const x1 = centerX + radius * Math.cos(startRad);
            const y1 = centerY + radius * Math.sin(startRad);
            const x2 = centerX + radius * Math.cos(endRad);
            const y2 = centerY + radius * Math.sin(endRad);

            // Label position (inside the slice)
            const labelX = centerX + labelRadius * Math.cos(midRad);
            const labelY = centerY + labelRadius * Math.sin(midRad);

            // Large arc flag
            const largeArc = sliceAngle > 180 ? 1 : 0;

            const pathData = `
                M ${centerX} ${centerY}
                L ${x1} ${y1}
                A ${radius} ${radius} 0 ${largeArc} 1 ${x2} ${y2}
                Z
            `;

            // Only show label if slice is big enough (> 10%)
            const showLabel = segment.percentage > 10;

            return (
                <g key={index}>
                    <path
                        d={pathData}
                        fill={segment.color}
                        stroke="#0a0a0a"
                        strokeWidth="2"
                        className={styles.pieSlice}
                        style={{ animationDelay: `${index * 0.1}s` }}
                    />
                    {showLabel && (
                        <text
                            x={labelX}
                            y={labelY}
                            textAnchor="middle"
                            dominantBaseline="middle"
                            className={styles.sliceLabel}
                            fill="#0a0a0a"
                        >
                            <tspan x={labelX} dy="-0.4em" className={styles.sliceLabelValue}>{segment.displayValue}</tspan>
                            <tspan x={labelX} dy="1.1em" className={styles.sliceLabelPercent}>({segment.percentage.toFixed(0)}%)</tspan>
                        </text>
                    )}
                </g>
            );
        });
    };

    const getTotalLabel = (): string => {
        switch (selectedFilter) {
            case 'issueSize':
                return `Total: ‚Çπ${ipo.issue_size_cr || 0} Cr`;
            case 'subscription':
                return `Total: ${(ipo.subscription_total || 0).toFixed(2)}x`;
            default:
                return '';
        }
    };

    return (
        <div className={styles.tile}>
            <div className={styles.header}>
                <h3 className={styles.ipoName}>{ipo.ipo_name}</h3>
                <span className={styles.category}>{ipo.category || 'Mainboard'}</span>
            </div>

            <div className={styles.filterContainer}>
                <select
                    value={selectedFilter}
                    onChange={(e) => setSelectedFilter(e.target.value as FilterType)}
                    className={styles.filterDropdown}
                >
                    {filterOptions.map((option) => (
                        <option key={option.value} value={option.value}>
                            {option.label}
                        </option>
                    ))}
                </select>
            </div>

            <div className={styles.chartContainer}>
                <svg viewBox="0 0 200 200" className={styles.pieChart}>
                    {generatePieSlices()}
                </svg>
            </div>

            {getTotalLabel() && (
                <div className={styles.totalLabel}>{getTotalLabel()}</div>
            )}

            <div className={styles.legend}>
                {chartData.map((segment, index) => (
                    <div key={index} className={styles.legendItem}>
                        <span
                            className={styles.legendColor}
                            style={{ backgroundColor: segment.color }}
                        />
                        <span className={styles.legendLabel}>{segment.label}</span>
                        <span className={styles.legendValue}>{segment.displayValue}</span>
                    </div>
                ))}
            </div>
        </div>
    );
}
</file>

<file path="components/homepage/IPOCalendarWidget.module.css">
/* ============================================
   IPO Calendar Widget - Brutalist Editorial Style
   ============================================ */

.container {
    background: var(--color-bg-card);
    border: 4px solid var(--black);
    overflow: hidden;
    box-shadow: var(--shadow-card);
    display: flex;
    flex-direction: column;
    height: 100%;
}

.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 1rem;
    background: var(--yellow);
    border-bottom: 3px solid var(--black);
}

.monthYear {
    font-size: 1rem;
    font-family: var(--font-heading);
    color: var(--black);
    margin: 0;
    text-transform: uppercase;
}

.navButton {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: var(--white);
    border: 2px solid var(--black);
    cursor: pointer;
    transition: all 0.15s ease;
    color: var(--black);
    font-size: 0.875rem;
}

.navButton:hover {
    background: var(--black);
    color: var(--yellow);
    transform: rotate(-3deg);
}

.calendar {
    background-color: var(--white);
}

.weekdays {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    background-color: var(--gray);
    border-bottom: 3px solid var(--black);
}

.weekday {
    padding: 0.875rem 0.5rem;
    text-align: center;
    font-size: 0.6875rem;
    font-family: var(--font-body);
    font-weight: 700;
    color: var(--black);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    border-right: 1px solid var(--color-border-light);
}

.weekday:last-child {
    border-right: none;
}

.days {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
}

.blankDay {
    aspect-ratio: 1;
    background-color: var(--gray);
    border-right: 1px solid var(--color-border-light);
    border-bottom: 1px solid var(--color-border-light);
}

.blankDay:nth-child(7n) {
    border-right: none;
}

.day {
    aspect-ratio: 1;
    padding: 0.5rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    border-right: 1px solid var(--color-border-light);
    border-bottom: 1px solid var(--color-border-light);
    cursor: pointer;
    transition: all 0.15s ease;
    position: relative;
    background-color: var(--white);
}

.day:nth-child(7n) {
    border-right: none;
}

.day:hover {
    background-color: var(--yellow);
}

.dayNumber {
    font-size: 0.875rem;
    font-family: var(--font-body);
    font-weight: 700;
    color: var(--color-text-primary);
}

.today {
    background: var(--yellow);
}

.today .dayNumber {
    background: var(--black);
    color: var(--yellow);
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
}

.hasEvents {
    background-color: rgba(255, 237, 78, 0.3);
}

.hasEvents .dayNumber {
    color: var(--black);
    font-weight: 700;
}

.eventDots {
    display: flex;
    gap: 4px;
    margin-top: 0.375rem;
}

.eventDot {
    width: 8px;
    height: 8px;
    background: var(--black);
}

/* Upcoming Events Section */
.upcomingEvents {
    padding: 1.5rem;
    border-top: 4px solid var(--black);
    background: var(--gray);
}

.eventsTitle {
    font-size: 1rem;
    font-family: var(--font-heading);
    color: var(--black);
    margin: 0 0 1rem 0;
    text-transform: uppercase;
    background: var(--yellow);
    display: inline-block;
    padding: 0.25rem 0.75rem;
    transform: rotate(-1deg);
}

.eventsList {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.eventItem {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background-color: var(--white);
    border: 3px solid var(--black);
    transition: all 0.15s ease;
    text-decoration: none;
}

.eventItem:hover {
    box-shadow: var(--shadow-sm);
    transform: translateX(4px) rotate(-1deg);
    background: var(--yellow);
}

.eventDate {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 40px;
    height: 40px;
    background: var(--black);
    color: var(--yellow);
    font-size: 1rem;
    font-family: var(--font-body);
    font-weight: 700;
}

.eventInfo {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
    flex: 1;
    min-width: 0;
}

.eventTitle {
    font-size: 0.875rem;
    font-family: var(--font-body);
    font-weight: 700;
    color: var(--color-text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    text-transform: uppercase;
}

.eventType {
    font-size: 0.6875rem;
    font-family: var(--font-body);
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

/* Responsive Design */
@media (max-width: 768px) {
    .header {
        padding: 1rem 1.25rem;
    }

    .monthYear {
        font-size: 1rem;
    }

    .weekday {
        padding: 0.625rem 0.25rem;
        font-size: 0.5625rem;
    }

    .day {
        padding: 0.375rem;
    }

    .dayNumber {
        font-size: 0.75rem;
    }

    .today .dayNumber {
        width: 24px;
        height: 24px;
    }

    .eventDots {
        gap: 3px;
    }

    .eventDot {
        width: 6px;
        height: 6px;
    }

    .upcomingEvents {
        padding: 1.25rem;
    }

    .eventItem {
        padding: 0.75rem;
    }

    .eventDate {
        min-width: 36px;
        height: 36px;
        font-size: 0.875rem;
    }
}
</file>

<file path="components/homepage/IPOCalendarWidget.tsx">
'use client';

import { useState, useEffect } from 'react';
import Link from 'next/link';
import styles from './IPOCalendarWidget.module.css';
import { fetchCalendarEvents } from '@/lib/api';

export default function IPOCalendarWidget() {
    const [currentDate, setCurrentDate] = useState(new Date());
    const [events, setEvents] = useState<any[]>([]);
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        loadEvents();
    }, [currentDate]);

    async function loadEvents() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth() + 1;
        const data = await fetchCalendarEvents(year, month);
        setEvents(data);
        setLoading(false);
    }

    const getDaysInMonth = () => {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startingDayOfWeek = firstDay.getDay();

        return { daysInMonth, startingDayOfWeek };
    };

    const getEventsForDay = (day: number) => {
        const dateStr = new Date(
            currentDate.getFullYear(),
            currentDate.getMonth(),
            day
        ).toISOString().split('T')[0];

        return events.filter(event => event.event_date === dateStr);
    };

    const { daysInMonth, startingDayOfWeek } = getDaysInMonth();
    const days = Array.from({ length: daysInMonth }, (_, i) => i + 1);
    const blanks = Array.from({ length: startingDayOfWeek }, (_, i) => i);

    const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

    return (
        <div className={styles.container}>
            <div className={styles.header}>
                <button 
                    className={styles.navButton}
                    onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1))}
                >
                    ‚Üê
                </button>
                <h3 className={styles.monthYear}>
                    {monthNames[currentDate.getMonth()]} {currentDate.getFullYear()}
                </h3>
                <button 
                    className={styles.navButton}
                    onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1))}
                >
                    ‚Üí
                </button>
            </div>

            <div className={styles.calendar}>
                <div className={styles.weekdays}>
                    {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (
                        <div key={day} className={styles.weekday}>{day}</div>
                    ))}
                </div>

                <div className={styles.days}>
                    {blanks.map(i => (
                        <div key={`blank-${i}`} className={styles.blankDay} />
                    ))}
                    {days.map(day => {
                        const dayEvents = getEventsForDay(day);
                        const hasEvents = dayEvents.length > 0;
                        const today = new Date();
                        const isToday = 
                            day === today.getDate() &&
                            currentDate.getMonth() === today.getMonth() &&
                            currentDate.getFullYear() === today.getFullYear();

                        return (
                            <div
                                key={day}
                                className={`${styles.day} ${hasEvents ? styles.hasEvents : ''} ${isToday ? styles.today : ''}`}
                                title={hasEvents ? dayEvents.map(e => e.event_title).join(', ') : ''}
                            >
                                <span className={styles.dayNumber}>{day}</span>
                                {hasEvents && (
                                    <div className={styles.eventDots}>
                                        {dayEvents.slice(0, 3).map((event, i) => (
                                            <div key={i} className={styles.eventDot} />
                                        ))}
                                    </div>
                                )}
                            </div>
                        );
                    })}
                </div>
            </div>

            {events.length > 0 && (
                <div className={styles.upcomingEvents}>
                    <h4 className={styles.eventsTitle}>Upcoming Events</h4>
                    <div className={styles.eventsList}>
                        {events.slice(0, 5).map((event, i) => (
                            <Link 
                                key={i} 
                                href={`/ipo/${event.ipos?.slug || '#'}`}
                                className={styles.eventItem}
                            >
                                <span className={styles.eventDate}>
                                    {new Date(event.event_date).getDate()}
                                </span>
                                <div className={styles.eventInfo}>
                                    <span className={styles.eventTitle}>{event.event_title}</span>
                                    <span className={styles.eventType}>{event.event_type}</span>
                                </div>
                            </Link>
                        ))}
                    </div>
                </div>
            )}
        </div>
    );
}
</file>

<file path="components/homepage/IPOCategoryChart.module.css">
/* IPO Category Chart Section - Template Style */

.chartSection {
    background: linear-gradient(145deg, #ebe4d1 0%, #e5dcc5 100%);
    border-radius: 8px;
    padding: 1.5rem 2rem;
    margin-bottom: 3rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

.chartSection:hover {
    /* Removed rotation change */
}

.loading {
    text-align: center;
    padding: 3rem;
    font-size: 1rem;
    color: #666;
}

/* Header */
.chartHeader {
    margin-bottom: 1rem;
}

.chartTitle {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--black, #0a0a0a);
    margin: 0 0 0.25rem 0;
    font-family: var(--font-heading, 'Inter', sans-serif);
}

.chartSubtitle {
    font-size: 0.8rem;
    color: #666;
    margin: 0;
}

/* Dropdown Row */
.dropdownRow {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
}

.dropdownGroup {
    flex: 1;
}

.dropdownLabel {
    display: block;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #666;
    margin-bottom: 0.5rem;
}

.dropdown {
    width: 100%;
    padding: 0.875rem 1rem;
    background: rgba(58, 58, 58, 0.09);
    border: 2px solid var(--black, #0a0a0a);
    border-radius: 4px;
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--black, #0a0a0a);
    cursor: pointer;
    transition: all 0.2s ease;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%230a0a0a' d='M6 8L2 4h8z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 1rem center;
    padding-right: 2.5rem;
}

.dropdown:hover {
    background: #f0f0f0;
}

.dropdown:focus {
    outline: none;
    border-color: var(--yellow, #ffed4e);
    box-shadow: 0 0 0 3px rgba(255, 237, 78, 0.3);
}

.dropdown option {
    background: white;
    color: var(--black, #0a0a0a);
}

/* Chart Container */
.chartContainer {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    align-items: center;
}

/* Pie Chart Wrapper */
.pieChartWrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
}

.pieSvg {
    display: block;
}

.pieSlice {
    transition: all 0.3s ease;
    cursor: pointer;
}

.pieSlice:hover {
    opacity: 0.85;
    filter: brightness(1.05);
}

/* Slice Labels */
.sliceLabel {
    font-family: 'JetBrains Mono', 'Courier New', monospace;
    pointer-events: none;
}

/* Total displayed below the pie chart */
.totalBelow {
    text-align: center;
    margin-top: 0;
    padding: 0.75rem 1.5rem;
    background: rgba(26, 58, 58, 0.08);
    border-radius: 10px;
    border: 1px solid rgba(26, 58, 58, 0.15);
}

.totalValue {
    font-family: 'JetBrains Mono', 'Courier New', monospace;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--teal-dark, #1a3a3a);
    line-height: 1.2;
}

.totalLabel {
    font-size: 0.65rem;
    color: #4a6a6a;
    margin-top: 0.125rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

/* Legend */
.chartLegend {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.legendItem {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.5rem 0.75rem;
    background: rgba(58, 58, 58, 0.09);
    border-radius: 6px;
    transition: all 0.2s ease;
    cursor: pointer;
}

.legendItem:hover {
    background: #f0f0f0;
    transform: translateX(4px);
}

.legendColor {
    width: 40px;
    height: 40px;
    border-radius: 6px;
    flex-shrink: 0;
}

.legendInfo {
    flex: 1;
}

.legendLabel {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--black, #0a0a0a);
    margin-bottom: 0.25rem;
}

.legendValue {
    font-family: 'JetBrains Mono', 'Courier New', monospace;
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--black, #0a0a0a);
}

.legendPercent {
    font-size: 0.75rem;
    color: #666;
    margin-left: 0.5rem;
    font-family: var(--font-body, 'Inter', sans-serif);
}

/* Responsive */
@media (max-width: 768px) {
    .chartSection {
        padding: 1.5rem;
        margin-bottom: 3rem;
    }

    .chartTitle {
        font-size: 1.25rem;
    }

    .chartSubtitle {
        font-size: 0.8125rem;
    }

    .dropdownRow {
        flex-direction: column;
        gap: 1rem;
    }

    .chartContainer {
        grid-template-columns: 1fr;
        gap: 2rem;
    }

    .pieChart {
        width: 240px;
        height: 240px;
    }

    .pieCenter {
        width: 80px;
        height: 80px;
    }

    .pieCenterValue {
        font-size: 1.125rem;
    }

    .pieCenterLabel {
        font-size: 0.5625rem;
    }

    .legendItem {
        padding: 0.75rem;
    }

    .legendColor {
        width: 32px;
        height: 32px;
    }

    .legendLabel {
        font-size: 0.75rem;
    }

    .legendValue {
        font-size: 1rem;
    }
}

@media (max-width: 480px) {
    .chartSection {
        padding: 1rem;
        margin-bottom: 2rem;
    }

    .chartTitle {
        font-size: 1.125rem;
    }

    .dropdown {
        padding: 0.75rem;
        font-size: 0.8125rem;
    }

    .pieChart {
        width: 200px;
        height: 200px;
    }

    .pieCenter {
        width: 70px;
        height: 70px;
    }

    .pieCenterValue {
        font-size: 1rem;
    }

    .legendItem {
        padding: 0.625rem;
        gap: 0.75rem;
    }

    .legendColor {
        width: 28px;
        height: 28px;
    }

    .legendLabel {
        font-size: 0.6875rem;
    }

    .legendValue {
        font-size: 0.875rem;
    }

    .legendPercent {
        font-size: 0.625rem;
    }
}
</file>

<file path="components/homepage/IPOCategoryChart.tsx">
'use client';

import { useState, useEffect } from 'react';
import styles from './IPOCategoryChart.module.css';
import { fetchFeaturedIPOs, fetchOpenIPOs } from '@/lib/api';

interface IPOData {
    id: number;
    ipo_name: string;
    company_name?: string;
    category?: string;
    issue_size_cr?: number;
    lot_size?: number;
    subscription_retail?: number;
    subscription_nii?: number;
    subscription_qib?: number;
    subscription_total?: number;
}

type FilterType = 'allocation' | 'issueSize' | 'subscription';

interface FilterOption {
    value: FilterType;
    label: string;
}

const filterOptions: FilterOption[] = [
    { value: 'allocation', label: 'Allocation %' },
    { value: 'issueSize', label: 'Issue Size (‚Çπ Cr)' },
    { value: 'subscription', label: 'Subscription Data' },
];

// Dynamic color palette
const CHART_COLORS = [
    '#FFED4E', // Yellow
    '#FF9500', // Orange
    '#007AFF', // Blue
    '#AF52DE', // Purple
    '#5AC8FA', // Teal
    '#34C759', // Green
    '#FF3B30', // Red
    '#FF6F61', // Coral
];

function getChartColor(index: number): string {
    return CHART_COLORS[index % CHART_COLORS.length];
}

// SEBI-defined allocation percentages
const ALLOCATION_PERCENTAGES = {
    retail: 35,
    qib: 50,
    nii: 15,
};

interface PieSegment {
    label: string;
    value: number;
    color: string;
    displayValue: string;
    subscribed?: string;
}

export default function IPOCategoryChart() {
    const [ipos, setIpos] = useState<IPOData[]>([]);
    const [selectedIPO, setSelectedIPO] = useState<IPOData | null>(null);
    const [selectedFilter, setSelectedFilter] = useState<FilterType>('allocation');
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        loadIPOs();
    }, []);

    async function loadIPOs() {
        try {
            const [featured, open] = await Promise.all([
                fetchFeaturedIPOs(),
                fetchOpenIPOs(),
            ]);
            const allIPOs = [...featured, ...open];
            const uniqueIPOs = allIPOs.filter((ipo, index, self) =>
                index === self.findIndex((t) => t.id === ipo.id)
            );
            setIpos(uniqueIPOs);
            if (uniqueIPOs.length > 0) {
                setSelectedIPO(uniqueIPOs[0]);
            }
        } catch (error) {
            console.error('Error loading IPOs:', error);
        } finally {
            setLoading(false);
        }
    }

    const getChartData = (): PieSegment[] => {
        if (!selectedIPO) return [];

        const issueSize = selectedIPO.issue_size_cr || 100;
        const retailSub = selectedIPO.subscription_retail || 0;
        const niiSub = selectedIPO.subscription_nii || 0;
        const qibSub = selectedIPO.subscription_qib || 0;

        switch (selectedFilter) {
            case 'allocation':
                return [
                    { label: 'Retail', value: ALLOCATION_PERCENTAGES.retail, color: getChartColor(0), displayValue: `${ALLOCATION_PERCENTAGES.retail}%`, subscribed: `${retailSub.toFixed(2)}x` },
                    { label: 'QIB', value: ALLOCATION_PERCENTAGES.qib, color: getChartColor(1), displayValue: `${ALLOCATION_PERCENTAGES.qib}%`, subscribed: `${qibSub.toFixed(2)}x` },
                    { label: 'NII', value: ALLOCATION_PERCENTAGES.nii, color: getChartColor(2), displayValue: `${ALLOCATION_PERCENTAGES.nii}%`, subscribed: `${niiSub.toFixed(2)}x` },
                ];

            case 'issueSize': {
                const retailCr = (issueSize * ALLOCATION_PERCENTAGES.retail) / 100;
                const qibCr = (issueSize * ALLOCATION_PERCENTAGES.qib) / 100;
                const niiCr = (issueSize * ALLOCATION_PERCENTAGES.nii) / 100;
                return [
                    { label: 'Retail', value: retailCr, color: getChartColor(0), displayValue: `‚Çπ${retailCr.toFixed(1)}Cr` },
                    { label: 'QIB', value: qibCr, color: getChartColor(1), displayValue: `‚Çπ${qibCr.toFixed(1)}Cr` },
                    { label: 'NII', value: niiCr, color: getChartColor(2), displayValue: `‚Çπ${niiCr.toFixed(1)}Cr` },
                ];
            }

            case 'subscription': {
                return [
                    { label: 'Retail', value: retailSub || 0.01, color: getChartColor(0), displayValue: `${retailSub.toFixed(2)}x` },
                    { label: 'QIB', value: qibSub || 0.01, color: getChartColor(1), displayValue: `${qibSub.toFixed(2)}x` },
                    { label: 'NII', value: niiSub || 0.01, color: getChartColor(2), displayValue: `${niiSub.toFixed(2)}x` },
                ];
            }

            default:
                return [];
        }
    };

    const chartData = getChartData();
    const total = chartData.reduce((sum, segment) => sum + segment.value, 0) || 1;

    const centerX = 170;
    const centerY = 160;
    const radius = 100;
    const innerLabelRadius = 55; // For labels inside the slice
    const labelRadius = 112; // For label line start (outside edge)
    const outerLabelRadius = 130; // For label line bend point

    // Threshold: slices with more than 25% get labels inside
    const INSIDE_LABEL_THRESHOLD = 0.25;

    // Generate filled pie slices and labels with smart placement
    const generatePieChart = () => {
        let currentAngle = -90;
        const slices: JSX.Element[] = [];
        const labels: JSX.Element[] = [];

        chartData.forEach((segment, index) => {
            const percentage = segment.value / total;
            const sliceAngle = percentage * 360;
            const startAngle = currentAngle;
            const endAngle = currentAngle + sliceAngle;
            const midAngle = startAngle + sliceAngle / 2;

            currentAngle = endAngle;

            // Convert angles to radians
            const startRad = (startAngle * Math.PI) / 180;
            const endRad = (endAngle * Math.PI) / 180;
            const midRad = (midAngle * Math.PI) / 180;

            // Calculate arc points for slice
            const x1 = centerX + radius * Math.cos(startRad);
            const y1 = centerY + radius * Math.sin(startRad);
            const x2 = centerX + radius * Math.cos(endRad);
            const y2 = centerY + radius * Math.sin(endRad);

            const largeArc = sliceAngle > 180 ? 1 : 0;

            // Filled pie slice path
            const pathData = `
                M ${centerX} ${centerY}
                L ${x1} ${y1}
                A ${radius} ${radius} 0 ${largeArc} 1 ${x2} ${y2}
                Z
            `;

            slices.push(
                <path
                    key={`slice-${index}`}
                    d={pathData}
                    fill={segment.color}
                    stroke="#1a3a3a"
                    strokeWidth="2"
                    className={styles.pieSlice}
                />
            );

            // Smart label placement based on slice size
            if (percentage >= INSIDE_LABEL_THRESHOLD) {
                // Large slice: place label INSIDE with name on top, value below
                const labelX = centerX + innerLabelRadius * Math.cos(midRad);
                const labelY = centerY + innerLabelRadius * Math.sin(midRad);

                labels.push(
                    <text
                        key={`label-${index}`}
                        x={labelX}
                        y={labelY}
                        textAnchor="middle"
                        className={styles.sliceLabel}
                        fill="#1a3a3a"
                    >
                        <tspan x={labelX} dy="-0.5em" fontSize="13" fontWeight="600">
                            {segment.label}
                        </tspan>
                        <tspan x={labelX} dy="1.2em" fontSize="15" fontWeight="700">
                            {segment.displayValue}
                        </tspan>
                    </text>
                );
            } else {
                // Small slice: place label OUTSIDE with connecting lines
                const edgeX = centerX + labelRadius * Math.cos(midRad);
                const edgeY = centerY + labelRadius * Math.sin(midRad);
                const outerX = centerX + outerLabelRadius * Math.cos(midRad);
                const outerY = centerY + outerLabelRadius * Math.sin(midRad);

                // Horizontal extension for the label
                const isRightSide = midAngle > -90 && midAngle < 90;
                const horizontalExtend = isRightSide ? 30 : -30;
                const textAnchor = isRightSide ? 'start' : 'end';
                const textX = outerX + horizontalExtend + (isRightSide ? 5 : -5);

                labels.push(
                    <g key={`label-${index}`}>
                        {/* First line: from edge to outer point */}
                        <line
                            x1={edgeX}
                            y1={edgeY}
                            x2={outerX}
                            y2={outerY}
                            stroke="#1a3a3a"
                            strokeWidth="1.5"
                        />
                        {/* Second line: horizontal extension */}
                        <line
                            x1={outerX}
                            y1={outerY}
                            x2={outerX + horizontalExtend}
                            y2={outerY}
                            stroke="#1a3a3a"
                            strokeWidth="1.5"
                        />
                        {/* Label text - stacked */}
                        <text
                            x={textX}
                            y={outerY}
                            textAnchor={textAnchor}
                            className={styles.sliceLabel}
                            fill="#1a3a3a"
                        >
                            <tspan x={textX} dy="-0.4em" fontSize="11" fontWeight="600">
                                {segment.label}
                            </tspan>
                            <tspan x={textX} dy="1.1em" fontSize="13" fontWeight="700">
                                {segment.displayValue}
                            </tspan>
                        </text>
                    </g>
                );
            }
        });

        return { slices, labels };
    };

    const getCenterValue = (): string => {
        switch (selectedFilter) {
            case 'allocation':
                return '100%';
            case 'issueSize':
                return `‚Çπ${selectedIPO?.issue_size_cr || 0}Cr`;
            case 'subscription':
                return `${(selectedIPO?.subscription_total || 0).toFixed(2)}x`;
            default:
                return '100%';
        }
    };

    const getCenterLabel = (): string => {
        switch (selectedFilter) {
            case 'allocation':
                return 'Total Allocation';
            case 'issueSize':
                return 'Total Issue Size';
            case 'subscription':
                return 'Total Subscribed';
            default:
                return 'Total';
        }
    };

    if (loading) {
        return (
            <div className={styles.chartSection}>
                <div className={styles.loading}>Loading IPO data...</div>
            </div>
        );
    }

    const { slices, labels } = generatePieChart();

    return (
        <div className={styles.chartSection}>
            <div className={styles.chartHeader}>
                <h2 className={styles.chartTitle}>IPO Category Distribution</h2>
                <p className={styles.chartSubtitle}>Breakdown by subscription category</p>
            </div>

            {/* Dropdowns */}
            <div className={styles.dropdownRow}>
                <div className={styles.dropdownGroup}>
                    <label className={styles.dropdownLabel}>Select IPO</label>
                    <select
                        value={selectedIPO?.id || ''}
                        onChange={(e) => {
                            const ipo = ipos.find(i => i.id === Number(e.target.value));
                            if (ipo) setSelectedIPO(ipo);
                        }}
                        className={styles.dropdown}
                    >
                        {ipos.map((ipo) => (
                            <option key={ipo.id} value={ipo.id}>
                                {ipo.ipo_name}
                            </option>
                        ))}
                    </select>
                </div>

                <div className={styles.dropdownGroup}>
                    <label className={styles.dropdownLabel}>Filter By</label>
                    <select
                        value={selectedFilter}
                        onChange={(e) => setSelectedFilter(e.target.value as FilterType)}
                        className={styles.dropdown}
                    >
                        {filterOptions.map((option) => (
                            <option key={option.value} value={option.value}>
                                {option.label}
                            </option>
                        ))}
                    </select>
                </div>
            </div>

            <div className={styles.chartContainer}>
                {/* Pie Chart with labels */}
                <div className={styles.pieChartWrapper}>
                    <svg width="340" height="340" viewBox="0 0 340 320" className={styles.pieSvg}>
                        {slices}
                        {labels}
                    </svg>
                    {/* Total displayed below the pie chart */}
                    <div className={styles.totalBelow}>
                        <div className={styles.totalValue}>{getCenterValue()}</div>
                        <div className={styles.totalLabel}>{getCenterLabel()}</div>
                    </div>
                </div>

                {/* Legend */}
                <div className={styles.chartLegend}>
                    {chartData.map((segment, index) => (
                        <div key={index} className={styles.legendItem}>
                            <div
                                className={styles.legendColor}
                                style={{ backgroundColor: segment.color }}
                            />
                            <div className={styles.legendInfo}>
                                <div className={styles.legendLabel}>{segment.label}</div>
                                <div className={styles.legendValue}>
                                    {segment.displayValue}
                                    {segment.subscribed && (
                                        <span className={styles.legendPercent}> ({segment.subscribed} subscribed)</span>
                                    )}
                                </div>
                            </div>
                        </div>
                    ))}
                </div>
            </div>
        </div>
    );
}
</file>

<file path="components/homepage/IPOFilters.module.css">
/* ============================================
   IPO Filters - Brutalist Editorial Style
   ============================================ */

.filtersContainer {
    background: var(--color-bg-card);
    border: 4px solid var(--black);
    padding: 2rem;
    box-shadow: var(--shadow-card);
}

.filtersHeader {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 3px solid var(--black);
}

.filtersTitle {
    font-size: 1.25rem;
    font-family: var(--font-heading);
    color: var(--color-text-primary);
    text-transform: uppercase;
    background: var(--yellow);
    padding: 0.375rem 1rem;
    transform: rotate(-1deg);
}

.clearButton {
    padding: 0.625rem 1.25rem;
    background-color: var(--white);
    color: var(--black);
    border: 3px solid var(--black);
    font-size: 0.875rem;
    font-family: var(--font-body);
    font-weight: 700;
    cursor: pointer;
    transition: all 0.15s ease;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.clearButton:hover {
    background-color: var(--black);
    color: var(--yellow);
    transform: rotate(-2deg);
}

.filterGroup {
    margin-bottom: 1.5rem;
}

.filterGroup:last-child {
    margin-bottom: 0;
}

.filterLabel {
    font-size: 0.75rem;
    font-family: var(--font-body);
    font-weight: 700;
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 0.75rem;
    display: block;
}

.filterOptions {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
}

.filterButton {
    padding: 0.75rem 1.5rem;
    background-color: var(--white);
    color: var(--black);
    border: 3px solid var(--black);
    font-size: 0.9375rem;
    font-family: var(--font-body);
    font-weight: 700;
    cursor: pointer;
    transition: all 0.15s ease;
    white-space: nowrap;
    text-transform: uppercase;
}

.filterButton:hover {
    background-color: var(--yellow);
    transform: rotate(-1deg);
}

.filterButton.active {
    background: var(--black);
    color: var(--yellow);
}

.filterButton .count {
    display: inline-block;
    margin-left: 0.5rem;
    padding: 0.125rem 0.5rem;
    background-color: var(--gray);
    font-size: 0.75rem;
    border: 1px solid var(--black);
}

.filterButton.active .count {
    background-color: var(--yellow);
    color: var(--black);
}

.searchBox {
    width: 100%;
    padding: 1rem 1.25rem;
    padding-left: 3.5rem;
    border: 3px solid var(--black);
    font-size: 0.9375rem;
    font-family: var(--font-body);
    color: var(--color-text-primary);
    background-color: var(--white);
    background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16zM19 19l-4.35-4.35' stroke='%23000000' stroke-width='2.5' stroke-linecap='square' stroke-linejoin='miter'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: 1.25rem center;
    transition: all 0.15s ease;
}

.searchBox:hover {
    background-color: var(--gray);
}

.searchBox:focus {
    outline: none;
    background-color: var(--yellow);
}

.searchBox::placeholder {
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.rangeFilter {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: 1rem;
    align-items: center;
}

.rangeInput {
    padding: 1rem 1.25rem;
    border: 3px solid var(--black);
    font-size: 0.9375rem;
    font-family: var(--font-body);
    color: var(--color-text-primary);
    background-color: var(--white);
    transition: all 0.15s ease;
}

.rangeInput:hover {
    background-color: var(--gray);
}

.rangeInput:focus {
    outline: none;
    background-color: var(--yellow);
}

.rangeSeparator {
    font-size: 1rem;
    font-family: var(--font-body);
    color: var(--black);
    font-weight: 700;
}

.checkboxGroup {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.checkboxLabel {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    cursor: pointer;
    font-size: 0.9375rem;
    font-family: var(--font-body);
    color: var(--color-text-primary);
    transition: color 0.15s ease;
    text-transform: uppercase;
}

.checkboxLabel:hover {
    color: var(--black);
}

.checkbox {
    width: 24px;
    height: 24px;
    border: 3px solid var(--black);
    cursor: pointer;
    transition: all 0.15s ease;
    appearance: none;
    position: relative;
    background-color: var(--white);
}

.checkbox:hover {
    background-color: var(--gray);
}

.checkbox:checked {
    background: var(--black);
}

.checkbox:checked::after {
    content: '';
    position: absolute;
    top: 3px;
    left: 7px;
    width: 6px;
    height: 10px;
    border: solid var(--yellow);
    border-width: 0 3px 3px 0;
    transform: rotate(45deg);
}

.activeFiltersBar {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem;
    background-color: var(--gray);
    border: 3px solid var(--black);
    margin-top: 1.5rem;
    flex-wrap: wrap;
}

.activeFiltersLabel {
    font-size: 0.75rem;
    font-family: var(--font-body);
    font-weight: 700;
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

.activeFilterTag {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: var(--black);
    color: var(--yellow);
    font-size: 0.875rem;
    font-family: var(--font-body);
    font-weight: 700;
    text-transform: uppercase;
}

.removeFilterButton {
    background: none;
    border: none;
    color: var(--yellow);
    cursor: pointer;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 16px;
    height: 16px;
    transition: transform 0.15s ease;
}

.removeFilterButton:hover {
    transform: rotate(90deg);
}

@media (max-width: 768px) {
    .filtersContainer {
        padding: 1.5rem;
    }

    .filtersHeader {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }

    .filterOptions {
        gap: 0.5rem;
    }

    .filterButton {
        padding: 0.625rem 1rem;
        font-size: 0.8125rem;
    }

    .rangeFilter {
        grid-template-columns: 1fr;
    }

    .rangeSeparator {
        display: none;
    }
}
</file>

<file path="components/homepage/IPOFilters.tsx">
'use client';

import styles from './IPOFilters.module.css';

interface IPOFiltersProps {
    selectedCategory: string;
    onCategoryChange: (category: string) => void;
}

export default function IPOFilters({ selectedCategory, onCategoryChange }: IPOFiltersProps) {
    const categories = [
        { id: 'all', label: 'All IPOs', icon: 'üìä' },
        { id: 'Mainboard', label: 'Mainboard', icon: 'üè¢' },
        { id: 'SME', label: 'SME', icon: 'üè™' }
    ];

    const sortOptions = [
        { id: 'date', label: 'By Date' },
        { id: 'gmp', label: 'By GMP' },
        { id: 'subscription', label: 'By Subscription' }
    ];

    return (
        <div className={styles.container}>
            <div className={styles.categoryFilters}>
                {categories.map(category => (
                    <button
                        key={category.id}
                        className={`${styles.filterButton} ${selectedCategory === category.id ? styles.active : ''}`}
                        onClick={() => onCategoryChange(category.id)}
                    >
                        <span className={styles.icon}>{category.icon}</span>
                        <span>{category.label}</span>
                    </button>
                ))}
            </div>

            <div className={styles.sortSection}>
                <label className={styles.sortLabel}>Sort by:</label>
                <select className={styles.sortSelect}>
                    {sortOptions.map(option => (
                        <option key={option.id} value={option.id}>
                            {option.label}
                        </option>
                    ))}
                </select>
            </div>
        </div>
    );
}
</file>

<file path="components/homepage/MarketSentimentGauge.module.css">
/* ============================================
   Market Sentiment Gauge - Brutalist Editorial Style
   ============================================ */

.gauge {
    background: var(--color-bg-card);
    border: 4px solid var(--black);
    padding: 1.5rem;
    text-align: center;
    box-shadow: var(--shadow-card);
}

.title {
    font-size: 1.125rem;
    font-family: var(--font-heading);
    color: var(--black);
    margin: 0 0 1.5rem 0;
    text-transform: uppercase;
    background: var(--yellow);
    display: inline-block;
    padding: 0.375rem 1rem;
    transform: rotate(-1deg);
}

/* Loading State */
.loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    gap: 1rem;
    color: var(--color-text-primary);
}

.loadingSpinner {
    width: 40px;
    height: 40px;
    border: 4px solid var(--gray);
    border-top-color: var(--black);
    animation: spin 0.8s linear infinite;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

.loading p {
    font-size: 0.9375rem;
    font-family: var(--font-body);
    margin: 0;
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

/* Gauge Visual */
.gaugeVisual {
    position: relative;
    width: 200px;
    height: 110px;
    margin: 0 auto 1.25rem;
}

.gaugeSvg {
    width: 100%;
    height: 100%;
    overflow: visible;
}

.gaugeFill {
    transition: stroke-dasharray 0.8s ease;
}

.needle {
    transition: transform 0.8s ease;
}

/* Sentiment Label */
.sentimentLabel {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
}

.icon {
    font-size: 1.75rem;
}

.text {
    font-size: 1.5rem;
    font-family: var(--font-heading);
    font-weight: 400;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.score {
    font-size: 1rem;
    font-family: var(--font-body);
    font-weight: 700;
    padding: 0.375rem 0.875rem;
    background: var(--yellow);
    border: 3px solid var(--black);
}

/* Stats Grid */
.stats {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0;
    border: 3px solid var(--black);
}

.statItem {
    display: flex;
    flex-direction: column;
    gap: 0.375rem;
    padding: 1rem;
    background: var(--gray);
    transition: all 0.15s ease;
    border-right: 3px solid var(--black);
}

.statItem:last-child {
    border-right: none;
}

.statItem:hover {
    background: var(--yellow);
}

.statLabel {
    font-size: 0.625rem;
    font-family: var(--font-body);
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-weight: 700;
}

.statValue {
    font-size: 1.375rem;
    font-family: var(--font-body);
    font-weight: 700;
    color: var(--color-text-primary);
}

/* Positive/Negative value styling */
.statValue.positive {
    color: var(--blue);
}

.statValue.negative {
    color: var(--red);
}

/* Responsive Design */
@media (max-width: 768px) {
    .gauge {
        padding: 1.25rem;
    }

    .title {
        font-size: 1rem;
        margin-bottom: 1.25rem;
    }

    .gaugeVisual {
        width: 160px;
        height: 88px;
    }

    .sentimentLabel {
        gap: 0.5rem;
    }

    .icon {
        font-size: 1.25rem;
    }

    .text {
        font-size: 1.25rem;
    }

    .score {
        font-size: 0.875rem;
        padding: 0.25rem 0.625rem;
    }

    .stats {
        grid-template-columns: 1fr;
    }

    .statItem {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
        border-right: none;
        border-bottom: 3px solid var(--black);
    }

    .statItem:last-child {
        border-bottom: none;
    }
}
</file>

<file path="components/homepage/MarketSentimentGauge.tsx">
'use client';

import styles from './MarketSentimentGauge.module.css';

interface MarketSentimentProps {
    overall_sentiment: 'Bullish' | 'Neutral' | 'Bearish';
    sentiment_score: number;
    avg_gmp_mainboard: number;
    avg_gmp_sme: number;
    positive_gmp_count: number;
    total_open_ipos: number;
}

export default function MarketSentimentGauge({ data }: { data: MarketSentimentProps | null }) {
    if (!data) {
        return (
            <div className={styles.gauge}>
                <h3 className={styles.title}>üìä Market Sentiment</h3>
                <div className={styles.loading}>
                    <div className={styles.loadingSpinner}></div>
                    <p>Loading market data...</p>
                </div>
            </div>
        );
    }

    const { overall_sentiment, sentiment_score, avg_gmp_mainboard, avg_gmp_sme, positive_gmp_count, total_open_ipos } = data;

    const getSentimentColor = () => {
        if (overall_sentiment === 'Bullish') return '#22c55e';
        if (overall_sentiment === 'Bearish') return '#ef4444';
        return '#f59e0b';
    };

    const getSentimentIcon = () => {
        if (overall_sentiment === 'Bullish') return 'üìà';
        if (overall_sentiment === 'Bearish') return 'üìâ';
        return '‚ûñ';
    };

    const needleRotation = (sentiment_score / 100) * 180 - 90;

    return (
        <div className={styles.gauge}>
            <h3 className={styles.title}>üìä Market Sentiment</h3>

            <div className={styles.gaugeVisual}>
                <svg viewBox="0 0 200 110" className={styles.gaugeSvg}>
                    {/* Background arcs */}
                    <path
                        d="M 20 90 A 70 70 0 0 1 180 90"
                        fill="none"
                        stroke="#ef4444"
                        strokeWidth="15"
                        strokeLinecap="round"
                        opacity="0.2"
                    />
                    <path
                        d="M 20 90 A 70 70 0 0 1 180 90"
                        fill="none"
                        stroke="#f59e0b"
                        strokeWidth="15"
                        strokeLinecap="round"
                        strokeDasharray="110 330"
                        strokeDashoffset="0"
                        opacity="0.2"
                    />
                    <path
                        d="M 20 90 A 70 70 0 0 1 180 90"
                        fill="none"
                        stroke="#22c55e"
                        strokeWidth="15"
                        strokeLinecap="round"
                        strokeDasharray="110 330"
                        strokeDashoffset="-220"
                        opacity="0.2"
                    />

                    {/* Active arc */}
                    <path
                        d="M 20 90 A 70 70 0 0 1 180 90"
                        fill="none"
                        stroke={getSentimentColor()}
                        strokeWidth="15"
                        strokeLinecap="round"
                        strokeDasharray={`${(sentiment_score / 100) * 220} 220`}
                        className={styles.gaugeFill}
                    />

                    {/* Needle */}
                    <line
                        x1="100"
                        y1="90"
                        x2="100"
                        y2="35"
                        stroke={getSentimentColor()}
                        strokeWidth="3"
                        strokeLinecap="round"
                        transform={`rotate(${needleRotation} 100 90)`}
                        className={styles.needle}
                    />
                    <circle cx="100" cy="90" r="6" fill={getSentimentColor()} />
                    <circle cx="100" cy="90" r="3" fill="#0a0e27" />
                </svg>
            </div>

            <div className={styles.sentimentLabel} style={{ color: getSentimentColor() }}>
                <span className={styles.icon}>{getSentimentIcon()}</span>
                <span className={styles.text}>{overall_sentiment}</span>
                <span className={styles.score}>{sentiment_score.toFixed(0)}/100</span>
            </div>

            <div className={styles.stats}>
                <div className={styles.statItem}>
                    <span className={styles.statLabel}>Mainboard GMP</span>
                    <span className={styles.statValue}>+{avg_gmp_mainboard.toFixed(1)}%</span>
                </div>
                <div className={styles.statItem}>
                    <span className={styles.statLabel}>SME GMP</span>
                    <span className={styles.statValue}>+{avg_gmp_sme.toFixed(1)}%</span>
                </div>
                <div className={styles.statItem}>
                    <span className={styles.statLabel}>Positive IPOs</span>
                    <span className={styles.statValue}>{positive_gmp_count}/{total_open_ipos}</span>
                </div>
            </div>
        </div>
    );
}
</file>

<file path="components/homepage/QuickActionButtons.module.css">
/* ============================================
   Quick Action Buttons - Brutalist Editorial Style
   ============================================ */

.container {
    background: var(--color-bg-card);
    border: 4px solid var(--black);
    padding: 1.5rem;
    box-shadow: var(--shadow-card);
}

.title {
    font-size: 1.125rem;
    font-family: var(--font-heading);
    color: var(--black);
    margin: 0 0 1.25rem 0;
    text-transform: uppercase;
    background: var(--yellow);
    display: inline-block;
    padding: 0.375rem 1rem;
    transform: rotate(-1deg);
}

.buttonsGrid {
    display: flex;
    flex-direction: column;
    gap: 0.875rem;
}

.actionButton {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.25rem 1.5rem;
    background: var(--black);
    border: 3px solid var(--black);
    text-decoration: none;
    transition: all 0.15s ease;
    position: relative;
    overflow: hidden;
}

.actionButton::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 6px;
    background: var(--yellow);
}

.actionButton:hover {
    background: var(--yellow);
    transform: rotate(-2deg);
    box-shadow: var(--shadow-md);
}

.actionButton:hover::before {
    background: var(--black);
}

.icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    background: var(--yellow);
    font-size: 1.5rem;
    flex-shrink: 0;
    transition: all 0.15s ease;
}

.actionButton:hover .icon {
    background: var(--black);
    color: var(--yellow);
    transform: rotate(5deg);
}

.content {
    flex: 1;
    min-width: 0;
}

.actionTitle {
    font-size: 1rem;
    font-family: var(--font-heading);
    color: var(--yellow);
    margin: 0 0 0.25rem 0;
    text-transform: uppercase;
}

.actionButton:hover .actionTitle {
    color: var(--black);
}

.actionDesc {
    font-size: 0.8125rem;
    font-family: var(--font-body);
    color: var(--gray);
    margin: 0;
    line-height: 1.4;
    text-transform: uppercase;
    letter-spacing: 0.02em;
}

.actionButton:hover .actionDesc {
    color: var(--color-text-secondary);
}

.arrow {
    font-size: 1.5rem;
    color: var(--yellow);
    transition: all 0.15s ease;
}

.actionButton:hover .arrow {
    color: var(--black);
    transform: translateX(4px) rotate(-5deg);
}

/* Responsive Design */
@media (max-width: 768px) {
    .container {
        padding: 1.25rem;
    }

    .title {
        font-size: 1rem;
        margin-bottom: 1rem;
    }

    .actionButton {
        padding: 1rem 1.25rem;
    }

    .icon {
        width: 44px;
        height: 44px;
        font-size: 1.25rem;
    }

    .actionTitle {
        font-size: 0.9375rem;
    }

    .actionDesc {
        font-size: 0.75rem;
    }
}
</file>

<file path="components/homepage/QuickActionButtons.tsx">
'use client';

import Link from 'next/link';
import styles from './QuickActionButtons.module.css';

export default function QuickActionButtons() {
    const actions = [
        {
            title: 'Check Allotment',
            description: 'View IPO allotment status',
            icon: 'üéØ',
            href: '/allotment',
            color: '#22c55e'
        },
        {
            title: 'Open IPOs',
            description: 'Currently open for bidding',
            icon: 'üìä',
            href: '/upcoming-ipos',
            color: '#06b6d4'
        },
        {
            title: 'GMP Tracker',
            description: 'Live grey market premium',
            icon: 'üíπ',
            href: '/gmp',
            color: '#a855f7'
        }
    ];

    return (
        <div className={styles.container}>
            <h3 className={styles.title}>Quick Actions</h3>
            <div className={styles.buttonsGrid}>
                {actions.map((action, index) => (
                    <Link 
                        key={index}
                        href={action.href} 
                        className={styles.actionButton}
                        style={{
                            '--button-color': action.color
                        } as React.CSSProperties}
                    >
                        <span className={styles.icon}>{action.icon}</span>
                        <div className={styles.content}>
                            <h4 className={styles.actionTitle}>{action.title}</h4>
                            <p className={styles.actionDesc}>{action.description}</p>
                        </div>
                        <span className={styles.arrow}>‚Üí</span>
                    </Link>
                ))}
            </div>
        </div>
    );
}
</file>

<file path="components/homepage/ShouldIApplyCalculator.module.css">
/* ============================================
   Should I Apply Calculator - Brutalist Editorial Style
   ============================================ */

.container {
    background: var(--color-bg-card);
    border: 4px solid var(--black);
    overflow: hidden;
    box-shadow: var(--shadow-card);
    padding: 1.5rem;
}

/* Input Section */
.inputs {
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
}

.inputGroup {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.label {
    font-size: 0.8125rem;
    font-family: var(--font-body);
    font-weight: 700;
    color: var(--color-text-primary);
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

.select,
.input {
    padding: 1rem 1.25rem;
    border: 3px solid var(--black);
    font-size: 0.9375rem;
    font-family: var(--font-body);
    color: var(--color-text-primary);
    background-color: var(--white);
    transition: all 0.15s ease;
    width: 100%;
}

.select:hover,
.input:hover {
    background-color: var(--gray);
}

.select:focus,
.input:focus {
    outline: none;
    background-color: var(--yellow);
}

.select {
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1.5L6 6.5L11 1.5' stroke='%23000000' stroke-width='2.5' stroke-linecap='square' stroke-linejoin='miter'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 1.25rem center;
    padding-right: 3.5rem;
}

.calculateButton {
    padding: 1.125rem;
    background: var(--black);
    color: var(--yellow);
    border: 3px solid var(--black);
    font-size: 1rem;
    font-family: var(--font-body);
    font-weight: 700;
    cursor: pointer;
    transition: all 0.15s ease;
    margin-top: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

.calculateButton:hover {
    background: var(--yellow);
    color: var(--black);
    transform: rotate(-2deg);
    box-shadow: var(--shadow-md);
}

.calculateButton:disabled {
    background: var(--gray);
    color: var(--color-text-muted);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
    border-color: var(--color-border-light);
}

/* Results Section */
.results {
    margin-top: 1.5rem;
    padding-top: 1.5rem;
    border-top: 4px solid var(--black);
}

.recommendation {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem 1.25rem;
    background: var(--yellow);
    border: 3px solid var(--black);
    margin-bottom: 1.25rem;
}

.recIcon {
    font-size: 1.75rem;
}

.recText {
    font-size: 1rem;
    font-family: var(--font-heading);
    font-weight: 400;
    color: var(--black);
    text-transform: uppercase;
}

.metricsGrid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0;
    border: 3px solid var(--black);
}

.resultCard {
    display: flex;
    flex-direction: column;
    gap: 0.375rem;
    padding: 1rem;
    background-color: var(--gray);
    transition: all 0.15s ease;
    border-right: 3px solid var(--black);
    border-bottom: 3px solid var(--black);
}

.resultCard:nth-child(2n) {
    border-right: none;
}

.resultCard:nth-last-child(-n+2) {
    border-bottom: none;
}

.resultCard:hover {
    background: var(--yellow);
}

.resultLabel {
    font-size: 0.625rem;
    font-family: var(--font-body);
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-weight: 700;
}

.resultValue {
    font-size: 1.375rem;
    font-family: var(--font-body);
    font-weight: 700;
    color: var(--color-text-primary);
}

.profit {
    color: var(--blue);
}

.loss {
    color: var(--red);
}

/* Responsive Design */
@media (max-width: 768px) {
    .container {
        padding: 1.25rem;
    }

    .metricsGrid {
        grid-template-columns: 1fr;
    }

    .resultCard {
        border-right: none;
        border-bottom: 3px solid var(--black);
    }

    .resultCard:last-child {
        border-bottom: none;
    }

    .resultCard {
        padding: 0.875rem;
    }

    .resultValue {
        font-size: 1.125rem;
    }
}
</file>

<file path="components/homepage/ShouldIApplyCalculator.tsx">
'use client';

import { useState } from 'react';
import styles from './ShouldIApplyCalculator.module.css';
import { calculateExpectedReturns } from '@/lib/api';

export default function ShouldIApplyCalculator({ ipos }: { ipos: any[] }) {
    const [selectedIPO, setSelectedIPO] = useState<any>(null);
    const [investment, setInvestment] = useState('15000');
    const [category, setCategory] = useState<'retail' | 'sNII' | 'bNII'>('retail');
    const [result, setResult] = useState<any>(null);

    const handleCalculate = () => {
        if (!selectedIPO || !investment) return;

        const investmentAmount = parseFloat(investment);
        const issuePrice = selectedIPO.issue_price || selectedIPO.max_price;

        const calculation = calculateExpectedReturns(
            investmentAmount,
            selectedIPO.gmp_amount,
            issuePrice,
            selectedIPO.lot_size,
            category,
            category === 'retail' ? selectedIPO.subscription_retail :
                category === 'sNII' ? selectedIPO.subscription_snii :
                    selectedIPO.subscription_bnii
        );

        setResult(calculation);
    };

    return (
        <div className={styles.container}>
            <div className={styles.inputs}>
                <div className={styles.inputGroup}>
                    <label className={styles.label}>Select IPO</label>
                    <select
                        className={styles.select}
                        onChange={(e) => {
                            const ipo = ipos.find(i => i.id === parseInt(e.target.value));
                            setSelectedIPO(ipo);
                            setResult(null);
                        }}
                    >
                        <option value="">Choose an IPO...</option>
                        {ipos.map(ipo => (
                            <option key={ipo.id} value={ipo.id}>
                                {ipo.company_name || ipo.ipo_name}
                            </option>
                        ))}
                    </select>
                </div>

                <div className={styles.inputGroup}>
                    <label className={styles.label}>Investment Amount (‚Çπ)</label>
                    <input
                        type="number"
                        className={styles.input}
                        value={investment}
                        onChange={(e) => setInvestment(e.target.value)}
                        placeholder="15000"
                    />
                </div>

                <div className={styles.inputGroup}>
                    <label className={styles.label}>Category</label>
                    <select
                        className={styles.select}
                        value={category}
                        onChange={(e) => setCategory(e.target.value as any)}
                    >
                        <option value="retail">Retail (1 lot)</option>
                        <option value="sNII">sNII (&lt; ‚Çπ10L)</option>
                        <option value="bNII">bNII (&gt; ‚Çπ10L)</option>
                    </select>
                </div>

                <button className={styles.calculateButton} onClick={handleCalculate}>
                    Calculate Returns
                </button>
            </div>

            {result && (
                <div className={styles.results}>
                    <div className={styles.recommendation} style={{ borderColor: result.recommendation.color }}>
                        <span className={styles.recIcon}>{result.recommendation.icon}</span>
                        <span className={styles.recText}>{result.recommendation.text}</span>
                    </div>

                    <div className={styles.metricsGrid}>
                        <div className={styles.resultCard}>
                            <span className={styles.resultLabel}>Lots Applied</span>
                            <span className={styles.resultValue}>{result.numLots}</span>
                        </div>
                        <div className={styles.resultCard}>
                            <span className={styles.resultLabel}>Total Shares</span>
                            <span className={styles.resultValue}>{result.numShares}</span>
                        </div>
                        <div className={styles.resultCard}>
                            <span className={styles.resultLabel}>Total Investment</span>
                            <span className={styles.resultValue}>‚Çπ{result.totalInvestment.toLocaleString()}</span>
                        </div>
                        <div className={styles.resultCard}>
                            <span className={styles.resultLabel}>Expected Profit</span>
                            <span className={`${styles.resultValue} ${result.totalProfit >= 0 ? styles.profit : styles.loss}`}>
                                ‚Çπ{result.totalProfit.toLocaleString()}
                            </span>
                        </div>
                        <div className={styles.resultCard}>
                            <span className={styles.resultLabel}>Allotment Probability</span>
                            <span className={styles.resultValue}>{result.allotmentProb.toFixed(1)}%</span>
                        </div>
                        <div className={styles.resultCard}>
                            <span className={styles.resultLabel}>Expected Return</span>
                            <span className={`${styles.resultValue} ${result.expectedProfit >= 0 ? styles.profit : styles.loss}`}>
                                ‚Çπ{result.expectedProfit.toLocaleString()}
                            </span>
                        </div>
                    </div>
                </div>
            )}
        </div>
    );
}
</file>

<file path="components/homepage/SubscriptionHeatmap.module.css">
/* ============================================
   Subscription Heatmap - Brutalist Editorial Style
   ============================================ */

.container {
    background: var(--color-bg-card);
    border: 4px solid var(--black);
    padding: 1.5rem;
    box-shadow: var(--shadow-card);
    display: flex;
    flex-direction: column;
    height: 100%;
    min-height: 400px;
}

/* Legend */
.legend {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1.5rem;
    padding: 1rem;
    background: var(--gray);
    border: 3px solid var(--black);
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
}

.legendItem {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.legendBox {
    width: 24px;
    height: 24px;
    border: 3px solid var(--black);
}

.legendItem span {
    font-size: 0.75rem;
    font-family: var(--font-body);
    color: var(--color-text-primary);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

/* Heatmap Grid */
.grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 1rem;
    flex: 1;
    align-content: start;
}

.heatBox {
    aspect-ratio: 1;
    padding: 1rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    transition: all 0.2s ease;
    cursor: pointer;
    border: 4px solid var(--black);
    position: relative;
    text-decoration: none;
    color: #ffffff;
    overflow: hidden;
    box-shadow: var(--shadow-sm);
}

.heatBox::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, transparent 50%);
    pointer-events: none;
}

.heatBox:hover {
    transform: rotate(2deg) scale(1.05);
    box-shadow: var(--shadow-lg);
    z-index: 1;
}

.boxContent {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.375rem;
    position: relative;
    z-index: 1;
}

.companyName {
    font-size: 0.75rem;
    font-family: var(--font-body);
    font-weight: 700;
    line-height: 1.2;
    text-align: center;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    text-transform: uppercase;
    letter-spacing: 0.02em;
}

.subscription {
    font-size: 2rem;
    font-family: var(--font-heading);
    font-weight: 400;
    line-height: 1;
}

.label {
    font-size: 0.625rem;
    font-family: var(--font-body);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-weight: 700;
    padding: 0.25rem 0.625rem;
    background: rgba(0, 0, 0, 0.3);
    border: 2px solid rgba(255, 255, 255, 0.5);
}

/* Empty State */
.empty {
    text-align: center;
    padding: 3rem;
    color: var(--color-text-primary);
    font-family: var(--font-body);
    text-transform: uppercase;
}

.empty p {
    font-size: 1rem;
    color: var(--color-text-muted);
}

/* Responsive Design */
@media (max-width: 768px) {
    .container {
        padding: 1.25rem;
    }

    .legend {
        gap: 1rem;
        padding: 0.875rem;
    }

    .legendBox {
        width: 20px;
        height: 20px;
    }

    .legendItem span {
        font-size: 0.6875rem;
    }

    .grid {
        grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
        gap: 0.75rem;
    }

    .heatBox {
        padding: 0.75rem;
        border-width: 3px;
    }

    .companyName {
        font-size: 0.625rem;
    }

    .subscription {
        font-size: 1.5rem;
    }

    .label {
        font-size: 0.5rem;
        padding: 0.2rem 0.5rem;
    }
}

@media (max-width: 480px) {
    .grid {
        grid-template-columns: repeat(2, 1fr);
    }
}
</file>

<file path="components/homepage/SubscriptionHeatmap.tsx">
'use client';

import Link from 'next/link';
import styles from './SubscriptionHeatmap.module.css';

export default function SubscriptionHeatmap({ ipos }: { ipos: any[] }) {
    const getHeatColor = (subscription: number) => {
        if (subscription < 1) return '#ef4444'; // Red - Undersubscribed
        if (subscription < 3) return '#f59e0b'; // Orange
        if (subscription < 5) return '#eab308'; // Yellow
        return '#22c55e'; // Green - Highly subscribed
    };

    const getHeatLabel = (subscription: number) => {
        if (subscription < 1) return 'Under';
        if (subscription < 3) return 'Low';
        if (subscription < 5) return 'Medium';
        if (subscription < 10) return 'High';
        return 'Very High';
    };

    if (ipos.length === 0) {
        return (
            <div className={styles.container}>
                <div className={styles.empty}>
                    <p>No open IPOs to display in heatmap</p>
                </div>
            </div>
        );
    }

    return (
        <div className={styles.container}>
            <div className={styles.legend}>
                <div className={styles.legendItem}>
                    <div className={styles.legendBox} style={{ backgroundColor: '#ef4444' }} />
                    <span>{'< 1x'}</span>
                </div>
                <div className={styles.legendItem}>
                    <div className={styles.legendBox} style={{ backgroundColor: '#f59e0b' }} />
                    <span>1-3x</span>
                </div>
                <div className={styles.legendItem}>
                    <div className={styles.legendBox} style={{ backgroundColor: '#eab308' }} />
                    <span>3-5x</span>
                </div>
                <div className={styles.legendItem}>
                    <div className={styles.legendBox} style={{ backgroundColor: '#22c55e' }} />
                    <span>{'5x+'}</span>
                </div>
            </div>

            <div className={styles.grid}>
                {ipos.map(ipo => (
                    <Link
                        key={ipo.id}
                        href={`/ipo/${ipo.slug}`}
                        className={styles.heatBox}
                        style={{
                            backgroundColor: getHeatColor(ipo.subscription_total),
                            '--box-color': getHeatColor(ipo.subscription_total)
                        } as React.CSSProperties}
                        title={`${ipo.company_name}: ${ipo.subscription_total.toFixed(2)}x subscribed`}
                    >
                        <div className={styles.boxContent}>
                            <span className={styles.companyName}>{ipo.company_name || ipo.ipo_name}</span>
                            <span className={styles.subscription}>{ipo.subscription_total.toFixed(2)}x</span>
                            <span className={styles.label}>{getHeatLabel(ipo.subscription_total)}</span>
                        </div>
                    </Link>
                ))}
            </div>
        </div>
    );
}
</file>

<file path="components/IPOCard.module.css">
/* ============================================
   Brutalist Editorial IPO Card
   ============================================ */

.ipoCard {
  background: var(--color-bg-card);
  border: 4px solid var(--black);
  padding: 2rem;
  cursor: pointer;
  transition: all 0.2s ease;
  position: relative;
  overflow: visible;
  box-shadow: var(--shadow-card);
}

/* Yellow top bar */
.ipoCard::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 8px;
  background: var(--yellow);
}

.ipoCard:hover {
  transform: rotate(1deg) scale(1.02);
  box-shadow: var(--shadow-card-hover);
  z-index: 1;
}

.ipoCard::after {
  display: none;
}

.ipoHeader {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 1.25rem;
  gap: 1rem;
  padding-top: 0.5rem;
}

.ipoName {
  font-size: 1.375rem;
  font-family: var(--font-heading);
  color: var(--color-text-primary);
  margin-bottom: 0.375rem;
  text-transform: uppercase;
  line-height: 1.1;
}

.ipoCategory {
  font-size: 0.75rem;
  font-family: var(--font-body);
  color: var(--color-text-muted);
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.1em;
}

.ipoStatus {
  padding: 0.5rem 1rem;
  font-size: 0.75rem;
  font-family: var(--font-body);
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  white-space: nowrap;
  border: 2px solid var(--black);
}

.statusUpcoming {
  background-color: var(--black);
  color: var(--yellow);
}

.statusOpen {
  background-color: var(--red);
  color: var(--white);
  border-color: var(--red);
  animation: pulse-status 1.5s ease-in-out infinite;
}

@keyframes pulse-status {

  0%,
  100% {
    transform: scale(1);
    box-shadow: 0 0 0 0 rgba(255, 59, 48, 0.4);
  }

  50% {
    transform: scale(1.05);
    box-shadow: 0 0 0 6px rgba(255, 59, 48, 0);
  }
}

.statusClosed {
  background-color: var(--gray);
  color: var(--color-text-secondary);
}

.ipoDetails {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 0;
  margin-top: 1.5rem;
  padding-top: 1.5rem;
  border-top: 3px solid var(--black);
}

.detailItem {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  padding: 1rem;
  border: 1px solid var(--color-border-light);
  background: var(--gray);
}

.detailItem:nth-child(1) {
  border-right: 2px solid var(--black);
  border-bottom: 2px solid var(--black);
}

.detailItem:nth-child(2) {
  border-bottom: 2px solid var(--black);
}

.detailItem:nth-child(3) {
  border-right: 2px solid var(--black);
}

.detailLabel {
  font-size: 0.6875rem;
  font-family: var(--font-body);
  color: var(--color-text-muted);
  text-transform: uppercase;
  letter-spacing: 0.1em;
  font-weight: 700;
}

.detailValue {
  font-size: 1.75rem;
  font-family: var(--font-body);
  font-weight: 700;
  color: var(--blue);
}

@media (max-width: 768px) {
  .ipoCard {
    padding: 1.5rem;
  }

  .ipoName {
    font-size: 1.125rem;
  }

  .ipoDetails {
    grid-template-columns: 1fr;
  }

  .detailItem {
    border-right: none !important;
    border-bottom: 2px solid var(--black);
  }

  .detailItem:last-child {
    border-bottom: none;
  }

  .detailValue {
    font-size: 1.375rem;
  }
}
</file>

<file path="components/IPOCard.tsx">
'use client';

import { useState } from 'react';
import styles from './IPOCard.module.css';
import IPOModal from './IPOModal';

export interface IPOData {
  id: number;
  name: string;
  status: 'upcoming' | 'open' | 'closed';
  openDate: string;
  closeDate: string;
  priceRange: string;
  lotSize: string;
  issueSize: string;
  listingDate: string;
  parentCompany: string;
  category: string;
  drhp: 'filed' | 'pending';
  rhp: 'filed' | 'pending';
  gmp?: number;
  expectedListing?: string;
}

interface IPOCardProps {
  ipo: any;
}

export default function IPOCard({ ipo }: IPOCardProps) {
  const [isModalOpen, setIsModalOpen] = useState(false);

  // Handle both camelCase (old) and snake_case (database) field names
  const name = ipo.name || ipo.company_name || ipo.ipo_name || '';
  const category = ipo.category || 'Mainboard';
  const status = ipo.status || 'upcoming';
  const openDate = ipo.openDate || ipo.open_date || '-';
  const closeDate = ipo.closeDate || ipo.close_date || '-';
  const priceRange = ipo.priceRange || ipo.price_range || '-';
  const issueSize = ipo.issueSize || ipo.issue_size || '-';

  return (
    <>
      <div className={styles.ipoCard} onClick={() => setIsModalOpen(true)}>
        <div className={styles.ipoHeader}>
          <div>
            <h3 className={styles.ipoName}>{name}</h3>
            <p className={styles.ipoCategory}>{category}</p>
          </div>
          <span className={`${styles.ipoStatus} ${styles[`status${status.charAt(0).toUpperCase() + status.slice(1)}`]}`}>
            {status}
          </span>
        </div>

        <div className={styles.ipoDetails}>
          <div className={styles.detailItem}>
            <span className={styles.detailLabel}>Open Date</span>
            <span className={styles.detailValue}>{openDate}</span>
          </div>
          <div className={styles.detailItem}>
            <span className={styles.detailLabel}>Close Date</span>
            <span className={styles.detailValue}>{closeDate}</span>
          </div>
          <div className={styles.detailItem}>
            <span className={styles.detailLabel}>Price Range</span>
            <span className={styles.detailValue}>{priceRange}</span>
          </div>
          <div className={styles.detailItem}>
            <span className={styles.detailLabel}>Issue Size</span>
            <span className={styles.detailValue}>{issueSize}</span>
          </div>
        </div>
      </div>

      {isModalOpen && (
        <IPOModal ipo={ipo} onClose={() => setIsModalOpen(false)} />
      )}
    </>
  );
}
</file>

<file path="components/IPOModal.module.css">
.modalOverlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  padding: 1.5rem;
  animation: fadeIn 0.2s ease;
}

.modalContent {
  background: var(--color-bg-card);
  border-radius: var(--radius-lg);
  max-width: 800px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: var(--shadow-xl);
  animation: slideUp 0.3s ease;
  border: 1px solid var(--color-border);
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }

  to {
    opacity: 1;
  }
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(24px) scale(0.98);
  }

  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.modalHeader {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  padding: 2rem;
  border-bottom: 1px solid var(--color-border-light);
}

.modalTitle {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--color-text-primary);
  margin-bottom: 0.5rem;
}

.modalSubtitle {
  font-size: 0.9375rem;
  color: var(--color-text-secondary);
}

.closeButton {
  background-color: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  cursor: pointer;
  padding: 0.625rem;
  color: var(--color-text-secondary);
  transition: var(--transition-base);
  display: flex;
  align-items: center;
  justify-content: center;
}

.closeButton:hover {
  color: var(--color-text-primary);
  background-color: var(--color-bg-tertiary);
  border-color: var(--color-border);
}

.closeButton svg {
  width: 20px;
  height: 20px;
}

.modalBody {
  padding: 2rem;
}

.section {
  margin-bottom: 2rem;
}

.section:last-child {
  margin-bottom: 0;
}

.sectionTitle {
  font-size: 1.125rem;
  font-weight: 600;
  color: var(--color-text-primary);
  margin-bottom: 1rem;
  padding-bottom: 0.75rem;
  border-bottom: 1px solid var(--color-border-light);
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.sectionTitle::before {
  content: '';
  width: 3px;
  height: 18px;
  background: var(--gradient-primary);
  border-radius: 2px;
}

.infoGrid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1.5rem;
}

.infoItem {
  display: flex;
  flex-direction: column;
  gap: 0.375rem;
}

.infoLabel {
  font-size: 0.8125rem;
  color: var(--color-text-muted);
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.03em;
}

.infoValue {
  font-size: 1rem;
  color: var(--color-text-primary);
  font-weight: 600;
}

.statusBadge {
  display: inline-flex;
  align-items: center;
  padding: 0.5rem 1rem;
  border-radius: 9999px;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  width: fit-content;
}

.statusOpen {
  background-color: var(--color-success-light);
  color: #047857;
}

.statusClosed {
  background-color: var(--color-bg-tertiary);
  color: var(--color-text-secondary);
}

.statusUpcoming {
  background-color: var(--color-warning-light);
  color: #b45309;
}

.gmpCard {
  padding: 1.75rem;
  background: linear-gradient(135deg, rgba(79, 70, 229, 0.04) 0%, rgba(139, 92, 246, 0.04) 100%);
  border: 1px solid rgba(79, 70, 229, 0.1);
  border-radius: var(--radius-md);
  text-align: center;
}

.gmpLabel {
  font-size: 0.8125rem;
  color: var(--color-text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  font-weight: 600;
  margin-bottom: 0.75rem;
}

.gmpValue {
  font-size: 2.75rem;
  font-weight: 700;
  line-height: 1;
  margin-bottom: 0.5rem;
}

.gmpPositive {
  color: var(--color-success);
}

.gmpNegative {
  color: var(--color-error);
}

.gmpNeutral {
  color: var(--color-text-secondary);
}

.gmpPercentage {
  font-size: 1rem;
  color: var(--color-text-secondary);
  font-weight: 500;
}

.subscriptionBar {
  width: 100%;
  height: 10px;
  background-color: var(--color-bg-tertiary);
  border-radius: 10px;
  overflow: hidden;
  margin-top: 1rem;
}

.subscriptionFill {
  height: 100%;
  background: linear-gradient(90deg, var(--color-success) 0%, #34d399 100%);
  transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  border-radius: 10px;
}

.subscriptionInfo {
  display: flex;
  justify-content: space-between;
  margin-top: 0.5rem;
  font-size: 0.8125rem;
  color: var(--color-text-secondary);
}

.timelineList {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.timelineItem {
  display: flex;
  gap: 1rem;
  align-items: flex-start;
}

.timelineDot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: var(--gradient-primary);
  margin-top: 0.25rem;
  flex-shrink: 0;
  box-shadow: 0 2px 6px rgba(79, 70, 229, 0.3);
}

.timelineContent {
  flex: 1;
}

.timelineDate {
  font-size: 0.9375rem;
  color: var(--color-text-primary);
  font-weight: 600;
  margin-bottom: 0.25rem;
}

.timelineEvent {
  font-size: 0.875rem;
  color: var(--color-text-secondary);
}

.documentsList {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.documentItem {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1rem;
  background-color: var(--color-bg-secondary);
  border: 1px solid var(--color-border-light);
  border-radius: var(--radius-md);
  transition: var(--transition-base);
}

.documentItem:hover {
  background-color: var(--color-bg-card);
  box-shadow: var(--shadow-sm);
  border-color: rgba(79, 70, 229, 0.15);
}

.documentInfo {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.documentIcon {
  width: 40px;
  height: 40px;
  background: linear-gradient(135deg, var(--color-bg-tertiary) 0%, var(--color-border) 100%);
  border-radius: var(--radius-md);
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--color-text-secondary);
}

.documentName {
  font-size: 0.9375rem;
  color: var(--color-text-primary);
  font-weight: 600;
}

.downloadButton {
  padding: 0.5rem 1rem;
  background: var(--gradient-primary);
  color: #ffffff;
  border: none;
  border-radius: var(--radius-sm);
  font-size: 0.875rem;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition-base);
  box-shadow: 0 2px 6px rgba(79, 70, 229, 0.2);
}

.downloadButton:hover {
  box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
  transform: translateY(-1px);
}

.modalFooter {
  padding: 1.5rem 2rem;
  border-top: 1px solid var(--color-border-light);
  display: flex;
  gap: 1rem;
  justify-content: flex-end;
}

.footerButton {
  padding: 0.75rem 1.5rem;
  border-radius: var(--radius-md);
  font-size: 0.9375rem;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition-base);
}

.primaryButton {
  background: var(--gradient-primary);
  color: #ffffff;
  border: none;
  box-shadow: 0 2px 8px rgba(79, 70, 229, 0.25);
}

.primaryButton:hover {
  box-shadow: 0 4px 16px rgba(79, 70, 229, 0.35);
  transform: translateY(-1px);
}

.secondaryButton {
  background-color: var(--color-bg-secondary);
  color: var(--color-text-secondary);
  border: 1px solid var(--color-border);
}

.secondaryButton:hover {
  background-color: var(--color-bg-tertiary);
  border-color: var(--color-primary);
  color: var(--color-primary);
}

@media (max-width: 768px) {
  .modalOverlay {
    padding: 0;
  }

  .modalContent {
    max-height: 100vh;
    border-radius: 0;
  }

  .modalHeader,
  .modalBody,
  .modalFooter {
    padding: 1.5rem;
  }

  .infoGrid {
    grid-template-columns: 1fr;
    gap: 1rem;
  }

  .gmpValue {
    font-size: 2.25rem;
  }

  .modalFooter {
    flex-direction: column;
  }

  .footerButton {
    width: 100%;
  }
}
</file>

<file path="components/IPOModal.tsx">
'use client';

import { useEffect } from 'react';
import styles from './IPOModal.module.css';
import { IPOData } from './IPOCard';

interface IPOModalProps {
  ipo: IPOData;
  onClose: () => void;
}

export default function IPOModal({ ipo, onClose }: IPOModalProps) {
  useEffect(() => {
    document.body.style.overflow = 'hidden';
    return () => {
      document.body.style.overflow = 'unset';
    };
  }, []);

  const handleBackdropClick = (e: React.MouseEvent) => {
    if (e.target === e.currentTarget) {
      onClose();
    }
  };

  return (
    <div className={styles.modal} onClick={handleBackdropClick}>
      <div className={styles.modalContent}>
        <button className={styles.modalClose} onClick={onClose}>
          &times;
        </button>

        <h2 className={styles.modalTitle}>{ipo.name}</h2>
        <p className={styles.modalCategory}>{ipo.category}</p>

        <div className={styles.modalDetails}>
          <div className={styles.modalDetailGroup}>
            <h3 className={styles.groupTitle}>Issue Details</h3>
            <div className={styles.detailRow}>
              <span className={styles.detailLabel}>Open Date</span>
              <span className={styles.detailValue}>{ipo.openDate}</span>
            </div>
            <div className={styles.detailRow}>
              <span className={styles.detailLabel}>Close Date</span>
              <span className={styles.detailValue}>{ipo.closeDate}</span>
            </div>
            <div className={styles.detailRow}>
              <span className={styles.detailLabel}>Listing Date</span>
              <span className={styles.detailValue}>{ipo.listingDate}</span>
            </div>
            <div className={styles.detailRow}>
              <span className={styles.detailLabel}>Price Range</span>
              <span className={styles.detailValue}>{ipo.priceRange}</span>
            </div>
          </div>

          <div className={styles.modalDetailGroup}>
            <h3 className={styles.groupTitle}>Investment Info</h3>
            <div className={styles.detailRow}>
              <span className={styles.detailLabel}>Lot Size</span>
              <span className={styles.detailValue}>{ipo.lotSize}</span>
            </div>
            <div className={styles.detailRow}>
              <span className={styles.detailLabel}>Issue Size</span>
              <span className={styles.detailValue}>{ipo.issueSize}</span>
            </div>
            {ipo.gmp && (
              <>
                <div className={styles.detailRow}>
                  <span className={styles.detailLabel}>GMP</span>
                  <span className={styles.detailValue}>‚Çπ{ipo.gmp}</span>
                </div>
                <div className={styles.detailRow}>
                  <span className={styles.detailLabel}>Expected Listing</span>
                  <span className={styles.detailValue}>{ipo.expectedListing}</span>
                </div>
              </>
            )}
          </div>

          <div className={styles.modalDetailGroup}>
            <h3 className={styles.groupTitle}>Company Info</h3>
            <div className={styles.detailRow}>
              <span className={styles.detailLabel}>Parent Company</span>
              <span className={styles.detailValue}>{ipo.parentCompany}</span>
            </div>
            <div className={styles.detailRow}>
              <span className={styles.detailLabel}>Category</span>
              <span className={styles.detailValue}>{ipo.category}</span>
            </div>
          </div>

          <div className={styles.modalDetailGroup}>
            <h3 className={styles.groupTitle}>Regulatory Filings</h3>
            <div className={styles.detailRow}>
              <span className={styles.detailLabel}>DRHP Status</span>
              <span className={`${styles.badge} ${ipo.drhp === 'filed' ? styles.badgeFiled : styles.badgePending}`}>
                {ipo.drhp}
              </span>
            </div>
            <div className={styles.detailRow}>
              <span className={styles.detailLabel}>RHP Status</span>
              <span className={`${styles.badge} ${ipo.rhp === 'filed' ? styles.badgeFiled : styles.badgePending}`}>
                {ipo.rhp}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="components/Navbar.tsx">
import React from "react";
import { LineChart, Send } from "lucide-react";

export function Navbar() {
  return (
    <nav className="border-b border-white/10 bg-black/50 backdrop-blur-xl sticky top-0 z-50">
      <div className="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
        {/* Logo */}
        <div className="flex items-center gap-2">
          <div className="p-2 bg-gradient-to-br from-green-500 to-blue-600 rounded-lg">
            <LineChart className="w-5 h-5 text-white" />
          </div>
          <h1 className="text-xl font-bold bg-gradient-to-r from-white to-gray-400 bg-clip-text text-transparent">
            IPO<span className="text-green-500">Track</span>
          </h1>
        </div>

        {/* Action Button */}
        <button className="flex items-center gap-2 px-4 py-2 bg-white text-black text-sm font-bold rounded-full hover:bg-gray-200 transition-all hover:scale-105 active:scale-95">
          <Send size={14} />
          <span>Join Channel</span>
        </button>
      </div>
    </nav>
  );
}
</file>

<file path="components/Navigation.module.css">
/* ============================================
   Elegant Navigation - Beige Theme
   ============================================ */

/* Top Promo Bar - Hidden in elegant theme */
.topBar {
  display: none;
}

.topBar::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 200%;
  height: 100%;
  background: linear-gradient(90deg,
      transparent 0%,
      rgba(255, 237, 78, 0.1) 50%,
      transparent 100%);
  animation: shimmer 4s infinite;
}

@keyframes shimmer {
  0% {
    transform: translateX(-50%);
  }

  100% {
    transform: translateX(50%);
  }
}

.topBarContent {
  max-width: 1280px;
  margin: 0 auto;
  padding: 0 1.5rem;
  display: flex;
  justify-content: center;
  align-items: center;
}

.promoText {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 0.875rem;
  font-family: var(--font-body);
  color: var(--yellow);
  font-weight: 700;
  letter-spacing: 0.1em;
  text-transform: uppercase;
}

.sparkle {
  display: flex;
  width: 16px;
  height: 16px;
  color: var(--yellow);
  animation: sparkle 1.5s ease-in-out infinite;
}

.sparkle svg {
  width: 100%;
  height: 100%;
}

@keyframes sparkle {

  0%,
  100% {
    transform: scale(1) rotate(0deg);
    opacity: 1;
  }

  50% {
    transform: scale(1.3) rotate(15deg);
    opacity: 0.8;
  }
}

/* Main Navbar - Teal Theme */
.navbar {
  background: linear-gradient(135deg, #1a3a3a 0%, #2c5f5f 50%, #1a3a3a 100%);
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  position: sticky;
  top: 0;
  z-index: 1000;
  transition: all 0.2s ease;
}

.navbar.scrolled {
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

.navMain {
  width: 100%;
  max-width: none;
  margin: 0 auto;
  padding: 0.875rem 5%;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

/* Logo Styles - Text only like reference */
.logo {
  display: flex;
  align-items: center;
  gap: 0;
  text-decoration: none;
  transition: opacity 0.2s ease;
}

.logo:hover {
  opacity: 0.8;
}

.logoIcon {
  display: none;
  /* Hide icon for cleaner look */
}

.logoText {
  font-size: 1.125rem;
  font-family: var(--font-heading, 'Inter', sans-serif);
  font-weight: 800;
  color: #ffffff;
  text-transform: uppercase;
  letter-spacing: -0.02em;
}

.logoAccent {
  color: #3fffc3;
}

/* Navigation Links - Right aligned, smaller fonts */
.navLinks {
  display: flex;
  gap: 1.5rem;
  align-items: center;
  list-style: none;
  margin: 0;
  padding: 0;
}

.navLink {
  display: flex;
  align-items: center;
  gap: 0.375rem;
  padding: 0.25rem 0;
  font-size: 0.8125rem;
  font-family: var(--font-body, 'Inter', sans-serif);
  font-weight: 600;
  color: rgba(255, 255, 255, 0.85);
  text-decoration: none;
  position: relative;
  transition: color 0.3s ease;
  border: none;
  background: transparent;
}

.navLink:hover {
  color: #3fffc3;
  background: transparent;
}

.navIcon {
  display: flex;
  width: 14px;
  height: 14px;
}

.navIcon svg {
  width: 100%;
  height: 100%;
}

.navLink:hover .navIcon {
  transform: none;
}

.navLabel {
  white-space: nowrap;
}

/* Active Link State - Underline highlight */
.activeLink {
  font-weight: 700;
}

.activeLink::after {
  content: '';
  position: absolute;
  bottom: -2px;
  left: 0;
  right: 0;
  height: 2px;
  background: var(--black);
}

.activeLink .navIcon {
  opacity: 1;
}

/* Highlighted Link (GMP) - Subtle emphasis */
.highlightLink {
  font-weight: 700;
}

.highlightLink:hover {
  opacity: 0.7;
}

/* Badge */
.navBadge {
  font-size: 0.625rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  padding: 0.25rem 0.5rem;
  background: var(--red);
  color: var(--white);
  animation: pulse-badge 1.5s infinite;
}

@keyframes pulse-badge {

  0%,
  100% {
    transform: scale(1);
  }

  50% {
    transform: scale(1.1);
  }
}

/* Mobile Menu Button */
.mobileMenuButton {
  display: none;
  align-items: center;
  justify-content: center;
  width: 48px;
  height: 48px;
  background: var(--black);
  border: 3px solid var(--black);
  color: var(--yellow);
  cursor: pointer;
  transition: all 0.15s ease;
}

.mobileMenuButton:hover {
  background: var(--yellow);
  color: var(--black);
  transform: rotate(-3deg);
}

.mobileMenuButton svg {
  width: 24px;
  height: 24px;
}

/* Mobile Menu */
.mobileMenu {
  display: none;
  background-color: var(--yellow);
  border-bottom: 4px solid var(--black);
  padding: 0;
  max-height: 0;
  overflow: hidden;
  transition: all 0.3s ease;
}

.mobileMenu.open {
  max-height: 500px;
  padding: 1rem 1.5rem 1.5rem;
}

.mobileNavLinks {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  list-style: none;
  margin: 0;
  padding: 0;
}

.mobileNavLink {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1rem 1.25rem;
  font-size: 1rem;
  font-family: var(--font-body);
  font-weight: 700;
  color: var(--black);
  text-decoration: none;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  transition: all 0.15s ease;
  background: var(--white);
  border: 3px solid var(--black);
}

.mobileNavLink:hover {
  background: var(--black);
  color: var(--yellow);
  transform: rotate(-1deg);
}

.mobileActiveLink {
  background: var(--black);
  color: var(--yellow);
}

.mobileNavIcon {
  display: flex;
  width: 22px;
  height: 22px;
  color: inherit;
}

.mobileNavIcon svg {
  width: 100%;
  height: 100%;
}

.mobileBadge {
  margin-left: auto;
  font-size: 0.6875rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  padding: 0.25rem 0.625rem;
  background: var(--red);
  color: var(--white);
}

/* ============================================
   Responsive Design
   ============================================ */

/* Large tablets */
@media (max-width: 1024px) {
  .navMain {
    padding: 0.75rem 1.5rem;
  }

  .navLinks {
    gap: 1rem;
  }

  .navLink {
    padding: 0.4rem 0.5rem;
    font-size: 0.75rem;
  }

  .navIcon {
    width: 14px;
    height: 14px;
  }

  .logoText {
    font-size: 1rem;
  }
}

/* Tablets - switch to mobile menu */
@media (max-width: 900px) {
  .navLinks {
    display: none;
  }

  .mobileMenuButton {
    display: flex;
    width: 44px;
    height: 44px;
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(255, 255, 255, 0.2);
    color: #fff;
  }

  .mobileMenuButton:hover {
    background: rgba(255, 255, 255, 0.2);
    color: #3fffc3;
    transform: none;
  }

  .mobileMenu {
    display: block;
    background: linear-gradient(135deg, #1a3a3a 0%, #2c5f5f 100%);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .mobileMenu.open {
    padding: 1rem;
  }

  .mobileNavLinks {
    gap: 0.5rem;
  }

  .mobileNavLink {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: #fff;
    padding: 1rem 1.25rem;
    border-radius: 8px;
  }

  .mobileNavLink:hover {
    background: rgba(255, 255, 255, 0.1);
    color: #3fffc3;
    transform: none;
  }

  .mobileActiveLink {
    background: rgba(63, 255, 195, 0.15);
    color: #3fffc3;
    border-color: rgba(63, 255, 195, 0.3);
  }

  .mobileNavIcon {
    color: currentColor;
  }

  .mobileBadge {
    background: #ff3b3b;
    color: #fff;
  }
}

/* Mobile phones */
@media (max-width: 480px) {
  .topBar {
    padding: 0.5rem 0;
  }

  .promoText {
    font-size: 0.6875rem;
    gap: 0.5rem;
  }

  .sparkle {
    width: 12px;
    height: 12px;
  }

  .navMain {
    padding: 0.625rem 0.75rem;
  }

  .logo {
    gap: 0;
  }

  .logoText {
    font-size: 0.9375rem;
  }

  .mobileMenuButton {
    width: 40px;
    height: 40px;
  }

  .mobileMenuButton svg {
    width: 20px;
    height: 20px;
  }

  .mobileMenu.open {
    padding: 0.75rem;
  }

  .mobileNavLink {
    padding: 0.875rem 1rem;
    font-size: 0.9375rem;
  }

  .mobileNavIcon {
    width: 20px;
    height: 20px;
  }
}
</file>

<file path="components/Navigation.tsx">
'use client';

import Link from 'next/link';
import { usePathname } from 'next/navigation';
import { useState, useEffect } from 'react';
import styles from './Navigation.module.css';

// Icons as inline SVGs for better control
const HomeIcon = () => (
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
    <polyline points="9 22 9 12 15 12 15 22" />
  </svg>
);

const CalendarIcon = () => (
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
    <line x1="16" y1="2" x2="16" y2="6" />
    <line x1="8" y1="2" x2="8" y2="6" />
    <line x1="3" y1="10" x2="21" y2="10" />
  </svg>
);

const UsersIcon = () => (
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
    <circle cx="9" cy="7" r="4" />
    <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
    <path d="M16 3.13a4 4 0 0 1 0 7.75" />
  </svg>
);

const TrendingIcon = () => (
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <polyline points="23 6 13.5 15.5 8.5 10.5 1 18" />
    <polyline points="17 6 23 6 23 12" />
  </svg>
);

const CheckCircleIcon = () => (
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
    <polyline points="22 4 12 14.01 9 11.01" />
  </svg>
);

const MenuIcon = () => (
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <line x1="3" y1="12" x2="21" y2="12" />
    <line x1="3" y1="6" x2="21" y2="6" />
    <line x1="3" y1="18" x2="21" y2="18" />
  </svg>
);

const CloseIcon = () => (
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <line x1="18" y1="6" x2="6" y2="18" />
    <line x1="6" y1="6" x2="18" y2="18" />
  </svg>
);

const SparkleIcon = () => (
  <svg viewBox="0 0 24 24" fill="currentColor">
    <path d="M12 0L14.59 8.41L23 11L14.59 13.59L12 22L9.41 13.59L1 11L9.41 8.41L12 0Z" />
  </svg>
);

export default function Navigation() {
  const pathname = usePathname();
  const [scrolled, setScrolled] = useState(false);
  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);

  useEffect(() => {
    const handleScroll = () => {
      setScrolled(window.scrollY > 20);
    };
    window.addEventListener('scroll', handleScroll);
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

  const navItems = [
    { href: '/', label: 'Home', icon: HomeIcon },
    { href: '/upcoming-ipos', label: 'Upcoming IPOs', icon: CalendarIcon },
    { href: '/shareholders', label: 'Shareholders Category', icon: UsersIcon },
    { href: '/gmp', label: 'GMP', icon: TrendingIcon },
    { href: '/allotment', label: 'Check Allotment', icon: CheckCircleIcon },
  ];

  const isActive = (href: string) => {
    if (href === '/') return pathname === '/';
    return pathname.startsWith(href);
  };

  return (
    <>

      {/* Main Navigation */}
      <nav className={`${styles.navbar} ${scrolled ? styles.scrolled : ''}`}>
        <div className={styles.navMain}>
          {/* Logo */}
          <Link href="/" className={styles.logo}>
            <span className={styles.logoIcon}>
              <TrendingIcon />
            </span>
            <span className={styles.logoText}>
              IPO<span className={styles.logoAccent}>Tracker</span>
            </span>
          </Link>

          {/* Desktop Navigation */}
          <ul className={styles.navLinks}>
            {navItems.map((item) => {
              const Icon = item.icon;
              const active = isActive(item.href);
              return (
                <li key={item.href}>
                  <Link
                    href={item.href}
                    className={`${styles.navLink} ${active ? styles.activeLink : ''} ${item.highlight ? styles.highlightLink : ''}`}
                  >
                    <span className={styles.navIcon}><Icon /></span>
                    <span className={styles.navLabel}>{item.label}</span>
                    {item.badge && <span className={styles.navBadge}>{item.badge}</span>}
                  </Link>
                </li>
              );
            })}
          </ul>

          {/* Mobile Menu Button */}
          <button
            className={styles.mobileMenuButton}
            onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
            aria-label="Toggle menu"
          >
            {mobileMenuOpen ? <CloseIcon /> : <MenuIcon />}
          </button>
        </div>

        {/* Mobile Menu */}
        <div className={`${styles.mobileMenu} ${mobileMenuOpen ? styles.open : ''}`}>
          <ul className={styles.mobileNavLinks}>
            {navItems.map((item) => {
              const Icon = item.icon;
              const active = isActive(item.href);
              return (
                <li key={item.href}>
                  <Link
                    href={item.href}
                    className={`${styles.mobileNavLink} ${active ? styles.mobileActiveLink : ''}`}
                    onClick={() => setMobileMenuOpen(false)}
                  >
                    <span className={styles.mobileNavIcon}><Icon /></span>
                    <span>{item.label}</span>
                    {item.badge && <span className={styles.mobileBadge}>{item.badge}</span>}
                  </Link>
                </li>
              );
            })}
          </ul>
        </div>
      </nav>
    </>
  );
}
</file>

<file path="eslint.config.mjs">
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;
</file>

<file path="lib/api.ts">
// frontend/lib/api.ts
import { supabase } from './supabase';

// ============================================
// EXISTING FUNCTIONS (Keep these as they are)
// ============================================

export async function fetchUpcomingIPOs() {
    const { data, error } = await supabase
        .from('ipos')
        .select('*')
        .eq('status', 'upcoming')
        .order('open_date', { ascending: true });

    if (error) {
        console.error('Error fetching upcoming IPOs:', error);
        return [];
    }
    return data || [];
}

export async function fetchGMPData() {
    const { data, error } = await supabase
        .from('ipos')
        .select('*')
        .in('status', ['open', 'upcoming', 'closed'])
        .order('listing_date', { ascending: true });

    if (error) {
        console.error('Error fetching GMP data:', error);
        return [];
    }
    return data || [];
}

export async function fetchAllotmentLinks() {
    const { data, error } = await supabase
        .from('ipo_allotment_links')
        .select('*')
        .eq('is_active', true)
        .order('id', { ascending: false });

    if (error) {
        console.error('Error fetching allotment links:', error);
        return [];
    }
    return data || [];
}

export async function fetchShareholderData() {
    // Query from ipos table since shareholder_intel table doesn't exist
    // This returns parent company and regulatory filing data
    const { data, error } = await supabase
        .from('ipos')
        .select('id, ipo_name, parent_company, category, drhp_status, rhp_status, issue_size_cr')
        .in('status', ['upcoming', 'open', 'closed', 'listed'])
        .order('id', { ascending: false });

    if (error) {
        console.error('Error fetching shareholder data:', error);
        return [];
    }
    return data || [];
}

// ============================================
// NEW FUNCTIONS FOR HOMEPAGE REDESIGN
// ============================================

export async function fetchCombinedIPOData() {
    const { data, error } = await supabase
        .from('ipos')
        .select('*')
        .in('status', ['upcoming', 'open', 'closed'])
        .order('open_date', { ascending: true });

    if (error) {
        console.error('Error fetching combined IPO data:', error);
        return [];
    }
    return data || [];
}

export async function fetchFeaturedIPOs() {
    const { data, error } = await supabase
        .from('ipos')
        .select('*')
        .eq('is_featured', true)
        .in('status', ['open', 'upcoming'])
        .order('trending_score', { ascending: false })
        .limit(3);

    if (error) {
        console.error('Error fetching featured IPOs:', error);
        return [];
    }
    return data || [];
}

export async function fetchMarketSentiment() {
    const { data, error } = await supabase
        .from('market_sentiment')
        .select('*')
        .order('date', { ascending: false })
        .limit(1)
        .single();

    if (error) {
        console.error('Error fetching market sentiment:', error);
        return null;
    }
    return data;
}

export async function fetchOpenIPOs() {
    const { data, error } = await supabase
        .from('ipos')
        .select('*')
        .eq('status', 'open')
        .order('close_date', { ascending: true });

    if (error) {
        console.error('Error fetching open IPOs:', error);
        return [];
    }
    return data || [];
}

export async function fetchClosingSoonIPOs() {
    const today = new Date().toISOString().split('T')[0];
    const twoDaysLater = new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];

    const { data, error } = await supabase
        .from('ipos')
        .select('*')
        .eq('status', 'open')
        .lte('close_date', twoDaysLater)
        .gte('close_date', today)
        .order('close_date', { ascending: true });

    if (error) {
        console.error('Error fetching closing soon IPOs:', error);
        return [];
    }
    return data || [];
}

export async function fetchRecentlyListedIPOs() {
    const thirtyDaysAgo = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];

    const { data, error } = await supabase
        .from('ipos')
        .select('*')
        .eq('status', 'listed')
        .gte('listing_date', thirtyDaysAgo)
        .order('listing_date', { ascending: false })
        .limit(10);

    if (error) {
        console.error('Error fetching recently listed IPOs:', error);
        return [];
    }
    return data || [];
}

export async function fetchUpcomingThisWeek() {
    const today = new Date().toISOString().split('T')[0];
    const nextWeek = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];

    const { data, error } = await supabase
        .from('ipos')
        .select('*')
        .eq('status', 'upcoming')
        .gte('open_date', today)
        .lte('open_date', nextWeek)
        .order('open_date', { ascending: true });

    if (error) {
        console.error('Error fetching upcoming IPOs this week:', error);
        return [];
    }
    return data || [];
}

export async function fetchCalendarEvents(year: number, month: number) {
    const startDate = new Date(year, month - 1, 1).toISOString().split('T')[0];
    const endDate = new Date(year, month, 0).toISOString().split('T')[0];

    const { data, error } = await supabase
        .from('ipo_calendar_events')
        .select(`
            *,
            ipos (
                ipo_name,
                company_name,
                category,
                slug
            )
        `)
        .gte('event_date', startDate)
        .lte('event_date', endDate)
        .order('event_date', { ascending: true });

    if (error) {
        console.error('Error fetching calendar events:', error);
        return [];
    }
    return data || [];
}

export async function fetchAllIPOsForComparison(category: string = 'all') {
    let query = supabase
        .from('ipos')
        .select('*')
        .in('status', ['open', 'upcoming', 'closed']);

    if (category !== 'all') {
        query = query.eq('category', category);
    }

    const { data, error } = await query.order('open_date', { ascending: false });

    if (error) {
        console.error('Error fetching IPOs for comparison:', error);
        return [];
    }
    return data || [];
}

// Calculate allotment probability
export function calculateAllotmentProbability(
    category: 'retail' | 'sNII' | 'bNII',
    subscription: number,
    lots: number
): number {
    if (subscription <= 1) return 100;

    if (category === 'retail') {
        if (subscription < 2) return 95;
        if (subscription < 5) return 60;
        if (subscription < 10) return 30;
        if (subscription < 20) return 15;
        return Math.max(5, 100 / subscription);
    }

    const baseProb = Math.min(100, (100 / subscription) * lots);

    if (category === 'sNII') {
        return Math.max(10, baseProb * 1.2);
    }

    return Math.max(5, baseProb * 0.8);
}

// Calculate expected returns
export function calculateExpectedReturns(
    investment: number,
    gmp: number,
    issuePrice: number,
    lotSize: number,
    category: 'retail' | 'sNII' | 'bNII',
    subscription: number
) {
    const numLots = Math.floor(investment / (issuePrice * lotSize));
    const numShares = numLots * lotSize;
    const totalInvestment = numShares * issuePrice;

    const expectedListingPrice = issuePrice + gmp;
    const profitPerShare = gmp;
    const totalProfit = profitPerShare * numShares;
    const profitPercentage = (profitPerShare / issuePrice) * 100;

    const allotmentProb = calculateAllotmentProbability(category, subscription, numLots);
    const expectedProfit = (totalProfit * allotmentProb) / 100;

    return {
        numLots,
        numShares,
        totalInvestment,
        expectedListingPrice,
        profitPerShare,
        totalProfit,
        profitPercentage,
        allotmentProb,
        expectedProfit,
        recommendation: getRecommendation(profitPercentage, allotmentProb, subscription)
    };
}

function getRecommendation(profitPercentage: number, allotmentProb: number, subscription: number) {
    if (profitPercentage > 30 && allotmentProb > 50) {
        return { text: 'Strong Buy', color: '#22c55e', icon: 'üöÄ' };
    }
    if (profitPercentage > 15 && allotmentProb > 30) {
        return { text: 'Buy', color: '#4ade80', icon: '‚úÖ' };
    }
    if (profitPercentage > 0 && subscription < 10) {
        return { text: 'Consider', color: '#facc15', icon: '‚ö†Ô∏è' };
    }
    if (profitPercentage < 0) {
        return { text: 'Avoid', color: '#ef4444', icon: '‚ùå' };
    }
    return { text: 'Neutral', color: '#9ca3af', icon: '‚ûñ' };
}
</file>

<file path="lib/supabase.ts">
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;
const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;

if (!supabaseUrl || !supabaseAnonKey) {
    throw new Error('Missing Supabase environment variables');
}

export const supabase = createClient(supabaseUrl, supabaseAnonKey);

// Database Types
export interface IPODetail {
    id: number;
    ipo_name: string;
    company_name?: string;
    category?: string;
    issue_size?: string;
    issue_size_numeric?: number;
    price_range?: string;
    min_price?: number;
    max_price?: number;
    lot_size?: number;
    open_date?: string;
    close_date?: string;
    listing_date?: string;
    allotment_date?: string;
    status?: 'upcoming' | 'open' | 'closed' | 'listed';
    drhp_status?: 'filed' | 'pending' | 'approved';
    rhp_status?: 'filed' | 'pending' | 'approved';
    parent_company?: string;
    description?: string;
    website_url?: string;
    lead_managers?: string[];
    registrar?: string;
    exchange?: string[];
    subscription_retail?: number;
    subscription_nii?: number;
    subscription_qib?: number;
    subscription_total?: number;
    created_at?: string;
    updated_at?: string;
}

export interface IPOGMP {
    id: number;
    ipo_name: string;
    gmp?: number;
    price?: number;
    gain_percent?: number;
    subject?: string;
    ipo_date?: string;
    open_date?: string;
    close_date?: string;
    allotment_date?: string;
    listing_date?: string;
    created_at?: string;
    updated_at?: string;
}

export interface ShareholderIntel {
    id: number;
    ipo_name: string;
    parent_company?: string;
    sebi_status?: string;
    created_at?: string;
    updated_at?: string;
}

export interface AllotmentLink {
    id: number;
    ipo_name: string;
    registrar: string;
    link_url: string;
    link_type?: 'allotment' | 'refund' | 'status';
    is_active?: boolean;
    created_at?: string;
    updated_at?: string;
}

export interface GMPHistory {
    id: number;
    ipo_name: string;
    gmp: number;
    price: number;
    gain_percent?: number;
    recorded_at?: string;
}
</file>

<file path="lib/utils.ts">
import { clsx, type ClassValue } from "clsx";
import { twMerge } from "tailwind-merge";

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}
</file>

<file path="next-env.d.ts">
/// <reference types="next" />
/// <reference types="next/image-types/global" />
/// <reference path="./.next/types/routes.d.ts" />

// NOTE: This file should not be edited
// see https://nextjs.org/docs/app/api-reference/config/typescript for more information.
</file>

<file path="next.config.js">
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
}

module.exports = nextConfig
</file>

<file path="next.config.ts">
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
};

export default nextConfig;
</file>

<file path="package.json">
{
  "name": "ipo-tracker",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint"
  },
  "dependencies": {
    "@supabase/supabase-js": "^2.89.0",
    "clsx": "^2.1.1",
    "lucide-react": "^0.562.0",
    "next": "^15.1.3",
    "react": "^19.0.0",
    "react-dom": "^19.0.0",
    "tailwind-merge": "^3.4.0"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4.1.18",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "autoprefixer": "^10.4.23",
    "postcss": "^8.5.6",
    "tailwindcss": "^4.1.18",
    "typescript": "^5"
  }
}
</file>

<file path="postcss.config.mjs">
/** @type {import('postcss-load-config').Config} */
const config = {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};

export default config;
</file>

<file path="public/file.svg">
<svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z" clip-rule="evenodd" fill="#666" fill-rule="evenodd"/></svg>
</file>

<file path="public/globe.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g clip-path="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1" fill="#666"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"/></clipPath></defs></svg>
</file>

<file path="public/next.svg">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>
</file>

<file path="public/vercel.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1155 1000"><path d="m577.3 0 577.4 1000H0z" fill="#fff"/></svg>
</file>

<file path="public/window.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5" fill="#666"/></svg>
</file>

<file path="README.md">
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.
</file>

<file path="scripts/seed-data.sql">
-- =============================================
-- DUMMY DATA FOR IPO TRACKER
-- Run this in Supabase SQL Editor
-- =============================================

-- Update existing IPOs with more complete data
UPDATE public.ipos SET
    parent_company = 'Tata Motors Ltd',
    drhp_status = 'approved',
    rhp_status = 'approved',
    sebi_status = 'Approved',
    pre_ipo_promoter_holding_percent = 74.39,
    post_ipo_promoter_holding_percent = 59.15,
    company_description = 'Tata Technologies is a global engineering and product development digital services company. The company provides services to automotive and aerospace manufacturers worldwide.',
    industry_sector = 'IT Services & Consulting',
    key_highlights = '["Global leader in engineering and design services", "Serving top automotive and aerospace OEMs", "Strong presence in EV and sustainable mobility", "8 global delivery centers"]'::jsonb,
    strengths = '["Strong parentage with Tata Group brand value", "Diversified global client base", "Leadership in ER&D services", "High client retention rate of 95%+"]'::jsonb,
    concerns = '["Premium valuation compared to peers", "High dependence on automotive sector", "Forex exposure due to global operations"]'::jsonb,
    expert_rating = 4.2,
    rating_financial_performance = 4.5,
    rating_valuation = 3.8,
    rating_growth_prospects = 4.5,
    rating_management_quality = 4.2,
    rating_industry_outlook = 4.0,
    expert_recommendation = 'Subscribe for Long-term',
    risk_level = 'Medium',
    investment_horizon = 'Long-term',
    should_apply_yes_votes = 9823,
    should_apply_no_votes = 2720
WHERE ipo_name ILIKE '%Tata Technologies%';

UPDATE public.ipos SET
    parent_company = 'Honasa Consumer Pvt Ltd',
    drhp_status = 'approved',
    rhp_status = 'approved',
    sebi_status = 'Approved',
    pre_ipo_promoter_holding_percent = 35.72,
    post_ipo_promoter_holding_percent = 32.95,
    company_description = 'Mamaearth is a leading direct-to-consumer (D2C) beauty and personal care brand in India, known for its toxin-free products.',
    industry_sector = 'FMCG - Personal Care',
    key_highlights = '["#1 D2C beauty brand in India", "Toxin-free & sustainable products", "Strong digital presence", "Celebrity-backed brand"]'::jsonb,
    strengths = '["Strong brand recognition", "High growth trajectory", "Omnichannel distribution", "Repeat customer base"]'::jsonb,
    concerns = '["High marketing expenses", "Intense competition from FMCG giants", "Path to profitability unclear"]'::jsonb,
    expert_rating = 3.5,
    rating_financial_performance = 3.0,
    rating_valuation = 3.2,
    rating_growth_prospects = 4.2,
    rating_management_quality = 3.8,
    rating_industry_outlook = 4.0,
    expert_recommendation = 'Subscribe for Long-term',
    risk_level = 'High',
    investment_horizon = 'Long-term'
WHERE ipo_name ILIKE '%Mamaearth%' OR ipo_name ILIKE '%Honasa%';

UPDATE public.ipos SET
    parent_company = 'Jio Financial Services Ltd',
    drhp_status = 'approved',
    rhp_status = 'approved',
    sebi_status = 'Approved',
    pre_ipo_promoter_holding_percent = 100,
    post_ipo_promoter_holding_percent = 92.5,
    company_description = 'Jio Financial Services is a financial services company part of Reliance Industries, offering lending, insurance, and wealth management services.',
    industry_sector = 'Financial Services',
    key_highlights = '["Backed by Reliance Industries", "Tech-first financial services", "Pan-India digital reach", "Partnership with BlackRock"]'::jsonb,
    strengths = '["Strong parent company support", "Digital-first approach", "Massive customer base from Jio", "Low cost of acquisition"]'::jsonb,
    concerns = '["New entrant in financial services", "Competition from established players", "Regulatory uncertainties"]'::jsonb,
    expert_rating = 4.0,
    rating_financial_performance = 3.5,
    rating_valuation = 3.8,
    rating_growth_prospects = 4.5,
    rating_management_quality = 4.2,
    rating_industry_outlook = 4.0,
    expert_recommendation = 'Subscribe',
    risk_level = 'Medium',
    investment_horizon = 'Long-term'
WHERE ipo_name ILIKE '%Jio Financial%';

UPDATE public.ipos SET
    parent_company = 'Hyundai Motor Company, South Korea',
    drhp_status = 'approved',
    rhp_status = 'approved',
    sebi_status = 'Approved',
    pre_ipo_promoter_holding_percent = 100,
    post_ipo_promoter_holding_percent = 82.5,
    company_description = 'Hyundai Motor India is the second-largest car manufacturer in India, offering a wide range of vehicles from hatchbacks to SUVs.',
    industry_sector = 'Automobile',
    key_highlights = '["#2 car manufacturer in India", "Strong SUV portfolio (Creta, Venue)", "EV leadership with Ioniq", "Export hub for Hyundai global"]'::jsonb,
    strengths = '["Market leader in SUV segment", "Strong brand recall", "Wide dealer network", "Profitability leader in auto sector"]'::jsonb,
    concerns = '["Competition from Tata, Maruti", "EV transition challenges", "Chip shortage impact"]'::jsonb,
    expert_rating = 4.5,
    rating_financial_performance = 4.8,
    rating_valuation = 4.0,
    rating_growth_prospects = 4.2,
    rating_management_quality = 4.5,
    rating_industry_outlook = 4.0,
    expert_recommendation = 'Subscribe',
    risk_level = 'Low',
    investment_horizon = 'Long-term'
WHERE ipo_name ILIKE '%Hyundai%';

UPDATE public.ipos SET
    parent_company = 'NTPC Ltd',
    drhp_status = 'approved', 
    rhp_status = 'approved',
    sebi_status = 'Approved',
    pre_ipo_promoter_holding_percent = 100,
    post_ipo_promoter_holding_percent = 88.25,
    company_description = 'NTPC Green Energy is the renewable energy arm of NTPC, focusing on solar, wind, and green hydrogen projects.',
    industry_sector = 'Renewable Energy',
    key_highlights = '["Backed by NTPC (Maharatna PSU)", "15 GW renewable capacity target", "Green hydrogen focus", "Government backing for renewables"]'::jsonb,
    strengths = '["Strong parent company", "Government push for green energy", "Massive project pipeline", "Tech expertise from NTPC"]'::jsonb,
    concerns = '["Execution risks in renewable projects", "Land acquisition challenges", "Policy dependency"]'::jsonb,
    expert_rating = 4.0,
    rating_financial_performance = 3.5,
    rating_valuation = 4.0,
    rating_growth_prospects = 4.5,
    rating_management_quality = 4.0,
    rating_industry_outlook = 4.5,
    expert_recommendation = 'Subscribe for Long-term',
    risk_level = 'Medium',
    investment_horizon = 'Long-term'
WHERE ipo_name ILIKE '%NTPC Green%';

UPDATE public.ipos SET
    parent_company = 'Bundl Technologies Pvt Ltd',
    drhp_status = 'approved',
    rhp_status = 'approved',
    sebi_status = 'Approved',
    pre_ipo_promoter_holding_percent = 8.82,
    post_ipo_promoter_holding_percent = 6.51,
    company_description = 'Swiggy is one of leading food delivery and quick commerce platforms in India, operating Swiggy Food, Instamart, and Dineout.',
    industry_sector = 'E-commerce - Food Tech',
    key_highlights = '["Top 2 food delivery platform in India", "Quick commerce through Instamart", "Restaurant discovery via Dineout", "Strong unit economics improvements"]'::jsonb,
    strengths = '["Strong brand recognition", "Multiple revenue streams", "Improving unit economics", "Large customer base"]'::jsonb,
    concerns = '["Path to profitability", "Intense competition with Zomato", "High cash burn", "Gig worker regulations"]'::jsonb,
    expert_rating = 3.8,
    rating_financial_performance = 3.0,
    rating_valuation = 3.5,
    rating_growth_prospects = 4.5,
    rating_management_quality = 4.0,
    rating_industry_outlook = 4.0,
    expert_recommendation = 'Subscribe for Long-term',
    risk_level = 'High',
    investment_horizon = 'Long-term'
WHERE ipo_name ILIKE '%Swiggy%';

-- Insert sample GMP history
INSERT INTO public.gmp_history (ipo_id, ipo_name, gmp_amount, gmp_percentage, issue_price, expected_listing_price, recorded_at)
SELECT 
    id,
    ipo_name,
    FLOOR(RANDOM() * 100 + 20)::int,
    ROUND((RANDOM() * 30 + 5)::numeric, 2),
    max_price,
    max_price + FLOOR(RANDOM() * 100 + 20)::int,
    NOW() - (INTERVAL '1 day' * generate_series)
FROM public.ipos,
     generate_series(1, 10)
WHERE ipo_name ILIKE '%Tata Technologies%'
ON CONFLICT DO NOTHING;

-- Insert sample comments
INSERT INTO public.ipo_comments (ipo_id, user_name, user_email, comment_text, should_apply_vote, is_approved, created_at)
SELECT 
    id,
    'Investor ' || (ROW_NUMBER() OVER ()),
    'investor' || (ROW_NUMBER() OVER ()) || '@example.com',
    CASE (ROW_NUMBER() OVER ()) % 5
        WHEN 0 THEN 'Great IPO, strong fundamentals. Definitely applying!'
        WHEN 1 THEN 'Valuation seems stretched but long-term prospects are good.'
        WHEN 2 THEN 'Applied from multiple demat accounts. Hoping for allotment!'
        WHEN 3 THEN 'GMP is very high, might correct post listing. Be careful.'
        WHEN 4 THEN 'Solid company with good management. Subscribe for long term.'
    END,
    CASE WHEN RANDOM() > 0.3 THEN 'Yes' ELSE 'No' END,
    true,
    NOW() - (INTERVAL '1 hour' * (ROW_NUMBER() OVER ()))
FROM public.ipos
LIMIT 20
ON CONFLICT DO NOTHING;

-- Update allotment links with ipo_id
UPDATE public.ipo_allotment_links al
SET ipo_id = i.id
FROM public.ipos i
WHERE al.ipo_name ILIKE i.ipo_name
AND al.ipo_id IS NULL;

SELECT 'Data update complete! Check your tables.' as status;
</file>

<file path="tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": [
      "dom",
      "dom.iterable",
      "esnext"
    ],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": [
        "./*"
      ]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts"
  ],
  "exclude": [
    "node_modules"
  ]
}
</file>

</files>
</file>

<file path="frontend/app/globals.css">
/* Google Fonts Import */
@import url('https://fonts.googleapis.com/css2?family=Archivo+Black&family=Inter:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap');

* {
  box-sizing: border-box;
  padding: 0;
  margin: 0;
}

:root {
  /* Elegant Theme Color Palette */
  --beige: #e8e5d6;
  --beige-dark: #d0cbb8;
  --teal-dark: #1a3a3a;
  --teal-mid: #2d4a4a;
  --teal-light: #2d5555;
  --accent-green: #22c55e;
  --accent-blue: #3b82f6;

  /* Core Colors (mapped to elegant theme) */
  --yellow: #e8e5d6;
  --red: #FF3B30;
  --blue: #007AFF;
  --black: #1a3a3a;
  --white: #FFFFFF;
  --gray: #e8e5d6;
  --dark-bg: #e8e5d6;

  /* Semantic Colors */
  --color-primary: var(--yellow);
  --color-accent: var(--red);
  --color-positive: var(--blue);
  --color-negative: var(--red);

  /* Text Colors */
  --color-text-primary: var(--black);
  --color-text-secondary: #333333;
  --color-text-muted: #666666;

  /* Background Colors */
  --color-bg-primary: var(--white);
  --color-bg-secondary: var(--gray);
  --color-bg-tertiary: #EBEBEB;
  --color-bg-card: #f5f5eb;

  /* Border Colors */
  --color-border: var(--black);
  --color-border-light: #CCCCCC;

  /* Status Colors */
  --color-success: #10b981;
  --color-success-light: #d1fae5;
  --color-warning: #f59e0b;
  --color-warning-light: #fef3c7;
  --color-error: var(--red);
  --color-error-light: #fee2e2;
  --color-info: var(--blue);
  --color-info-light: #dbeafe;

  /* ============================================
     RESPONSIVE TYPOGRAPHY SCALE
     Uses clamp() for fluid sizing across all devices:
     - Mobile: 320px
     - Tablet: 768px  
     - Laptop: 1024px
     - Desktop: 1440px
     - Large Monitor: 1920px+
     ============================================ */

  /* Base font size - scales from 14px (mobile) to 18px (large screens) */
  --font-size-base: clamp(0.875rem, 0.8rem + 0.4vw, 1.125rem);

  /* Small text */
  --font-size-xs: clamp(0.625rem, 0.575rem + 0.25vw, 0.8125rem);
  --font-size-sm: clamp(0.75rem, 0.7rem + 0.3vw, 0.9375rem);

  /* Regular text */
  --font-size-md: clamp(0.875rem, 0.8rem + 0.4vw, 1.125rem);
  --font-size-lg: clamp(1rem, 0.9rem + 0.5vw, 1.25rem);

  /* Large text */
  --font-size-xl: clamp(1.125rem, 1rem + 0.6vw, 1.5rem);
  --font-size-2xl: clamp(1.25rem, 1.1rem + 0.8vw, 1.75rem);
  --font-size-3xl: clamp(1.5rem, 1.3rem + 1vw, 2.25rem);

  /* Headings */
  --font-size-h1: clamp(1.75rem, 1.4rem + 1.75vw, 3.5rem);
  --font-size-h2: clamp(1.5rem, 1.25rem + 1.25vw, 2.75rem);
  --font-size-h3: clamp(1.25rem, 1.1rem + 0.75vw, 2rem);
  --font-size-h4: clamp(1.125rem, 1rem + 0.6vw, 1.5rem);

  /* Spacing */
  --spacing-xs: clamp(0.375rem, 0.3rem + 0.25vw, 0.625rem);
  --spacing-sm: clamp(0.75rem, 0.65rem + 0.4vw, 1.25rem);
  --spacing-md: clamp(1rem, 0.9rem + 0.5vw, 1.75rem);
  --spacing-lg: clamp(1.5rem, 1.3rem + 0.75vw, 2.5rem);
  --spacing-xl: clamp(2rem, 1.7rem + 1.25vw, 4rem);

  /* Border Radius - Brutalist is sharp */
  --radius-sm: 0;
  --radius-md: 0;
  --radius-lg: 0;
  --radius-xl: 0;

  /* Brutalist Shadows - Hard offset shadows */
  --shadow-xs: 2px 2px 0 var(--black);
  --shadow-sm: 3px 3px 0 var(--black);
  --shadow-md: 4px 4px 0 var(--black);
  --shadow-lg: 6px 6px 0 var(--black);
  --shadow-xl: 8px 8px 0 var(--black);
  --shadow-card: 4px 4px 0 var(--black);
  --shadow-card-hover: 6px 6px 0 var(--black);

  /* Transitions */
  --transition-fast: all 0.1s ease;
  --transition-base: all 0.15s ease;
  --transition-slow: all 0.2s ease;

  /* Typography */
  --font-heading: 'Archivo Black', sans-serif;
  --font-body: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  --font-mono: 'Space Mono', monospace;
}

html {
  /* This makes 1rem scale with viewport */
  font-size: 100%;
}

body {
  max-width: 100vw;
  overflow-x: hidden;
  font-family: var(--font-body);
  color: var(--color-text-primary);
  background: var(--color-bg-secondary);
  line-height: 1.6;
  font-size: var(--font-size-base);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

a {
  color: inherit;
  text-decoration: none;
  transition: var(--transition-base);
}

a:hover {
  color: var(--color-text-primary);
}

button {
  cursor: pointer;
  border: none;
  outline: none;
  font-family: var(--font-body);
  font-size: var(--font-size-base);
  transition: var(--transition-base);
}

button:focus-visible {
  outline: 3px solid var(--yellow);
  outline-offset: 2px;
}

h1 {
  font-family: var(--font-heading);
  font-weight: 400;
  line-height: 1.1;
  color: var(--color-text-primary);
  text-transform: uppercase;
  letter-spacing: -0.02em;
  font-size: var(--font-size-h1);
}

h2 {
  font-family: var(--font-heading);
  font-weight: 400;
  line-height: 1.1;
  color: var(--color-text-primary);
  text-transform: uppercase;
  letter-spacing: -0.02em;
  font-size: var(--font-size-h2);
}

h3 {
  font-family: var(--font-heading);
  font-weight: 400;
  line-height: 1.1;
  color: var(--color-text-primary);
  text-transform: uppercase;
  letter-spacing: -0.02em;
  font-size: var(--font-size-h3);
}

h4,
h5,
h6 {
  font-family: var(--font-heading);
  font-weight: 400;
  line-height: 1.1;
  color: var(--color-text-primary);
  text-transform: uppercase;
  letter-spacing: -0.02em;
  font-size: var(--font-size-h4);
}

p {
  font-size: var(--font-size-base);
}

/* Container */
.container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 0 var(--spacing-md);
}

/* Utility Classes */
.text-muted {
  color: var(--color-text-muted);
}

.text-secondary {
  color: var(--color-text-secondary);
}

.text-xs {
  font-size: var(--font-size-xs);
}

.text-sm {
  font-size: var(--font-size-sm);
}

.text-md {
  font-size: var(--font-size-md);
}

.text-lg {
  font-size: var(--font-size-lg);
}

.text-xl {
  font-size: var(--font-size-xl);
}

.text-2xl {
  font-size: var(--font-size-2xl);
}

.text-3xl {
  font-size: var(--font-size-3xl);
}

/* Brutalist Card Styles */
.card {
  background: var(--color-bg-card);
  border: 4px solid var(--black);
  padding: var(--spacing-md);
  box-shadow: var(--shadow-card);
  transition: var(--transition-slow);
  position: relative;
}

.card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 8px;
  background: var(--yellow);
}

.card:hover {
  box-shadow: var(--shadow-card-hover);
  transform: rotate(1deg) translateY(-4px);
}

/* Badge Styles - Brutalist */
.badge {
  display: inline-flex;
  align-items: center;
  padding: var(--spacing-xs) var(--spacing-sm);
  font-size: var(--font-size-xs);
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  font-family: var(--font-body);
  border: 2px solid var(--black);
}

.badge-success {
  background-color: var(--black);
  color: var(--yellow);
}

.badge-warning {
  background-color: var(--yellow);
  color: var(--black);
}

.badge-info {
  background-color: var(--blue);
  color: var(--white);
}

.badge-error,
.badge-live {
  background-color: var(--red);
  color: var(--white);
  animation: pulse-live 1.5s ease-in-out infinite;
}

/* Brutalist Button Styles */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-sm) var(--spacing-md);
  font-weight: 700;
  font-size: var(--font-size-sm);
  text-align: center;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  transition: var(--transition-base);
  border: 3px solid var(--black);
  font-family: var(--font-body);
}

.btn-primary {
  background: var(--black);
  color: var(--yellow);
}

.btn-primary:hover {
  background: var(--yellow);
  color: var(--black);
  transform: rotate(-2deg);
  box-shadow: var(--shadow-md);
}

.btn-secondary {
  background-color: var(--white);
  color: var(--black);
}

.btn-secondary:hover {
  background-color: var(--yellow);
  transform: rotate(-2deg);
}

.btn-outline {
  background-color: transparent;
  border: 3px solid var(--black);
  color: var(--black);
}

.btn-outline:hover {
  background: var(--black);
  color: var(--yellow);
}

/* Animations */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(8px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(16px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes pulse-live {

  0%,
  100% {
    transform: scale(1);
    box-shadow: 0 0 0 0 rgba(255, 59, 48, 0.4);
  }

  50% {
    transform: scale(1.05);
    box-shadow: 0 0 0 8px rgba(255, 59, 48, 0);
  }
}

@keyframes rotate-shake {

  0%,
  100% {
    transform: rotate(-1deg);
  }

  50% {
    transform: rotate(1deg);
  }
}

.fade-in {
  animation: fadeIn 0.4s ease forwards;
}

.slide-up {
  animation: slideUp 0.5s ease forwards;
}

/* Focus states for accessibility */
*:focus-visible {
  outline: 3px solid var(--yellow);
  outline-offset: 2px;
}

/* Selection styling */
::selection {
  background-color: var(--yellow);
  color: var(--black);
}

/* Scrollbar styling - Brutalist */
::-webkit-scrollbar {
  width: 12px;
  height: 12px;
}

::-webkit-scrollbar-track {
  background: var(--gray);
  border: 2px solid var(--black);
}

::-webkit-scrollbar-thumb {
  background: var(--black);
}

::-webkit-scrollbar-thumb:hover {
  background: var(--color-text-secondary);
}
</file>

<file path="frontend/app/page.module.css">
/* ============================================
   Homepage Layout - Elegant Theme
   ============================================ */

.homepage {
  min-height: 100vh;
  background: linear-gradient(135deg, #1a3a3a 0%, #2c5f5f 50%, #1a3a3a 100%);
}

.loadingContainer {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: var(--beige, #e8e5d6);
  gap: 1.5rem;
}

.loader {
  width: 48px;
  height: 48px;
  border: 4px solid var(--teal-dark, #1a3a3a);
  border-top-color: var(--accent-green, #22c55e);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

.loadingText {
  font-size: 1rem;
  font-family: var(--font-body);
  color: var(--teal-dark, #1a3a3a);
  text-transform: uppercase;
  letter-spacing: 0.1em;
}

/* Hero Section - Teal Gradient */
.heroSection {
  background: linear-gradient(135deg, #1a3a3a 0%, #2d5555 50%, #1a3a3a 100%);
  padding: 5rem 3rem 6rem;
  position: relative;
  overflow: hidden;
}

.heroSection::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background:
    radial-gradient(circle at 20% 50%, rgba(34, 197, 94, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 80% 80%, rgba(59, 130, 246, 0.1) 0%, transparent 50%);
  pointer-events: none;
}

.heroContent {
  width: 100%;
  max-width: none;
  margin: 0 auto;
  padding: 0 5%;
  position: relative;
  z-index: 1;
  display: grid;
  grid-template-columns: 1.2fr 1fr;
  gap: 8rem;
  align-items: center;
}

/* Slightly reduce gap on medium-large screens */
@media (min-width: 1600px) {
  .heroContent {
    gap: 12rem;
  }
}

@media (min-width: 2000px) {
  .heroContent {
    gap: 16rem;
  }
}

.heroText {
  /* Text section on the left */
}

/* Hero Badge */
.heroBadge {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  padding: 0.5rem 1.25rem;
  border-radius: 50px;
  margin-bottom: 2rem;
  animation: fadeInDown 0.8s ease-out;
}

.pulseDot {
  width: 8px;
  height: 8px;
  background: var(--accent-green, #22c55e);
  border-radius: 50%;
  animation: pulse 2s infinite;
}

@keyframes pulse {

  0%,
  100% {
    opacity: 1;
    transform: scale(1);
  }

  50% {
    opacity: 0.5;
    transform: scale(1.2);
  }
}

.badgeText {
  color: #fff;
  font-size: 0.9rem;
  font-weight: 500;
}

.heroTitle {
  font-size: 4.5rem;
  font-weight: 900;
  font-family: var(--font-heading, 'Inter', sans-serif);
  color: #fff;
  line-height: 1.1;
  margin-bottom: 1.5rem;
  letter-spacing: -2px;
  animation: fadeInUp 0.8s ease-out 0.2s both;
}

.gradientText {
  background: linear-gradient(135deg, #22c55e 0%, #3b82f6 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  display: inline-block;
}

.heroSubtitle {
  font-size: 1.35rem;
  font-family: var(--font-body, 'Inter', sans-serif);
  color: rgba(255, 255, 255, 0.85);
  max-width: 700px;
  line-height: 1.6;
  margin-bottom: 2.5rem;
  animation: fadeInUp 0.8s ease-out 0.4s both;
}

/* Hero Stats */
.heroStats {
  display: flex;
  gap: 3rem;
  animation: fadeInUp 0.8s ease-out 0.6s both;
}

.statItem {
  display: flex;
  flex-direction: column;
}

.statNumber {
  font-size: 2.5rem;
  font-weight: 800;
  color: var(--accent-green, #22c55e);
  line-height: 1;
  margin-bottom: 0.5rem;
}

.statLabel {
  font-size: 0.95rem;
  color: rgba(255, 255, 255, 0.7);
  font-weight: 500;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fadeInDown {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Hero Card - Floating on Right */
@keyframes float {

  0%,
  100% {
    transform: translateY(0px);
  }

  50% {
    transform: translateY(-20px);
  }
}

@keyframes blink {

  0%,
  100% {
    opacity: 1;
  }

  50% {
    opacity: 0.3;
  }
}

/* Container for stacked cards */
.heroCardsContainer {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.heroCard {
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 24px;
  padding: 2rem;
  transition: all 0.4s ease;
  animation: float 6s ease-in-out infinite;
}

.heroCardSecond {
  animation-delay: -3s;
  /* Offset animation for visual interest */
}

.heroCard:hover {
  transform: translateY(-10px) scale(1.02);
  box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
}

/* Upcoming badge (yellow) */
.upcomingBadge {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  background: #ffd93d;
  padding: 0.5rem 1rem;
  border-radius: 20px;
  font-size: 0.85rem;
  font-weight: 600;
  color: #1a2e2e;
}

.upcomingDot {
  width: 8px;
  height: 8px;
  background: #1a2e2e;
  border-radius: 50%;
}

.cardHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
}

.cardTitle {
  font-size: 1.5rem;
  font-weight: 700;
  color: #fff;
  margin: 0;
}

.liveBadge {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  background: #ff3b3b;
  padding: 0.5rem 1rem;
  border-radius: 20px;
  font-size: 0.85rem;
  font-weight: 600;
  color: white;
}

.liveDot {
  width: 8px;
  height: 8px;
  background: white;
  border-radius: 50%;
  animation: blink 1.5s infinite;
}

.cardMetrics {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.metric {
  text-align: center;
}

.metricLabel {
  font-size: 0.8rem;
  color: rgba(255, 255, 255, 0.6);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: 0.5rem;
}

.metricValue {
  font-size: 2rem;
  font-weight: 700;
  color: #3fffc3;
}

.positive {
  color: #00d9a3 !important;
}

.cardFooter {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-top: 1.5rem;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.cardFooterItem {
  display: flex;
  flex-direction: column;
}

.footerLabel {
  font-size: 0.85rem;
  color: rgba(255, 255, 255, 0.6);
  margin-bottom: 0.3rem;
}

.footerValue {
  font-size: 1.1rem;
  font-weight: 600;
  color: #3fffc3;
}

/* Container - Matches page gradient */
.container {
  width: 100%;
  max-width: none;
  margin: 0 auto;
  padding: 4rem 5%;
  background: transparent;
}

/* Cards Grid - 320px allows 3 cards on 15" laptops (~1366px) */
.cardsGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  gap: 1.5rem;
  margin-bottom: 4rem;
}

/* Force 3 columns on medium-large screens */
@media (min-width: 1100px) {
  .cardsGrid {
    grid-template-columns: repeat(3, 1fr);
  }
}

.noFeatured {
  grid-column: 1 / -1;
  text-align: center;
  padding: 3rem;
  background: rgba(26, 58, 58, 0.05);
  border: 2px solid rgba(26, 58, 58, 0.1);
  border-radius: 8px;
  color: var(--teal-mid, #2d4a4a);
  font-family: var(--font-body);
}

.noFeaturedSub {
  margin-top: 0.5rem;
  color: var(--teal-mid, #2d4a4a);
  opacity: 0.7;
  font-size: 0.875rem;
}

/* Legacy styles - keep for compatibility */
.featuredGrid {
  composes: cardsGrid;
}

.heroBottom {
  display: none;
}

.noAnalysisTiles {
  display: none;
}

/* Section Styling - Elegant Theme */
.dashboardSection,
.filtersSection,
.heatmapSection,
.calendarSection,
.comparisonSection {
  width: 100%;
  max-width: none;
  margin: 0 auto;
  padding: 3rem 5%;
  position: relative;
}

/* Hide the calculator section */
.calculatorSection {
  display: none;
}

.dashboardSection::after,
.heatmapSection::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 2rem;
  right: 2rem;
  height: 2px;
  background: var(--beige-dark, #d0cbb8);
}

.filtersSection::after,
.comparisonSection::after,
.calendarSection::after {
  display: none;
}

.filtersSection {
  padding-top: 1.5rem;
  padding-bottom: 1.5rem;
}

/* Heatmap and Calendar side by side layout */
.heatmapSection {
  float: left;
  width: calc(65% - 1rem);
  margin-right: 1rem;
  padding-bottom: 2rem;
  display: flex;
  flex-direction: column;
}

.heatmapSection::after {
  display: none;
}

.heatmapSection>* {
  flex: 1;
}

.calendarSection {
  float: left;
  width: 35%;
  padding-top: 3rem;
  padding-bottom: 2rem;
  display: flex;
  flex-direction: column;
}

.calendarSection>* {
  flex: 1;
}

/* Clear float after calendar */
.comparisonSection {
  clear: both;
  overflow: visible;
}

/* Table should scroll horizontally */
.comparisonSection :global(.tableWrapper) {
  overflow-x: auto;
  max-width: 100%;
}

.sectionTitle {
  font-size: 1.75rem;
  font-family: var(--font-heading);
  color: var(--teal-dark, #1a3a3a);
  margin-bottom: 1.5rem;
  display: inline-block;
  background: var(--beige-dark, #d0cbb8);
  padding: 0.5rem 1.5rem;
  border-radius: 4px;
  text-transform: uppercase;
}

.sectionTitle::before {
  display: none;
}

/* Responsive Design */

/* Large tablets and small desktops */
@media (max-width: 1200px) {
  .heroContent {
    gap: 8rem;
  }

  .cardsGrid {
    grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
  }
}

@media (max-width: 1024px) {
  .heroBottom {
    grid-template-columns: repeat(2, 1fr);
  }

  .heroContent {
    grid-template-columns: 1fr;
    gap: 2.5rem;
  }

  .heroCardsContainer {
    display: flex;
    flex-direction: row;
    gap: 1rem;
    overflow-x: auto;
    padding-bottom: 1rem;
    -webkit-overflow-scrolling: touch;
  }

  .heroCard {
    min-width: 300px;
    flex-shrink: 0;
  }

  .heroTitle {
    font-size: 3.5rem;
  }

  .cardsGrid {
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
  }

  /* Side-by-side sections become stacked */
  .heatmapSection,
  .calendarSection {
    float: none;
    width: 100%;
    margin-right: 0;
  }
}

/* Tablets */
@media (max-width: 768px) {
  .heroSection {
    padding: 2.5rem 1.25rem 3rem;
  }

  .heroContent {
    grid-template-columns: 1fr;
    gap: 2rem;
  }

  .heroCardsContainer,
  .heroCard {
    display: none;
  }

  .heroTitle {
    font-size: 2.25rem;
    letter-spacing: -1px;
  }

  .heroSubtitle {
    font-size: 0.9375rem;
    margin-bottom: 1.5rem;
  }

  .heroBadge {
    padding: 0.4rem 1rem;
    margin-bottom: 1.5rem;
  }

  .badgeText {
    font-size: 0.8rem;
  }

  .heroStats {
    flex-direction: row;
    flex-wrap: wrap;
    gap: 1.5rem;
    justify-content: flex-start;
  }

  .statItem {
    min-width: 45%;
  }

  .statNumber {
    font-size: 2rem;
  }

  .statLabel {
    font-size: 0.875rem;
  }

  .cardsGrid,
  .featuredGrid {
    grid-template-columns: 1fr;
    padding: 0;
    gap: 1.25rem;
  }

  .heroBottom {
    padding: 0 1rem;
    gap: 1.25rem;
  }

  .sectionTitle {
    font-size: 1.375rem;
    padding: 0.375rem 1rem;
  }

  .container {
    padding: 2.5rem 1rem;
  }

  .dashboardSection,
  .filtersSection,
  .calculatorSection,
  .heatmapSection,
  .calendarSection,
  .comparisonSection {
    padding: 2rem 1rem;
    float: none;
    width: 100%;
    margin-right: 0;
  }

  .dashboardSection::after,
  .calculatorSection::after,
  .heatmapSection::after,
  .calendarSection::after {
    left: 1rem;
    right: 1rem;
  }
}

/* Mobile phones */
@media (max-width: 480px) {
  .heroSection {
    padding: 2rem 1rem 2.5rem;
  }

  .heroTitle {
    font-size: 1.875rem;
    letter-spacing: -0.5px;
  }

  .heroSubtitle {
    font-size: 0.875rem;
    line-height: 1.5;
  }

  .heroStats {
    flex-direction: column;
    gap: 1rem;
  }

  .statItem {
    min-width: 100%;
    flex-direction: row;
    align-items: center;
    justify-content: space-between;
  }

  .statNumber {
    font-size: 1.75rem;
  }

  .container {
    padding: 2rem 0.75rem;
  }

  .cardsGrid,
  .featuredGrid {
    gap: 1rem;
  }

  .sectionTitle {
    font-size: 1.125rem;
    padding: 0.25rem 0.75rem;
  }

  .dashboardSection,
  .filtersSection,
  .calculatorSection,
  .heatmapSection,
  .calendarSection,
  .comparisonSection {
    padding: 1.5rem 0.75rem;
  }
}
</file>

<file path="frontend/app/page.tsx">
'use client';

import { useEffect, useState } from 'react';
import styles from './page.module.css';
import FeaturedIPOCard from '@/components/homepage/FeaturedIPOCard';
import IPOCategoryChart from '@/components/homepage/IPOCategoryChart';
import DashboardTabs from '@/components/homepage/DashboardTabs';
import IPOFilters from '@/components/homepage/IPOFilters';
import ShouldIApplyCalculator from '@/components/homepage/ShouldIApplyCalculator';
import SubscriptionHeatmap from '@/components/homepage/SubscriptionHeatmap';
import IPOCalendarWidget from '@/components/homepage/IPOCalendarWidget';
import ComparisonTable from '@/components/homepage/ComparisonTable';
import {
  fetchFeaturedIPOs,
  fetchOpenIPOs,
} from '@/lib/api';

// Note: Metadata is handled in layout.tsx for client components
// ISR revalidation is set in the layout

export default function Home() {
  const [featuredIPOs, setFeaturedIPOs] = useState<any[]>([]);
  const [openIPOs, setOpenIPOs] = useState<any[]>([]);
  const [filteredCategory, setFilteredCategory] = useState('all');
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadData();
    const interval = setInterval(loadData, 120000); // Refresh every 2 minutes
    return () => clearInterval(interval);
  }, []);

  async function loadData() {
    try {
      const [featured, open] = await Promise.all([
        fetchFeaturedIPOs(),
        fetchOpenIPOs(),
      ]);
      setFeaturedIPOs(featured);
      setOpenIPOs(open);
    } catch (error) {
      console.error('Error loading homepage data:', error);
    } finally {
      setLoading(false);
    }
  }

  if (loading) {
    return (
      <div className={styles.loadingContainer}>
        <div className={styles.loader}></div>
        <p className={styles.loadingText}>Loading IPO Tracker...</p>
      </div>
    );
  }

  return (
    <main className={styles.homepage}>
      {/* Hero Section */}
      <section className={styles.heroSection}>
        <div className={styles.heroContent}>
          {/* Left side - Text */}
          <div className={styles.heroText}>
            <div className={styles.heroBadge}>
              <div className={styles.pulseDot}></div>
              <span className={styles.badgeText}>Real-Time Market Intelligence</span>
            </div>

            <h1 className={styles.heroTitle}>
              TRACK MARKET<br />
              <span className={styles.gradientText}>INTELLIGENCE</span><br />
              IN REAL-TIME
            </h1>

            <p className={styles.heroSubtitle}>
              Live GMP tracking, subscription data, and comprehensive IPO analysis for informed investment decisions
            </p>

            <div className={styles.heroStats}>
              <div className={styles.statItem}>
                <div className={styles.statNumber}>50+</div>
                <div className={styles.statLabel}>Active IPOs Tracked</div>
              </div>
              <div className={styles.statItem}>
                <div className={styles.statNumber}>Real-Time</div>
                <div className={styles.statLabel}>GMP Updates</div>
              </div>
              <div className={styles.statItem}>
                <div className={styles.statNumber}>100%</div>
                <div className={styles.statLabel}>Accurate Data</div>
              </div>
            </div>
          </div>

          {/* Right side - Floating Card */}
          {featuredIPOs.length > 0 && (
            <div className={styles.heroCard}>
              <div className={styles.cardHeader}>
                <h3 className={styles.cardTitle}>{featuredIPOs[0].company_name || 'TATA TECHNOLOGIES'}</h3>
                <div className={styles.liveBadge}>
                  <span className={styles.liveDot}></span>
                  LIVE
                </div>
              </div>
              <div className={styles.cardMetrics}>
                <div className={styles.metric}>
                  <div className={styles.metricLabel}>GMP</div>
                  <div className={styles.metricValue}>‚Çπ{featuredIPOs[0].current_gmp || 485}</div>
                </div>
                <div className={styles.metric}>
                  <div className={styles.metricLabel}>GAIN</div>
                  <div className={`${styles.metricValue} ${styles.positive}`}>+{featuredIPOs[0].expected_gain_percent || 97}%</div>
                </div>
                <div className={styles.metric}>
                  <div className={styles.metricLabel}>SUB</div>
                  <div className={styles.metricValue}>{featuredIPOs[0].subscription_total || 69.43}x</div>
                </div>
              </div>
              <div className={styles.cardFooter}>
                <div className={styles.cardFooterItem}>
                  <span className={styles.footerLabel}>Retail Subscription</span>
                  <span className={styles.footerValue}>{featuredIPOs[0].subscription_retail || 12.87}x</span>
                </div>
                <div className={styles.cardFooterItem}>
                  <span className={styles.footerLabel}>Issue Price</span>
                  <span className={styles.footerValue}>‚Çπ{featuredIPOs[0].price_band_low || 50}</span>
                </div>
                <div className={styles.cardFooterItem}>
                  <span className={styles.footerLabel}>Time Remaining</span>
                  <span className={styles.footerValue}>3 Days</span>
                </div>
              </div>
            </div>
          )}
        </div>
      </section>

      {/* Cards Section */}
      <div className={styles.container}>
        {/* Featured IPO Cards */}
        <div className={styles.cardsGrid}>
          {featuredIPOs.length > 0 ? (
            featuredIPOs.map((ipo: any) => (
              <FeaturedIPOCard key={ipo.id} ipo={ipo} />
            ))
          ) : (
            <div className={styles.noFeatured}>
              <p>üîç No featured IPOs available at the moment</p>
              <p className={styles.noFeaturedSub}>Check back soon for hot IPO opportunities!</p>
            </div>
          )}
        </div>

        {/* IPO Category Chart Section */}
        <IPOCategoryChart />
      </div>

      {/* Dashboard Section */}
      <section className={styles.dashboardSection}>
        <h2 className={styles.sectionTitle}>üìä Live Dashboard</h2>
        <DashboardTabs />
      </section>



      {/* Calculator */}
      <section className={styles.calculatorSection}>
        <h2 className={styles.sectionTitle}>üßÆ Should I Apply Calculator</h2>
        <ShouldIApplyCalculator ipos={openIPOs} />
      </section>

      {/* Heatmap */}
      <section className={styles.heatmapSection}>
        <h2 className={styles.sectionTitle}>üî• Heatmap</h2>
        <SubscriptionHeatmap />
      </section>

      {/* Calendar */}
      <section className={styles.calendarSection}>
        <h2 className={styles.sectionTitle}>üìÖ IPO Calendar</h2>
        <IPOCalendarWidget />
      </section>

      {/* Comparison Table */}
      <section className={styles.comparisonSection}>
        <h2 className={styles.sectionTitle}>üìã IPO Comparison Table</h2>
        <ComparisonTable category={filteredCategory} />
      </section>
    </main>
  );
}
</file>

<file path="frontend/components/homepage/FeaturedIPOCard.module.css">
/* ============================================
   Featured IPO Card - Cream/Teal Theme
   ============================================ */

.card {
    background: #f5f5eb;
    border: 4px solid #1a1a1a;
    overflow: visible;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    flex-direction: column;
    box-shadow: 8px 8px 0 rgba(0, 0, 0, 0.3);
    text-decoration: none;
    position: relative;
    transform: rotate(-1.5deg) translateZ(0);

    /* Advanced Rendering Optimization for Sharp Text */
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
    transform-style: preserve-3d;
    -webkit-font-smoothing: subpixel-antialiased;
    -moz-osx-font-smoothing: auto;
    will-change: transform;
    outline: 1px solid transparent;
    /* Anti-aliasing hack */
    perspective: 1000px;
}

.card:nth-child(4n+1) {
    transform: rotate(-1.5deg) translateZ(0);
}

.card:nth-child(4n+2) {
    transform: rotate(-1.5deg) translateZ(0);
}

.card:nth-child(4n+3) {
    transform: rotate(-1.5deg) translateZ(0);
}

.card:nth-child(4n) {
    transform: rotate(-1.5deg) translateZ(0);
}

/* Tilt animation on hover */
.card:hover {
    box-shadow: 10px 10px 0 rgba(0, 0, 0, 0.3);
    transform: rotate(0deg) translateY(-8px) scale(1.02);
    border-color: #1a1a1a;
}

.cardHeader {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: 24px;
    gap: 1rem;
    border-bottom: 3px solid #1a1a1a;
    background: #f5f5eb;
}

.titleSection {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.companyName {
    font-size: 20px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    font-weight: 700;
    color: #1a1a1a;
    line-height: 1.15;
    margin: 0;
    letter-spacing: -0.3px;
}

.badge {
    display: inline-flex;
    align-items: center;
    padding: 4px 12px;
    font-size: 11px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    width: fit-content;
    border: 2px solid #1a1a1a;
    background: transparent;
    color: #1a1a1a;
}

.smeBadge {
    background-color: transparent;
    color: #1a1a1a;
}

.mainboardBadge {
    background-color: transparent;
    color: #1a1a1a;
}

.statusSection {
    flex-shrink: 0;
}

.statusBadge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    font-size: 11px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    font-weight: 700;
    white-space: nowrap;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border: 2px solid #1a1a1a;
}

.openStatus {
    background-color: #ff4444;
    color: white;
    border-color: #1a1a1a;
}

.openStatus::before {
    content: '';
    width: 8px;
    height: 8px;
    background: currentColor;
    border-radius: 50%;
    animation: pulse-dot 1.5s ease-in-out infinite;
}

@keyframes pulse-dot {

    0%,
    100% {
        opacity: 1;
        transform: scale(1);
    }

    50% {
        opacity: 0.6;
        transform: scale(1.3);
    }
}

.upcomingStatus {
    background-color: #ffc107;
    color: #1a1a1a;
    border-color: #1a1a1a;
}

.upcomingStatus::before {
    content: '';
    width: 8px;
    height: 8px;
    background: #1a1a1a;
    border-radius: 50%;
}

.metricsRow {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0;
    background: #f5f5eb;
    border-bottom: 3px solid #1a1a1a;
    padding: 24px;
}

.metric {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 8px;
    padding: 0 12px;
    border-right: 2px solid #1a1a1a;
}

.metric:last-child {
    border-right: none;
}

.metricLabel {
    font-size: 11px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 600;
}

.metricValue {
    font-size: 28px;
    font-family: 'Courier New', Courier, monospace;
    font-weight: 700;
    color: #1a1a1a;
    line-height: 1.2;
}

.positive {
    color: #22c55e;
}

.negative {
    color: #ff4444;
}

.progressSection {
    padding: 20px 24px;
    background: #f5f5eb;
    border-bottom: 3px solid #1a1a1a;
}

.progressLabel {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    font-size: 13px;
    font-family: 'Courier New', Courier, monospace;
    font-weight: 600;
    color: #1a1a1a;
}

.timer {
    font-weight: 700;
    color: #1a1a1a;
    font-size: 12px;
}

.progressBar {
    width: 100%;
    height: 12px;
    background-color: #c4b9a4;
    border: 2px solid #1a1a1a;
    overflow: hidden;
}

.progressFill {
    height: 100%;
    transition: width 0.6s ease;
    background: #22c55e;
}

/* Footer with darker cream background */
.footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 24px;
    margin-top: auto;
    background: #c4b9a4;
}

.price {
    font-size: 15px;
    font-family: 'Courier New', Courier, monospace;
    font-weight: 600;
    color: #1a1a1a;
}

.viewDetails {
    padding: 10px 20px;
    background: #1a1a1a;
    color: #dfd8c8;
    text-decoration: none;
    font-size: 13px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    font-weight: 600;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    border: 2px solid #1a1a1a;
}

.card:hover .viewDetails {
    background: #2c5f5f;
    border-color: #1a1a1a;
}

/* Compatibility class names */
.featuredCard {
    composes: card;
}

.cardContent {
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    flex: 1;
    background: #dfd8c8;
}

.priceTag {
    text-align: right;
}

.currentPrice {
    font-size: 1.75rem;
    font-family: 'Courier New', Courier, monospace;
    font-weight: 700;
    color: #1a1a1a;
    line-height: 1;
}

.originalPrice {
    font-size: 0.875rem;
    color: #666;
    text-decoration: line-through;
    margin-top: 0.25rem;
}

.cardMetrics {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0;
    border: 2px solid #1a1a1a;
    overflow: hidden;
}

.cardMetrics .metric {
    border: none;
    border-right: 2px solid #1a1a1a;
    background: #dfd8c8;
}

.cardMetrics .metric:nth-child(2n) {
    border-right: none;
}

.gmpPositive {
    color: #22c55e;
}

.gmpNegative {
    color: #ff4444;
}

.subscriptionHigh {
    color: #22c55e;
}

.subscriptionMedium {
    color: #1a1a1a;
}

.subscriptionLow {
    color: #666;
}

.cardFooter {
    margin-top: auto;
}

.viewButton {
    width: 100%;
    padding: 1rem;
    background: #1a1a1a;
    color: #dfd8c8;
    border: none;
    font-size: 0.9375rem;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.viewButton:hover {
    background: #2c5f5f;
    color: #dfd8c8;
}

.statusOpen {
    background-color: #ff4444;
    color: white;
}

.statusClosing {
    background-color: #ffc107;
    color: #1a1a1a;
}

.statusUpcoming {
    background-color: #ffc107;
    color: #1a1a1a;
}

/* Tablets */
@media (max-width: 768px) {
    .card {
        transform: rotate(0deg);
        box-shadow: 6px 6px 0 rgba(0, 0, 0, 0.3);
    }

    .card:nth-child(2),
    .card:nth-child(3),
    .card:nth-child(4n+1),
    .card:nth-child(4n+2),
    .card:nth-child(4n+3),
    .card:nth-child(4n) {
        transform: rotate(0deg);
    }

    .card:hover {
        transform: translateY(-4px) scale(1.01);
    }

    .cardHeader {
        flex-direction: column;
        gap: 0.75rem;
        padding: 1.25rem;
    }

    .metricsRow {
        grid-template-columns: repeat(3, 1fr);
        gap: 0;
        padding: 1.25rem;
    }

    .metric {
        padding: 0 8px;
    }

    .metricValue {
        font-size: 24px;
    }

    .companyName {
        font-size: 1.125rem;
    }

    .footer {
        flex-direction: column;
        gap: 1rem;
        align-items: stretch;
    }

    .viewDetails {
        width: 100%;
        justify-content: center;
    }
}

/* Mobile phones */
@media (max-width: 480px) {
    .card {
        box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.25);
        border-width: 3px;
    }

    .cardHeader {
        padding: 1rem;
        border-bottom-width: 2px;
    }

    .titleSection {
        gap: 6px;
    }

    .companyName {
        font-size: 1rem;
        letter-spacing: -0.2px;
    }

    .badge {
        font-size: 10px;
        padding: 3px 10px;
    }

    .statusBadge {
        font-size: 10px;
        padding: 6px 12px;
    }

    .metricsRow {
        padding: 1rem;
        border-bottom-width: 2px;
    }

    .metric {
        padding: 0 6px;
        gap: 6px;
    }

    .metricLabel {
        font-size: 10px;
    }

    .metricValue {
        font-size: 20px;
    }

    .progressSection {
        padding: 1rem;
        border-bottom-width: 2px;
    }

    .progressLabel {
        font-size: 12px;
        margin-bottom: 10px;
    }

    .timer {
        font-size: 11px;
    }

    .progressBar {
        height: 10px;
    }

    .footer {
        padding: 1rem;
    }

    .price {
        font-size: 14px;
    }

    .viewDetails {
        padding: 10px 16px;
        font-size: 12px;
    }
}
</file>

<file path="frontend/components/homepage/SubscriptionHeatmap.module.css">
/* ============================================
   Heatmap - Treemap Style with Filters
   ============================================ */

.container {
    background: linear-gradient(145deg, #ebe4d1 0%, #e5dcc5 100%);
    border-radius: 8px;
    padding: 1.5rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

.loading {
    text-align: center;
    padding: 3rem;
    font-size: 1rem;
    color: #666;
}

/* Filter Controls */
.filterRow {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
}

.filterGroup {
    flex: 1;
    min-width: 150px;
}

.filterLabel {
    display: block;
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #666;
    margin-bottom: 0.375rem;
}

.filterSelect {
    width: 100%;
    padding: 0.625rem 0.75rem;
    background: #fafafa;
    border: 2px solid var(--black, #0a0a0a);
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--black, #0a0a0a);
    cursor: pointer;
    transition: all 0.2s ease;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%230a0a0a' d='M6 8L2 4h8z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 0.625rem center;
    padding-right: 2rem;
}

.filterSelect:hover {
    background-color: #f0f0f0;
}

.filterSelect:focus {
    outline: none;
    border-color: var(--yellow, #ffed4e);
    box-shadow: 0 0 0 3px rgba(255, 237, 78, 0.3);
}

/* Legend */
.legend {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1.25rem;
    padding: 0.75rem;
    background: #fafafa;
    border: 2px solid var(--black, #0a0a0a);
    margin-bottom: 1rem;
    flex-wrap: wrap;
    border-radius: 4px;
}

.legendItem {
    display: flex;
    align-items: center;
    gap: 0.375rem;
}

.legendBox {
    width: 18px;
    height: 18px;
    border: 2px solid var(--black, #0a0a0a);
    border-radius: 2px;
}

.legendItem span {
    font-size: 0.7rem;
    font-weight: 600;
    color: var(--black, #0a0a0a);
    text-transform: uppercase;
    letter-spacing: 0.03em;
}

/* Treemap Grid */
.treemap {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: 0.5rem;
    min-height: 300px;
}

.heatBox {
    padding: 0.75rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    transition: all 0.2s ease;
    cursor: pointer;
    border: 3px solid var(--black, #0a0a0a);
    text-decoration: none;
    color: #ffffff;
    overflow: hidden;
    border-radius: 4px;
    position: relative;
}

.heatBox::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.15) 0%, transparent 50%);
    pointer-events: none;
}

.heatBox:hover {
    transform: scale(1.03);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);
    z-index: 1;
}

/* Size variants for treemap effect */
.size1 {
    grid-column: span 1;
    grid-row: span 1;
    min-height: 80px;
}

.size2 {
    grid-column: span 1;
    grid-row: span 1;
    min-height: 100px;
}

.size3 {
    grid-column: span 2;
    grid-row: span 1;
    min-height: 100px;
}

.size4 {
    grid-column: span 2;
    grid-row: span 2;
    min-height: 140px;
}

.size5 {
    grid-column: span 2;
    grid-row: span 2;
    min-height: 160px;
}

.boxContent {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
    position: relative;
    z-index: 1;
}

.companyName {
    font-size: 0.7rem;
    font-weight: 700;
    line-height: 1.2;
    text-align: center;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    text-transform: uppercase;
    letter-spacing: 0.02em;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
}

.metricValue {
    font-size: 1.25rem;
    font-family: 'JetBrains Mono', 'Courier New', monospace;
    font-weight: 700;
    line-height: 1;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
}

.categoryBadge {
    font-size: 0.55rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: 0.15rem 0.4rem;
    background: rgba(0, 0, 0, 0.25);
    border: 1px solid rgba(255, 255, 255, 0.4);
    border-radius: 2px;
}

/* Larger boxes get bigger text */
.size3 .metricValue,
.size4 .metricValue,
.size5 .metricValue {
    font-size: 1.5rem;
}

.size4 .companyName,
.size5 .companyName {
    font-size: 0.85rem;
    -webkit-line-clamp: 3;
}

/* Empty State */
.empty {
    text-align: center;
    padding: 3rem;
    color: var(--black, #0a0a0a);
    min-height: 200px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.empty p {
    font-size: 1rem;
    color: #666;
}

/* Responsive Design */
@media (max-width: 768px) {
    .container {
        padding: 1rem;
    }

    .filterRow {
        gap: 0.75rem;
    }

    .filterGroup {
        min-width: 120px;
    }

    .filterSelect {
        padding: 0.5rem 0.625rem;
        font-size: 0.75rem;
    }

    .legend {
        gap: 0.75rem;
        padding: 0.625rem;
    }

    .treemap {
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
        gap: 0.375rem;
    }

    .heatBox {
        padding: 0.5rem;
        border-width: 2px;
    }

    .companyName {
        font-size: 0.6rem;
    }

    .metricValue {
        font-size: 1rem;
    }

    /* Simpler sizing on mobile */
    .size3,
    .size4,
    .size5 {
        grid-column: span 1;
        grid-row: span 1;
        min-height: 80px;
    }
}

@media (max-width: 480px) {
    .filterRow {
        flex-direction: column;
        gap: 0.5rem;
    }

    .filterGroup {
        min-width: 100%;
    }

    .treemap {
        grid-template-columns: repeat(2, 1fr);
    }
}
</file>

<file path="frontend/components/Navigation.module.css">
/* ============================================
   Elegant Navigation - Beige Theme
   ============================================ */

/* Top Promo Bar - Hidden in elegant theme */
.topBar {
  display: none;
}

.topBar::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 200%;
  height: 100%;
  background: linear-gradient(90deg,
      transparent 0%,
      rgba(255, 237, 78, 0.1) 50%,
      transparent 100%);
  animation: shimmer 4s infinite;
}

@keyframes shimmer {
  0% {
    transform: translateX(-50%);
  }

  100% {
    transform: translateX(50%);
  }
}

.topBarContent {
  max-width: 1280px;
  margin: 0 auto;
  padding: 0 1.5rem;
  display: flex;
  justify-content: center;
  align-items: center;
}

.promoText {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 0.875rem;
  font-family: var(--font-body);
  color: var(--yellow);
  font-weight: 700;
  letter-spacing: 0.1em;
  text-transform: uppercase;
}

.sparkle {
  display: flex;
  width: 16px;
  height: 16px;
  color: var(--yellow);
  animation: sparkle 1.5s ease-in-out infinite;
}

.sparkle svg {
  width: 100%;
  height: 100%;
}

@keyframes sparkle {

  0%,
  100% {
    transform: scale(1) rotate(0deg);
    opacity: 1;
  }

  50% {
    transform: scale(1.3) rotate(15deg);
    opacity: 0.8;
  }
}

/* Main Navbar - Teal Theme */
.navbar {
  background: linear-gradient(135deg, #1a3a3a 0%, #2c5f5f 50%, #1a3a3a 100%);
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  position: sticky;
  top: 0;
  z-index: 1000;
  transition: all 0.2s ease;
}

.navbar.scrolled {
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

.navMain {
  width: 100%;
  max-width: none;
  margin: 0 auto;
  padding: 0.875rem 5%;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

/* Logo Styles - Text only like reference */
.logo {
  display: flex;
  align-items: center;
  gap: 0;
  text-decoration: none;
  transition: opacity 0.2s ease;
}

.logo:hover {
  opacity: 0.8;
}

.logoIcon {
  display: none;
  /* Hide icon for cleaner look */
}

.logoText {
  font-size: 1.125rem;
  font-family: var(--font-heading, 'Inter', sans-serif);
  font-weight: 800;
  color: #ffffff;
  text-transform: uppercase;
  letter-spacing: -0.02em;
}

.logoAccent {
  color: #3fffc3;
}

/* Navigation Links - Right aligned, smaller fonts */
.navLinks {
  display: flex;
  gap: 1.5rem;
  align-items: center;
  list-style: none;
  margin: 0;
  padding: 0;
}

.navLink {
  display: flex;
  align-items: center;
  gap: 0.375rem;
  padding: 0.25rem 0;
  font-size: 0.8125rem;
  font-family: var(--font-body, 'Inter', sans-serif);
  font-weight: 600;
  color: rgba(255, 255, 255, 0.85);
  text-decoration: none;
  position: relative;
  transition: color 0.3s ease;
  border: none;
  background: transparent;
}

.navLink:hover {
  color: #3fffc3;
  background: transparent;
}

.navIcon {
  display: flex;
  width: 14px;
  height: 14px;
}

.navIcon svg {
  width: 100%;
  height: 100%;
}

.navLink:hover .navIcon {
  transform: none;
}

.navLabel {
  white-space: nowrap;
}

/* Active Link State - Underline highlight */
.activeLink {
  font-weight: 700;
}

.activeLink::after {
  content: '';
  position: absolute;
  bottom: -2px;
  left: 0;
  right: 0;
  height: 2px;
  background: var(--black);
}

.activeLink .navIcon {
  opacity: 1;
}

/* Highlighted Link (GMP) - Subtle emphasis */
.highlightLink {
  font-weight: 700;
}

.highlightLink:hover {
  opacity: 0.7;
}

/* Badge */
.navBadge {
  font-size: 0.625rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  padding: 0.25rem 0.5rem;
  background: var(--red);
  color: var(--white);
  animation: pulse-badge 1.5s infinite;
}

@keyframes pulse-badge {

  0%,
  100% {
    transform: scale(1);
  }

  50% {
    transform: scale(1.1);
  }
}

/* Mobile Menu Button */
.mobileMenuButton {
  display: none;
  align-items: center;
  justify-content: center;
  width: 48px;
  height: 48px;
  background: var(--black);
  border: 3px solid var(--black);
  color: var(--yellow);
  cursor: pointer;
  transition: all 0.15s ease;
}

.mobileMenuButton:hover {
  background: var(--yellow);
  color: var(--black);
  transform: rotate(-3deg);
}

.mobileMenuButton svg {
  width: 24px;
  height: 24px;
}

/* Mobile Menu */
.mobileMenu {
  display: none;
  background-color: var(--yellow);
  border-bottom: 4px solid var(--black);
  padding: 0;
  max-height: 0;
  overflow: hidden;
  transition: all 0.3s ease;
}

.mobileMenu.open {
  max-height: 500px;
  padding: 1rem 1.5rem 1.5rem;
}

.mobileNavLinks {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  list-style: none;
  margin: 0;
  padding: 0;
}

.mobileNavLink {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1rem 1.25rem;
  font-size: 1rem;
  font-family: var(--font-body);
  font-weight: 700;
  color: var(--black);
  text-decoration: none;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  transition: all 0.15s ease;
  background: var(--white);
  border: 3px solid var(--black);
}

.mobileNavLink:hover {
  background: var(--black);
  color: var(--yellow);
  transform: rotate(-1deg);
}

.mobileActiveLink {
  background: var(--black);
  color: var(--yellow);
}

.mobileNavIcon {
  display: flex;
  width: 22px;
  height: 22px;
  color: inherit;
}

.mobileNavIcon svg {
  width: 100%;
  height: 100%;
}

.mobileBadge {
  margin-left: auto;
  font-size: 0.6875rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  padding: 0.25rem 0.625rem;
  background: var(--red);
  color: var(--white);
}

/* ============================================
   Responsive Design
   ============================================ */

/* Large tablets */
@media (max-width: 1024px) {
  .navMain {
    padding: 0.75rem 1.5rem;
  }

  .navLinks {
    gap: 1rem;
  }

  .navLink {
    padding: 0.4rem 0.5rem;
    font-size: 0.75rem;
  }

  .navIcon {
    width: 14px;
    height: 14px;
  }

  .logoText {
    font-size: 1rem;
  }
}

/* Tablets - switch to mobile menu */
@media (max-width: 900px) {
  .navLinks {
    display: none;
  }

  .mobileMenuButton {
    display: flex;
    width: 44px;
    height: 44px;
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(255, 255, 255, 0.2);
    color: #fff;
  }

  .mobileMenuButton:hover {
    background: rgba(255, 255, 255, 0.2);
    color: #3fffc3;
    transform: none;
  }

  .mobileMenu {
    display: block;
    background: linear-gradient(135deg, #1a3a3a 0%, #2c5f5f 100%);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .mobileMenu.open {
    padding: 1rem;
  }

  .mobileNavLinks {
    gap: 0.5rem;
  }

  .mobileNavLink {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: #fff;
    padding: 1rem 1.25rem;
    border-radius: 8px;
  }

  .mobileNavLink:hover {
    background: rgba(255, 255, 255, 0.1);
    color: #3fffc3;
    transform: none;
  }

  .mobileActiveLink {
    background: rgba(63, 255, 195, 0.15);
    color: #3fffc3;
    border-color: rgba(63, 255, 195, 0.3);
  }

  .mobileNavIcon {
    color: currentColor;
  }

  .mobileBadge {
    background: #ff3b3b;
    color: #fff;
  }
}

/* Mobile phones */
@media (max-width: 480px) {
  .topBar {
    padding: 0.5rem 0;
  }

  .promoText {
    font-size: 0.6875rem;
    gap: 0.5rem;
  }

  .sparkle {
    width: 12px;
    height: 12px;
  }

  .navMain {
    padding: 0.625rem 0.75rem;
  }

  .logo {
    gap: 0;
  }

  .logoText {
    font-size: 0.9375rem;
  }

  .mobileMenuButton {
    width: 40px;
    height: 40px;
  }

  .mobileMenuButton svg {
    width: 20px;
    height: 20px;
  }

  .mobileMenu.open {
    padding: 0.75rem;
  }

  .mobileNavLink {
    padding: 0.875rem 1rem;
    font-size: 0.9375rem;
  }

  .mobileNavIcon {
    width: 20px;
    height: 20px;
  }
}
</file>

<file path="frontend/components/Navigation.tsx">
'use client';

import React from 'react';
import Link from 'next/link';
import { usePathname } from 'next/navigation';
import { useState, useEffect } from 'react';
import styles from './Navigation.module.css';

// Icons as inline SVGs for better control
const HomeIcon = () => (
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
    <polyline points="9 22 9 12 15 12 15 22" />
  </svg>
);

const CalendarIcon = () => (
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
    <line x1="16" y1="2" x2="16" y2="6" />
    <line x1="8" y1="2" x2="8" y2="6" />
    <line x1="3" y1="10" x2="21" y2="10" />
  </svg>
);

const UsersIcon = () => (
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
    <circle cx="9" cy="7" r="4" />
    <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
    <path d="M16 3.13a4 4 0 0 1 0 7.75" />
  </svg>
);

const TrendingIcon = () => (
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <polyline points="23 6 13.5 15.5 8.5 10.5 1 18" />
    <polyline points="17 6 23 6 23 12" />
  </svg>
);

const CheckCircleIcon = () => (
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
    <polyline points="22 4 12 14.01 9 11.01" />
  </svg>
);

const MenuIcon = () => (
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <line x1="3" y1="12" x2="21" y2="12" />
    <line x1="3" y1="6" x2="21" y2="6" />
    <line x1="3" y1="18" x2="21" y2="18" />
  </svg>
);

const CloseIcon = () => (
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <line x1="18" y1="6" x2="6" y2="18" />
    <line x1="6" y1="6" x2="18" y2="18" />
  </svg>
);

const SparkleIcon = () => (
  <svg viewBox="0 0 24 24" fill="currentColor">
    <path d="M12 0L14.59 8.41L23 11L14.59 13.59L12 22L9.41 13.59L1 11L9.41 8.41L12 0Z" />
  </svg>
);

export default function Navigation() {
  const pathname = usePathname();
  const [scrolled, setScrolled] = useState(false);
  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);

  useEffect(() => {
    const handleScroll = () => {
      setScrolled(window.scrollY > 20);
    };
    window.addEventListener('scroll', handleScroll);
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

  const navItems: { href: string; label: string; icon: React.FC; highlight?: boolean; badge?: string }[] = [
    { href: '/', label: 'Home', icon: HomeIcon },
    { href: '/upcoming-ipos', label: 'Upcoming IPOs', icon: CalendarIcon },
    { href: '/shareholders', label: 'Shareholders Category', icon: UsersIcon },
    { href: '/gmp', label: 'GMP', icon: TrendingIcon },
    { href: '/allotment', label: 'Check Allotment', icon: CheckCircleIcon },
    { href: '/portfolio-optimizer', label: 'üíº Portfolio Optimizer', icon: SparkleIcon, highlight: true },
  ];

  const isActive = (href: string) => {
    if (href === '/') return pathname === '/';
    return pathname.startsWith(href);
  };

  return (
    <>

      {/* Main Navigation */}
      <nav className={`${styles.navbar} ${scrolled ? styles.scrolled : ''}`}>
        <div className={styles.navMain}>
          {/* Logo */}
          <Link href="/" className={styles.logo}>
            <span className={styles.logoIcon}>
              <TrendingIcon />
            </span>
            <span className={styles.logoText}>
              IPO<span className={styles.logoAccent}>Tracker</span>
            </span>
          </Link>

          {/* Desktop Navigation */}
          <ul className={styles.navLinks}>
            {navItems.map((item) => {
              const Icon = item.icon;
              const active = isActive(item.href);
              return (
                <li key={item.href}>
                  <Link
                    href={item.href}
                    className={`${styles.navLink} ${active ? styles.activeLink : ''} ${item.highlight ? styles.highlightLink : ''}`}
                  >
                    <span className={styles.navIcon}><Icon /></span>
                    <span className={styles.navLabel}>{item.label}</span>
                    {item.badge && <span className={styles.navBadge}>{item.badge}</span>}
                  </Link>
                </li>
              );
            })}
          </ul>

          {/* Mobile Menu Button */}
          <button
            className={styles.mobileMenuButton}
            onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
            aria-label="Toggle menu"
          >
            {mobileMenuOpen ? <CloseIcon /> : <MenuIcon />}
          </button>
        </div>

        {/* Mobile Menu */}
        <div className={`${styles.mobileMenu} ${mobileMenuOpen ? styles.open : ''}`}>
          <ul className={styles.mobileNavLinks}>
            {navItems.map((item) => {
              const Icon = item.icon;
              const active = isActive(item.href);
              return (
                <li key={item.href}>
                  <Link
                    href={item.href}
                    className={`${styles.mobileNavLink} ${active ? styles.mobileActiveLink : ''}`}
                    onClick={() => setMobileMenuOpen(false)}
                  >
                    <span className={styles.mobileNavIcon}><Icon /></span>
                    <span>{item.label}</span>
                    {item.badge && <span className={styles.mobileBadge}>{item.badge}</span>}
                  </Link>
                </li>
              );
            })}
          </ul>
        </div>
      </nav>
    </>
  );
}
</file>

</files>
